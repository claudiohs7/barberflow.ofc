(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1867],{28247:function(e,a,s){Promise.resolve().then(s.bind(s,81523)),Promise.resolve().then(s.bind(s,70049)),Promise.resolve().then(s.bind(s,61819))},61819:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return w}});var t=s(57437),r=s(2265),n=s(94076),i=s(93448),o=s(23340),l=s(26811),d=s(69174),c=s(12381),u=s(79820),p=s(31593),m=s(74291),h=s(24287),x=s(27658),f=s(53459),v=s(25361),N=s(30666),b=s(53630),g=s(96299),j=s(33145);let C={CONNECTED:{label:"Conectado",description:"Pronto para enviar mensagens.",className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/25",icon:h.Z},AWAITING_SCAN:{label:"Desconectado",description:"Gere/valide um QR e escaneie no WhatsApp > Aparelhos conectados.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:x.Z},SCAN_QR_CODE:{label:"Desconectado",description:"Gere/valide um QR e escaneie no WhatsApp > Aparelhos conectados.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:x.Z},LOADING_QR:{label:"Gerando QR Code",description:"Aguarde ou clique em validar para atualizar.",className:"bg-amber-500/10 text-amber-400 border-amber-500/25",icon:f.Z},DISCONNECTED:{label:"Desconectado",description:"Clique em conectar para gerar um novo QR Code.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:x.Z},TIMEOUT:{label:"Tempo esgotado",description:"Gere um novo QR Code e tente novamente.",className:"bg-orange-500/10 text-orange-400 border-orange-500/25",icon:v.Z},ERROR:{label:"Erro",description:"Tente validar ou reconectar para gerar um novo QR.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:v.Z},UNKNOWN:{label:"Status desconhecido",description:"Carregue os dados para continuar.",className:"bg-slate-500/10 text-slate-200 border-slate-500/25",icon:v.Z}};function w(){let{barbershopId:e,isLoading:a}=(0,l.Y)(),{toast:s}=(0,o.pm)(),[h,v]=(0,r.useState)(null),[w,y]=(0,r.useState)(!0),[E,S]=(0,r.useState)(!1),[A,O]=(0,r.useState)(!1),[T,R]=(0,r.useState)(!1),[D,Z]=(0,r.useState)(!1),[I,Q]=(0,r.useState)(null),W=(0,r.useRef)(null==h?void 0:h.whatsappStatus),k=C[(null==h?void 0:h.whatsappStatus)||"UNKNOWN"],q=(null==h?void 0:h.whatsappStatus)==="DISCONNECTED",B=(0,r.useMemo)(()=>(null==h?void 0:h.qrCodeBase64)?"data:image/png;base64,".concat(h.qrCodeBase64):null,[null==h?void 0:h.qrCodeBase64]),G=!!B;(0,r.useEffect)(()=>{(null==h?void 0:h.whatsappStatus)!=="CONNECTED"&&G||Z(!1)},[null==h?void 0:h.whatsappStatus,G]);let z=(0,r.useCallback)(async()=>{if(e){S(!0);try{let a=await fetch("/api/bitsafira/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({barbershopId:e})}),t=await a.json();if(!a.ok)throw Error(t.message||"N\xe3o foi poss\xedvel iniciar a conex\xe3o.");v(e=>{var a,s;return e?{...e,bitsafiraInstanceId:t.instanceId||e.bitsafiraInstanceId,whatsappStatus:t.whatsappStatus||e.whatsappStatus,qrCodeBase64:null!==(s=null!==(a=t.qrCodeBase64)&&void 0!==a?a:e.qrCodeBase64)&&void 0!==s?s:null}:e}),t.qrCodeBase64&&Q(Date.now()),s({title:"Conex\xe3o iniciada",description:t.message||"Escaneie o QR Code no WhatsApp para concluir."})}catch(e){s({variant:"destructive",title:"Erro ao conectar",description:(null==e?void 0:e.message)||"Tente novamente."})}finally{S(!1)}}},[e,s]),_=(0,r.useCallback)(async()=>{if(e){O(!0);try{var a,t;let r=await fetch("/api/bitsafira/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({barbershopId:e})}),n=await r.json();if(!r.ok||!1===n.success)throw Error(n.message||"N\xe3o foi poss\xedvel validar a inst\xe2ncia.");let i=n.status||(null==h?void 0:h.whatsappStatus),o=(null===(a=n.data)||void 0===a?void 0:a.qrCode)||(null===(t=n.data)||void 0===t?void 0:t.qr)||n.qrCodeBase64||null;v(e=>{var a,s;return e?{...e,whatsappStatus:i||e.whatsappStatus,qrCodeBase64:null!==(s=null!=o?o:e.qrCodeBase64)&&void 0!==s?s:null,bitsafiraInstanceId:e.bitsafiraInstanceId||(null===(a=n.data)||void 0===a?void 0:a.id)}:e}),o&&Q(Date.now()),s({title:"Status atualizado",description:n.message||"Conex\xe3o validada com a WhatsApp."})}catch(e){s({variant:"destructive",title:"Erro ao validar",description:(null==e?void 0:e.message)||"Tente novamente."})}finally{O(!1)}}},[e,null==h?void 0:h.whatsappStatus,s]),P=(0,r.useCallback)(async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e){y(!1);return}y(!0);try{let s=(await (0,n.rd)("/api/barbershops/".concat(e))).data;v(s),a.withStatusValidate&&await _()}catch(e){s({variant:"destructive",title:"Erro ao carregar WhatsApp",description:(null==e?void 0:e.message)||"N\xe3o foi poss\xedvel carregar os dados da barbearia."})}finally{y(!1)}},[e,s,_]);(0,r.useEffect)(()=>{P({withStatusValidate:!0})},[P]),(0,r.useEffect)(()=>{W.current=null==h?void 0:h.whatsappStatus,(null==h?void 0:h.whatsappStatus)==="CONNECTED"&&Q(null)},[null==h?void 0:h.whatsappStatus]),(0,r.useEffect)(()=>{if(!I||"CONNECTED"===W.current)return;let a=setTimeout(async()=>{!e||E||A||(await _(),"CONNECTED"===W.current||E||await z())},25e3);return()=>clearTimeout(a)},[I,e,E,A,_,z]);let V=async()=>{if(e){R(!0);try{let a=await fetch("/api/bitsafira/instance/disconnect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({barbershopId:e})}),t=await a.json();if(!a.ok||!1===t.success)throw Error(t.message||"N\xe3o foi poss\xedvel desconectar.");v(e=>e?{...e,whatsappStatus:"DISCONNECTED",qrCodeBase64:null}:e),Q(null),s({title:"Desconectado",description:t.message||"Inst\xe2ncia desconectada com sucesso."})}catch(e){s({variant:"destructive",title:"Erro ao desconectar",description:(null==e?void 0:e.message)||"Tente novamente."})}finally{R(!1)}}};return a||w?(0,t.jsxs)("div",{className:"flex h-[70vh] flex-col items-center justify-center gap-2 text-center",children:[(0,t.jsx)(f.Z,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Carregando configura\xe7\xf5es do WhatsApp..."})]}):e&&h?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"WhatsApp"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Conecte sua inst\xe2ncia no WhatsApp e personalize as mensagens autom\xe1ticas da barbearia."})]}),(0,t.jsxs)(d.C,{className:(0,i.cn)("flex items-center gap-2 border px-3 py-1.5 text-sm",k.className),children:[(0,t.jsx)(k.icon,{className:"h-4 w-4"}),k.label]})]}),(0,t.jsx)("div",{className:"grid gap-6 xl:grid-cols-[1.15fr,0.85fr]",children:(0,t.jsxs)(u.Zb,{children:[(0,t.jsxs)(u.Ol,{children:[(0,t.jsxs)(u.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(N.Z,{className:"h-5 w-5"}),"Conex\xe3o com WhatsApp"]}),(0,t.jsx)(u.SZ,{children:"Gere o QR Code, acompanhe o status e desconecte quando precisar."})]}),(0,t.jsxs)(u.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)(c.z,{onClick:z,disabled:E||"Conectado"===k.label,className:"gap-2 transition-all duration-150 hover:-translate-y-0.5 hover:shadow-lg hover:bg-white hover:text-destructive",children:[E?(0,t.jsx)(f.Z,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(N.Z,{className:"h-4 w-4"}),"Conectar / Gerar QR"]}),(0,t.jsxs)(c.z,{variant:"outline",onClick:_,disabled:A,className:"gap-2",children:[A?(0,t.jsx)(f.Z,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(b.Z,{className:"h-4 w-4"}),"Validar status"]}),(0,t.jsxs)(c.z,{variant:"destructive",onClick:V,disabled:T||q,className:"gap-2 bg-destructive text-destructive-foreground border border-transparent transition-all duration-150 hover:-translate-y-0.5 hover:shadow-lg hover:bg-white hover:text-destructive hover:border-destructive disabled:hover:translate-y-0 disabled:hover:shadow-none",children:[T?(0,t.jsx)(f.Z,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(x.Z,{className:"h-4 w-4"}),"Desconectar WhatsApp"]})]}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-[1.1fr,0.9fr]",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:(0,i.cn)("flex items-start gap-3 rounded-lg border p-4",k.className),children:[(0,t.jsx)(k.icon,{className:"mt-0.5 h-5 w-5"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Estado atual: ",k.label]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:k.description})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Inst\xe2ncia"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"ID usado para conectar com a Whatsapp."})]}),(0,t.jsx)(d.C,{variant:"outline",children:h.bitsafiraInstanceId?"Existente":"Nova"})]}),(0,t.jsx)("p",{className:"mt-2 font-mono text-sm break-all",children:h.bitsafiraInstanceId||"Ainda n\xe3o criada"}),(0,t.jsx)(p.Z,{className:"my-4"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-4",children:[(0,t.jsx)("li",{children:'Clique em "Conectar / Gerar QR" para criar ou recuperar a inst\xe2ncia.'}),(0,t.jsx)("li",{children:"No celular, abra WhatsApp > Aparelhos conectados > Conectar um aparelho."}),(0,t.jsx)("li",{children:"Escaneie o QR Code exibido ao lado."}),(0,t.jsx)("li",{children:'Depois de escanear, use "Validar status" para atualizar a conex\xe3o.'})]})]})]}),(0,t.jsx)("div",{className:"rounded-lg border p-4 bg-muted/30 flex items-center justify-center min-h-[300px]",children:G?(0,t.jsxs)("div",{className:"w-full space-y-3",children:[(0,t.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"Aponte a c?mera do WhatsApp para este c?digo:"}),(0,t.jsx)("div",{className:"mx-auto flex max-w-xs items-center justify-center rounded-lg bg-background p-4 shadow-sm",children:(0,t.jsx)(j.default,{src:B,alt:"QR Code do WhatsApp",width:220,height:220,className:"h-auto w-full max-w-[220px]"})}),(0,t.jsx)(c.z,{variant:"outline",className:"w-full",onClick:()=>G&&(null==h?void 0:h.whatsappStatus)!=="CONNECTED"&&Z(!0),disabled:!G||(null==h?void 0:h.whatsappStatus)==="CONNECTED",children:"Ampliar QR Code"})]}):(0,t.jsxs)("div",{className:"text-center text-sm text-muted-foreground space-y-2",children:[(0,t.jsx)(g.Z,{className:"mx-auto h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{children:"Gere um QR Code para conectar ou valide o status da inst\xe2ncia j\xe1 criada."}),"Conectado"===k.label&&(0,t.jsx)("p",{className:"text-emerald-400",children:"Conex\xe3o ativa: n\xe3o \xe9 necess\xe1rio QR Code."})]})})]})]})]})}),(0,t.jsx)(m.Vq,{open:G&&D,onOpenChange:e=>Z(G&&e),children:(0,t.jsxs)(m.cZ,{className:"max-w-md",children:[(0,t.jsx)(m.fK,{children:(0,t.jsx)(m.$N,{children:"QR Code do WhatsApp"})}),G?(0,t.jsx)("div",{className:"mx-auto flex max-w-sm items-center justify-center rounded-lg bg-background p-4 shadow-sm",children:(0,t.jsx)(j.default,{src:B,alt:"QR Code do WhatsApp",width:320,height:320,className:"h-auto w-full max-w-[320px]"})}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gere ou valide para exibir o QR Code."})]})})]}):(0,t.jsx)("div",{className:"flex h-[60vh] items-center justify-center",children:(0,t.jsx)(u.Zb,{className:"max-w-xl",children:(0,t.jsxs)(u.Ol,{children:[(0,t.jsx)(u.ll,{children:"Conecte uma barbearia primeiro"}),(0,t.jsx)(u.SZ,{children:"N\xe3o encontramos uma barbearia vinculada ao seu usu\xe1rio. Crie ou selecione uma para habilitar o WhatsApp."})]})})})}},69174:function(e,a,s){"use strict";s.d(a,{C:function(){return o}});var t=s(57437);s(2265);var r=s(90535),n=s(93448);let i=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:a,variant:s,...r}=e;return(0,t.jsx)("div",{className:(0,n.cn)(i({variant:s}),a),...r})}},31593:function(e,a,s){"use strict";s.d(a,{Z:function(){return o}});var t=s(57437),r=s(2265),n=s(55156),i=s(93448);let o=r.forwardRef((e,a)=>{let{className:s,orientation:r="horizontal",decorative:o=!0,...l}=e;return(0,t.jsx)(n.f,{ref:a,decorative:o,orientation:r,className:(0,i.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...l})});o.displayName=n.f.displayName}},function(e){e.O(0,[6137,1906,9049,8888,5878,9974,9088,2971,2117,1744],function(){return e(e.s=28247)}),_N_E=e.O()}]);