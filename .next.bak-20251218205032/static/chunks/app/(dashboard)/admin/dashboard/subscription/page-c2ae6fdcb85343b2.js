(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3892],{76341:function(e,a,t){Promise.resolve().then(t.bind(t,12438))},12438:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return k}});var s=t(57437),r=t(2265),n=t(12381),i=t(79820),o=t(23340),l=t(74291),d=t(27311),c=t(66904),u=t(63390),m=t(80659),p=t(53459),x=t(96299),f=t(71245),h=t(94076),g=t(26811),b=t(56942),j=t(31303),v=t(58642),N=t(53430),y=t(93448),w=t(69174),C=t(33145),P=t(40279),I=t(75060),E=t(71488);let S="B\xe1sico",z={[S]:49.9,Premium:119.9};function k(){let{toast:e}=(0,o.pm)(),{user:a}=(0,f.a)(),{barbershopId:t,isLoading:k}=(0,g.Y)();null==a||a.email;let[q,D]=(0,r.useState)(null),[T,Z]=(0,r.useState)(!0),G=(0,r.useCallback)(async function(){let{showLoading:a=!0,suppressToast:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return D(null),a&&Z(!1),null;a&&Z(!0);try{var r;let e=await (0,h.rd)("/api/barbershops/".concat(encodeURIComponent(t))),a=null!==(r=e.data)&&void 0!==r?r:null;return D(a),a}catch(a){return s||e({variant:"destructive",title:"Erro ao carregar barbearia",description:a.message||"N\xe3o foi poss\xedvel buscar as informa\xe7\xf5es da barbearia."}),null}finally{a&&Z(!1)}},[t,e]);(0,r.useEffect)(()=>{if(!t){D(null),Z(!1);return}G()},[t,G]);let[O,R]=(0,r.useState)(!1),[_,B]=(0,r.useState)(0),[V,F]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!O||!t)return;let a=!0,s=async()=>{let t=await G({showLoading:!1,suppressToast:!0});a&&t&&"Premium"===t.plan&&(e({title:"Upgrade conclu\xeddo!",description:"Seu plano foi atualizado para Premium com sucesso."}),R(!1))};s();let r=setInterval(s,5e3);return()=>{a=!1,clearInterval(r)}},[O,t,G,e]);let[L,X]=(0,r.useState)(!1),[A,U]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=e=>{let a=e.detail;null!=a&&a.id&&a.id!==t&&(a.ownerId&&a.ownerId!==t||!a.ownerId)||G({showLoading:!1,suppressToast:!0})},a=e=>{if("barbershop-updated"===e.key&&e.newValue){try{let a=JSON.parse(e.newValue);if(a.id&&a.id!==t&&(a.ownerId&&a.ownerId!==t||!a.ownerId))return}catch(e){console.warn("Formato inv\xe1lido em barbershop-updated:",e)}G({showLoading:!1,suppressToast:!0})}};return window.addEventListener("barbershop-updated",e),window.addEventListener("storage",a),()=>{window.removeEventListener("barbershop-updated",e),window.removeEventListener("storage",a)}},[t,G]);let J=async()=>{if(!t||!(null==q?void 0:q.cpfCnpj)||!(null==q?void 0:q.email)){e({variant:"destructive",title:"Erro",description:"Dados da barbearia (ID, CPF/CNPJ ou Email) est\xe3o incompletos."});return}X(!0),U(null);try{let e=await fetch("/api/create-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:_,barbershopId:t,ownerData:{email:q.email,cpfCnpj:q.cpfCnpj,legalName:q.legalName||q.name}})});if(!e.ok){let a=await e.json();throw Error(a.message||"Falha ao gerar o PIX.")}let a=await e.json();U({qrCodeBase64:a.qrCodeBase64,qrCode:a.qrCode,paymentId:a.paymentId})}catch(a){e({variant:"destructive",title:"Erro ao Gerar PIX",description:a.message})}finally{X(!1)}};if(k||T)return(0,s.jsx)("div",{className:"p-6",children:"Carregando plano..."});let Y=(null==q?void 0:q.plan)||"B\xe1sico",W=(()=>{if(!q||!q.expiryDate)return{text:"Sem data de expira\xe7\xe3o.",days:0,date:null,isTrial:!1};let e=new Date(q.expiryDate);if(Number.isNaN(e.getTime()))return{text:"Sem data de expira\xe7\xe3o v\xe1lida.",days:0,date:null,isTrial:q.plan===S};let a=(0,b.b)(new Date),t=(0,j.j)(e,a),s=(0,v.WU)(e,"dd/MM/yyyy"),r=q.plan===S,n=r?"Teste expira em ".concat(t," dias."):"Renova\xe7\xe3o em ".concat(t," dias.");return t<=0&&(n=r?"Per\xedodo de teste expirou.":"Seu plano expirou."),1===t&&(n=r?"Teste expira hoje.":"Renova\xe7\xe3o em hoje."),{text:n,days:t,date:s,isTrial:r}})();return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"Plano e Assinatura"}),(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Vis\xe3o Geral"}),(0,s.jsx)(i.SZ,{children:"Gerencie seu plano atual e informa\xe7\xf5es de pagamento."})]}),(0,s.jsxs)(i.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start p-4 rounded-lg bg-muted/50 border gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Seu plano atual"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("p",{className:"text-xl font-bold font-headline flex items-center gap-2",children:["Premium"===Y&&(0,s.jsx)(d.Z,{className:"h-5 w-5 text-primary"}),"Plano ",Y]})}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-muted-foreground",children:["(",(0,y.xG)(z[Y]),"/m\xeas)"]})]}),(0,s.jsxs)("div",{className:"text-center sm:text-right",children:[(0,s.jsx)(w.C,{variant:W.days>7?"secondary":"destructive",children:W.text}),W.date&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Pr\xf3xima cobran\xe7a em ",W.date]})]})]}),"B\xe1sico"===Y&&(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-primary/10 border border-primary/20 text-center",children:[(0,s.jsxs)("h3",{className:"font-semibold text-primary flex items-center justify-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-5 w-5"}),"Fa\xe7a o upgrade para o Premium!"]}),(0,s.jsx)("p",{className:"text-sm text-primary/80 mt-1",children:"Desbloqueie WhatsApp autom\xe1tico, Webhooks, relat\xf3rios avan\xe7ados e muito mais."})]})]}),(0,s.jsxs)(i.eW,{className:"border-t px-6 py-4 flex justify-between items-center",children:["B\xe1sico"===Y&&(0,s.jsxs)(n.z,{className:"w-full",onClick:()=>{let e=(null==q?void 0:q.expiryDate)?new Date(q.expiryDate):null,a=new Date;if(!e||Number.isNaN(e.getTime())||(0,N.R)(e,a))F(0),B(z.Premium);else{let t=(0,j.j)(e,a),s=3.99*t-1.66*t;B(s>0?s:0)}R(!0),U(null),X(!1)},children:[(0,s.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Fazer Upgrade para Premium"]}),"Premium"===Y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Voc\xea j\xe1 possui o plano mais completo!"}),(0,s.jsx)(E.pn,{children:(0,s.jsxs)(E.u,{children:[(0,s.jsx)(E.aJ,{asChild:!0,children:(0,s.jsxs)(n.z,{variant:"outline",disabled:!0,children:[(0,s.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Gerenciar Assinatura"]})}),(0,s.jsx)(E._v,{children:(0,s.jsx)("p",{children:"Em breve voc\xea poder\xe1 gerenciar sua assinatura por aqui."})})]})})]})]})]})}),(0,s.jsx)(l.Vq,{open:O,onOpenChange:R,children:(0,s.jsxs)(l.cZ,{className:"sm:max-w-lg",children:[(0,s.jsxs)(l.fK,{children:[(0,s.jsxs)(l.$N,{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-6 w-6 text-primary"}),"Upgrade para o Plano Premium"]}),(0,s.jsx)(l.Be,{children:"Complete a transi\xe7\xe3o para o plano Premium e desbloqueie todos os recursos."})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[(0,s.jsxs)(i.Zb,{className:"bg-muted/50 border-dashed",children:[(0,s.jsx)(i.Ol,{className:"pb-2",children:(0,s.jsx)(i.ll,{className:"text-center text-lg",children:"Resumo da Cobran\xe7a"})}),(0,s.jsxs)(i.aY,{className:"text-center space-y-1",children:[V>0&&(0,s.jsxs)("p",{className:"text-sm text-green-500",children:["Cr\xe9dito de ",(0,y.xG)(V)," (dias restantes do plano B\xe1sico) aplicado."]}),(0,s.jsx)("p",{className:"text-4xl font-bold",children:(0,y.xG)(_)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Valor proporcional para upgrade imediato. A pr\xf3xima cobran\xe7a ser\xe1 o valor cheio do plano."})]})]}),A?(0,s.jsxs)("div",{className:"space-y-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Escaneie o QR Code abaixo com o app do seu banco:"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(C.default,{src:"data:image/png;base64,".concat(A.qrCodeBase64),alt:"PIX QR Code",width:256,height:256})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(I._,{htmlFor:"pix-copy-paste",className:"text-xs",children:"Ou use o PIX Copia e Cola:"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(P.I,{id:"pix-copy-paste",readOnly:!0,value:A.qrCode,className:"text-xs h-8"}),(0,s.jsxs)(n.z,{size:"sm",onClick:()=>{(null==A?void 0:A.qrCode)&&navigator.clipboard.writeText(A.qrCode).then(()=>{e({title:"C\xf3digo PIX Copiado!",description:"Use 'Copia e Cola' no seu app do banco."})})},children:[(0,s.jsx)(m.Z,{className:"mr-2 h-3 w-3"}),"Copiar"]})]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground pt-2",children:"Aguardando pagamento... A p\xe1gina ser\xe1 atualizada automaticamente."})]}):(0,s.jsxs)(n.z,{onClick:J,className:"w-full",disabled:L,children:[L?(0,s.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),L?"Gerando PIX...":"Gerar QR Code PIX"]})]}),(0,s.jsx)(l.cN,{children:(0,s.jsx)(l.GG,{asChild:!0,children:(0,s.jsx)(n.z,{variant:"outline",children:"Fechar"})})})]})})]})}},69174:function(e,a,t){"use strict";t.d(a,{C:function(){return o}});var s=t(57437);t(2265);var r=t(90535),n=t(93448);let i=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:a,variant:t,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(i({variant:t}),a),...r})}},40279:function(e,a,t){"use strict";t.d(a,{I:function(){return i}});var s=t(57437),r=t(2265),n=t(93448);let i=r.forwardRef((e,a)=>{let{className:t,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...i})});i.displayName="Input"},75060:function(e,a,t){"use strict";t.d(a,{_:function(){return d}});var s=t(57437),r=t(2265),n=t(6394),i=t(90535),o=t(93448);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(n.f,{ref:a,className:(0,o.cn)(l(),t),...r})});d.displayName=n.f.displayName},71488:function(e,a,t){"use strict";t.d(a,{_v:function(){return c},aJ:function(){return d},pn:function(){return o},u:function(){return l}});var s=t(57437),r=t(2265),n=t(91668),i=t(93448);let o=n.zt,l=n.fC,d=n.xz,c=r.forwardRef((e,a)=>{let{className:t,sideOffset:r=4,...o}=e;return(0,s.jsx)(n.h_,{children:(0,s.jsx)(n.VY,{ref:a,sideOffset:r,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...o})})});c.displayName=n.VY.displayName}},function(e){e.O(0,[6137,1906,9049,8888,6008,8642,1668,5878,5571,9088,2971,2117,1744],function(){return e(e.s=76341)}),_N_E=e.O()}]);