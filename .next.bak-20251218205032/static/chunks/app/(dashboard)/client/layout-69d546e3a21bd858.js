(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7617],{16096:function(e,t,n){Promise.resolve().then(n.bind(n,34086))},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},34086:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(57437),a=n(82930),i=n(71245),u=n(99376),s=n(2265),o=n(94076);function l(e){let{children:t}=e,{user:n,isLoading:a,signOut:l}=(0,i.a)(),c=(0,u.useRouter)(),[d,f]=(0,s.useState)(!1),[h,m]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{if(a)return;if(!n){c.push("/auth/client/login");return}if("CLIENT"!==n.role){l().then(()=>c.push("/auth/client/login"));return}let e=!0;return m(!0),(0,o.rd)("/api/clients?userId=".concat(encodeURIComponent(n.id))).then(t=>{if(!e)return;let n=!!(t.data&&t.data.length);f(!0),n||console.warn("Cliente logado sem perfil associado; permitindo acesso mesmo assim.")}).catch(()=>{e&&(console.warn("Falha ao verificar perfil do cliente; permitindo acesso."),f(!0))}).finally(()=>{e&&m(!1)}),()=>{e=!1}},[n,a,c,l]),a||h||!d)?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,r.jsx)("p",{children:"Verificando permiss\xf5es de cliente..."})}):(0,r.jsx)(r.Fragment,{children:t})}function c(e){let{children:t}=e;return(0,r.jsx)(a.RouteGuard,{children:(0,r.jsx)(l,{children:t})})}},82930:function(e,t,n){"use strict";n.d(t,{RouteGuard:function(){return o}});var r=n(57437),a=n(99376),i=n(2265),u=n(71245);function s(e){return e.startsWith("/super-admin")?"super-admin":e.startsWith("/admin")?"admin":e.startsWith("/barber")?"barber":e.startsWith("/client")?"client":null}function o(e){let{children:t}=e,n=(0,a.usePathname)(),o=(0,a.useRouter)(),{user:l,isLoading:c}=(0,u.a)();(0,i.useEffect)(()=>{if(c)return;let e=s(n);if(!["/find-barbershop"].includes(n)&&!l&&e&&["admin","super-admin","barber","client"].includes(e)){let t="/auth/login";"super-admin"===e?t="/super-admin/login":"admin"===e?t="/auth/admin/login":"barber"===e?t="/auth/barber/login":"client"===e&&(t="/auth/client/login"),o.push(t)}},[n,l,c,o]);let d=["admin","super-admin","barber","client"].includes(s(n)||""),f=["/find-barbershop"].includes(n);return c&&d&&!f?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,r.jsx)("p",{children:"Verificando autentica\xe7\xe3o..."})}):!d||l||f?(0,r.jsx)(r.Fragment,{children:t}):null}},71245:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return d},a:function(){return f}});var r=n(57437),a=n(2265),i=n(94076);let u=(0,a.createContext)(void 0),s="barberflow_access_token";function o(e){e?window.localStorage.setItem(s,e):window.localStorage.removeItem(s)}async function l(e){return(await (0,i.rd)("/api/auth/me",{credentials:"omit",headers:{Authorization:"Bearer ".concat(e)}})).data}async function c(){let e=await (0,i.rd)("/api/auth/refresh",{method:"POST",credentials:"include"});return(0,i.M8)(e.data.accessToken),e.data.user}function d(e){let{children:t}=e,[n,s]=(0,a.useState)(null),[d,f]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=!0;return(async()=>{f(!0);let t=(0,i.hP)();if(!t){e&&(s(null),f(!1));return}try{let n=await l(t);if(!e)return;s(n)}catch(t){try{let t=await c();e&&s(t)}catch(t){o(null),e&&s(null)}}finally{e&&f(!1)}})(),()=>{e=!1}},[]);let h=async e=>{let t=e.email.trim().toLowerCase(),n=await (0,i.rd)("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,email:t})});return o(n.data.accessToken),(0,i.M8)(n.data.accessToken),s(n.data.user),n.data.user},m=async()=>{await fetch("/api/auth/logout",{method:"POST"}),(0,i.M8)(null),s(null)},p=(0,a.useCallback)(async()=>{let e=(0,i.hP)();if(!e)return null;try{let t=await l(e);return s(t),t}catch(e){return s(null),null}},[]),w=(0,a.useMemo)(()=>({user:n,isLoading:d,signIn:h,signOut:m,refreshUser:p}),[n,d,p]);return(0,r.jsx)(u.Provider,{value:w,children:t})}function f(){let e=(0,a.useContext)(u);if(!e)throw Error("useAuth deve ser usado dentro de AuthProvider");return e}},94076:function(e,t,n){"use strict";n.d(t,{M8:function(){return i},hP:function(){return a},rd:function(){return u}});let r="barberflow_access_token";function a(){return window.localStorage.getItem(r)}function i(e){e?window.localStorage.setItem(r,e):window.localStorage.removeItem(r)}async function u(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new Headers(r.headers),u=a();u&&i.set("Authorization","Bearer ".concat(u));let s=await fetch(e,{...r,headers:i,credentials:null!==(t=r.credentials)&&void 0!==t?t:"omit"});if(!s.ok){if((s.headers.get("content-type")||"").includes("application/json"))try{let e=(n=await s.json())&&"object"==typeof n?"string"==typeof n.error&&n.error.trim()?n.error.trim():"string"==typeof n.message&&n.message.trim()?n.message.trim():"string"==typeof n.detail&&n.detail.trim()?n.detail.trim():null:null;throw Error(e||s.statusText||"Falha na requisi\xe7\xe3o.")}catch(e){if(e instanceof Error&&e.message)throw e}throw Error((await s.text()).trim()||s.statusText||"Falha na requisi\xe7\xe3o.")}return s.json()}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=16096)}),_N_E=e.O()}]);