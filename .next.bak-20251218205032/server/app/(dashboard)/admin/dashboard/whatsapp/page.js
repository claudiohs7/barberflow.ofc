(()=>{var e={};e.id=1867,e.ids=[1867],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},42203:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>p,pages:()=>c,routeModule:()=>u,tree:()=>l}),t(37345),t(44898),t(61930),t(6989),t(35866),t(98128);var s=t(23191),r=t(88716),i=t(37922),n=t.n(i),o=t(95231),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);t.d(a,d);let l=["",{children:["(dashboard)",{children:["admin",{children:["dashboard",{children:["whatsapp",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,37345)),"/var/www/barberflow/src/app/(dashboard)/admin/dashboard/whatsapp/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,44898)),"/var/www/barberflow/src/app/(dashboard)/admin/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,61930)),"/var/www/barberflow/src/app/(dashboard)/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,6989)),"/var/www/barberflow/src/app/(dashboard)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,2304))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,98128)),"/var/www/barberflow/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,2304))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/var/www/barberflow/src/app/(dashboard)/admin/dashboard/whatsapp/page.tsx"],p="/(dashboard)/admin/dashboard/whatsapp/page",h={require:t,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(dashboard)/admin/dashboard/whatsapp/page",pathname:"/admin/dashboard/whatsapp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},40279:(e,a,t)=>{Promise.resolve().then(t.bind(t,933)),Promise.resolve().then(t.bind(t,46618)),Promise.resolve().then(t.bind(t,9539))},46226:(e,a,t)=>{"use strict";t.d(a,{default:()=>r.a});var s=t(69029),r=t.n(s)},69029:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),function(e,a){for(var t in a)Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}(a,{default:function(){return d},getImageProps:function(){return o}});let s=t(91174),r=t(23078),i=t(92481),n=s._(t(86820));function o(e){let{props:a}=(0,r.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/barberflow/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,t]of Object.entries(a))void 0===t&&delete a[e];return{props:a}}let d=i.Image},9539:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>C});var s=t(10326),r=t(17577),i=t(76488),n=t(51223),o=t(84097),d=t(81599),l=t(38443),c=t(91664),p=t(29752),h=t(78062),u=t(24118),m=t(85131),x=t(9664);let b=(0,x.Z)("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);var g=t(46721),f=t(74926);let v=(0,x.Z)("PlugZap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]),w=(0,x.Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);var y=t(35116),j=t(46226);let N={CONNECTED:{label:"Conectado",description:"Pronto para enviar mensagens.",className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/25",icon:m.Z},AWAITING_SCAN:{label:"Desconectado",description:"Gere/valide um QR e escaneie no WhatsApp > Aparelhos conectados.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:b},SCAN_QR_CODE:{label:"Desconectado",description:"Gere/valide um QR e escaneie no WhatsApp > Aparelhos conectados.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:b},LOADING_QR:{label:"Gerando QR Code",description:"Aguarde ou clique em validar para atualizar.",className:"bg-amber-500/10 text-amber-400 border-amber-500/25",icon:g.Z},DISCONNECTED:{label:"Desconectado",description:"Clique em conectar para gerar um novo QR Code.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:b},TIMEOUT:{label:"Tempo esgotado",description:"Gere um novo QR Code e tente novamente.",className:"bg-orange-500/10 text-orange-400 border-orange-500/25",icon:f.Z},ERROR:{label:"Erro",description:"Tente validar ou reconectar para gerar um novo QR.",className:"bg-red-500/10 text-red-400 border-red-500/25",icon:f.Z},UNKNOWN:{label:"Status desconhecido",description:"Carregue os dados para continuar.",className:"bg-slate-500/10 text-slate-200 border-slate-500/25",icon:f.Z}};function C(){let{barbershopId:e,isLoading:a}=(0,d.Y)(),{toast:t}=(0,o.pm)(),[m,x]=(0,r.useState)(null),[f,C]=(0,r.useState)(!0),[k,S]=(0,r.useState)(!1),[A,P]=(0,r.useState)(!1),[q,E]=(0,r.useState)(!1),[Z,I]=(0,r.useState)(!1),[O,R]=(0,r.useState)(null);(0,r.useRef)(m?.whatsappStatus);let M=N[m?.whatsappStatus||"UNKNOWN"],_=m?.whatsappStatus==="DISCONNECTED",Q=(0,r.useMemo)(()=>m?.qrCodeBase64?`data:image/png;base64,${m.qrCodeBase64}`:null,[m?.qrCodeBase64]),T=!!Q,D=(0,r.useCallback)(async()=>{if(e){S(!0);try{let a=await fetch("/api/bitsafira/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({barbershopId:e})}),s=await a.json();if(!a.ok)throw Error(s.message||"N\xe3o foi poss\xedvel iniciar a conex\xe3o.");x(e=>e?{...e,bitsafiraInstanceId:s.instanceId||e.bitsafiraInstanceId,whatsappStatus:s.whatsappStatus||e.whatsappStatus,qrCodeBase64:s.qrCodeBase64??e.qrCodeBase64??null}:e),s.qrCodeBase64&&R(Date.now()),t({title:"Conex\xe3o iniciada",description:s.message||"Escaneie o QR Code no WhatsApp para concluir."})}catch(e){t({variant:"destructive",title:"Erro ao conectar",description:e?.message||"Tente novamente."})}finally{S(!1)}}},[e,t]),W=(0,r.useCallback)(async()=>{if(e){P(!0);try{let a=await fetch("/api/bitsafira/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({barbershopId:e})}),s=await a.json();if(!a.ok||!1===s.success)throw Error(s.message||"N\xe3o foi poss\xedvel validar a inst\xe2ncia.");let r=s.status||m?.whatsappStatus,i=s.data?.qrCode||s.data?.qr||s.qrCodeBase64||null;x(e=>e?{...e,whatsappStatus:r||e.whatsappStatus,qrCodeBase64:i??e.qrCodeBase64??null,bitsafiraInstanceId:e.bitsafiraInstanceId||s.data?.id}:e),i&&R(Date.now()),t({title:"Status atualizado",description:s.message||"Conex\xe3o validada com a WhatsApp."})}catch(e){t({variant:"destructive",title:"Erro ao validar",description:e?.message||"Tente novamente."})}finally{P(!1)}}},[e,m?.whatsappStatus,t]);(0,r.useCallback)(async(a={})=>{if(!e){C(!1);return}C(!0);try{let t=(await (0,i.rd)(`/api/barbershops/${e}`)).data;x(t),a.withStatusValidate&&await W()}catch(e){t({variant:"destructive",title:"Erro ao carregar WhatsApp",description:e?.message||"N\xe3o foi poss\xedvel carregar os dados da barbearia."})}finally{C(!1)}},[e,t,W]);let G=async()=>{if(e){E(!0);try{let a=await fetch("/api/bitsafira/instance/disconnect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({barbershopId:e})}),s=await a.json();if(!a.ok||!1===s.success)throw Error(s.message||"N\xe3o foi poss\xedvel desconectar.");x(e=>e?{...e,whatsappStatus:"DISCONNECTED",qrCodeBase64:null}:e),R(null),t({title:"Desconectado",description:s.message||"Inst\xe2ncia desconectada com sucesso."})}catch(e){t({variant:"destructive",title:"Erro ao desconectar",description:e?.message||"Tente novamente."})}finally{E(!1)}}};return a||f?(0,s.jsxs)("div",{className:"flex h-[70vh] flex-col items-center justify-center gap-2 text-center",children:[s.jsx(g.Z,{className:"h-6 w-6 animate-spin text-muted-foreground"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando configura\xe7\xf5es do WhatsApp..."})]}):e&&m?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"WhatsApp"}),s.jsx("p",{className:"text-muted-foreground",children:"Conecte sua inst\xe2ncia no WhatsApp e personalize as mensagens autom\xe1ticas da barbearia."})]}),(0,s.jsxs)(l.C,{className:(0,n.cn)("flex items-center gap-2 border px-3 py-1.5 text-sm",M.className),children:[s.jsx(M.icon,{className:"h-4 w-4"}),M.label]})]}),s.jsx("div",{className:"grid gap-6 xl:grid-cols-[1.15fr,0.85fr]",children:(0,s.jsxs)(p.Zb,{children:[(0,s.jsxs)(p.Ol,{children:[(0,s.jsxs)(p.ll,{className:"flex items-center gap-2",children:[s.jsx(v,{className:"h-5 w-5"}),"Conex\xe3o com WhatsApp"]}),s.jsx(p.SZ,{children:"Gere o QR Code, acompanhe o status e desconecte quando precisar."})]}),(0,s.jsxs)(p.aY,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)(c.z,{onClick:D,disabled:k||"Conectado"===M.label,className:"gap-2 transition-all duration-150 hover:-translate-y-0.5 hover:shadow-lg hover:bg-white hover:text-destructive",children:[k?s.jsx(g.Z,{className:"h-4 w-4 animate-spin"}):s.jsx(v,{className:"h-4 w-4"}),"Conectar / Gerar QR"]}),(0,s.jsxs)(c.z,{variant:"outline",onClick:W,disabled:A,className:"gap-2",children:[A?s.jsx(g.Z,{className:"h-4 w-4 animate-spin"}):s.jsx(w,{className:"h-4 w-4"}),"Validar status"]}),(0,s.jsxs)(c.z,{variant:"destructive",onClick:G,disabled:q||_,className:"gap-2 bg-destructive text-destructive-foreground border border-transparent transition-all duration-150 hover:-translate-y-0.5 hover:shadow-lg hover:bg-white hover:text-destructive hover:border-destructive disabled:hover:translate-y-0 disabled:hover:shadow-none",children:[q?s.jsx(g.Z,{className:"h-4 w-4 animate-spin"}):s.jsx(b,{className:"h-4 w-4"}),"Desconectar WhatsApp"]})]}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-[1.1fr,0.9fr]",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:(0,n.cn)("flex items-start gap-3 rounded-lg border p-4",M.className),children:[s.jsx(M.icon,{className:"mt-0.5 h-5 w-5"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"font-semibold",children:["Estado atual: ",M.label]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:M.description})]})]}),(0,s.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Inst\xe2ncia"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"ID usado para conectar com a Whatsapp."})]}),s.jsx(l.C,{variant:"outline",children:m.bitsafiraInstanceId?"Existente":"Nova"})]}),s.jsx("p",{className:"mt-2 font-mono text-sm break-all",children:m.bitsafiraInstanceId||"Ainda n\xe3o criada"}),s.jsx(h.Z,{className:"my-4"}),(0,s.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-4",children:[s.jsx("li",{children:'Clique em "Conectar / Gerar QR" para criar ou recuperar a inst\xe2ncia.'}),s.jsx("li",{children:"No celular, abra WhatsApp > Aparelhos conectados > Conectar um aparelho."}),s.jsx("li",{children:"Escaneie o QR Code exibido ao lado."}),s.jsx("li",{children:'Depois de escanear, use "Validar status" para atualizar a conex\xe3o.'})]})]})]}),s.jsx("div",{className:"rounded-lg border p-4 bg-muted/30 flex items-center justify-center min-h-[300px]",children:T?(0,s.jsxs)("div",{className:"w-full space-y-3",children:[s.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Aponte a c?mera do WhatsApp para este c?digo:"}),s.jsx("div",{className:"mx-auto flex max-w-xs items-center justify-center rounded-lg bg-background p-4 shadow-sm",children:s.jsx(j.default,{src:Q,alt:"QR Code do WhatsApp",width:220,height:220,className:"h-auto w-full max-w-[220px]"})}),s.jsx(c.z,{variant:"outline",className:"w-full",onClick:()=>T&&m?.whatsappStatus!=="CONNECTED"&&I(!0),disabled:!T||m?.whatsappStatus==="CONNECTED",children:"Ampliar QR Code"})]}):(0,s.jsxs)("div",{className:"text-center text-sm text-muted-foreground space-y-2",children:[s.jsx(y.Z,{className:"mx-auto h-10 w-10 text-muted-foreground"}),s.jsx("p",{children:"Gere um QR Code para conectar ou valide o status da inst\xe2ncia j\xe1 criada."}),"Conectado"===M.label&&s.jsx("p",{className:"text-emerald-400",children:"Conex\xe3o ativa: n\xe3o \xe9 necess\xe1rio QR Code."})]})})]})]})]})}),s.jsx(u.Vq,{open:T&&Z,onOpenChange:e=>I(T&&e),children:(0,s.jsxs)(u.cZ,{className:"max-w-md",children:[s.jsx(u.fK,{children:s.jsx(u.$N,{children:"QR Code do WhatsApp"})}),T?s.jsx("div",{className:"mx-auto flex max-w-sm items-center justify-center rounded-lg bg-background p-4 shadow-sm",children:s.jsx(j.default,{src:Q,alt:"QR Code do WhatsApp",width:320,height:320,className:"h-auto w-full max-w-[320px]"})}):s.jsx("p",{className:"text-sm text-muted-foreground",children:"Gere ou valide para exibir o QR Code."})]})})]}):s.jsx("div",{className:"flex h-[60vh] items-center justify-center",children:s.jsx(p.Zb,{className:"max-w-xl",children:(0,s.jsxs)(p.Ol,{children:[s.jsx(p.ll,{children:"Conecte uma barbearia primeiro"}),s.jsx(p.SZ,{children:"N\xe3o encontramos uma barbearia vinculada ao seu usu\xe1rio. Crie ou selecione uma para habilitar o WhatsApp."})]})})})}},38443:(e,a,t)=>{"use strict";t.d(a,{C:()=>o});var s=t(10326);t(17577);var r=t(79360),i=t(51223);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o({className:e,variant:a,...t}){return s.jsx("div",{className:(0,i.cn)(n({variant:a}),e),...t})}},37345:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i});var s=t(19510);let r=(0,t(55782).default)(()=>t.e(297).then(t.bind(t,80297)),{loadableGenerated:{modules:["app/(dashboard)/admin/dashboard/whatsapp/page.tsx -> ./page.client"]},ssr:!1});function i(){return s.jsx(r,{})}},74926:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(9664).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},85131:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(9664).Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},35116:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(9664).Z)("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]])}};var a=require("../../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[8948,7925,2535,434,1458,1245,7389,4020,5269,2481,9853,7154,3799,9788,8494],()=>t(42203));module.exports=s})();