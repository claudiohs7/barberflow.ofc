"use strict";(()=>{var e={};e.id=3176,e.ids=[3176],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},62991:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>c,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>p});var n=a(49303),o=a(88716),s=a(60670),i=a(87070),l=a(26003);async function p(e){let t=e.nextUrl.searchParams.get("barbershopId")||void 0;try{let e=await (0,l.U)(t);return i.NextResponse.json({data:e})}catch(e){return console.error("Erro ao listar logs do WhatsApp:",e),i.NextResponse.json({data:[],error:e?.message||"Erro ao listar logs do WhatsApp."},{status:200})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/reminders/logs/route",pathname:"/api/reminders/logs",filename:"route",bundlePath:"app/api/reminders/logs/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/reminders/logs/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:c}=d,g="/api/reminders/logs/route";function h(){return(0,s.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:m})}},63841:(e,t,a)=>{a.d(t,{Z:()=>n});var r=a(53524);let n=globalThis.prisma??new r.PrismaClient({log:["error"]})},26003:(e,t,a)=>{a.d(t,{C:()=>s,U:()=>i});var r=a(63841);let n=[];function o(e){return e?n.filter(t=>t.barbershopId===e):n}async function s(e){if(!e.length)return;let t=()=>{var t;t=e.map(e=>({id:e.id||`${Date.now()}-${Math.random().toString(36).slice(2)}`,barbershopId:e.barbershopId,appointmentId:e.appointmentId??null,clientName:e.clientName??void 0,clientPhone:e.clientPhone??void 0,templateType:e.templateType??void 0,status:e.status,message:e.message,sentAt:(e.sentAt?new Date(e.sentAt):new Date).toISOString(),details:e.details??void 0})),n.unshift(...t),n.length>200&&(n.length=200)},a=r.Z.whatsappmessagelog;if(!a){console.warn("Modelo whatsappmessagelog nao encontrado. Usando log em memoria."),t();return}let o=e.map(e=>({...e.id?{id:e.id}:{},barbershopId:e.barbershopId,appointmentId:e.appointmentId??null,clientName:e.clientName??null,clientPhone:e.clientPhone??null,templateType:e.templateType??null,status:e.status,message:e.message,sentAt:e.sentAt?new Date(e.sentAt):new Date,details:e.details??null}));try{await a.createMany({data:o})}catch(e){console.warn("Falha ao gravar logs no banco. Usando log em memoria.",e),t()}}async function i(e){let t=r.Z.whatsappmessagelog;if(!t)return o(e);try{return t.findMany({where:e?{barbershopId:e}:void 0,orderBy:{sentAt:"desc"}})}catch(t){return console.warn("Falha ao ler logs do banco. Usando log em memoria.",t),o(e)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>a(62991));module.exports=r})();