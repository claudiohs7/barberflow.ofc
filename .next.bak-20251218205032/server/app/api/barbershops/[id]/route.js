"use strict";(()=>{var e={};e.id=244,e.ids=[244],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50755:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>c,serverHooks:()=>b,staticGenerationAsyncStorage:()=>m});var t={};r.r(t),r.d(t,{DELETE:()=>l,GET:()=>d,PATCH:()=>u});var n=r(49303),s=r(88716),o=r(60670),i=r(87070),p=r(58181);async function d(e,{params:a}){let{id:r}=a||{};if(!r)return i.NextResponse.json({error:"Barbearia n\xe3o encontrada"},{status:404});try{let e=await (0,p.kn)(r);if(!e)return i.NextResponse.json({error:"Barbearia n\xe3o encontrada"},{status:404});return i.NextResponse.json({data:e})}catch(e){return console.error("GET /api/barbershops/[id] error:",e),i.NextResponse.json({error:"Erro ao buscar barbearia"},{status:500})}}async function u(e,{params:a}){let{id:r}=a||{};if(!r)return i.NextResponse.json({error:"Barbearia n\xe3o encontrada"},{status:404});try{let a=await e.json(),t={};a.name&&(t.name=a.name),a.legalName&&(t.legalName=a.legalName),a.cpfCnpj&&(t.cpfCnpj=a.cpfCnpj),a.email&&(t.email=a.email),a.phone&&(t.phone=a.phone),a.description&&(t.description=a.description),a.plan&&(t.plan=a.plan),a.status&&(t.status=a.status),"Inativa"!==a.status||a.expiryDate?a.expiryDate&&(t.expiryDate=new Date(a.expiryDate)):t.expiryDate=new Date().toISOString(),void 0!==a.logoUrl&&(t.logoUrl=a.logoUrl),a.address&&(t.address=a.address),a.operatingHours&&(t.operatingHours=a.operatingHours);let n=await (0,p.Ye)(r,t);return i.NextResponse.json({data:n})}catch(a){console.error("PATCH /api/barbershops/[id] error:",a);let e=a?.message||"Erro ao atualizar barbearia";return i.NextResponse.json({error:e},{status:400})}}async function l(e,{params:a}){let{id:r}=a||{};if(!r)return i.NextResponse.json({error:"Barbearia n\xe3o encontrada"},{status:404});try{return await (0,p._6)(r),i.NextResponse.json({success:!0})}catch(e){return console.error("DELETE /api/barbershops/[id] error:",e),i.NextResponse.json({error:"Erro ao excluir barbearia"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/barbershops/[id]/route",pathname:"/api/barbershops/[id]",filename:"route",bundlePath:"app/api/barbershops/[id]/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/barbershops/[id]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:b}=c,h="/api/barbershops/[id]/route";function g(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:m})}},40644:(e,a,r)=>{r.d(a,{cn:()=>s,lV:()=>i,xG:()=>o});var t=r(55761),n=r(62386);function s(...e){return(0,n.m6)((0,t.W)(e))}function o(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}function i(e){return e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-{2,}/g,"-"):""}},63841:(e,a,r)=>{r.d(a,{Z:()=>n});var t=r(53524);let n=globalThis.prisma??new t.PrismaClient({log:["error"]})},58181:(e,a,r)=>{r.d(a,{JN:()=>m,Pz:()=>b,XX:()=>h,Ye:()=>l,_6:()=>g,kn:()=>f,uq:()=>u,vX:()=>c});var t=r(63841),n=r(40644);function s(e){return e&&e.toLowerCase().includes("prem")?"PREMIUM":"BASIC"}function o(e){return(e||"").replace(/\D/g,"")}function i(e){if(!e)return;if(e instanceof Date)return e;let a=new Date(e);return Number.isNaN(a.getTime())?void 0:a}async function p(e,a){return(await t.Z.barbershop.findMany({where:{cpfCnpj:{not:null},...a?{NOT:{id:a}}:{}},select:{id:!0,cpfCnpj:!0}})).find(a=>o(a.cpfCnpj??"")===e)}function d(e){return{id:e.id,name:e.name,legalName:e.legalName??void 0,cpfCnpj:e.cpfCnpj??void 0,email:e.email??void 0,phone:e.phone??void 0,description:e.description??void 0,ownerId:e.ownerId??void 0,plan:"PREMIUM"===e.plan?"Premium":"B\xe1sico",status:e.status,expiryDate:e.expiryDate?.toISOString(),address:e.addressJson??void 0,operatingHours:e.operatingHoursJson??void 0,logoUrl:e.logoUrl??void 0,whatsappStatus:e.whatsappStatus,qrCodeBase64:e.qrCodeBase64??void 0,bitsafiraInstanceId:e.bitsafiraInstanceId??void 0,bitSafiraToken:e.bitSafiraToken??void 0,whatsAppInstanceId:e.whatsAppInstanceId??void 0,messageTemplates:e.messageTemplates?.map(e=>({id:e.id,name:e.name,content:e.content,enabled:e.enabled,type:e.type,reminderHoursBefore:e.reminderHoursBefore??null}))||[],bitsafiraInstanceData:e.bitsafiraInstanceData??void 0,createdAt:e.createdAt?.toISOString()}}async function u(e){let a=e.id||crypto.randomUUID(),r=o(e.cpfCnpj),n=i(e.expiryDate);if(r&&await p(r))throw Error("CPF/CNPJ j\xe1 est\xe1 cadastrado para outra barbearia.");return d(await t.Z.barbershop.create({data:{id:a,name:e.name,legalName:e.legalName,cpfCnpj:r||e.cpfCnpj,email:e.email,phone:e.phone,description:e.description,ownerId:e.ownerId,plan:s(e.plan),status:e.status,expiryDate:n,addressJson:e.address?e.address:void 0,operatingHoursJson:e.operatingHours?e.operatingHours:void 0,logoUrl:e.logoUrl,whatsappStatus:e.whatsappStatus,qrCodeBase64:e.qrCodeBase64,bitsafiraInstanceId:e.bitsafiraInstanceId??void 0,bitSafiraToken:e.bitSafiraToken??void 0,whatsAppInstanceId:e.whatsAppInstanceId??void 0,bitsafiraInstanceData:e.bitsafiraInstanceData??void 0},include:{messageTemplates:!0}}))}async function l(e,a){let r=o(a.cpfCnpj);if(r&&await p(r,e))throw Error("CPF/CNPJ j\xe1 est\xe1 cadastrado para outra barbearia.");let n=i(a.expiryDate);return d(await t.Z.barbershop.update({where:{id:e},data:{name:a.name,legalName:a.legalName,cpfCnpj:r||a.cpfCnpj,email:a.email,phone:a.phone,description:a.description,ownerId:a.ownerId,plan:a.plan?s(a.plan):void 0,status:a.status,expiryDate:n,addressJson:a.address?a.address:void 0,operatingHoursJson:a.operatingHours?a.operatingHours:void 0,logoUrl:a.logoUrl,whatsappStatus:a.whatsappStatus,qrCodeBase64:a.qrCodeBase64,bitsafiraInstanceId:a.bitsafiraInstanceId,bitSafiraToken:a.bitSafiraToken,whatsAppInstanceId:a.whatsAppInstanceId,bitsafiraInstanceData:a.bitsafiraInstanceData},include:{messageTemplates:!0}}))}async function c(e){let a=await t.Z.barbershop.findUnique({where:{id:e},include:{messageTemplates:!0}});return a?d(a):null}async function f(e){let a=await c(e);if(a)return a;let r=(0,n.lV)(e||"");if(!r)return null;let s=(await t.Z.barbershop.findMany({include:{messageTemplates:!0}})).find(e=>(0,n.lV)(e.name)===r);return s?d(s):null}async function m(e){let a=await t.Z.barbershop.findFirst({where:{bitsafiraInstanceId:e},include:{messageTemplates:!0}});return a?d(a):null}async function b(){return(await t.Z.barbershop.findMany({orderBy:{createdAt:"desc"},include:{messageTemplates:!0}})).map(d)}async function h(e){return(await t.Z.barbershop.findMany({where:{ownerId:e},orderBy:{createdAt:"desc"},include:{messageTemplates:!0}})).map(d)}async function g(e){await t.Z.barbershop.delete({where:{id:e}})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[8948,5972,86],()=>r(50755));module.exports=t})();