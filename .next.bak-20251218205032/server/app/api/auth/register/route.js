"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},23184:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var t={};a.r(t),a.d(t,{POST:()=>p});var s=a(49303),n=a(88716),o=a(60670),i=a(87070),u=a(77141);async function p(e){try{let r=await e.json();if(!r.email||!r.password)return i.NextResponse.json({error:"E-mail e senha s\xe3o obrigat\xf3rios"},{status:400});let a=r.email.trim().toLowerCase(),t=await (0,u.r4)({email:a,password:r.password,name:r.name,phone:r.phone,role:r.role});return i.NextResponse.json({data:{id:t.id,email:t.email,name:t.name,role:t.role}},{status:201})}catch(a){console.error("POST /api/auth/register error:",a);let e=a?.message||"N\xe3o foi poss\xedvel cadastrar",r=e.toLowerCase().includes("e-mail")||e.toLowerCase().includes("email");return i.NextResponse.json({error:e},{status:r?400:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/auth/register/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:h}=d,m="/api/auth/register/route";function w(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}},63841:(e,r,a)=>{a.d(r,{Z:()=>s});var t=a(53524);let s=globalThis.prisma??new t.PrismaClient({log:["error"]})},77141:(e,r,a)=>{a.d(r,{BA:()=>h,Lj:()=>m,TK:()=>i,Zy:()=>c,cI:()=>d,cJ:()=>l,l$:()=>p,r4:()=>o,zI:()=>u});var t=a(98691),s=a(63841);async function n(e){return s.Z.user.findUnique({where:{email:e.toLowerCase()}})}async function o(e){if(await n(e.email))throw Error("E-mail j\xe1 est\xe1 em uso.");let r=await t.ZP.hash(e.password,12);return s.Z.user.create({data:{id:crypto.randomUUID(),email:e.email.toLowerCase(),name:e.name,phone:e.phone,passwordHash:r,role:e.role??"CLIENT",avatarUrl:e.avatarUrl}})}async function i(e,r){let a=await n(e);return a&&a.passwordHash&&await t.ZP.compare(r,a.passwordHash)?a:null}async function u(e,r){await s.Z.user.update({where:{id:e},data:{refreshToken:r}})}async function p(e){await s.Z.user.update({where:{id:e},data:{refreshToken:null}})}async function d(e){return e?s.Z.user.findFirst({where:{refreshToken:e}}):null}async function l(e,r){return s.Z.user.update({where:{id:e},data:{email:r}})}async function c(e,r){let a=await t.ZP.hash(r,12);return s.Z.user.update({where:{id:e},data:{passwordHash:a}})}async function h(e,r){return s.Z.user.update({where:{id:e},data:{avatarUrl:r}})}async function m(e,r){return s.Z.user.update({where:{id:e},data:{name:r.name??void 0,phone:r.phone??void 0}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[8948,5972,8691],()=>a(23184));module.exports=t})();