"use strict";(()=>{var e={};e.id=9575,e.ids=[9575],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},99308:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var t={};a.r(t),a.d(t,{POST:()=>d});var n=a(49303),o=a(88716),s=a(60670),i=a(87070),u=a(77141),l=a(75183),p=a(1852);async function d(e){try{let r=e.cookies.get("refresh_token");if(!r)return i.NextResponse.json({error:"Refresh token ausente."},{status:401});let a=await (0,u.cI)(r.value);if(!a)return i.NextResponse.json({error:"Refresh token inv\xe1lido."},{status:401});let t=crypto.randomUUID();await (0,u.zI)(a.id,t);let n=(0,p.o)(a.email)?"SUPERADMIN":a.role,o=(0,l.A)({userId:a.id,email:a.email,role:n,name:a.name??null,phone:a.phone??null,avatarUrl:a.avatarUrl??null}),s={user:{id:a.id,email:a.email,name:a.name??null,role:n,phone:a.phone??null,avatarUrl:a.avatarUrl??null},accessToken:o},d=i.NextResponse.json({data:s});return d.cookies.set("refresh_token",t,{httpOnly:!0,path:"/",maxAge:2592e3,sameSite:"lax"}),d}catch(e){return console.error("POST /api/auth/refresh error:",e),i.NextResponse.json({error:"Falha ao renovar sess\xe3o"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/refresh/route",pathname:"/api/auth/refresh",filename:"route",bundlePath:"app/api/auth/refresh/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/auth/refresh/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:f}=c,w="/api/auth/refresh/route";function v(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},75183:(e,r,a)=>{a.d(r,{A:()=>i,e:()=>u});var t=a(41482),n=a.n(t);let o=process.env.JWT_SECRET||"super-secret",s=process.env.JWT_EXPIRES_IN||"30m";function i(e){return n().sign(e,o,{expiresIn:s})}function u(e){try{return n().verify(e,o)}catch{return null}}},1852:(e,r,a)=>{a.d(r,{o:()=>n});let t=["claudiohs@hotmail.com"];function n(e){let r=(e||"").trim().toLowerCase();return!!r&&t.includes(r)}},63841:(e,r,a)=>{a.d(r,{Z:()=>n});var t=a(53524);let n=globalThis.prisma??new t.PrismaClient({log:["error"]})},77141:(e,r,a)=>{a.d(r,{BA:()=>h,Lj:()=>m,TK:()=>i,Zy:()=>c,cI:()=>p,cJ:()=>d,l$:()=>l,r4:()=>s,zI:()=>u});var t=a(98691),n=a(63841);async function o(e){return n.Z.user.findUnique({where:{email:e.toLowerCase()}})}async function s(e){if(await o(e.email))throw Error("E-mail j\xe1 est\xe1 em uso.");let r=await t.ZP.hash(e.password,12);return n.Z.user.create({data:{id:crypto.randomUUID(),email:e.email.toLowerCase(),name:e.name,phone:e.phone,passwordHash:r,role:e.role??"CLIENT",avatarUrl:e.avatarUrl}})}async function i(e,r){let a=await o(e);return a&&a.passwordHash&&await t.ZP.compare(r,a.passwordHash)?a:null}async function u(e,r){await n.Z.user.update({where:{id:e},data:{refreshToken:r}})}async function l(e){await n.Z.user.update({where:{id:e},data:{refreshToken:null}})}async function p(e){return e?n.Z.user.findFirst({where:{refreshToken:e}}):null}async function d(e,r){return n.Z.user.update({where:{id:e},data:{email:r}})}async function c(e,r){let a=await t.ZP.hash(r,12);return n.Z.user.update({where:{id:e},data:{passwordHash:a}})}async function h(e,r){return n.Z.user.update({where:{id:e},data:{avatarUrl:r}})}async function m(e,r){return n.Z.user.update({where:{id:e},data:{name:r.name??void 0,phone:r.phone??void 0}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[8948,5972,1482,8691],()=>a(99308));module.exports=t})();