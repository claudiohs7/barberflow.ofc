"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},22006:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m});var t={};a.r(t),a.d(t,{POST:()=>d});var n=a(49303),o=a(88716),i=a(60670),s=a(87070),u=a(77141),l=a(75183),p=a(1852);async function d(e){try{let r=await e.json(),a=r.email.trim().toLowerCase(),t=await (0,u.TK)(a,r.password);if(!t)return s.NextResponse.json({error:"Credenciais inv\xe1lidas"},{status:401});let n=(0,p.o)(t.email)?"SUPERADMIN":t.role,o=(0,l.A)({userId:t.id,email:t.email,role:n,name:t.name??null,phone:t.phone??null,avatarUrl:t.avatarUrl??null}),i=crypto.randomUUID();await (0,u.zI)(t.id,i);let d={user:{id:t.id,email:t.email,name:t.name??null,role:n,phone:t.phone??null,avatarUrl:t.avatarUrl??null},accessToken:o},c=s.NextResponse.json({data:d});return c.cookies.set("refresh_token",i,{httpOnly:!0,path:"/",maxAge:2592e3,sameSite:"lax"}),c}catch(e){return console.error("POST /api/auth/login error:",e),s.NextResponse.json({error:"Falha ao autenticar"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:w}=c,f="/api/auth/login/route";function v(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},75183:(e,r,a)=>{a.d(r,{A:()=>s,e:()=>u});var t=a(41482),n=a.n(t);let o=process.env.JWT_SECRET||"super-secret",i=process.env.JWT_EXPIRES_IN||"30m";function s(e){return n().sign(e,o,{expiresIn:i})}function u(e){try{return n().verify(e,o)}catch{return null}}},1852:(e,r,a)=>{a.d(r,{o:()=>n});let t=["claudiohs@hotmail.com"];function n(e){let r=(e||"").trim().toLowerCase();return!!r&&t.includes(r)}},63841:(e,r,a)=>{a.d(r,{Z:()=>n});var t=a(53524);let n=globalThis.prisma??new t.PrismaClient({log:["error"]})},77141:(e,r,a)=>{a.d(r,{BA:()=>h,Lj:()=>m,TK:()=>s,Zy:()=>c,cI:()=>p,cJ:()=>d,l$:()=>l,r4:()=>i,zI:()=>u});var t=a(98691),n=a(63841);async function o(e){return n.Z.user.findUnique({where:{email:e.toLowerCase()}})}async function i(e){if(await o(e.email))throw Error("E-mail j\xe1 est\xe1 em uso.");let r=await t.ZP.hash(e.password,12);return n.Z.user.create({data:{id:crypto.randomUUID(),email:e.email.toLowerCase(),name:e.name,phone:e.phone,passwordHash:r,role:e.role??"CLIENT",avatarUrl:e.avatarUrl}})}async function s(e,r){let a=await o(e);return a&&a.passwordHash&&await t.ZP.compare(r,a.passwordHash)?a:null}async function u(e,r){await n.Z.user.update({where:{id:e},data:{refreshToken:r}})}async function l(e){await n.Z.user.update({where:{id:e},data:{refreshToken:null}})}async function p(e){return e?n.Z.user.findFirst({where:{refreshToken:e}}):null}async function d(e,r){return n.Z.user.update({where:{id:e},data:{email:r}})}async function c(e,r){let a=await t.ZP.hash(r,12);return n.Z.user.update({where:{id:e},data:{passwordHash:a}})}async function h(e,r){return n.Z.user.update({where:{id:e},data:{avatarUrl:r}})}async function m(e,r){return n.Z.user.update({where:{id:e},data:{name:r.name??void 0,phone:r.phone??void 0}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[8948,5972,1482,8691],()=>a(22006));module.exports=t})();