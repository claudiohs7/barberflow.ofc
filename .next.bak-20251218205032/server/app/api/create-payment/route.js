"use strict";(()=>{var e={};e.id=5941,e.ids=[5941],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},33062:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>l,staticGenerationAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{POST:()=>c});var a=t(49303),s=t(88716),n=t(60670),i=t(87070),p=t(36994);async function c(e){try{let{amount:r,barbershopId:t,ownerData:o}=await e.json(),a=process.env.MP_ACCESS_TOKEN;if(!a)return console.error("MP_ACCESS_TOKEN n\xe3o est\xe1 configurado nas vari\xe1veis de ambiente."),i.NextResponse.json({success:!1,message:"Configura\xe7\xe3o do servidor de pagamento incompleta."},{status:500});if(!r||!t||!o)return i.NextResponse.json({success:!1,message:"Dados incompletos para gerar pagamento."},{status:400});let{email:s,cpfCnpj:n,legalName:c}=o;if(!s||!n||!c)return i.NextResponse.json({success:!1,message:"Dados do propriet\xe1rio (e-mail, nome, CPF/CNPJ) est\xe3o incompletos."},{status:400});let u=c.trim().split(/\s+/),d=u.shift()||"Cliente",m=u.join(" ")||"BarberFlow",l=new p.f7({accessToken:a}),g=new p.F6(l),x={transaction_amount:Number(r.toFixed(2)),description:"Upgrade para o plano Premium - BarberFlow",payment_method_id:"pix",payer:{email:s,first_name:d,last_name:m,identification:{type:11===n.replace(/\D/g,"").length?"CPF":"CNPJ",number:n.replace(/\D/g,"")}},external_reference:t,notification_url:"http://localhost:3000/api/webhooks/mercadopago"},_=await g.create({body:x}),f=_.point_of_interaction?.transaction_data?.qr_code_base64,h=_.point_of_interaction?.transaction_data?.qr_code,P=_.id;if(!f||!h||!P)throw Error("Resposta da API do Mercado Pago n\xe3o continha os dados do QR Code ou ID do pagamento.");return i.NextResponse.json({success:!0,qrCodeBase64:f,qrCode:h,paymentId:P})}catch(r){console.error("Erro ao criar pagamento PIX:",r?.cause||r.message);let e=r.cause?.error?.message||r.message||"Erro desconhecido ao processar o pagamento.";return i.NextResponse.json({success:!1,message:e},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/create-payment/route",pathname:"/api/create-payment",filename:"route",bundlePath:"app/api/create-payment/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/create-payment/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:l}=u,g="/api/create-payment/route";function x(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:m})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972,6994],()=>t(33062));module.exports=o})();