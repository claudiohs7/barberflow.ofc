"use strict";(()=>{var e={};e.id=5809,e.ids=[5809],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13257:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>u});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),c=r(30557);async function d(e,{params:t}){try{let e=await (0,c.PS)(t.id);return o.NextResponse.json({data:e})}catch(e){return console.error("GET /api/tickets/:id/responses error:",e),o.NextResponse.json({error:"Erro ao listar respostas"},{status:500})}}async function u(e,{params:t}){try{let r=await e.json(),s=await (0,c.u2)({...r,ticketId:t.id});return o.NextResponse.json({data:s},{status:201})}catch(e){return console.error("POST /api/tickets/:id/responses error:",e),o.NextResponse.json({error:"Erro ao adicionar resposta"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/tickets/[id]/responses/route",pathname:"/api/tickets/[id]/responses",filename:"route",bundlePath:"app/api/tickets/[id]/responses/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/tickets/[id]/responses/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:y}=p,g="/api/tickets/[id]/responses/route";function h(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},63841:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient({log:["error"]})},30557:(e,t,r)=>{r.d(t,{M4:()=>u,O:()=>d,PS:()=>l,XN:()=>o,ax:()=>c,u2:()=>p});var s=r(63841);function a(e){switch(e){case"in_progress":return"IN_PROGRESS";case"closed":return"CLOSED";default:return"OPEN"}}function i(e){return{id:e.id,title:e.subject,description:e.message??"",status:"CLOSED"===e.status?"closed":"IN_PROGRESS"===e.status?"in_progress":"open",priority:e.priority||"medium",category:e.category||"other",createdBy:e.createdByUserId??"",createdAt:e.createdAt,updatedAt:e.updatedAt,assignedTo:void 0,barbershopId:e.barbershopId??void 0,clientEmail:e.clientEmail??"",clientName:e.clientName??""}}function n(e){return{id:e.id,message:e.message,createdBy:e.authorUserId??"",createdAt:e.createdAt,isAdmin:!!e.isAdmin}}async function o(e){return(await s.Z.ticket.findMany({where:e?{barbershopId:e}:void 0,orderBy:{createdAt:"desc"}})).map(i)}async function c(e){return i(await s.Z.ticket.create({data:{barbershopId:e.barbershopId,subject:e.title,message:e.description,status:a(e.status),priority:e.priority,category:e.category,createdByUserId:e.createdBy,clientEmail:e.clientEmail,clientName:e.clientName}}))}async function d(e,t){return i(await s.Z.ticket.update({where:{id:e},data:{subject:t.title,message:t.description,status:t.status?a(t.status):void 0,priority:t.priority,category:t.category,clientEmail:t.clientEmail,clientName:t.clientName,barbershopId:t.barbershopId}}))}async function u(e){await s.Z.ticket.delete({where:{id:e}})}async function p(e){return n(await s.Z.ticketResponse.create({data:{ticketId:e.ticketId,message:e.message,authorUserId:e.createdBy,isAdmin:e.isAdmin}}))}async function l(e){return(await s.Z.ticketResponse.findMany({where:{ticketId:e},orderBy:{createdAt:"asc"}})).map(n)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972],()=>r(13257));module.exports=s})();