"use strict";(()=>{var e={};e.id=4594,e.ids=[4594],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},22155:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>u});var i=r(49303),s=r(88716),n=r(60670),o=r(87070),c=r(30557);async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("barbershopId")||void 0,a=await (0,c.XN)(r||void 0);return o.NextResponse.json({data:a})}catch(e){return console.error("GET /api/tickets error:",e),o.NextResponse.json({error:"Erro ao listar tickets"},{status:500})}}async function u(e){try{let t=await e.json(),r=await (0,c.ax)(t);return o.NextResponse.json({data:r},{status:201})}catch(e){return console.error("POST /api/tickets error:",e),o.NextResponse.json({error:"Erro ao criar ticket"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/tickets/route",pathname:"/api/tickets",filename:"route",bundlePath:"app/api/tickets/route"},resolvedPagePath:"/var/www/barberflow/src/app/api/tickets/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:y}=p,g="/api/tickets/route";function h(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},63841:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(53524);let i=globalThis.prisma??new a.PrismaClient({log:["error"]})},30557:(e,t,r)=>{r.d(t,{M4:()=>u,O:()=>d,PS:()=>l,XN:()=>o,ax:()=>c,u2:()=>p});var a=r(63841);function i(e){switch(e){case"in_progress":return"IN_PROGRESS";case"closed":return"CLOSED";default:return"OPEN"}}function s(e){return{id:e.id,title:e.subject,description:e.message??"",status:"CLOSED"===e.status?"closed":"IN_PROGRESS"===e.status?"in_progress":"open",priority:e.priority||"medium",category:e.category||"other",createdBy:e.createdByUserId??"",createdAt:e.createdAt,updatedAt:e.updatedAt,assignedTo:void 0,barbershopId:e.barbershopId??void 0,clientEmail:e.clientEmail??"",clientName:e.clientName??""}}function n(e){return{id:e.id,message:e.message,createdBy:e.authorUserId??"",createdAt:e.createdAt,isAdmin:!!e.isAdmin}}async function o(e){return(await a.Z.ticket.findMany({where:e?{barbershopId:e}:void 0,orderBy:{createdAt:"desc"}})).map(s)}async function c(e){return s(await a.Z.ticket.create({data:{barbershopId:e.barbershopId,subject:e.title,message:e.description,status:i(e.status),priority:e.priority,category:e.category,createdByUserId:e.createdBy,clientEmail:e.clientEmail,clientName:e.clientName}}))}async function d(e,t){return s(await a.Z.ticket.update({where:{id:e},data:{subject:t.title,message:t.description,status:t.status?i(t.status):void 0,priority:t.priority,category:t.category,clientEmail:t.clientEmail,clientName:t.clientName,barbershopId:t.barbershopId}}))}async function u(e){await a.Z.ticket.delete({where:{id:e}})}async function p(e){return n(await a.Z.ticketResponse.create({data:{ticketId:e.ticketId,message:e.message,authorUserId:e.createdBy,isAdmin:e.isAdmin}}))}async function l(e){return(await a.Z.ticketResponse.findMany({where:{ticketId:e},orderBy:{createdAt:"asc"}})).map(n)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>r(22155));module.exports=a})();