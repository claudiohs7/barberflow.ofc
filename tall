[1mdiff --git a/.gitignore b/.gitignore[m
[1mindex ed4d267..8031eea 100755[m
[1m--- a/.gitignore[m
[1m+++ b/.gitignore[m
[36m@@ -30,3 +30,6 @@[m [mpnpm-debug.log*[m
 [m
 # Firebase[m
 /firebase-tools-instant-win.exe[m
[32m+[m
[32m+[m[32m# Uploads (persisted on VPS)[m
[32m+[m[32m/uploads[m
[1mdiff --git a/eslint.config.mjs b/eslint.config.mjs[m
[1mnew file mode 100644[m
[1mindex 0000000..459f764[m
[1m--- /dev/null[m
[1m+++ b/eslint.config.mjs[m
[36m@@ -0,0 +1,18 @@[m
[32m+[m[32mimport nextConfig from "eslint-config-next";[m
[32m+[m
[32m+[m[32mconst config = [[m
[32m+[m[32m  {[m
[32m+[m[32m    ignores: ["**/node_modules/**", ".next/**", "dist/**", "out/**"],[m
[32m+[m[32m  },[m
[32m+[m[32m  ...nextConfig,[m
[32m+[m[32m  {[m
[32m+[m[32m    rules: {[m
[32m+[m[32m      "react-hooks/set-state-in-effect": "off",[m
[32m+[m[32m      "react-hooks/purity": "off",[m
[32m+[m[32m      "react-hooks/use-memo": "off",[m
[32m+[m[32m      "react/no-unescaped-entities": "off",[m
[32m+[m[32m    },[m
[32m+[m[32m  },[m
[32m+[m[32m];[m
[32m+[m
[32m+[m[32mexport default config;[m
[1mdiff --git a/next-env.d.ts b/next-env.d.ts[m
[1mindex 40c3d68..c4b7818 100755[m
[1m--- a/next-env.d.ts[m
[1m+++ b/next-env.d.ts[m
[36m@@ -1,5 +1,6 @@[m
 /// <reference types="next" />[m
 /// <reference types="next/image-types/global" />[m
[32m+[m[32mimport "./.next/dev/types/routes.d.ts";[m
 [m
 // NOTE: This file should not be edited[m
[31m-// see https://nextjs.org/docs/app/building-your-application/configuring/typescript for more information.[m
[32m+[m[32m// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.[m
[1mdiff --git a/next.config.js b/next.config.js[m
[1mindex bfc27aa..a450dc8 100755[m
[1m--- a/next.config.js[m
[1m+++ b/next.config.js[m
[36m@@ -6,9 +6,6 @@[m [mconst nextConfig = {[m
   typescript: {[m
     ignoreBuildErrors: true,[m
   },[m
[31m-  eslint: {[m
[31m-    ignoreDuringBuilds: true,[m
[31m-  },[m
   experimental: {[m
     [m
   },[m
[1mdiff --git a/package-lock.json b/package-lock.json[m
[1mindex 1b0c938..cced771 100755[m
[1m--- a/package-lock.json[m
[1m+++ b/package-lock.json[m
[36m@@ -48,7 +48,6 @@[m
         "jspdf": "^3.0.4",[m
         "jspdf-autotable": "^5.0.2",[m
         "lucide-react": "^0.475.0",[m
[31m-        "mercadopago": "^2.0.11",[m
         "next": "latest",[m
         "patch-package": "^8.0.0",[m
         "react": "^18.3.1",[m
[36m@@ -62,12 +61,13 @@[m
         "zod": "^3.24.2"[m
       },[m
       "devDependencies": {[m
[32m+[m[32m        "@next/eslint-plugin-next": "16.1.0",[m
         "@types/jspdf": "^2.0.0",[m
         "@types/node": "^20.19.27",[m
         "@types/react": "^18",[m
         "@types/react-dom": "^18",[m
[31m-        "eslint": "^8.57.1",[m
[31m-        "eslint-config-next": "^14.2.33",[m
[32m+[m[32m        "eslint": "^9.14.0",[m
[32m+[m[32m        "eslint-config-next": "16.1.0",[m
         "genkit-cli": "^1.20.0",[m
         "postcss": "^8",[m
         "prisma": "^5.22.0",[m
[36m@@ -100,6 +100,261 @@[m
         "zod": "^3.20.2"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/@babel/code-frame": {[m
[32m+[m[32m      "version": "7.27.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.27.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/helper-validator-identifier": "^7.27.1",[m
[32m+[m[32m        "js-tokens": "^4.0.0",[m
[32m+[m[32m        "picocolors": "^1.1.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/compat-data": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-6uFXyCayocRbqhZOB+6XcuZbkMNimwfVGFji8CTZnCzOHVGvDqzvitu1re2AU5LROliz7eQPhB8CpAMvnx9EjA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/core": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-e7jT4DxYvIDLk1ZHmU/m/mB19rex9sv0c2ftBtjSBv+kVM/902eh0fINUzD7UwLLNR+jU585GxUJ8/EBfAM5fw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "peer": true,[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/code-frame": "^7.27.1",[m
[32m+[m[32m        "@babel/generator": "^7.28.5",[m
[32m+[m[32m        "@babel/helper-compilation-targets": "^7.27.2",[m
[32m+[m[32m        "@babel/helper-module-transforms": "^7.28.3",[m
[32m+[m[32m        "@babel/helpers": "^7.28.4",[m
[32m+[m[32m        "@babel/parser": "^7.28.5",[m
[32m+[m[32m        "@babel/template": "^7.27.2",[m
[32m+[m[32m        "@babel/traverse": "^7.28.5",[m
[32m+[m[32m        "@babel/types": "^7.28.5",[m
[32m+[m[32m        "@jridgewell/remapping": "^2.3.5",[m
[32m+[m[32m        "convert-source-map": "^2.0.0",[m
[32m+[m[32m        "debug": "^4.1.0",[m
[32m+[m[32m        "gensync": "^1.0.0-beta.2",[m
[32m+[m[32m        "json5": "^2.2.3",[m
[32m+[m[32m        "semver": "^6.3.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "type": "opencollective",[m
[32m+[m[32m        "url": "https://opencollective.com/babel"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/core/node_modules/debug": {[m
[32m+[m[32m      "version": "4.4.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "ms": "^2.1.3"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependenciesMeta": {[m
[32m+[m[32m        "supports-color": {[m
[32m+[m[32m          "optional": true[m
[32m+[m[32m        }[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/core/node_modules/ms": {[m
[32m+[m[32m      "version": "2.1.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/core/node_modules/semver": {[m
[32m+[m[32m      "version": "6.3.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC",[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "semver": "bin/semver.js"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/generator": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-3EwLFhZ38J4VyIP6WNtt2kUdW9dokXA9Cr4IVIFHuCpZ3H8/YFOl5JjZHisrn1fATPBmKKqXzDFvh9fUwHz6CQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/parser": "^7.28.5",[m
[32m+[m[32m        "@babel/types": "^7.28.5",[m
[32m+[m[32m        "@jridgewell/gen-mapping": "^0.3.12",[m
[32m+[m[32m        "@jridgewell/trace-mapping": "^0.3.28",[m
[32m+[m[32m        "jsesc": "^3.0.2"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-compilation-targets": {[m
[32m+[m[32m      "version": "7.27.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-compilation-targets/-/helper-compilation-targets-7.27.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/compat-data": "^7.27.2",[m
[32m+[m[32m        "@babel/helper-validator-option": "^7.27.1",[m
[32m+[m[32m        "browserslist": "^4.24.0",[m
[32m+[m[32m        "lru-cache": "^5.1.1",[m
[32m+[m[32m        "semver": "^6.3.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-compilation-targets/node_modules/lru-cache": {[m
[32m+[m[32m      "version": "5.1.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "yallist": "^3.0.2"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-compilation-targets/node_modules/semver": {[m
[32m+[m[32m      "version": "6.3.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC",[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "semver": "bin/semver.js"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-compilation-targets/node_modules/yallist": {[m
[32m+[m[32m      "version": "3.1.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC"[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-globals": {[m
[32m+[m[32m      "version": "7.28.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-globals/-/helper-globals-7.28.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-module-imports": {[m
[32m+[m[32m      "version": "7.27.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.27.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/traverse": "^7.27.1",[m
[32m+[m[32m        "@babel/types": "^7.27.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-module-transforms": {[m
[32m+[m[32m      "version": "7.28.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-module-transforms/-/helper-module-transforms-7.28.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-gytXUbs8k2sXS9PnQptz5o0QnpLL51SwASIORY6XaBKF88nsOT0Zw9szLqlSGQDP/4TljBAD5y98p2U1fqkdsw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/helper-module-imports": "^7.27.1",[m
[32m+[m[32m        "@babel/helper-validator-identifier": "^7.27.1",[m
[32m+[m[32m        "@babel/traverse": "^7.28.3"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "@babel/core": "^7.0.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-string-parser": {[m
[32m+[m[32m      "version": "7.27.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-validator-identifier": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helper-validator-option": {[m
[32m+[m[32m      "version": "7.27.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helper-validator-option/-/helper-validator-option-7.27.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/helpers": {[m
[32m+[m[32m      "version": "7.28.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/helpers/-/helpers-7.28.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-HFN59MmQXGHVyYadKLVumYsA9dBFun/ldYxipEjzA4196jpLZd8UjEEBLkbEkvfYreDqJhZxYAWFPtrfhNpj4w==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/template": "^7.27.2",[m
[32m+[m[32m        "@babel/types": "^7.28.4"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/parser": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-KKBU1VGYR7ORr3At5HAtUQ+TV3SzRCXmA/8OdDZiLDBIZxVyzXuztPjfLd3BV1PRAQGCMWWSHYhL0F8d5uHBDQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/types": "^7.28.5"[m
[32m+[m[32m      },[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "parser": "bin/babel-parser.js"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.0.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/@babel/runtime": {[m
       "version": "7.28.4",[m
       "resolved": "https://registry.npmjs.org/@babel/runtime/-/runtime-7.28.4.tgz",[m
[36m@@ -109,6 +364,79 @@[m
         "node": ">=6.9.0"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/@babel/template": {[m
[32m+[m[32m      "version": "7.27.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.27.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/code-frame": "^7.27.1",[m
[32m+[m[32m        "@babel/parser": "^7.27.2",[m
[32m+[m[32m        "@babel/types": "^7.27.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/traverse": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-TCCj4t55U90khlYkVV/0TfkJkAkUg3jZFA3Neb7unZT8CPok7iiRfaX0F+WnqWqt7OxhOn0uBKXCw4lbL8W0aQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/code-frame": "^7.27.1",[m
[32m+[m[32m        "@babel/generator": "^7.28.5",[m
[32m+[m[32m        "@babel/helper-globals": "^7.28.0",[m
[32m+[m[32m        "@babel/parser": "^7.28.5",[m
[32m+[m[32m        "@babel/template": "^7.27.2",[m
[32m+[m[32m        "@babel/types": "^7.28.5",[m
[32m+[m[32m        "debug": "^4.3.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/traverse/node_modules/debug": {[m
[32m+[m[32m      "version": "4.4.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "ms": "^2.1.3"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependenciesMeta": {[m
[32m+[m[32m        "supports-color": {[m
[32m+[m[32m          "optional": true[m
[32m+[m[32m        }[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/traverse/node_modules/ms": {[m
[32m+[m[32m      "version": "2.1.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@babel/types": {[m
[32m+[m[32m      "version": "7.28.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.28.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-qQ5m48eI/MFLQ5PxQj4PFaprjyCTLI37ElWMmNs0K8Lk3dVeOdNpB3ks8jc7yM5CDmVC73eMVk/trk3fgmrUpA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/helper-string-parser": "^7.27.1",[m
[32m+[m[32m        "@babel/helper-validator-identifier": "^7.28.5"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/@colors/colors": {[m
       "version": "1.6.0",[m
       "resolved": "https://registry.npmjs.org/@colors/colors/-/colors-1.6.0.tgz",[m
[36m@@ -147,7 +475,6 @@[m
       "version": "1.7.1",[m
       "resolved": "https://registry.npmjs.org/@emnapi/runtime/-/runtime-1.7.1.tgz",[m
       "integrity": "sha512-PVtJr5CmLwYAU9PZDMITZoR5iAOShYREoR45EyyLrbntV50mdePTgUn4AmOw90Ifcj+x2kRjdzr1HP3RrNiHGA==",[m
[31m-      "dev": true,[m
       "license": "MIT",[m
       "optional": true,[m
       "dependencies": {[m
[36m@@ -652,48 +979,22 @@[m
         "node": "^12.0.0 || ^14.0.0 || >=16.0.0"[m
       }[m
     },[m
[31m-    "node_modules/@eslint/eslintrc": {[m
[31m-      "version": "2.1.4",[m
[31m-      "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-2.1.4.tgz",[m
[31m-      "integrity": "sha512-269Z39MS6wVJtsoUl10L60WdkhJVdPG24Q4eZTH3nnF6lpvSShEK3wQjDX9JRWAUPvPh7COouPpU9IrqaZFvtQ==",[m
[32m+[m[32m    "node_modules/@eslint/config-array": {[m
[32m+[m[32m      "version": "0.21.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.21.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-aw1gNayWpdI/jSYVgzN5pL0cfzU02GT3NBpeT/DXbx1/1x7ZKxFPd9bwrzygx/qiwIQiJ1sw/zD8qY/kRvlGHA==",[m
       "dev": true,[m
[31m-      "license": "MIT",[m
[32m+[m[32m      "license": "Apache-2.0",[m
       "dependencies": {[m
[31m-        "ajv": "^6.12.4",[m
[31m-        "debug": "^4.3.2",[m
[31m-        "espree": "^9.6.0",[m
[31m-        "globals": "^13.19.0",[m
[31m-        "ignore": "^5.2.0",[m
[31m-        "import-fresh": "^3.2.1",[m
[31m-        "js-yaml": "^4.1.0",[m
[31m-        "minimatch": "^3.1.2",[m
[31m-        "strip-json-comments": "^3.1.1"[m
[32m+[m[32m        "@eslint/object-schema": "^2.1.7",[m
[32m+[m[32m        "debug": "^4.3.1",[m
[32m+[m[32m        "minimatch": "^3.1.2"[m
       },[m
       "engines": {[m
[31m-        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "url": "https://opencollective.com/eslint"[m
[31m-      }[m
[31m-    },[m
[31m-    "node_modules/@eslint/eslintrc/node_modules/ajv": {[m
[31m-      "version": "6.12.6",[m
[31m-      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",[m
[31m-      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "fast-deep-equal": "^3.1.1",[m
[31m-        "fast-json-stable-stringify": "^2.0.0",[m
[31m-        "json-schema-traverse": "^0.4.1",[m
[31m-        "uri-js": "^4.2.2"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "type": "github",[m
[31m-        "url": "https://github.com/sponsors/epoberezkin"[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
       }[m
     },[m
[31m-    "node_modules/@eslint/eslintrc/node_modules/brace-expansion": {[m
[32m+[m[32m    "node_modules/@eslint/config-array/node_modules/brace-expansion": {[m
       "version": "1.1.12",[m
       "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",[m
       "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",[m
[36m@@ -704,7 +1005,7 @@[m
         "concat-map": "0.0.1"[m
       }[m
     },[m
[31m-    "node_modules/@eslint/eslintrc/node_modules/debug": {[m
[32m+[m[32m    "node_modules/@eslint/config-array/node_modules/debug": {[m
       "version": "4.4.3",[m
       "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",[m
       "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",[m
[36m@@ -722,14 +1023,7 @@[m
         }[m
       }[m
     },[m
[31m-    "node_modules/@eslint/eslintrc/node_modules/json-schema-traverse": {[m
[31m-      "version": "0.4.1",[m
[31m-      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",[m
[31m-      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT"[m
[31m-    },[m
[31m-    "node_modules/@eslint/eslintrc/node_modules/minimatch": {[m
[32m+[m[32m    "node_modules/@eslint/config-array/node_modules/minimatch": {[m
       "version": "3.1.2",[m
       "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",[m
       "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",[m
[36m@@ -742,26 +1036,176 @@[m
         "node": "*"[m
       }[m
     },[m
[31m-    "node_modules/@eslint/eslintrc/node_modules/ms": {[m
[32m+[m[32m    "node_modules/@eslint/config-array/node_modules/ms": {[m
       "version": "2.1.3",[m
       "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",[m
       "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",[m
       "dev": true,[m
       "license": "MIT"[m
     },[m
[31m-    "node_modules/@eslint/js": {[m
[31m-      "version": "8.57.1",[m
[31m-      "resolved": "https://registry.npmjs.org/@eslint/js/-/js-8.57.1.tgz",[m
[31m-      "integrity": "sha512-d9zaMRSTIKDLhctzH12MtXvJKSSUhaHcjV+2Z+GK+EEY7XKpP5yR4x+N3TAcHTcu963nIr+TMcCb4DBCYX1z6Q==",[m
[32m+[m[32m    "node_modules/@eslint/config-helpers": {[m
[32m+[m[32m      "version": "0.4.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/config-helpers/-/config-helpers-0.4.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-gBrxN88gOIf3R7ja5K9slwNayVcZgK6SOUORm2uBzTeIEfeVaIhOpCtTox3P6R7o2jLFwLFTLnC7kU/RGcYEgw==",[m
       "dev": true,[m
[31m-      "license": "MIT",[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@eslint/core": "^0.17.0"[m
[32m+[m[32m      },[m
       "engines": {[m
[31m-        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
       }[m
     },[m
[31m-    "node_modules/@fastify/busboy": {[m
[31m-      "version": "3.2.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@fastify/busboy/-/busboy-3.2.0.tgz",[m
[32m+[m[32m    "node_modules/@eslint/core": {[m
[32m+[m[32m      "version": "0.17.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/core/-/core-0.17.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-yL/sLrpmtDaFEiUj1osRP4TI2MDz1AddJL+jZ7KSqvBuliN4xqYY54IfdN8qD8Toa6g1iloph1fxQNkjOxrrpQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@types/json-schema": "^7.0.15"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc": {[m
[32m+[m[32m      "version": "3.3.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-3.3.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-Kr+LPIUVKz2qkx1HAMH8q1q6azbqBAsXJUxBl/ODDuVPX45Z9DfwB8tPjTi6nNZ8BuM3nbJxC5zCAg5elnBUTQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "ajv": "^6.12.4",[m
[32m+[m[32m        "debug": "^4.3.2",[m
[32m+[m[32m        "espree": "^10.0.1",[m
[32m+[m[32m        "globals": "^14.0.0",[m
[32m+[m[32m        "ignore": "^5.2.0",[m
[32m+[m[32m        "import-fresh": "^3.2.1",[m
[32m+[m[32m        "js-yaml": "^4.1.1",[m
[32m+[m[32m        "minimatch": "^3.1.2",[m
[32m+[m[32m        "strip-json-comments": "^3.1.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/eslint"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc/node_modules/ajv": {[m
[32m+[m[32m      "version": "6.12.6",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",[m
[32m+[m[32m      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "fast-deep-equal": "^3.1.1",[m
[32m+[m[32m        "fast-json-stable-stringify": "^2.0.0",[m
[32m+[m[32m        "json-schema-traverse": "^0.4.1",[m
[32m+[m[32m        "uri-js": "^4.2.2"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "type": "github",[m
[32m+[m[32m        "url": "https://github.com/sponsors/epoberezkin"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc/node_modules/brace-expansion": {[m
[32m+[m[32m      "version": "1.1.12",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",[m
[32m+[m[32m      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "balanced-match": "^1.0.0",[m
[32m+[m[32m        "concat-map": "0.0.1"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc/node_modules/debug": {[m
[32m+[m[32m      "version": "4.4.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "ms": "^2.1.3"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependenciesMeta": {[m
[32m+[m[32m        "supports-color": {[m
[32m+[m[32m          "optional": true[m
[32m+[m[32m        }[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc/node_modules/json-schema-traverse": {[m
[32m+[m[32m      "version": "0.4.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc/node_modules/minimatch": {[m
[32m+[m[32m      "version": "3.1.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "brace-expansion": "^1.1.7"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "*"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/eslintrc/node_modules/ms": {[m
[32m+[m[32m      "version": "2.1.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/js": {[m
[32m+[m[32m      "version": "9.39.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/js/-/js-9.39.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-q1mjIoW1VX4IvSocvM/vbTiveKC4k9eLrajNEuSsmjymSDEbpGddtpfOoN7YGAqBK3NG+uqo8ia4PDTt8buCYA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://eslint.org/donate"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/object-schema": {[m
[32m+[m[32m      "version": "2.1.7",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/object-schema/-/object-schema-2.1.7.tgz",[m
[32m+[m[32m      "integrity": "sha512-VtAOaymWVfZcmZbp6E2mympDIHvyjXs/12LqWYjVw6qjrfF+VK+fyG33kChz3nnK+SU5/NeHOqrTEHS8sXO3OA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@eslint/plugin-kit": {[m
[32m+[m[32m      "version": "0.4.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@eslint/plugin-kit/-/plugin-kit-0.4.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-43/qtrDUokr7LJqoF2c3+RInu/t4zfrpYdoSDfYyhg52rwLV6TnOvdG4fXm7IkSB3wErkcmJS9iEhjVtOSEjjA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@eslint/core": "^0.17.0",[m
[32m+[m[32m        "levn": "^0.4.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@fastify/busboy": {[m
[32m+[m[32m      "version": "3.2.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@fastify/busboy/-/busboy-3.2.0.tgz",[m
       "integrity": "sha512-m9FVDXU3GT2ITSe0UaMA5rU3QkfC/UXtCU8y0gSN/GugTqtVldOBWIB5V6V3sbmenVZUIpU6f+mPEO2+m5iTaA==",[m
       "license": "MIT"[m
     },[m
[36m@@ -1899,6 +2343,19 @@[m
         "node": ">=6"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/@hono/node-server": {[m
[32m+[m[32m      "version": "1.19.7",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@hono/node-server/-/node-server-1.19.7.tgz",[m
[32m+[m[32m      "integrity": "sha512-vUcD0uauS7EU2caukW8z5lJKtoGMokxNbJtBiwHgpqxEXokaHCBkQUmCHhjFB1VUTWdqj25QoMkMKzgjq+uhrw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=18.14.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "hono": "^4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/@hookform/resolvers": {[m
       "version": "4.1.3",[m
       "resolved": "https://registry.npmjs.org/@hookform/resolvers/-/resolvers-4.1.3.tgz",[m
[36m@@ -1910,92 +2367,523 @@[m
         "react-hook-form": "^7.0.0"[m
       }[m
     },[m
[31m-    "node_modules/@humanwhocodes/config-array": {[m
[31m-      "version": "0.13.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@humanwhocodes/config-array/-/config-array-0.13.0.tgz",[m
[31m-      "integrity": "sha512-DZLEEqFWQFiyK6h5YIeynKx7JlvCYWL0cImfSRXZ9l4Sg2efkFGTuFf6vzXjK1cq6IYkU+Eg/JizXw+TD2vRNw==",[m
[31m-      "deprecated": "Use @eslint/config-array instead",[m
[32m+[m[32m    "node_modules/@humanfs/core": {[m
[32m+[m[32m      "version": "0.19.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@humanfs/core/-/core-0.19.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=18.18.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@humanfs/node": {[m
[32m+[m[32m      "version": "0.16.7",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@humanfs/node/-/node-0.16.7.tgz",[m
[32m+[m[32m      "integrity": "sha512-/zUx+yOsIrG4Y43Eh2peDeKCxlRt/gET6aHfaKpuq267qXdYDFViVHfMaLyygZOnl0kGWxFIgsBy8QFuTLUXEQ==",[m
       "dev": true,[m
       "license": "Apache-2.0",[m
       "dependencies": {[m
[31m-        "@humanwhocodes/object-schema": "^2.0.3",[m
[31m-        "debug": "^4.3.1",[m
[31m-        "minimatch": "^3.0.5"[m
[32m+[m[32m        "@humanfs/core": "^0.19.1",[m
[32m+[m[32m        "@humanwhocodes/retry": "^0.4.0"[m
       },[m
       "engines": {[m
[31m-        "node": ">=10.10.0"[m
[32m+[m[32m        "node": ">=18.18.0"[m
       }[m
     },[m
[31m-    "node_modules/@humanwhocodes/config-array/node_modules/brace-expansion": {[m
[31m-      "version": "1.1.12",[m
[31m-      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",[m
[31m-      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",[m
[32m+[m[32m    "node_modules/@humanwhocodes/module-importer": {[m
[32m+[m[32m      "version": "1.0.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",[m
       "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "balanced-match": "^1.0.0",[m
[31m-        "concat-map": "0.0.1"[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=12.22"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "type": "github",[m
[32m+[m[32m        "url": "https://github.com/sponsors/nzakas"[m
       }[m
     },[m
[31m-    "node_modules/@humanwhocodes/config-array/node_modules/debug": {[m
[31m-      "version": "4.4.3",[m
[31m-      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",[m
[31m-      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",[m
[32m+[m[32m    "node_modules/@humanwhocodes/retry": {[m
[32m+[m[32m      "version": "0.4.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.4.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==",[m
       "dev": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=18.18"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "type": "github",[m
[32m+[m[32m        "url": "https://github.com/sponsors/nzakas"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/colour": {[m
[32m+[m[32m      "version": "1.0.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/colour/-/colour-1.0.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-A5P/LfWGFSl6nsckYtjw9da+19jB8hkJ6ACTGcDfEJ0aE+l2n2El7dsVM7UVHZQ9s2lmYMWlrS21YLy2IR1LUw==",[m
       "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "ms": "^2.1.3"[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=18"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-darwin-arm64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-arm64/-/sharp-darwin-arm64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-imtQ3WMJXbMY4fxb/Ndp6HBTNVtWCUI0WdobyheGf5+ad6xX8VIDO8u2xE4qc/fr08CKG/7dDseFtn6M6g/r3w==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "darwin"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
       },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-darwin-arm64": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-darwin-x64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-x64/-/sharp-darwin-x64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-YNEFAF/4KQ/PeW0N+r+aVVsoIY0/qxxikF2SWdp+NRkmMB7y9LBZAVqQ4yhGCm/H3H270OSykqmQMKLBhBJDEw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "darwin"[m
[32m+[m[32m      ],[m
       "engines": {[m
[31m-        "node": ">=6.0"[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
       },[m
[31m-      "peerDependenciesMeta": {[m
[31m-        "supports-color": {[m
[31m-          "optional": true[m
[31m-        }[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-darwin-x64": "1.2.4"[m
       }[m
     },[m
[31m-    "node_modules/@humanwhocodes/config-array/node_modules/minimatch": {[m
[31m-      "version": "3.1.2",[m
[31m-      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",[m
[31m-      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC",[m
[31m-      "dependencies": {[m
[31m-        "brace-expansion": "^1.1.7"[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-darwin-arm64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-arm64/-/sharp-libvips-darwin-arm64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-zqjjo7RatFfFoP0MkQ51jfuFZBnVE2pRiaydKJ1G/rHZvnsrHAOcQALIi9sA5co5xenQdTugCvtb1cuf78Vf4g==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "darwin"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-darwin-x64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-x64/-/sharp-libvips-darwin-x64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-1IOd5xfVhlGwX+zXv2N93k0yMONvUlANylbJw1eTah8K/Jtpi15KC+WSiaX/nBmbm2HxRM1gZ0nSdjSsrZbGKg==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "darwin"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linux-arm": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm/-/sharp-libvips-linux-arm-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-bFI7xcKFELdiNCVov8e44Ia4u2byA+l3XtsAj+Q8tfCwO6BQ8iDojYdvoPMqsKDkuoOo+X6HZA0s0q11ANMQ8A==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linux-arm64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm64/-/sharp-libvips-linux-arm64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-excjX8DfsIcJ10x1Kzr4RcWe1edC9PquDRRPx3YVCvQv+U5p7Yin2s32ftzikXojb1PIFc/9Mt28/y+iRklkrw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linux-ppc64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-ppc64/-/sharp-libvips-linux-ppc64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-FMuvGijLDYG6lW+b/UvyilUWu5Ayu+3r2d1S8notiGCIyYU/76eig1UfMmkZ7vwgOrzKzlQbFSuQfgm7GYUPpA==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "ppc64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linux-riscv64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-riscv64/-/sharp-libvips-linux-riscv64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-oVDbcR4zUC0ce82teubSm+x6ETixtKZBh/qbREIOcI3cULzDyb18Sr/Wcyx7NRQeQzOiHTNbZFF1UwPS2scyGA==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "riscv64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linux-s390x": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-s390x/-/sharp-libvips-linux-s390x-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-qmp9VrzgPgMoGZyPvrQHqk02uyjA0/QrTO26Tqk6l4ZV0MPWIW6LTkqOIov+J1yEu7MbFQaDpwdwJKhbJvuRxQ==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "s390x"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linux-x64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-x64/-/sharp-libvips-linux-x64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-tJxiiLsmHc9Ax1bz3oaOYBURTXGIRDODBqhveVHonrHJ9/+k89qbLl0bcJns+e4t4rvaNBxaEZsFtSfAdquPrw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linuxmusl-arm64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-arm64/-/sharp-libvips-linuxmusl-arm64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-FVQHuwx1IIuNow9QAbYUzJ+En8KcVm9Lk5+uGUQJHaZmMECZmOlix9HnH7n1TRkXMS0pGxIJokIVB9SuqZGGXw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-libvips-linuxmusl-x64": {[m
[32m+[m[32m      "version": "1.2.4",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-x64/-/sharp-libvips-linuxmusl-x64-1.2.4.tgz",[m
[32m+[m[32m      "integrity": "sha512-+LpyBk7L44ZIXwz/VYfglaX/okxezESc6UxDSoyo2Ks6Jxc4Y7sGjpgU9s4PMgqgjj1gZCylTieNamqA1MF7Dg==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-linux-arm": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm/-/sharp-linux-arm-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-9dLqsvwtg1uuXBGZKsxem9595+ujv0sJ6Vi8wcTANSFpwV/GONat5eCkzQo/1O6zRIkh0m/8+5BjrRr7jDUSZw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
       },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linux-arm": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-linux-arm64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm64/-/sharp-linux-arm64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-bKQzaJRY/bkPOXyKx5EVup7qkaojECG6NLYswgktOZjaXecSAeCWiZwwiFf3/Y+O1HrauiE3FVsGxFg8c24rZg==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
       "engines": {[m
[31m-        "node": "*"[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linux-arm64": "1.2.4"[m
       }[m
     },[m
[31m-    "node_modules/@humanwhocodes/config-array/node_modules/ms": {[m
[31m-      "version": "2.1.3",[m
[31m-      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",[m
[31m-      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT"[m
[32m+[m[32m    "node_modules/@img/sharp-linux-ppc64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linux-ppc64/-/sharp-linux-ppc64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-7zznwNaqW6YtsfrGGDA6BRkISKAAE1Jo0QdpNYXNMHu2+0dTrPflTLNkpc8l7MUP5M16ZJcUvysVWWrMefZquA==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "ppc64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linux-ppc64": "1.2.4"[m
[32m+[m[32m      }[m
     },[m
[31m-    "node_modules/@humanwhocodes/module-importer": {[m
[31m-      "version": "1.0.1",[m
[31m-      "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",[m
[31m-      "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",[m
[31m-      "dev": true,[m
[32m+[m[32m    "node_modules/@img/sharp-linux-riscv64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linux-riscv64/-/sharp-linux-riscv64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-51gJuLPTKa7piYPaVs8GmByo7/U7/7TZOq+cnXJIHZKavIRHAP77e3N2HEl3dgiqdD/w0yUfiJnII77PuDDFdw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "riscv64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linux-riscv64": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-linux-s390x": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linux-s390x/-/sharp-linux-s390x-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-nQtCk0PdKfho3eC5MrbQoigJ2gd1CgddUMkabUj+rBevs8tZ2cULOx46E7oyX+04WGfABgIwmMC0VqieTiR4jg==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "s390x"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linux-s390x": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-linux-x64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linux-x64/-/sharp-linux-x64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-MEzd8HPKxVxVenwAa+JRPwEC7QFjoPWuS5NZnBt6B3pu7EG2Ge0id1oLHZpPJdn3OQK+BQDiw9zStiHBTJQQQQ==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
       "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linux-x64": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-linuxmusl-arm64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-arm64/-/sharp-linuxmusl-arm64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-fprJR6GtRsMt6Kyfq44IsChVZeGN97gTD331weR1ex1c1rypDEABN6Tm2xa1wE6lYb5DdEnk03NZPqA7Id21yg==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linuxmusl-arm64": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-linuxmusl-x64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-x64/-/sharp-linuxmusl-x64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-Jg8wNT1MUzIvhBFxViqrEhWDGzqymo3sV7z7ZsaWbZNDLXRJZoRGrjulp60YYtV4wfY8VIKcWidjojlLcWrd8Q==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "linux"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-libvips-linuxmusl-x64": "1.2.4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-wasm32": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-wasm32/-/sharp-wasm32-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-OdWTEiVkY2PHwqkbBI8frFxQQFekHaSSkUIJkwzclWZe64O1X4UlUjqqqLaPbUpMOQk6FBu/HtlGXNblIs0huw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "wasm32"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0 AND LGPL-3.0-or-later AND MIT",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@emnapi/runtime": "^1.7.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-win32-arm64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-win32-arm64/-/sharp-win32-arm64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-WQ3AgWCWYSb2yt+IG8mnC6Jdk9Whs7O0gxphblsLvdhSpSTtmu69ZG1Gkb6NuvxsNACwiPV6cNSZNzt0KPsw7g==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "arm64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0 AND LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "win32"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@img/sharp-win32-ia32": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-win32-ia32/-/sharp-win32-ia32-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-FV9m/7NmeCmSHDD5j4+4pNI8Cp3aW+JvLoXcTUo0IqyjSfAZJ8dIUmijx1qaJsIiU+Hosw6xM5KijAWRJCSgNg==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "ia32"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0 AND LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "win32"[m
[32m+[m[32m      ],[m
       "engines": {[m
[31m-        "node": ">=12.22"[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
       },[m
       "funding": {[m
[31m-        "type": "github",[m
[31m-        "url": "https://github.com/sponsors/nzakas"[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
       }[m
     },[m
[31m-    "node_modules/@humanwhocodes/object-schema": {[m
[31m-      "version": "2.0.3",[m
[31m-      "resolved": "https://registry.npmjs.org/@humanwhocodes/object-schema/-/object-schema-2.0.3.tgz",[m
[31m-      "integrity": "sha512-93zYdMES/c1D69yZiKDBj0V24vqNzB/koF26KPaagAfd3P/4gUlh3Dys5ogAK+Exi9QyzlD8x/08Zt7wIKcDcA==",[m
[31m-      "deprecated": "Use @eslint/object-schema instead",[m
[31m-      "dev": true,[m
[31m-      "license": "BSD-3-Clause"[m
[32m+[m[32m    "node_modules/@img/sharp-win32-x64": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@img/sharp-win32-x64/-/sharp-win32-x64-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-+29YMsqY2/9eFEiW93eqWnuLcWcufowXewwSNIT6UwZdUUCrM3oFjMWH/Z6/TMmb4hlFenmfAVbpWeup2jryCw==",[m
[32m+[m[32m      "cpu": [[m
[32m+[m[32m        "x64"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "Apache-2.0 AND LGPL-3.0-or-later",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "os": [[m
[32m+[m[32m        "win32"[m
[32m+[m[32m      ],[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      }[m
     },[m
     "node_modules/@inquirer/ansi": {[m
       "version": "1.0.0",[m
[36m@@ -2457,16 +3345,24 @@[m
       }[m
     },[m
     "node_modules/@jridgewell/gen-mapping": {[m
[31m-      "version": "0.3.8",[m
[31m-      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.8.tgz",[m
[31m-      "integrity": "sha512-imAbBGkb+ebQyxKgzv5Hu2nmROxoDOXHh80evxdoXNOrvAnVx7zimzc1Oo5h9RlfV4vPXaE2iM5pOFbvOCClWA==",[m
[32m+[m[32m      "version": "0.3.13",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",[m
[32m+[m[32m      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",[m
[32m+[m[32m      "license": "MIT",[m
       "dependencies": {[m
[31m-        "@jridgewell/set-array": "^1.2.1",[m
[31m-        "@jridgewell/sourcemap-codec": "^1.4.10",[m
[32m+[m[32m        "@jridgewell/sourcemap-codec": "^1.5.0",[m
[32m+[m[32m        "@jridgewell/trace-mapping": "^0.3.24"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@jridgewell/remapping": {[m
[32m+[m[32m      "version": "2.3.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@jridgewell/remapping/-/remapping-2.3.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-LI9u/+laYG4Ds1TDKSJW2YPrIlcVYOwi2fUC6xB43lueCjgxV4lffOCZCtYFiH6TNOX+tQKXx97T4IKHbhyHEQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@jridgewell/gen-mapping": "^0.3.5",[m
         "@jridgewell/trace-mapping": "^0.3.24"[m
[31m-      },[m
[31m-      "engines": {[m
[31m-        "node": ">=6.0.0"[m
       }[m
     },[m
     "node_modules/@jridgewell/resolve-uri": {[m
[36m@@ -2477,23 +3373,16 @@[m
         "node": ">=6.0.0"[m
       }[m
     },[m
[31m-    "node_modules/@jridgewell/set-array": {[m
[31m-      "version": "1.2.1",[m
[31m-      "resolved": "https://registry.npmjs.org/@jridgewell/set-array/-/set-array-1.2.1.tgz",[m
[31m-      "integrity": "sha512-R8gLRTZeyp03ymzP/6Lil/28tGeGEzhx1q2k703KGWRAI1VdvPIXdG70VJc2pAMw3NA6JKL5hhFu1sJX0Mnn/A==",[m
[31m-      "engines": {[m
[31m-        "node": ">=6.0.0"[m
[31m-      }[m
[31m-    },[m
     "node_modules/@jridgewell/sourcemap-codec": {[m
       "version": "1.5.0",[m
       "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.0.tgz",[m
       "integrity": "sha512-gv3ZRaISU3fjPAgNsriBRqGWQL6quFx04YMPW/zD8XMLsU32mhCCbfbO6KZFLjvYpCZ8zyDEgqsgf+PwPaM7GQ=="[m
     },[m
     "node_modules/@jridgewell/trace-mapping": {[m
[31m-      "version": "0.3.25",[m
[31m-      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.25.tgz",[m
[31m-      "integrity": "sha512-vNk6aEwybGtawWmy/PzwnGDOjCkLWSD2wqvjGGAgOAwCGWySYXfYoxt00IJkTF+8Lb57DwOb3Aa0o9CApepiYQ==",[m
[32m+[m[32m      "version": "0.3.31",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.31.tgz",[m
[32m+[m[32m      "integrity": "sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==",[m
[32m+[m[32m      "license": "MIT",[m
       "dependencies": {[m
         "@jridgewell/resolve-uri": "^3.1.0",[m
         "@jridgewell/sourcemap-codec": "^1.4.14"[m
[36m@@ -2510,13 +3399,15 @@[m
       }[m
     },[m
     "node_modules/@modelcontextprotocol/sdk": {[m
[31m-      "version": "1.18.2",[m
[31m-      "resolved": "https://registry.npmjs.org/@modelcontextprotocol/sdk/-/sdk-1.18.2.tgz",[m
[31m-      "integrity": "sha512-beedclIvFcCnPrYgHsylqiYJVJ/CI47Vyc4tY8no1/Li/O8U4BTlJfy6ZwxkYwx+Mx10nrgwSVrA7VBbhh4slg==",[m
[32m+[m[32m      "version": "1.25.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@modelcontextprotocol/sdk/-/sdk-1.25.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-yO28oVFFC7EBoiKdAn+VqRm+plcfv4v0xp6osG/VsCB0NlPZWi87ajbCZZ8f/RvOFLEu7//rSRmuZZ7lMoe3gQ==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "ajv": "^6.12.6",[m
[32m+[m[32m        "@hono/node-server": "^1.19.7",[m
[32m+[m[32m        "ajv": "^8.17.1",[m
[32m+[m[32m        "ajv-formats": "^3.0.1",[m
         "content-type": "^1.0.5",[m
         "cors": "^2.8.5",[m
         "cross-spawn": "^7.0.5",[m
[36m@@ -2524,13 +3415,27 @@[m
         "eventsource-parser": "^3.0.0",[m
         "express": "^5.0.1",[m
         "express-rate-limit": "^7.5.0",[m
[32m+[m[32m        "jose": "^6.1.1",[m
[32m+[m[32m        "json-schema-typed": "^8.0.2",[m
         "pkce-challenge": "^5.0.0",[m
         "raw-body": "^3.0.0",[m
[31m-        "zod": "^3.23.8",[m
[31m-        "zod-to-json-schema": "^3.24.1"[m
[32m+[m[32m        "zod": "^3.25 || ^4.0",[m
[32m+[m[32m        "zod-to-json-schema": "^3.25.0"[m
       },[m
       "engines": {[m
         "node": ">=18"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "@cfworker/json-schema": "^4.1.1",[m
[32m+[m[32m        "zod": "^3.25 || ^4.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependenciesMeta": {[m
[32m+[m[32m        "@cfworker/json-schema": {[m
[32m+[m[32m          "optional": true[m
[32m+[m[32m        },[m
[32m+[m[32m        "zod": {[m
[32m+[m[32m          "optional": false[m
[32m+[m[32m        }[m
       }[m
     },[m
     "node_modules/@modelcontextprotocol/sdk/node_modules/accepts": {[m
[36m@@ -2547,23 +3452,6 @@[m
         "node": ">= 0.6"[m
       }[m
     },[m
[31m-    "node_modules/@modelcontextprotocol/sdk/node_modules/ajv": {[m
[31m-      "version": "6.12.6",[m
[31m-      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",[m
[31m-      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "fast-deep-equal": "^3.1.1",[m
[31m-        "fast-json-stable-stringify": "^2.0.0",[m
[31m-        "json-schema-traverse": "^0.4.1",[m
[31m-        "uri-js": "^4.2.2"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "type": "github",[m
[31m-        "url": "https://github.com/sponsors/epoberezkin"[m
[31m-      }[m
[31m-    },[m
     "node_modules/@modelcontextprotocol/sdk/node_modules/body-parser": {[m
       "version": "2.2.1",[m
       "resolved": "https://registry.npmjs.org/body-parser/-/body-parser-2.2.1.tgz",[m
[36m@@ -2718,12 +3606,15 @@[m
         "url": "https://opencollective.com/express"[m
       }[m
     },[m
[31m-    "node_modules/@modelcontextprotocol/sdk/node_modules/json-schema-traverse": {[m
[31m-      "version": "0.4.1",[m
[31m-      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",[m
[31m-      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",[m
[32m+[m[32m    "node_modules/@modelcontextprotocol/sdk/node_modules/jose": {[m
[32m+[m[32m      "version": "6.1.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/jose/-/jose-6.1.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-0TpaTfihd4QMNwrz/ob2Bp7X04yuxJkjRGi4aKmOqwhov54i6u79oCv7T+C7lo70MKH6BesI3vscD1yb/yzKXQ==",[m
       "dev": true,[m
[31m-      "license": "MIT"[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://github.com/sponsors/panva"[m
[32m+[m[32m      }[m
     },[m
     "node_modules/@modelcontextprotocol/sdk/node_modules/media-typer": {[m
       "version": "1.1.0",[m
[36m@@ -2874,6 +3765,27 @@[m
         "node": ">= 0.6"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/@modelcontextprotocol/sdk/node_modules/zod": {[m
[32m+[m[32m      "version": "4.2.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/zod/-/zod-4.2.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-0wZ1IRqGGhMP76gLqz8EyfBXKk0J2qo2+H3fi4mcUP/KtTocoX08nmIAHl1Z2kJIZbZee8KOpBCSNPRgauucjw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "peer": true,[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://github.com/sponsors/colinhacks"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/@modelcontextprotocol/sdk/node_modules/zod-to-json-schema": {[m
[32m+[m[32m      "version": "3.25.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/zod-to-json-schema/-/zod-to-json-schema-3.25.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-HvWtU2UG41LALjajJrML6uQejQhNJx+JBO9IflpSja4R03iNWfKXrj6W2h7ljuLyc1nKS+9yDyL/9tD1U/yBnQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC",[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "zod": "^3.25 || ^4"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/@napi-rs/wasm-runtime": {[m
       "version": "0.2.12",[m
       "resolved": "https://registry.npmjs.org/@napi-rs/wasm-runtime/-/wasm-runtime-0.2.12.tgz",[m
[36m@@ -2888,67 +3800,55 @@[m
       }[m
     },[m
     "node_modules/@next/env": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/env/-/env-14.2.33.tgz",[m
[31m-      "integrity": "sha512-CgVHNZ1fRIlxkLhIX22flAZI/HmpDaZ8vwyJ/B0SDPTBuLZ1PJ+DWMjCHhqnExfmSQzA/PbZi8OAc7PAq2w9IA==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/env/-/env-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Dd23XQeFHmhf3KBW76leYVkejHlCdB7erakC2At2apL1N08Bm+dLYNP+nNHh0tzUXfPQcNcXiQyacw0PG4Fcpw==",[m
       "license": "MIT"[m
     },[m
     "node_modules/@next/eslint-plugin-next": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/eslint-plugin-next/-/eslint-plugin-next-14.2.33.tgz",[m
[31m-      "integrity": "sha512-DQTJFSvlB+9JilwqMKJ3VPByBNGxAGFTfJ7BuFj25cVcbBy7jm88KfUN+dngM4D3+UxZ8ER2ft+WH9JccMvxyg==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/eslint-plugin-next/-/eslint-plugin-next-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-sooC/k0LCF4/jLXYHpgfzJot04lZQqsttn8XJpTguP8N3GhqXN3wSkh68no2OcZzS/qeGwKDFTqhZ8WofdXmmQ==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "glob": "10.3.10"[m
[32m+[m[32m        "fast-glob": "3.3.1"[m
       }[m
     },[m
[31m-    "node_modules/@next/eslint-plugin-next/node_modules/glob": {[m
[31m-      "version": "10.3.10",[m
[31m-      "resolved": "https://registry.npmjs.org/glob/-/glob-10.3.10.tgz",[m
[31m-      "integrity": "sha512-fa46+tv1Ak0UPK1TOy/pZrIybNNt4HCv7SDzwyfiOZkvZLEbjsZkJBPtDHVshZjbecAoAGSC20MjLDG/qr679g==",[m
[32m+[m[32m    "node_modules/@next/eslint-plugin-next/node_modules/fast-glob": {[m
[32m+[m[32m      "version": "3.3.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-kNFPyjhh5cKjrUltxs+wFx+ZkbRaxxmZ+X0ZU31SOsxCEtP9VPgtq2teZw1DebupL5GmDaNQ6yKMMVcM41iqDg==",[m
       "dev": true,[m
[31m-      "license": "ISC",[m
[32m+[m[32m      "license": "MIT",[m
       "dependencies": {[m
[31m-        "foreground-child": "^3.1.0",[m
[31m-        "jackspeak": "^2.3.5",[m
[31m-        "minimatch": "^9.0.1",[m
[31m-        "minipass": "^5.0.0 || ^6.0.2 || ^7.0.0",[m
[31m-        "path-scurry": "^1.10.1"[m
[31m-      },[m
[31m-      "bin": {[m
[31m-        "glob": "dist/esm/bin.mjs"[m
[32m+[m[32m        "@nodelib/fs.stat": "^2.0.2",[m
[32m+[m[32m        "@nodelib/fs.walk": "^1.2.3",[m
[32m+[m[32m        "glob-parent": "^5.1.2",[m
[32m+[m[32m        "merge2": "^1.3.0",[m
[32m+[m[32m        "micromatch": "^4.0.4"[m
       },[m
       "engines": {[m
[31m-        "node": ">=16 || 14 >=14.17"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "url": "https://github.com/sponsors/isaacs"[m
[32m+[m[32m        "node": ">=8.6.0"[m
       }[m
     },[m
[31m-    "node_modules/@next/eslint-plugin-next/node_modules/jackspeak": {[m
[31m-      "version": "2.3.6",[m
[31m-      "resolved": "https://registry.npmjs.org/jackspeak/-/jackspeak-2.3.6.tgz",[m
[31m-      "integrity": "sha512-N3yCS/NegsOBokc8GAdM8UcmfsKiSS8cipheD/nivzr700H+nsMOxJjQnvwOcRYVuFkdH0wGUvW2WbXGmrZGbQ==",[m
[32m+[m[32m    "node_modules/@next/eslint-plugin-next/node_modules/glob-parent": {[m
[32m+[m[32m      "version": "5.1.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",[m
       "dev": true,[m
[31m-      "license": "BlueOak-1.0.0",[m
[32m+[m[32m      "license": "ISC",[m
       "dependencies": {[m
[31m-        "@isaacs/cliui": "^8.0.2"[m
[32m+[m[32m        "is-glob": "^4.0.1"[m
       },[m
       "engines": {[m
[31m-        "node": ">=14"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "url": "https://github.com/sponsors/isaacs"[m
[31m-      },[m
[31m-      "optionalDependencies": {[m
[31m-        "@pkgjs/parseargs": "^0.11.0"[m
[32m+[m[32m        "node": ">= 6"[m
       }[m
     },[m
     "node_modules/@next/swc-darwin-arm64": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-darwin-arm64/-/swc-darwin-arm64-14.2.33.tgz",[m
[31m-      "integrity": "sha512-HqYnb6pxlsshoSTubdXKu15g3iivcbsMXg4bYpjL2iS/V6aQot+iyF4BUc2qA/J/n55YtvE4PHMKWBKGCF/+wA==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-darwin-arm64/-/swc-darwin-arm64-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-onHq8dl8KjDb8taANQdzs3XmIqQWV3fYdslkGENuvVInFQzZnuBYYOG2HGHqqtvgmEU7xWzhgndXXxnhk4Z3fQ==",[m
       "cpu": [[m
         "arm64"[m
       ],[m
[36m@@ -2962,9 +3862,9 @@[m
       }[m
     },[m
     "node_modules/@next/swc-darwin-x64": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-darwin-x64/-/swc-darwin-x64-14.2.33.tgz",[m
[31m-      "integrity": "sha512-8HGBeAE5rX3jzKvF593XTTFg3gxeU4f+UWnswa6JPhzaR6+zblO5+fjltJWIZc4aUalqTclvN2QtTC37LxvZAA==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-darwin-x64/-/swc-darwin-x64-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Am6VJTp8KhLuAH13tPrAoVIXzuComlZlMwGr++o2KDjWiKPe3VwpxYhgV6I4gKls2EnsIMggL4y7GdXyDdJcFA==",[m
       "cpu": [[m
         "x64"[m
       ],[m
[36m@@ -2978,9 +3878,9 @@[m
       }[m
     },[m
     "node_modules/@next/swc-linux-arm64-gnu": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-14.2.33.tgz",[m
[31m-      "integrity": "sha512-JXMBka6lNNmqbkvcTtaX8Gu5by9547bukHQvPoLe9VRBx1gHwzf5tdt4AaezW85HAB3pikcvyqBToRTDA4DeLw==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-fVicfaJT6QfghNyg8JErZ+EMNQ812IS0lmKfbmC01LF1nFBcKfcs4Q75Yy8IqnsCqH/hZwGhqzj3IGVfWV6vpA==",[m
       "cpu": [[m
         "arm64"[m
       ],[m
[36m@@ -2994,9 +3894,9 @@[m
       }[m
     },[m
     "node_modules/@next/swc-linux-arm64-musl": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-14.2.33.tgz",[m
[31m-      "integrity": "sha512-Bm+QulsAItD/x6Ih8wGIMfRJy4G73tu1HJsrccPW6AfqdZd0Sfm5Imhgkgq2+kly065rYMnCOxTBvmvFY1BKfg==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-TojQnDRoX7wJWXEEwdfuJtakMDW64Q7NrxQPviUnfYJvAx5/5wcGE+1vZzQ9F17m+SdpFeeXuOr6v3jbyusYMQ==",[m
       "cpu": [[m
         "arm64"[m
       ],[m
[36m@@ -3010,9 +3910,9 @@[m
       }[m
     },[m
     "node_modules/@next/swc-linux-x64-gnu": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-14.2.33.tgz",[m
[31m-      "integrity": "sha512-FnFn+ZBgsVMbGDsTqo8zsnRzydvsGV8vfiWwUo1LD8FTmPTdV+otGSWKc4LJec0oSexFnCYVO4hX8P8qQKaSlg==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-quhNFVySW4QwXiZkZ34SbfzNBm27vLrxZ2HwTfFFO1BBP0OY1+pI0nbyewKeq1FriqU+LZrob/cm26lwsiAi8Q==",[m
       "cpu": [[m
         "x64"[m
       ],[m
[36m@@ -3026,9 +3926,9 @@[m
       }[m
     },[m
     "node_modules/@next/swc-linux-x64-musl": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-14.2.33.tgz",[m
[31m-      "integrity": "sha512-345tsIWMzoXaQndUTDv1qypDRiebFxGYx9pYkhwY4hBRaOLt8UGfiWKr9FSSHs25dFIf8ZqIFaPdy5MljdoawA==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-6JW0z2FZUK5iOVhUIWqE4RblAhUj1EwhZ/MwteGb//SpFTOHydnhbp3868gxalwea+mbOLWO6xgxj9wA9wNvNw==",[m
       "cpu": [[m
         "x64"[m
       ],[m
[36m@@ -3042,9 +3942,9 @@[m
       }[m
     },[m
     "node_modules/@next/swc-win32-arm64-msvc": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-win32-arm64-msvc/-/swc-win32-arm64-msvc-14.2.33.tgz",[m
[31m-      "integrity": "sha512-nscpt0G6UCTkrT2ppnJnFsYbPDQwmum4GNXYTeoTIdsmMydSKFz9Iny2jpaRupTb+Wl298+Rh82WKzt9LCcqSQ==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-win32-arm64-msvc/-/swc-win32-arm64-msvc-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-+DK/akkAvvXn5RdYN84IOmLkSy87SCmpofJPdB8vbLmf01BzntPBSYXnMvnEEv/Vcf3HYJwt24QZ/s6sWAwOMQ==",[m
       "cpu": [[m
         "arm64"[m
       ],[m
[36m@@ -3057,26 +3957,10 @@[m
         "node": ">= 10"[m
       }[m
     },[m
[31m-    "node_modules/@next/swc-win32-ia32-msvc": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-win32-ia32-msvc/-/swc-win32-ia32-msvc-14.2.33.tgz",[m
[31m-      "integrity": "sha512-pc9LpGNKhJ0dXQhZ5QMmYxtARwwmWLpeocFmVG5Z0DzWq5Uf0izcI8tLc+qOpqxO1PWqZ5A7J1blrUIKrIFc7Q==",[m
[31m-      "cpu": [[m
[31m-        "ia32"[m
[31m-      ],[m
[31m-      "license": "MIT",[m
[31m-      "optional": true,[m
[31m-      "os": [[m
[31m-        "win32"[m
[31m-      ],[m
[31m-      "engines": {[m
[31m-        "node": ">= 10"[m
[31m-      }[m
[31m-    },[m
     "node_modules/@next/swc-win32-x64-msvc": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-14.2.33.tgz",[m
[31m-      "integrity": "sha512-nOjfZMy8B94MdisuzZo9/57xuFVLHJaDj5e/xrduJp9CV2/HrfxTRH2fbyLe+K9QT41WBLUd4iXX3R7jBp0EUg==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Tr0j94MphimCCks+1rtYPzQFK+faJuhHWCegU9S9gDlgyOk8Y3kPmO64UcjyzZAlligeBtYZ/2bEyrKq0d2wqQ==",[m
       "cpu": [[m
         "x64"[m
       ],[m
[36m@@ -6140,32 +7024,18 @@[m
       "dev": true,[m
       "license": "MIT"[m
     },[m
[31m-    "node_modules/@rushstack/eslint-patch": {[m
[31m-      "version": "1.15.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@rushstack/eslint-patch/-/eslint-patch-1.15.0.tgz",[m
[31m-      "integrity": "sha512-ojSshQPKwVvSMR8yT2L/QtUkV5SXi/IfDiJ4/8d6UbTPjiHVmxZzUAzGD8Tzks1b9+qQkZa0isUOvYObedITaw==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT"[m
[31m-    },[m
     "node_modules/@standard-schema/utils": {[m
       "version": "0.3.0",[m
       "resolved": "https://registry.npmjs.org/@standard-schema/utils/-/utils-0.3.0.tgz",[m
       "integrity": "sha512-e7Mew686owMaPJVNNLs55PUvgz371nKgwsc4vxE49zsODpJEnxgxRo2y/OKrqueavXgZNMDVj3DdHFlaSAeU8g=="[m
     },[m
[31m-    "node_modules/@swc/counter": {[m
[31m-      "version": "0.1.3",[m
[31m-      "resolved": "https://registry.npmjs.org/@swc/counter/-/counter-0.1.3.tgz",[m
[31m-      "integrity": "sha512-e2BR4lsJkkRlKZ/qCHPw9ZaSxc0MVUd7gtbtaB7aMvHeJVYe8sOB8DBZkP2DtISHGSku9sCK6T6cnY0CtXrOCQ==",[m
[31m-      "license": "Apache-2.0"[m
[31m-    },[m
     "node_modules/@swc/helpers": {[m
[31m-      "version": "0.5.5",[m
[31m-      "resolved": "https://registry.npmjs.org/@swc/helpers/-/helpers-0.5.5.tgz",[m
[31m-      "integrity": "sha512-KGYxvIOXcceOAbEk4bi/dVLEK9z8sZ0uBB3Il5b1rhfClSpcX0yfRO0KmTkqR2cnQDymwLB+25ZyMzICg/cm/A==",[m
[32m+[m[32m      "version": "0.5.15",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@swc/helpers/-/helpers-0.5.15.tgz",[m
[32m+[m[32m      "integrity": "sha512-JQ5TuMi45Owi4/BIMAJBoSQoOJu12oOk/gADqlcUL9JEdHB8vyjUSsxqeNXnmXHjYKMi2WcYtezGEEhqUI/E2g==",[m
       "license": "Apache-2.0",[m
       "dependencies": {[m
[31m-        "@swc/counter": "^0.1.3",[m
[31m-        "tslib": "^2.4.0"[m
[32m+[m[32m        "tslib": "^2.8.0"[m
       }[m
     },[m
     "node_modules/@tootallnate/once": {[m
[36m@@ -6179,9 +7049,9 @@[m
       }[m
     },[m
     "node_modules/@trpc/server": {[m
[31m-      "version": "10.45.2",[m
[31m-      "resolved": "https://registry.npmjs.org/@trpc/server/-/server-10.45.2.tgz",[m
[31m-      "integrity": "sha512-wOrSThNNE4HUnuhJG6PfDRp4L2009KDVxsd+2VYH8ro6o/7/jwYZ8Uu5j+VaW+mOmc8EHerHzGcdbGNQSAUPgg==",[m
[32m+[m[32m      "version": "10.45.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@trpc/server/-/server-10.45.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-CVZM42FdGwqYQxV7vSRwb//AF8REfV60S/fUnwx7xqCnnSDus0FW/UuAOW4eQJ30RQlOPy4MYU8B3dbTAx85Ew==",[m
       "dev": true,[m
       "funding": [[m
         "https://trpc.io/sponsor"[m
[36m@@ -6296,6 +7166,13 @@[m
       "resolved": "https://registry.npmjs.org/@types/d3-timer/-/d3-timer-3.0.2.tgz",[m
       "integrity": "sha512-Ps3T8E8dZDam6fUyNiMkekK3XUsaUEik+idO9/YjPtfj2qruF8tFBXS7XhtE4iIXBLxhmLjP3SXpLhVf21I9Lw=="[m
     },[m
[32m+[m[32m    "node_modules/@types/estree": {[m
[32m+[m[32m      "version": "1.0.8",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",[m
[32m+[m[32m      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
     "node_modules/@types/express": {[m
       "version": "4.17.23",[m
       "resolved": "https://registry.npmjs.org/@types/express/-/express-4.17.23.tgz",[m
[36m@@ -6580,17 +7457,17 @@[m
       }[m
     },[m
     "node_modules/@typescript-eslint/eslint-plugin": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.49.0.tgz",[m
[31m-      "integrity": "sha512-JXij0vzIaTtCwu6SxTh8qBc66kmf1xs7pI4UOiMDFVct6q86G0Zs7KRcEoJgY3Cav3x5Tq0MF5jwgpgLqgKG3A==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-O7QnmOXYKVtPrfYzMolrCTfkezCJS9+ljLdKW/+DCvRsc3UAz+sbH6Xcsv7p30+0OwUbeWfUDAQE0vpabZ3QLg==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
         "@eslint-community/regexpp": "^4.10.0",[m
[31m-        "@typescript-eslint/scope-manager": "8.49.0",[m
[31m-        "@typescript-eslint/type-utils": "8.49.0",[m
[31m-        "@typescript-eslint/utils": "8.49.0",[m
[31m-        "@typescript-eslint/visitor-keys": "8.49.0",[m
[32m+[m[32m        "@typescript-eslint/scope-manager": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/type-utils": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/utils": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/visitor-keys": "8.50.0",[m
         "ignore": "^7.0.0",[m
         "natural-compare": "^1.4.0",[m
         "ts-api-utils": "^2.1.0"[m
[36m@@ -6603,7 +7480,7 @@[m
         "url": "https://opencollective.com/typescript-eslint"[m
       },[m
       "peerDependencies": {[m
[31m-        "@typescript-eslint/parser": "^8.49.0",[m
[32m+[m[32m        "@typescript-eslint/parser": "^8.50.0",[m
         "eslint": "^8.57.0 || ^9.0.0",[m
         "typescript": ">=4.8.4 <6.0.0"[m
       }[m
[36m@@ -6619,16 +7496,16 @@[m
       }[m
     },[m
     "node_modules/@typescript-eslint/parser": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/parser/-/parser-8.49.0.tgz",[m
[31m-      "integrity": "sha512-N9lBGA9o9aqb1hVMc9hzySbhKibHmB+N3IpoShyV6HyQYRGIhlrO5rQgttypi+yEeKsKI4idxC8Jw6gXKD4THA==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/parser/-/parser-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-6/cmF2piao+f6wSxUsJLZjck7OQsYyRtcOZS02k7XINSNlz93v6emM8WutDQSXnroG2xwYlEVHJI+cPA7CPM3Q==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@typescript-eslint/scope-manager": "8.49.0",[m
[31m-        "@typescript-eslint/types": "8.49.0",[m
[31m-        "@typescript-eslint/typescript-estree": "8.49.0",[m
[31m-        "@typescript-eslint/visitor-keys": "8.49.0",[m
[32m+[m[32m        "@typescript-eslint/scope-manager": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/types": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/typescript-estree": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/visitor-keys": "8.50.0",[m
         "debug": "^4.3.4"[m
       },[m
       "engines": {[m
[36m@@ -6669,14 +7546,14 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/@typescript-eslint/project-service": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/project-service/-/project-service-8.49.0.tgz",[m
[31m-      "integrity": "sha512-/wJN0/DKkmRUMXjZUXYZpD1NEQzQAAn9QWfGwo+Ai8gnzqH7tvqS7oNVdTjKqOcPyVIdZdyCMoqN66Ia789e7g==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/project-service/-/project-service-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Cg/nQcL1BcoTijEWyx4mkVC56r8dj44bFDvBdygifuS20f3OZCHmFbjF34DPSi07kwlFvqfv/xOLnJ5DquxSGQ==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@typescript-eslint/tsconfig-utils": "^8.49.0",[m
[31m-        "@typescript-eslint/types": "^8.49.0",[m
[32m+[m[32m        "@typescript-eslint/tsconfig-utils": "^8.50.0",[m
[32m+[m[32m        "@typescript-eslint/types": "^8.50.0",[m
         "debug": "^4.3.4"[m
       },[m
       "engines": {[m
[36m@@ -6716,14 +7593,14 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/@typescript-eslint/scope-manager": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/scope-manager/-/scope-manager-8.49.0.tgz",[m
[31m-      "integrity": "sha512-npgS3zi+/30KSOkXNs0LQXtsg9ekZ8OISAOLGWA/ZOEn0ZH74Ginfl7foziV8DT+D98WfQ5Kopwqb/PZOaIJGg==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/scope-manager/-/scope-manager-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-xCwfuCZjhIqy7+HKxBLrDVT5q/iq7XBVBXLn57RTIIpelLtEIZHXAF/Upa3+gaCpeV1NNS5Z9A+ID6jn50VD4A==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@typescript-eslint/types": "8.49.0",[m
[31m-        "@typescript-eslint/visitor-keys": "8.49.0"[m
[32m+[m[32m        "@typescript-eslint/types": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/visitor-keys": "8.50.0"[m
       },[m
       "engines": {[m
         "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[36m@@ -6734,9 +7611,9 @@[m
       }[m
     },[m
     "node_modules/@typescript-eslint/tsconfig-utils": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/tsconfig-utils/-/tsconfig-utils-8.49.0.tgz",[m
[31m-      "integrity": "sha512-8prixNi1/6nawsRYxet4YOhnbW+W9FK/bQPxsGB1D3ZrDzbJ5FXw5XmzxZv82X3B+ZccuSxo/X8q9nQ+mFecWA==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/tsconfig-utils/-/tsconfig-utils-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-vxd3G/ybKTSlm31MOA96gqvrRGv9RJ7LGtZCn2Vrc5htA0zCDvcMqUkifcjrWNNKXHUU3WCkYOzzVSFBd0wa2w==",[m
       "dev": true,[m
       "license": "MIT",[m
       "engines": {[m
[36m@@ -6751,15 +7628,15 @@[m
       }[m
     },[m
     "node_modules/@typescript-eslint/type-utils": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/type-utils/-/type-utils-8.49.0.tgz",[m
[31m-      "integrity": "sha512-KTExJfQ+svY8I10P4HdxKzWsvtVnsuCifU5MvXrRwoP2KOlNZ9ADNEWWsQTJgMxLzS5VLQKDjkCT/YzgsnqmZg==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/type-utils/-/type-utils-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-7OciHT2lKCewR0mFoBrvZJ4AXTMe/sYOe87289WAViOocEmDjjv8MvIOT2XESuKj9jp8u3SZYUSh89QA4S1kQw==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@typescript-eslint/types": "8.49.0",[m
[31m-        "@typescript-eslint/typescript-estree": "8.49.0",[m
[31m-        "@typescript-eslint/utils": "8.49.0",[m
[32m+[m[32m        "@typescript-eslint/types": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/typescript-estree": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/utils": "8.50.0",[m
         "debug": "^4.3.4",[m
         "ts-api-utils": "^2.1.0"[m
       },[m
[36m@@ -6801,9 +7678,9 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/@typescript-eslint/types": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/types/-/types-8.49.0.tgz",[m
[31m-      "integrity": "sha512-e9k/fneezorUo6WShlQpMxXh8/8wfyc+biu6tnAqA81oWrEic0k21RHzP9uqqpyBBeBKu4T+Bsjy9/b8u7obXQ==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/types/-/types-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-iX1mgmGrXdANhhITbpp2QQM2fGehBse9LbTf0sidWK6yg/NE+uhV5dfU1g6EYPlcReYmkE9QLPq/2irKAmtS9w==",[m
       "dev": true,[m
       "license": "MIT",[m
       "engines": {[m
[36m@@ -6815,16 +7692,16 @@[m
       }[m
     },[m
     "node_modules/@typescript-eslint/typescript-estree": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-8.49.0.tgz",[m
[31m-      "integrity": "sha512-jrLdRuAbPfPIdYNppHJ/D0wN+wwNfJ32YTAm10eJVsFmrVpXQnDWBn8niCSMlWjvml8jsce5E/O+86IQtTbJWA==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-W7SVAGBR/IX7zm1t70Yujpbk+zdPq/u4soeFSknWFdXIFuWsBGBOUu/Tn/I6KHSKvSh91OiMuaSnYp3mtPt5IQ==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@typescript-eslint/project-service": "8.49.0",[m
[31m-        "@typescript-eslint/tsconfig-utils": "8.49.0",[m
[31m-        "@typescript-eslint/types": "8.49.0",[m
[31m-        "@typescript-eslint/visitor-keys": "8.49.0",[m
[32m+[m[32m        "@typescript-eslint/project-service": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/tsconfig-utils": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/types": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/visitor-keys": "8.50.0",[m
         "debug": "^4.3.4",[m
         "minimatch": "^9.0.4",[m
         "semver": "^7.6.0",[m
[36m@@ -6868,16 +7745,16 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/@typescript-eslint/utils": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/utils/-/utils-8.49.0.tgz",[m
[31m-      "integrity": "sha512-N3W7rJw7Rw+z1tRsHZbK395TWSYvufBXumYtEGzypgMUthlg0/hmCImeA8hgO2d2G4pd7ftpxxul2J8OdtdaFA==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/utils/-/utils-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-87KgUXET09CRjGCi2Ejxy3PULXna63/bMYv72tCAlDJC3Yqwln0HiFJ3VJMst2+mEtNtZu5oFvX4qJGjKsnAgg==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
         "@eslint-community/eslint-utils": "^4.7.0",[m
[31m-        "@typescript-eslint/scope-manager": "8.49.0",[m
[31m-        "@typescript-eslint/types": "8.49.0",[m
[31m-        "@typescript-eslint/typescript-estree": "8.49.0"[m
[32m+[m[32m        "@typescript-eslint/scope-manager": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/types": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/typescript-estree": "8.50.0"[m
       },[m
       "engines": {[m
         "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[36m@@ -6892,13 +7769,13 @@[m
       }[m
     },[m
     "node_modules/@typescript-eslint/visitor-keys": {[m
[31m-      "version": "8.49.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@typescript-eslint/visitor-keys/-/visitor-keys-8.49.0.tgz",[m
[31m-      "integrity": "sha512-LlKaciDe3GmZFphXIc79THF/YYBugZ7FS1pO581E/edlVVNbZKDy93evqmrfQ9/Y4uN0vVhX4iuchq26mK/iiA==",[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/@typescript-eslint/visitor-keys/-/visitor-keys-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Xzmnb58+Db78gT/CCj/PVCvK+zxbnsw6F+O1oheYszJbBSdEjVhQi3C/Xttzxgi/GLmpvOggRs1RFpiJ8+c34Q==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@typescript-eslint/types": "8.49.0",[m
[32m+[m[32m        "@typescript-eslint/types": "8.50.0",[m
         "eslint-visitor-keys": "^4.2.1"[m
       },[m
       "engines": {[m
[36m@@ -6922,13 +7799,6 @@[m
         "url": "https://opencollective.com/eslint"[m
       }[m
     },[m
[31m-    "node_modules/@ungap/structured-clone": {[m
[31m-      "version": "1.3.0",[m
[31m-      "resolved": "https://registry.npmjs.org/@ungap/structured-clone/-/structured-clone-1.3.0.tgz",[m
[31m-      "integrity": "sha512-WmoN8qaIAo7WTYWbAZuG8PYEhn5fkz7dZrqTBZ7dtt//lL2Gwms1IcnQ5yHqjDfX8Ft5j4YzDM23f87zBfDe9g==",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC"[m
[31m-    },[m
     "node_modules/@unrs/resolver-binding-android-arm-eabi": {[m
       "version": "1.11.1",[m
       "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-android-arm-eabi/-/resolver-binding-android-arm-eabi-1.11.1.tgz",[m
[36m@@ -7699,6 +8569,15 @@[m
         }[m
       ][m
     },[m
[32m+[m[32m    "node_modules/baseline-browser-mapping": {[m
[32m+[m[32m      "version": "2.9.10",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/baseline-browser-mapping/-/baseline-browser-mapping-2.9.10.tgz",[m
[32m+[m[32m      "integrity": "sha512-2VIKvDx8Z1a9rTB2eCkdPE5nSe28XnA+qivGnWHoB40hMMt/h1hSz0960Zqsn6ZyxWXUie0EBdElKv8may20AA==",[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "baseline-browser-mapping": "dist/cli.js"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/bcryptjs": {[m
       "version": "3.0.3",[m
       "resolved": "https://registry.npmjs.org/bcryptjs/-/bcryptjs-3.0.3.tgz",[m
[36m@@ -7783,6 +8662,41 @@[m
         "node": ">=8"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/browserslist": {[m
[32m+[m[32m      "version": "4.28.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/browserslist/-/browserslist-4.28.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-ZC5Bd0LgJXgwGqUknZY/vkUQ04r8NXnJZ3yYi4vDmSiZmC/pdSN0NbNRPxZpbtO4uAfDUAFffO8IZoM3Gj8IkA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "funding": [[m
[32m+[m[32m        {[m
[32m+[m[32m          "type": "opencollective",[m
[32m+[m[32m          "url": "https://opencollective.com/browserslist"[m
[32m+[m[32m        },[m
[32m+[m[32m        {[m
[32m+[m[32m          "type": "tidelift",[m
[32m+[m[32m          "url": "https://tidelift.com/funding/github/npm/browserslist"[m
[32m+[m[32m        },[m
[32m+[m[32m        {[m
[32m+[m[32m          "type": "github",[m
[32m+[m[32m          "url": "https://github.com/sponsors/ai"[m
[32m+[m[32m        }[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "peer": true,[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "baseline-browser-mapping": "^2.9.0",[m
[32m+[m[32m        "caniuse-lite": "^1.0.30001759",[m
[32m+[m[32m        "electron-to-chromium": "^1.5.263",[m
[32m+[m[32m        "node-releases": "^2.0.27",[m
[32m+[m[32m        "update-browserslist-db": "^1.2.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "browserslist": "cli.js"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/buffer": {[m
       "version": "5.7.1",[m
       "resolved": "https://registry.npmjs.org/buffer/-/buffer-5.7.1.tgz",[m
[36m@@ -7837,17 +8751,6 @@[m
         "node": ">= 0.10.x"[m
       }[m
     },[m
[31m-    "node_modules/busboy": {[m
[31m-      "version": "1.6.0",[m
[31m-      "resolved": "https://registry.npmjs.org/busboy/-/busboy-1.6.0.tgz",[m
[31m-      "integrity": "sha512-8SFQbg/0hQ9xy3UNTB0YEnsNBbWfhf7RtnzpL7TkBiTBRfrQ9Fxcnz7VJsleJpyp6rVLvXiuORqjlHi5q+PYuA==",[m
[31m-      "dependencies": {[m
[31m-        "streamsearch": "^1.1.0"[m
[31m-      },[m
[31m-      "engines": {[m
[31m-        "node": ">=10.16.0"[m
[31m-      }[m
[31m-    },[m
     "node_modules/bytes": {[m
       "version": "3.1.2",[m
       "resolved": "https://registry.npmjs.org/bytes/-/bytes-3.1.2.tgz",[m
[36m@@ -7922,9 +8825,9 @@[m
       }[m
     },[m
     "node_modules/caniuse-lite": {[m
[31m-      "version": "1.0.30001699",[m
[31m-      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001699.tgz",[m
[31m-      "integrity": "sha512-b+uH5BakXZ9Do9iK+CkDmctUSEqZl+SP056vc5usa0PL+ev5OHw003rZXcnjNDv3L8P5j6rwT6C0BPKSikW08w==",[m
[32m+[m[32m      "version": "1.0.30001760",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001760.tgz",[m
[32m+[m[32m      "integrity": "sha512-7AAMPcueWELt1p3mi13HR/LHH0TJLT11cnwDJEs3xA4+CK/PLKeO9Kl1oru24htkyUKtkGCvAx4ohB0Ttry8Dw==",[m
       "funding": [[m
         {[m
           "type": "opencollective",[m
[36m@@ -7938,7 +8841,8 @@[m
           "type": "github",[m
           "url": "https://github.com/sponsors/ai"[m
         }[m
[31m-      ][m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "CC-BY-4.0"[m
     },[m
     "node_modules/canvg": {[m
       "version": "3.0.11",[m
[36m@@ -8375,6 +9279,13 @@[m
         "node": ">= 0.6"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/convert-source-map": {[m
[32m+[m[32m      "version": "2.0.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/convert-source-map/-/convert-source-map-2.0.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
     "node_modules/cookie": {[m
       "version": "0.7.1",[m
       "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.1.tgz",[m
[36m@@ -8759,6 +9670,16 @@[m
         "npm": "1.2.8000 || >= 1.4.16"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/detect-libc": {[m
[32m+[m[32m      "version": "2.1.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/detect-libc/-/detect-libc-2.1.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-Btj2BOOO83o3WyH59e8MgXsxEQVcarkUOpEYrubB0urwnN10yQ364rsiByU11nZlqWYZm05i/of7io4mzihBtQ==",[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=8"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/detect-node-es": {[m
       "version": "1.1.0",[m
       "resolved": "https://registry.npmjs.org/detect-node-es/-/detect-node-es-1.1.0.tgz",[m
[36m@@ -8784,19 +9705,6 @@[m
         "node": ">=16"[m
       }[m
     },[m
[31m-    "node_modules/doctrine": {[m
[31m-      "version": "3.0.0",[m
[31m-      "resolved": "https://registry.npmjs.org/doctrine/-/doctrine-3.0.0.tgz",[m
[31m-      "integrity": "sha512-yS+Q5i3hBf7GBkd4KG8a7eBNNWNGLTaEwwYWUijIYM7zrlYDM0BFXHjjPWlWZ1Rg7UaddZeIDmi9jF3HmqiQ2w==",[m
[31m-      "dev": true,[m
[31m-      "license": "Apache-2.0",[m
[31m-      "dependencies": {[m
[31m-        "esutils": "^2.0.2"[m
[31m-      },[m
[31m-      "engines": {[m
[31m-        "node": ">=6.0.0"[m
[31m-      }[m
[31m-    },[m
     "node_modules/dom-helpers": {[m
       "version": "5.2.1",[m
       "resolved": "https://registry.npmjs.org/dom-helpers/-/dom-helpers-5.2.1.tgz",[m
[36m@@ -8906,6 +9814,13 @@[m
       "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",[m
       "license": "MIT"[m
     },[m
[32m+[m[32m    "node_modules/electron-to-chromium": {[m
[32m+[m[32m      "version": "1.5.267",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/electron-to-chromium/-/electron-to-chromium-1.5.267.tgz",[m
[32m+[m[32m      "integrity": "sha512-0Drusm6MVRXSOJpGbaSVgcQsuB4hEkMpHXaVstcPmhu5LIedxs1xNK/nIxmQIU/RPC0+1/o0AVZfBTkTNJOdUw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "ISC"[m
[32m+[m[32m    },[m
     "node_modules/embla-carousel": {[m
       "version": "8.6.0",[m
       "resolved": "https://registry.npmjs.org/embla-carousel/-/embla-carousel-8.6.0.tgz",[m
[36m@@ -9218,82 +10133,84 @@[m
       }[m
     },[m
     "node_modules/eslint": {[m
[31m-      "version": "8.57.1",[m
[31m-      "resolved": "https://registry.npmjs.org/eslint/-/eslint-8.57.1.tgz",[m
[31m-      "integrity": "sha512-ypowyDxpVSYpkXr9WPv2PAZCtNip1Mv5KTW0SCurXv/9iOpcrH9PaqUElksqEB6pChqHGDRCFTyrZlGhnLNGiA==",[m
[31m-      "deprecated": "This version is no longer supported. Please see https://eslint.org/version-support for other options.",[m
[32m+[m[32m      "version": "9.39.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/eslint/-/eslint-9.39.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-LEyamqS7W5HB3ujJyvi0HQK/dtVINZvd5mAAp9eT5S/ujByGjiZLCzPcHVzuXbpJDJF/cxwHlfceVUDZ2lnSTw==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@eslint-community/eslint-utils": "^4.2.0",[m
[31m-        "@eslint-community/regexpp": "^4.6.1",[m
[31m-        "@eslint/eslintrc": "^2.1.4",[m
[31m-        "@eslint/js": "8.57.1",[m
[31m-        "@humanwhocodes/config-array": "^0.13.0",[m
[32m+[m[32m        "@eslint-community/eslint-utils": "^4.8.0",[m
[32m+[m[32m        "@eslint-community/regexpp": "^4.12.1",[m
[32m+[m[32m        "@eslint/config-array": "^0.21.1",[m
[32m+[m[32m        "@eslint/config-helpers": "^0.4.2",[m
[32m+[m[32m        "@eslint/core": "^0.17.0",[m
[32m+[m[32m        "@eslint/eslintrc": "^3.3.1",[m
[32m+[m[32m        "@eslint/js": "9.39.2",[m
[32m+[m[32m        "@eslint/plugin-kit": "^0.4.1",[m
[32m+[m[32m        "@humanfs/node": "^0.16.6",[m
         "@humanwhocodes/module-importer": "^1.0.1",[m
[31m-        "@nodelib/fs.walk": "^1.2.8",[m
[31m-        "@ungap/structured-clone": "^1.2.0",[m
[32m+[m[32m        "@humanwhocodes/retry": "^0.4.2",[m
[32m+[m[32m        "@types/estree": "^1.0.6",[m
         "ajv": "^6.12.4",[m
         "chalk": "^4.0.0",[m
[31m-        "cross-spawn": "^7.0.2",[m
[32m+[m[32m        "cross-spawn": "^7.0.6",[m
         "debug": "^4.3.2",[m
[31m-        "doctrine": "^3.0.0",[m
         "escape-string-regexp": "^4.0.0",[m
[31m-        "eslint-scope": "^7.2.2",[m
[31m-        "eslint-visitor-keys": "^3.4.3",[m
[31m-        "espree": "^9.6.1",[m
[31m-        "esquery": "^1.4.2",[m
[32m+[m[32m        "eslint-scope": "^8.4.0",[m
[32m+[m[32m        "eslint-visitor-keys": "^4.2.1",[m
[32m+[m[32m        "espree": "^10.4.0",[m
[32m+[m[32m        "esquery": "^1.5.0",[m
         "esutils": "^2.0.2",[m
         "fast-deep-equal": "^3.1.3",[m
[31m-        "file-entry-cache": "^6.0.1",[m
[32m+[m[32m        "file-entry-cache": "^8.0.0",[m
         "find-up": "^5.0.0",[m
         "glob-parent": "^6.0.2",[m
[31m-        "globals": "^13.19.0",[m
[31m-        "graphemer": "^1.4.0",[m
         "ignore": "^5.2.0",[m
         "imurmurhash": "^0.1.4",[m
         "is-glob": "^4.0.0",[m
[31m-        "is-path-inside": "^3.0.3",[m
[31m-        "js-yaml": "^4.1.0",[m
         "json-stable-stringify-without-jsonify": "^1.0.1",[m
[31m-        "levn": "^0.4.1",[m
         "lodash.merge": "^4.6.2",[m
         "minimatch": "^3.1.2",[m
         "natural-compare": "^1.4.0",[m
[31m-        "optionator": "^0.9.3",[m
[31m-        "strip-ansi": "^6.0.1",[m
[31m-        "text-table": "^0.2.0"[m
[32m+[m[32m        "optionator": "^0.9.3"[m
       },[m
       "bin": {[m
         "eslint": "bin/eslint.js"[m
       },[m
       "engines": {[m
[31m-        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
       },[m
       "funding": {[m
[31m-        "url": "https://opencollective.com/eslint"[m
[32m+[m[32m        "url": "https://eslint.org/donate"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "jiti": "*"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependenciesMeta": {[m
[32m+[m[32m        "jiti": {[m
[32m+[m[32m          "optional": true[m
[32m+[m[32m        }[m
       }[m
     },[m
     "node_modules/eslint-config-next": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/eslint-config-next/-/eslint-config-next-14.2.33.tgz",[m
[31m-      "integrity": "sha512-e2W+waB+I5KuoALAtKZl3WVDU4Q1MS6gF/gdcwHh0WOAkHf4TZI6dPjd25wKhlZFAsFrVKy24Z7/IwOhn8dHBw==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/eslint-config-next/-/eslint-config-next-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-RlPb8E2uO/Ix/w3kizxz6+6ogw99WqtNzTG0ArRZ5NEkIYcsfRb8U0j7aTG7NjRvcrsak5QtUSuxGNN2UcA58g==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@next/eslint-plugin-next": "14.2.33",[m
[31m-        "@rushstack/eslint-patch": "^1.3.3",[m
[31m-        "@typescript-eslint/eslint-plugin": "^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0",[m
[31m-        "@typescript-eslint/parser": "^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0",[m
[32m+[m[32m        "@next/eslint-plugin-next": "16.1.0",[m
         "eslint-import-resolver-node": "^0.3.6",[m
         "eslint-import-resolver-typescript": "^3.5.2",[m
[31m-        "eslint-plugin-import": "^2.28.1",[m
[31m-        "eslint-plugin-jsx-a11y": "^6.7.1",[m
[31m-        "eslint-plugin-react": "^7.33.2",[m
[31m-        "eslint-plugin-react-hooks": "^4.5.0 || 5.0.0-canary-7118f5dd7-20230705"[m
[32m+[m[32m        "eslint-plugin-import": "^2.32.0",[m
[32m+[m[32m        "eslint-plugin-jsx-a11y": "^6.10.0",[m
[32m+[m[32m        "eslint-plugin-react": "^7.37.0",[m
[32m+[m[32m        "eslint-plugin-react-hooks": "^7.0.0",[m
[32m+[m[32m        "globals": "16.4.0",[m
[32m+[m[32m        "typescript-eslint": "^8.46.0"[m
       },[m
       "peerDependencies": {[m
[31m-        "eslint": "^7.23.0 || ^8.0.0",[m
[32m+[m[32m        "eslint": ">=9.0.0",[m
         "typescript": ">=3.3.1"[m
       },[m
       "peerDependenciesMeta": {[m
[36m@@ -9302,6 +10219,19 @@[m
         }[m
       }[m
     },[m
[32m+[m[32m    "node_modules/eslint-config-next/node_modules/globals": {[m
[32m+[m[32m      "version": "16.4.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/globals/-/globals-16.4.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-ob/2LcVVaVGCYN+r14cnwnoDPUufjiYgSqRhiFD0Q1iI4Odora5RE8Iv1D24hAz5oMophRGkGz+yuvQmmUMnMw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=18"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://github.com/sponsors/sindresorhus"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/eslint-import-resolver-node": {[m
       "version": "0.3.9",[m
       "resolved": "https://registry.npmjs.org/eslint-import-resolver-node/-/eslint-import-resolver-node-0.3.9.tgz",[m
[36m@@ -9612,16 +10542,47 @@[m
       }[m
     },[m
     "node_modules/eslint-plugin-react-hooks": {[m
[31m-      "version": "5.0.0-canary-7118f5dd7-20230705",[m
[31m-      "resolved": "https://registry.npmjs.org/eslint-plugin-react-hooks/-/eslint-plugin-react-hooks-5.0.0-canary-7118f5dd7-20230705.tgz",[m
[31m-      "integrity": "sha512-AZYbMo/NW9chdL7vk6HQzQhT+PvTAEVqWk9ziruUoW2kAOcN5qNyelv70e0F1VNQAbvutOC9oc+xfWycI9FxDw==",[m
[32m+[m[32m      "version": "7.0.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/eslint-plugin-react-hooks/-/eslint-plugin-react-hooks-7.0.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-O0d0m04evaNzEPoSW+59Mezf8Qt0InfgGIBJnpC0h3NH/WjUAR7BIKUfysC6todmtiZ/A0oUVS8Gce0WhBrHsA==",[m
       "dev": true,[m
       "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@babel/core": "^7.24.4",[m
[32m+[m[32m        "@babel/parser": "^7.24.4",[m
[32m+[m[32m        "hermes-parser": "^0.25.1",[m
[32m+[m[32m        "zod": "^3.25.0 || ^4.0.0",[m
[32m+[m[32m        "zod-validation-error": "^3.5.0 || ^4.0.0"[m
[32m+[m[32m      },[m
       "engines": {[m
[31m-        "node": ">=10"[m
[32m+[m[32m        "node": ">=18"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "eslint": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/eslint-plugin-react-hooks/node_modules/zod": {[m
[32m+[m[32m      "version": "4.2.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/zod/-/zod-4.2.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-0wZ1IRqGGhMP76gLqz8EyfBXKk0J2qo2+H3fi4mcUP/KtTocoX08nmIAHl1Z2kJIZbZee8KOpBCSNPRgauucjw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "peer": true,[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://github.com/sponsors/colinhacks"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/eslint-plugin-react-hooks/node_modules/zod-validation-error": {[m
[32m+[m[32m      "version": "4.0.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/zod-validation-error/-/zod-validation-error-4.0.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-Q6/nZLe6jxuU80qb/4uJ4t5v2VEZ44lzQjPDhYJNztRQ4wyWc6VF3D3Kb/fAuPetZQnhS3hnajCf9CsWesghLQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=18.0.0"[m
       },[m
       "peerDependencies": {[m
[31m-        "eslint": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0"[m
[32m+[m[32m        "zod": "^3.25.0 || ^4.0.0"[m
       }[m
     },[m
     "node_modules/eslint-plugin-react/node_modules/brace-expansion": {[m
[36m@@ -9690,9 +10651,9 @@[m
       }[m
     },[m
     "node_modules/eslint-scope": {[m
[31m-      "version": "7.2.2",[m
[31m-      "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-7.2.2.tgz",[m
[31m-      "integrity": "sha512-dOt21O7lTMhDM+X9mB4GX+DZrZtCUJPL/wlcTqxyrx5IvO0IYtILdtrQGQp+8n5S0gwSVmOf9NQrjMOgfQZlIg==",[m
[32m+[m[32m      "version": "8.4.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-8.4.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-sNXOfKCn74rt8RICKMvJS7XKV/Xk9kA7DyJr8mJik3S7Cwgy3qlkkmyS2uQB3jiJg6VNdZd/pDBJu0nvG2NlTg==",[m
       "dev": true,[m
       "license": "BSD-2-Clause",[m
       "dependencies": {[m
[36m@@ -9700,7 +10661,7 @@[m
         "estraverse": "^5.2.0"[m
       },[m
       "engines": {[m
[31m-        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
       },[m
       "funding": {[m
         "url": "https://opencollective.com/eslint"[m
[36m@@ -9736,16 +10697,6 @@[m
         "url": "https://github.com/sponsors/epoberezkin"[m
       }[m
     },[m
[31m-    "node_modules/eslint/node_modules/ansi-regex": {[m
[31m-      "version": "5.0.1",[m
[31m-      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",[m
[31m-      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "engines": {[m
[31m-        "node": ">=8"[m
[31m-      }[m
[31m-    },[m
     "node_modules/eslint/node_modules/brace-expansion": {[m
       "version": "1.1.12",[m
       "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",[m
[36m@@ -9775,6 +10726,19 @@[m
         }[m
       }[m
     },[m
[32m+[m[32m    "node_modules/eslint/node_modules/eslint-visitor-keys": {[m
[32m+[m[32m      "version": "4.2.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-4.2.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/eslint"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/eslint/node_modules/json-schema-traverse": {[m
       "version": "0.4.1",[m
       "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",[m
[36m@@ -9802,32 +10766,32 @@[m
       "dev": true,[m
       "license": "MIT"[m
     },[m
[31m-    "node_modules/eslint/node_modules/strip-ansi": {[m
[31m-      "version": "6.0.1",[m
[31m-      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",[m
[31m-      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",[m
[32m+[m[32m    "node_modules/espree": {[m
[32m+[m[32m      "version": "10.4.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/espree/-/espree-10.4.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-j6PAQ2uUr79PZhBjP5C5fhl8e39FmRnOjsD5lGnWrFU8i2G776tBK7+nP8KuQUTTyAZUwfQqXAgrVH5MbH9CYQ==",[m
       "dev": true,[m
[31m-      "license": "MIT",[m
[32m+[m[32m      "license": "BSD-2-Clause",[m
       "dependencies": {[m
[31m-        "ansi-regex": "^5.0.1"[m
[32m+[m[32m        "acorn": "^8.15.0",[m
[32m+[m[32m        "acorn-jsx": "^5.3.2",[m
[32m+[m[32m        "eslint-visitor-keys": "^4.2.1"[m
       },[m
       "engines": {[m
[31m-        "node": ">=8"[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/eslint"[m
       }[m
     },[m
[31m-    "node_modules/espree": {[m
[31m-      "version": "9.6.1",[m
[31m-      "resolved": "https://registry.npmjs.org/espree/-/espree-9.6.1.tgz",[m
[31m-      "integrity": "sha512-oruZaFkjorTpF32kDSI5/75ViwGeZginGGy2NoOSg3Q9bnwlnmDm4HLnkl0RE3n+njDXR037aY1+x58Z/zFdwQ==",[m
[32m+[m[32m    "node_modules/espree/node_modules/eslint-visitor-keys": {[m
[32m+[m[32m      "version": "4.2.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-4.2.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==",[m
       "dev": true,[m
[31m-      "license": "BSD-2-Clause",[m
[31m-      "dependencies": {[m
[31m-        "acorn": "^8.9.0",[m
[31m-        "acorn-jsx": "^5.3.2",[m
[31m-        "eslint-visitor-keys": "^3.4.1"[m
[31m-      },[m
[32m+[m[32m      "license": "Apache-2.0",[m
       "engines": {[m
[31m-        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
       },[m
       "funding": {[m
         "url": "https://opencollective.com/eslint"[m
[36m@@ -10249,16 +11213,16 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/file-entry-cache": {[m
[31m-      "version": "6.0.1",[m
[31m-      "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-6.0.1.tgz",[m
[31m-      "integrity": "sha512-7Gps/XWymbLk2QLYK4NzpMOrYjMhdIxXuIvy2QBsLE6ljuodKvdkWs/cpyJJ3CVIVpH0Oi1Hvg1ovbMzLdFBBg==",[m
[32m+[m[32m      "version": "8.0.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-8.0.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "flat-cache": "^3.0.4"[m
[32m+[m[32m        "flat-cache": "^4.0.0"[m
       },[m
       "engines": {[m
[31m-        "node": "^10.12.0 || >=12.0.0"[m
[32m+[m[32m        "node": ">=16.0.0"[m
       }[m
     },[m
     "node_modules/fill-range": {[m
[36m@@ -10424,18 +11388,17 @@[m
       }[m
     },[m
     "node_modules/flat-cache": {[m
[31m-      "version": "3.2.0",[m
[31m-      "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-3.2.0.tgz",[m
[31m-      "integrity": "sha512-CYcENa+FtcUKLmhhqyctpclsq7QF38pKjZHsGNiSQF5r4FtoKDWabFDl3hzaEQMvT1LHEysw5twgLvpYYb4vbw==",[m
[32m+[m[32m      "version": "4.0.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-4.0.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==",[m
       "dev": true,[m
       "license": "MIT",[m
       "dependencies": {[m
         "flatted": "^3.2.9",[m
[31m-        "keyv": "^4.5.3",[m
[31m-        "rimraf": "^3.0.2"[m
[32m+[m[32m        "keyv": "^4.5.4"[m
       },[m
       "engines": {[m
[31m-        "node": "^10.12.0 || >=12.0.0"[m
[32m+[m[32m        "node": ">=16"[m
       }[m
     },[m
     "node_modules/flatted": {[m
[36m@@ -10571,13 +11534,6 @@[m
         "node": ">=12"[m
       }[m
     },[m
[31m-    "node_modules/fs.realpath": {[m
[31m-      "version": "1.0.0",[m
[31m-      "resolved": "https://registry.npmjs.org/fs.realpath/-/fs.realpath-1.0.0.tgz",[m
[31m-      "integrity": "sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC"[m
[31m-    },[m
     "node_modules/fsevents": {[m
       "version": "2.3.3",[m
       "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",[m
[36m@@ -10750,6 +11706,16 @@[m
         "node": ">=16"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/gensync": {[m
[32m+[m[32m      "version": "1.0.0-beta.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/gensync/-/gensync-1.0.0-beta.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/get-caller-file": {[m
       "version": "2.0.5",[m
       "resolved": "https://registry.npmjs.org/get-caller-file/-/get-caller-file-2.0.5.tgz",[m
[36m@@ -10892,16 +11858,13 @@[m
       }[m
     },[m
     "node_modules/globals": {[m
[31m-      "version": "13.24.0",[m
[31m-      "resolved": "https://registry.npmjs.org/globals/-/globals-13.24.0.tgz",[m
[31m-      "integrity": "sha512-AhO5QUcj8llrbG09iWhPU2B204J1xnPeL8kQmVorSsy+Sjj1sk8gIyh6cUocGmH4L0UuhAJy+hJMRA4mgA4mFQ==",[m
[32m+[m[32m      "version": "14.0.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/globals/-/globals-14.0.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==",[m
       "dev": true,[m
       "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "type-fest": "^0.20.2"[m
[31m-      },[m
       "engines": {[m
[31m-        "node": ">=8"[m
[32m+[m[32m        "node": ">=18"[m
       },[m
       "funding": {[m
         "url": "https://github.com/sponsors/sindresorhus"[m
[36m@@ -11069,13 +12032,6 @@[m
       "resolved": "https://registry.npmjs.org/graceful-fs/-/graceful-fs-4.2.11.tgz",[m
       "integrity": "sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ=="[m
     },[m
[31m-    "node_modules/graphemer": {[m
[31m-      "version": "1.4.0",[m
[31m-      "resolved": "https://registry.npmjs.org/graphemer/-/graphemer-1.4.0.tgz",[m
[31m-      "integrity": "sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT"[m
[31m-    },[m
     "node_modules/gtoken": {[m
       "version": "7.1.0",[m
       "resolved": "https://registry.npmjs.org/gtoken/-/gtoken-7.1.0.tgz",[m
[36m@@ -11195,6 +12151,23 @@[m
         "node": ">= 0.4"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/hermes-estree": {[m
[32m+[m[32m      "version": "0.25.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/hermes-estree/-/hermes-estree-0.25.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-0wUoCcLp+5Ev5pDW2OriHC2MJCbwLwuRx+gAqMTOkGKJJiBCLjtrvy4PWUGn6MIVefecRpzoOZ/UV6iGdOr+Cw==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
[32m+[m[32m    "node_modules/hermes-parser": {[m
[32m+[m[32m      "version": "0.25.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/hermes-parser/-/hermes-parser-0.25.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-6pEjquH3rqaI6cYAXYPcz9MS4rY6R4ngRgrgfDshRptUZIc3lw0MCIJIGDj9++mfySOuPTHB4nrSW99BCvOPIA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "hermes-estree": "0.25.1"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/hexer": {[m
       "version": "1.5.0",[m
       "resolved": "https://registry.npmjs.org/hexer/-/hexer-1.5.0.tgz",[m
[36m@@ -11212,6 +12185,17 @@[m
         "node": ">= 0.10.x"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/hono": {[m
[32m+[m[32m      "version": "4.11.1",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/hono/-/hono-4.11.1.tgz",[m
[32m+[m[32m      "integrity": "sha512-KsFcH0xxHes0J4zaQgWbYwmz3UPOOskdqZmItstUG93+Wk1ePBLkLGwbP9zlmh1BFUiL8Qp+Xfu9P7feJWpGNg==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "peer": true,[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=16.9.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/html-entities": {[m
       "version": "2.6.0",[m
       "resolved": "https://registry.npmjs.org/html-entities/-/html-entities-2.6.0.tgz",[m
[36m@@ -11439,18 +12423,6 @@[m
         "node": ">=0.8.19"[m
       }[m
     },[m
[31m-    "node_modules/inflight": {[m
[31m-      "version": "1.0.6",[m
[31m-      "resolved": "https://registry.npmjs.org/inflight/-/inflight-1.0.6.tgz",[m
[31m-      "integrity": "sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==",[m
[31m-      "deprecated": "This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC",[m
[31m-      "dependencies": {[m
[31m-        "once": "^1.3.0",[m
[31m-        "wrappy": "1"[m
[31m-      }[m
[31m-    },[m
     "node_modules/inherits": {[m
       "version": "2.0.4",[m
       "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",[m
[36m@@ -11802,16 +12774,6 @@[m
         "node": ">=8"[m
       }[m
     },[m
[31m-    "node_modules/is-path-inside": {[m
[31m-      "version": "3.0.3",[m
[31m-      "resolved": "https://registry.npmjs.org/is-path-inside/-/is-path-inside-3.0.3.tgz",[m
[31m-      "integrity": "sha512-Fd4gABb+ycGAmKou8eMftCupSir5lRxqf4aD/vd0cD2qc4HL07OjCeuHMr8Ro4CoMaeCKDB0/ECBOVWjTwUvPQ==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "engines": {[m
[31m-        "node": ">=8"[m
[31m-      }[m
[31m-    },[m
     "node_modules/is-promise": {[m
       "version": "4.0.0",[m
       "resolved": "https://registry.npmjs.org/is-promise/-/is-promise-4.0.0.tgz",[m
[36m@@ -12075,6 +13037,7 @@[m
       "version": "1.21.7",[m
       "resolved": "https://registry.npmjs.org/jiti/-/jiti-1.21.7.tgz",[m
       "integrity": "sha512-/imKNG4EbWNrVjoNC/1H5/9GFy+tqjGBHCaSsN+P2RnPqjsLmv6UD3Ej+Kj8nBWaRAwyk7kK5ZUc+OEatnTR3A==",[m
[32m+[m[32m      "peer": true,[m
       "bin": {[m
         "jiti": "bin/jiti.js"[m
       }[m
[36m@@ -12106,6 +13069,19 @@[m
         "js-yaml": "bin/js-yaml.js"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/jsesc": {[m
[32m+[m[32m      "version": "3.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-3.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "jsesc": "bin/jsesc"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": ">=6"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/json-2-csv": {[m
       "version": "5.5.9",[m
       "resolved": "https://registry.npmjs.org/json-2-csv/-/json-2-csv-5.5.9.tgz",[m
[36m@@ -12147,6 +13123,13 @@[m
       "integrity": "sha512-NM8/P9n3XjXhIZn1lLhkFaACTOURQXjWhV4BA/RnOv8xvgqtqpAX9IO4mRQxSx1Rlo4tqzeqb0sOlruaOy3dug==",[m
       "license": "MIT"[m
     },[m
[32m+[m[32m    "node_modules/json-schema-typed": {[m
[32m+[m[32m      "version": "8.0.2",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/json-schema-typed/-/json-schema-typed-8.0.2.tgz",[m
[32m+[m[32m      "integrity": "sha512-fQhoXdcvc3V28x7C7BMs4P5+kNlgUURe2jmUT1T//oBRMDrqy1QPelJimwZGo7Hg9VPV3EQV5Bnq4hbFy2vetA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "BSD-2-Clause"[m
[32m+[m[32m    },[m
     "node_modules/json-stable-stringify": {[m
       "version": "1.2.1",[m
       "resolved": "https://registry.npmjs.org/json-stable-stringify/-/json-stable-stringify-1.2.1.tgz",[m
[36m@@ -12662,48 +13645,6 @@[m
         "node": ">= 0.6"[m
       }[m
     },[m
[31m-    "node_modules/mercadopago": {[m
[31m-      "version": "2.10.0",[m
[31m-      "resolved": "https://registry.npmjs.org/mercadopago/-/mercadopago-2.10.0.tgz",[m
[31m-      "integrity": "sha512-G5wW+sxrteLwk2zipMUF9UOmJuFABI3W5KiDkb7xVt74IcHxPxHjI/81QjLMYFIYQZm7pO5L3/ieAsVvyLbmwg==",[m
[31m-      "dependencies": {[m
[31m-        "node-fetch": "^2.7.0",[m
[31m-        "uuid": "^9.0.0"[m
[31m-      }[m
[31m-    },[m
[31m-    "node_modules/mercadopago/node_modules/node-fetch": {[m
[31m-      "version": "2.7.0",[m
[31m-      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz",[m
[31m-      "integrity": "sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==",[m
[31m-      "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "whatwg-url": "^5.0.0"[m
[31m-      },[m
[31m-      "engines": {[m
[31m-        "node": "4.x || >=6.0.0"[m
[31m-      },[m
[31m-      "peerDependencies": {[m
[31m-        "encoding": "^0.1.0"[m
[31m-      },[m
[31m-      "peerDependenciesMeta": {[m
[31m-        "encoding": {[m
[31m-          "optional": true[m
[31m-        }[m
[31m-      }[m
[31m-    },[m
[31m-    "node_modules/mercadopago/node_modules/uuid": {[m
[31m-      "version": "9.0.1",[m
[31m-      "resolved": "https://registry.npmjs.org/uuid/-/uuid-9.0.1.tgz",[m
[31m-      "integrity": "sha512-b+1eJOlsR9K8HJpow9Ok3fiWOWSIcIzXodvv0rQjVoOVNpWMpxf1wZNpt4y9h10odCNrqnYp1OBzRktckBe3sA==",[m
[31m-      "funding": [[m
[31m-        "https://github.com/sponsors/broofa",[m
[31m-        "https://github.com/sponsors/ctavan"[m
[31m-      ],[m
[31m-      "license": "MIT",[m
[31m-      "bin": {[m
[31m-        "uuid": "dist/bin/uuid"[m
[31m-      }[m
[31m-    },[m
     "node_modules/merge-descriptors": {[m
       "version": "1.0.3",[m
       "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-1.0.3.tgz",[m
[36m@@ -12904,41 +13845,41 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/next": {[m
[31m-      "version": "14.2.33",[m
[31m-      "resolved": "https://registry.npmjs.org/next/-/next-14.2.33.tgz",[m
[31m-      "integrity": "sha512-GiKHLsD00t4ACm1p00VgrI0rUFAC9cRDGReKyERlM57aeEZkOQGcZTpIbsGn0b562FTPJWmYfKwplfO9EaT6ng==",[m
[32m+[m[32m      "version": "16.1.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/next/-/next-16.1.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Y+KbmDbefYtHDDQKLNrmzE/YYzG2msqo2VXhzh5yrJ54tx/6TmGdkR5+kP9ma7i7LwZpZMfoY3m/AoPPPKxtVw==",[m
       "license": "MIT",[m
       "dependencies": {[m
[31m-        "@next/env": "14.2.33",[m
[31m-        "@swc/helpers": "0.5.5",[m
[31m-        "busboy": "1.6.0",[m
[32m+[m[32m        "@next/env": "16.1.0",[m
[32m+[m[32m        "@swc/helpers": "0.5.15",[m
[32m+[m[32m        "baseline-browser-mapping": "^2.8.3",[m
         "caniuse-lite": "^1.0.30001579",[m
[31m-        "graceful-fs": "^4.2.11",[m
         "postcss": "8.4.31",[m
[31m-        "styled-jsx": "5.1.1"[m
[32m+[m[32m        "styled-jsx": "5.1.6"[m
       },[m
       "bin": {[m
         "next": "dist/bin/next"[m
       },[m
       "engines": {[m
[31m-        "node": ">=18.17.0"[m
[32m+[m[32m        "node": ">=20.9.0"[m
       },[m
       "optionalDependencies": {[m
[31m-        "@next/swc-darwin-arm64": "14.2.33",[m
[31m-        "@next/swc-darwin-x64": "14.2.33",[m
[31m-        "@next/swc-linux-arm64-gnu": "14.2.33",[m
[31m-        "@next/swc-linux-arm64-musl": "14.2.33",[m
[31m-        "@next/swc-linux-x64-gnu": "14.2.33",[m
[31m-        "@next/swc-linux-x64-musl": "14.2.33",[m
[31m-        "@next/swc-win32-arm64-msvc": "14.2.33",[m
[31m-        "@next/swc-win32-ia32-msvc": "14.2.33",[m
[31m-        "@next/swc-win32-x64-msvc": "14.2.33"[m
[32m+[m[32m        "@next/swc-darwin-arm64": "16.1.0",[m
[32m+[m[32m        "@next/swc-darwin-x64": "16.1.0",[m
[32m+[m[32m        "@next/swc-linux-arm64-gnu": "16.1.0",[m
[32m+[m[32m        "@next/swc-linux-arm64-musl": "16.1.0",[m
[32m+[m[32m        "@next/swc-linux-x64-gnu": "16.1.0",[m
[32m+[m[32m        "@next/swc-linux-x64-musl": "16.1.0",[m
[32m+[m[32m        "@next/swc-win32-arm64-msvc": "16.1.0",[m
[32m+[m[32m        "@next/swc-win32-x64-msvc": "16.1.0",[m
[32m+[m[32m        "sharp": "^0.34.4"[m
       },[m
       "peerDependencies": {[m
         "@opentelemetry/api": "^1.1.0",[m
[31m-        "@playwright/test": "^1.41.2",[m
[31m-        "react": "^18.2.0",[m
[31m-        "react-dom": "^18.2.0",[m
[32m+[m[32m        "@playwright/test": "^1.51.1",[m
[32m+[m[32m        "babel-plugin-react-compiler": "*",[m
[32m+[m[32m        "react": "^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0",[m
[32m+[m[32m        "react-dom": "^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0",[m
         "sass": "^1.3.0"[m
       },[m
       "peerDependenciesMeta": {[m
[36m@@ -12948,6 +13889,9 @@[m
         "@playwright/test": {[m
           "optional": true[m
         },[m
[32m+[m[32m        "babel-plugin-react-compiler": {[m
[32m+[m[32m          "optional": true[m
[32m+[m[32m        },[m
         "sass": {[m
           "optional": true[m
         }[m
[36m@@ -13016,9 +13960,9 @@[m
       }[m
     },[m
     "node_modules/node-forge": {[m
[31m-      "version": "1.3.1",[m
[31m-      "resolved": "https://registry.npmjs.org/node-forge/-/node-forge-1.3.1.tgz",[m
[31m-      "integrity": "sha512-dPEtOeMvF9VMcYV/1Wb8CPoVAXtp6MKMlcbAt4ddqmGqUJ6fQZFXkNZNkNlfevtNkGtaSoXf/vNNNSvgrdXwtA==",[m
[32m+[m[32m      "version": "1.3.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/node-forge/-/node-forge-1.3.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-rLvcdSyRCyouf6jcOIPe/BgwG/d7hKjzMKOas33/pHEr6gbq18IK9zV7DiPvzsz0oBJPme6qr6H6kGZuI9/DZg==",[m
       "license": "(BSD-3-Clause OR GPL-2.0)",[m
       "engines": {[m
         "node": ">= 6.13.0"[m
[36m@@ -13030,6 +13974,13 @@[m
       "integrity": "sha512-O5lz91xSOeoXP6DulyHfllpq+Eg00MWitZIbtPfoSEvqIHdl5gfcY6hYzDWnj0qD5tz52PI08u9qUvSVeUBeHw==",[m
       "license": "MIT"[m
     },[m
[32m+[m[32m    "node_modules/node-releases": {[m
[32m+[m[32m      "version": "2.0.27",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/node-releases/-/node-releases-2.0.27.tgz",[m
[32m+[m[32m      "integrity": "sha512-nmh3lCkYZ3grZvqcCH+fjmQ7X+H0OeZgP40OierEaAptX4XofMh5kwNbWh7lBduUzCcV/8kZ+NDLCwm2iorIlA==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT"[m
[32m+[m[32m    },[m
     "node_modules/normalize-path": {[m
       "version": "3.0.0",[m
       "resolved": "https://registry.npmjs.org/normalize-path/-/normalize-path-3.0.0.tgz",[m
[36m@@ -13467,16 +14418,6 @@[m
         "node": ">=8"[m
       }[m
     },[m
[31m-    "node_modules/path-is-absolute": {[m
[31m-      "version": "1.0.1",[m
[31m-      "resolved": "https://registry.npmjs.org/path-is-absolute/-/path-is-absolute-1.0.1.tgz",[m
[31m-      "integrity": "sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "engines": {[m
[31m-        "node": ">=0.10.0"[m
[31m-      }[m
[31m-    },[m
     "node_modules/path-key": {[m
       "version": "3.1.1",[m
       "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",[m
[36m@@ -14459,69 +15400,6 @@[m
         "node": ">= 0.8.15"[m
       }[m
     },[m
[31m-    "node_modules/rimraf": {[m
[31m-      "version": "3.0.2",[m
[31m-      "resolved": "https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz",[m
[31m-      "integrity": "sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==",[m
[31m-      "deprecated": "Rimraf versions prior to v4 are no longer supported",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC",[m
[31m-      "dependencies": {[m
[31m-        "glob": "^7.1.3"[m
[31m-      },[m
[31m-      "bin": {[m
[31m-        "rimraf": "bin.js"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "url": "https://github.com/sponsors/isaacs"[m
[31m-      }[m
[31m-    },[m
[31m-    "node_modules/rimraf/node_modules/brace-expansion": {[m
[31m-      "version": "1.1.12",[m
[31m-      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",[m
[31m-      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT",[m
[31m-      "dependencies": {[m
[31m-        "balanced-match": "^1.0.0",[m
[31m-        "concat-map": "0.0.1"[m
[31m-      }[m
[31m-    },[m
[31m-    "node_modules/rimraf/node_modules/glob": {[m
[31m-      "version": "7.2.3",[m
[31m-      "resolved": "https://registry.npmjs.org/glob/-/glob-7.2.3.tgz",[m
[31m-      "integrity": "sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==",[m
[31m-      "deprecated": "Glob versions prior to v9 are no longer supported",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC",[m
[31m-      "dependencies": {[m
[31m-        "fs.realpath": "^1.0.0",[m
[31m-        "inflight": "^1.0.4",[m
[31m-        "inherits": "2",[m
[31m-        "minimatch": "^3.1.1",[m
[31m-        "once": "^1.3.0",[m
[31m-        "path-is-absolute": "^1.0.0"[m
[31m-      },[m
[31m-      "engines": {[m
[31m-        "node": "*"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "url": "https://github.com/sponsors/isaacs"[m
[31m-      }[m
[31m-    },[m
[31m-    "node_modules/rimraf/node_modules/minimatch": {[m
[31m-      "version": "3.1.2",[m
[31m-      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",[m
[31m-      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",[m
[31m-      "dev": true,[m
[31m-      "license": "ISC",[m
[31m-      "dependencies": {[m
[31m-        "brace-expansion": "^1.1.7"[m
[31m-      },[m
[31m-      "engines": {[m
[31m-        "node": "*"[m
[31m-      }[m
[31m-    },[m
     "node_modules/router": {[m
       "version": "2.2.0",[m
       "resolved": "https://registry.npmjs.org/router/-/router-2.2.0.tgz",[m
[36m@@ -14826,6 +15704,51 @@[m
       "integrity": "sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw==",[m
       "license": "ISC"[m
     },[m
[32m+[m[32m    "node_modules/sharp": {[m
[32m+[m[32m      "version": "0.34.5",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/sharp/-/sharp-0.34.5.tgz",[m
[32m+[m[32m      "integrity": "sha512-Ou9I5Ft9WNcCbXrU9cMgPBcCK8LiwLqcbywW3t4oDV37n1pzpuNLsYiAV8eODnjbtQlSDwZ2cUEeQz4E54Hltg==",[m
[32m+[m[32m      "hasInstallScript": true,[m
[32m+[m[32m      "license": "Apache-2.0",[m
[32m+[m[32m      "optional": true,[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@img/colour": "^1.0.0",[m
[32m+[m[32m        "detect-libc": "^2.1.2",[m
[32m+[m[32m        "semver": "^7.7.3"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "url": "https://opencollective.com/libvips"[m
[32m+[m[32m      },[m
[32m+[m[32m      "optionalDependencies": {[m
[32m+[m[32m        "@img/sharp-darwin-arm64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-darwin-x64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-libvips-darwin-arm64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-darwin-x64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linux-arm": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linux-arm64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linux-ppc64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linux-riscv64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linux-s390x": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linux-x64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linuxmusl-arm64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-libvips-linuxmusl-x64": "1.2.4",[m
[32m+[m[32m        "@img/sharp-linux-arm": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linux-arm64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linux-ppc64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linux-riscv64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linux-s390x": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linux-x64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linuxmusl-arm64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-linuxmusl-x64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-wasm32": "0.34.5",[m
[32m+[m[32m        "@img/sharp-win32-arm64": "0.34.5",[m
[32m+[m[32m        "@img/sharp-win32-ia32": "0.34.5",[m
[32m+[m[32m        "@img/sharp-win32-x64": "0.34.5"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/shebang-command": {[m
       "version": "2.0.0",[m
       "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",[m
[36m@@ -15058,14 +15981,6 @@[m
       "devOptional": true,[m
       "license": "MIT"[m
     },[m
[31m-    "node_modules/streamsearch": {[m
[31m-      "version": "1.1.0",[m
[31m-      "resolved": "https://registry.npmjs.org/streamsearch/-/streamsearch-1.1.0.tgz",[m
[31m-      "integrity": "sha512-Mcc5wHehp9aXz1ax6bZUyY5afg9u2rv5cqQI3mRrYkGC8rW2hM02jWuwjtL++LS5qinSyhj2QfLyNsuc+VsExg==",[m
[31m-      "engines": {[m
[31m-        "node": ">=10.0.0"[m
[31m-      }[m
[31m-    },[m
     "node_modules/string_decoder": {[m
       "version": "1.3.0",[m
       "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz",[m
[36m@@ -15326,9 +16241,9 @@[m
       "license": "MIT"[m
     },[m
     "node_modules/styled-jsx": {[m
[31m-      "version": "5.1.1",[m
[31m-      "resolved": "https://registry.npmjs.org/styled-jsx/-/styled-jsx-5.1.1.tgz",[m
[31m-      "integrity": "sha512-pW7uC1l4mBZ8ugbiZrcIsiIvVx1UmTfw7UkC3Um2tmfUq9Bhk8IiyEIPl6F8agHgjzku6j0xQEZbfA5uSgSaCw==",[m
[32m+[m[32m      "version": "5.1.6",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/styled-jsx/-/styled-jsx-5.1.6.tgz",[m
[32m+[m[32m      "integrity": "sha512-qSVyDTeMotdvQYoHWLNGwRFJHC+i+ZvdBRYosOFgC+Wg1vx4frN2/RG/NA7SYqqvKNLf39P2LSRA2pu6n0XYZA==",[m
       "license": "MIT",[m
       "dependencies": {[m
         "client-only": "0.0.1"[m
[36m@@ -15337,7 +16252,7 @@[m
         "node": ">= 12.0.0"[m
       },[m
       "peerDependencies": {[m
[31m-        "react": ">= 16.8.0 || 17.x.x || ^18.0.0-0"[m
[32m+[m[32m        "react": ">= 16.8.0 || 17.x.x || ^18.0.0-0 || ^19.0.0-0"[m
       },[m
       "peerDependenciesMeta": {[m
         "@babel/core": {[m
[36m@@ -15588,13 +16503,6 @@[m
         "utrie": "^1.0.2"[m
       }[m
     },[m
[31m-    "node_modules/text-table": {[m
[31m-      "version": "0.2.0",[m
[31m-      "resolved": "https://registry.npmjs.org/text-table/-/text-table-0.2.0.tgz",[m
[31m-      "integrity": "sha512-N+8UisAXDGk8PFXP4HAzVR9nbfmVJ3zYLAWiTIoqC5v5isinhr+r5uaO8+7r3BMfuNIufIsA7RdpVgacC2cSpw==",[m
[31m-      "dev": true,[m
[31m-      "license": "MIT"[m
[31m-    },[m
     "node_modules/thenify": {[m
       "version": "3.3.1",[m
       "resolved": "https://registry.npmjs.org/thenify/-/thenify-3.3.1.tgz",[m
[36m@@ -15825,19 +16733,6 @@[m
         "node": ">= 0.8.0"[m
       }[m
     },[m
[31m-    "node_modules/type-fest": {[m
[31m-      "version": "0.20.2",[m
[31m-      "resolved": "https://registry.npmjs.org/type-fest/-/type-fest-0.20.2.tgz",[m
[31m-      "integrity": "sha512-Ne+eE4r0/iWnpAxD852z3A+N0Bt5RN//NjJwRd2VFHEmrywxf5vsZlh4R6lixl6B+wz/8d+maTSAkN1FIkI3LQ==",[m
[31m-      "dev": true,[m
[31m-      "license": "(MIT OR CC0-1.0)",[m
[31m-      "engines": {[m
[31m-        "node": ">=10"[m
[31m-      },[m
[31m-      "funding": {[m
[31m-        "url": "https://github.com/sponsors/sindresorhus"[m
[31m-      }[m
[31m-    },[m
     "node_modules/type-is": {[m
       "version": "1.6.18",[m
       "resolved": "https://registry.npmjs.org/type-is/-/type-is-1.6.18.tgz",[m
[36m@@ -15952,6 +16847,30 @@[m
         "node": ">=14.17"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/typescript-eslint": {[m
[32m+[m[32m      "version": "8.50.0",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/typescript-eslint/-/typescript-eslint-8.50.0.tgz",[m
[32m+[m[32m      "integrity": "sha512-Q1/6yNUmCpH94fbgMUMg2/BSAr/6U7GBk61kZTv1/asghQOWOjTlp9K8mixS5NcJmm2creY+UFfGeW/+OcA64A==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "@typescript-eslint/eslint-plugin": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/parser": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/typescript-estree": "8.50.0",[m
[32m+[m[32m        "@typescript-eslint/utils": "8.50.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "engines": {[m
[32m+[m[32m        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "funding": {[m
[32m+[m[32m        "type": "opencollective",[m
[32m+[m[32m        "url": "https://opencollective.com/typescript-eslint"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "eslint": "^8.57.0 || ^9.0.0",[m
[32m+[m[32m        "typescript": ">=4.8.4 <6.0.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/uglify-js": {[m
       "version": "3.19.3",[m
       "resolved": "https://registry.npmjs.org/uglify-js/-/uglify-js-3.19.3.tgz",[m
[36m@@ -16056,6 +16975,37 @@[m
         "@unrs/resolver-binding-win32-x64-msvc": "1.11.1"[m
       }[m
     },[m
[32m+[m[32m    "node_modules/update-browserslist-db": {[m
[32m+[m[32m      "version": "1.2.3",[m
[32m+[m[32m      "resolved": "https://registry.npmjs.org/update-browserslist-db/-/update-browserslist-db-1.2.3.tgz",[m
[32m+[m[32m      "integrity": "sha512-Js0m9cx+qOgDxo0eMiFGEueWztz+d4+M3rGlmKPT+T4IS/jP4ylw3Nwpu6cpTTP8R1MAC1kF4VbdLt3ARf209w==",[m
[32m+[m[32m      "dev": true,[m
[32m+[m[32m      "funding": [[m
[32m+[m[32m        {[m
[32m+[m[32m          "type": "opencollective",[m
[32m+[m[32m          "url": "https://opencollective.com/browserslist"[m
[32m+[m[32m        },[m
[32m+[m[32m        {[m
[32m+[m[32m          "type": "tidelift",[m
[32m+[m[32m          "url": "https://tidelift.com/funding/github/npm/browserslist"[m
[32m+[m[32m        },[m
[32m+[m[32m        {[m
[32m+[m[32m          "type": "github",[m
[32m+[m[32m          "url": "https://github.com/sponsors/ai"[m
[32m+[m[32m        }[m
[32m+[m[32m      ],[m
[32m+[m[32m      "license": "MIT",[m
[32m+[m[32m      "dependencies": {[m
[32m+[m[32m        "escalade": "^3.2.0",[m
[32m+[m[32m        "picocolors": "^1.1.1"[m
[32m+[m[32m      },[m
[32m+[m[32m      "bin": {[m
[32m+[m[32m        "update-browserslist-db": "cli.js"[m
[32m+[m[32m      },[m
[32m+[m[32m      "peerDependencies": {[m
[32m+[m[32m        "browserslist": ">= 4.21.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    },[m
     "node_modules/uri-js": {[m
       "version": "4.4.1",[m
       "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",[m
[1mdiff --git a/package.json b/package.json[m
[1mindex 6ec8d0a..2493afc 100755[m
[1m--- a/package.json[m
[1m+++ b/package.json[m
[36m@@ -3,12 +3,12 @@[m
   "version": "0.1.0",[m
   "private": true,[m
   "scripts": {[m
[31m-    "dev": "next dev",[m
[32m+[m[32m    "dev": "next dev --webpack",[m
     "genkit:dev": "genkit start -- tsx src/ai/dev.ts",[m
     "genkit:watch": "genkit start -- tsx --watch src/ai/dev.ts",[m
     "build": "next build",[m
     "start": "next start",[m
[31m-    "lint": "next lint",[m
[32m+[m[32m    "lint": "eslint .",[m
     "typecheck": "tsc --noEmit",[m
     "prisma:generate": "prisma generate",[m
     "prisma:migrate:dev": "prisma migrate dev"[m
[36m@@ -54,7 +54,6 @@[m
     "jspdf": "^3.0.4",[m
     "jspdf-autotable": "^5.0.2",[m
     "lucide-react": "^0.475.0",[m
[31m-    "mercadopago": "^2.0.11",[m
     "next": "latest",[m
     "patch-package": "^8.0.0",[m
     "react": "^18.3.1",[m
[36m@@ -72,8 +71,9 @@[m
     "@types/node": "^20.19.27",[m
     "@types/react": "^18",[m
     "@types/react-dom": "^18",[m
[31m-    "eslint": "^8.57.1",[m
[31m-    "eslint-config-next": "^14.2.33",[m
[32m+[m[32m    "eslint": "^9.14.0",[m
[32m+[m[32m    "eslint-config-next": "16.1.0",[m
[32m+[m[32m    "@next/eslint-plugin-next": "16.1.0",[m
     "genkit-cli": "^1.20.0",[m
     "postcss": "^8",[m
     "prisma": "^5.22.0",[m
[1mdiff --git a/prisma/migrations/20251218124639_add_tutorial_videos/migration.sql b/prisma/migrations/20251218124639_add_tutorial_videos/migration.sql[m
[1mnew file mode 100644[m
[1mindex 0000000..4dccd30[m
[1m--- /dev/null[m
[1m+++ b/prisma/migrations/20251218124639_add_tutorial_videos/migration.sql[m
[36m@@ -0,0 +1,17 @@[m
[32m+[m[32m-- CreateTable[m
[32m+[m[32mCREATE TABLE `tutorialvideo` ([m
[32m+[m[32m    `id` VARCHAR(191) NOT NULL,[m
[32m+[m[32m    `title` VARCHAR(191) NOT NULL,[m
[32m+[m[32m    `description` TEXT NULL,[m
[32m+[m[32m    `youtubeUrl` VARCHAR(500) NOT NULL,[m
[32m+[m[32m    `youtubeId` VARCHAR(50) NULL,[m
[32m+[m[32m    `targetEmail` VARCHAR(255) NULL,[m
[32m+[m[32m    `enabled` BOOLEAN NOT NULL DEFAULT true,[m
[32m+[m[32m    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),[m
[32m+[m[32m    `updatedAt` DATETIME(3) NOT NULL,[m
[32m+[m
[32m+[m[32m    INDEX `TutorialVideo_targetEmail_idx`(`targetEmail`),[m
[32m+[m[32m    INDEX `TutorialVideo_enabled_idx`(`enabled`),[m
[32m+[m[32m    INDEX `TutorialVideo_createdAt_idx`(`createdAt`),[m
[32m+[m[32m    PRIMARY KEY (`id`)[m
[32m+[m[32m) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;[m
[1mdiff --git a/prisma/migrations/20251218164926_add_site_appearance_assets/migration.sql b/prisma/migrations/20251218164926_add_site_appearance_assets/migration.sql[m
[1mnew file mode 100644[m
[1mindex 0000000..e4ae2bb[m
[1m--- /dev/null[m
[1m+++ b/prisma/migrations/20251218164926_add_site_appearance_assets/migration.sql[m
[36m@@ -0,0 +1,9 @@[m
[32m+[m[32m-- CreateTable[m
[32m+[m[32mCREATE TABLE `SiteAppearance` ([m
[32m+[m[32m    `id` INTEGER NOT NULL AUTO_INCREMENT,[m
[32m+[m[32m    `homeHeroDesktopPath` VARCHAR(500) NULL,[m
[32m+[m[32m    `homeHeroMobilePath` VARCHAR(500) NULL,[m
[32m+[m[32m    `updatedAt` DATETIME(3) NOT NULL,[m
[32m+[m
[32m+[m[32m    PRIMARY KEY (`id`)[m
[32m+[m[32m) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;[m
[1mdiff --git a/prisma/schema.prisma b/prisma/schema.prisma[m
[1mindex 3656882..1e9f872 100755[m
[1m--- a/prisma/schema.prisma[m
[1m+++ b/prisma/schema.prisma[m
[36m@@ -326,3 +326,28 @@[m [menum BarbershopPlan {[m
   BASIC[m
   PREMIUM[m
 }[m
[32m+[m
[32m+[m[32mmodel tutorialvideo {[m
[32m+[m[32m  id          String   @id @default(cuid())[m
[32m+[m[32m  title       String[m
[32m+[m[32m  description String?  @db.Text[m
[32m+[m[32m  youtubeUrl  String   @db.VarChar(500)[m
[32m+[m[32m  youtubeId   String?  @db.VarChar(50)[m
[32m+[m[32m  targetEmail String?  @db.VarChar(255)[m
[32m+[m[32m  enabled     Boolean  @default(true)[m
[32m+[m[32m  createdAt   DateTime @default(now())[m
[32m+[m[32m  updatedAt   DateTime @updatedAt[m
[32m+[m
[32m+[m[32m  @@index([targetEmail], map: "TutorialVideo_targetEmail_idx")[m
[32m+[m[32m  @@index([enabled], map: "TutorialVideo_enabled_idx")[m
[32m+[m[32m  @@index([createdAt], map: "TutorialVideo_createdAt_idx")[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mmodel siteappearance {[m
[32m+[m[32m  id                Int      @id @default(autoincrement())[m
[32m+[m[32m  homeHeroDesktopPath String? @db.VarChar(500)[m
[32m+[m[32m  homeHeroMobilePath  String? @db.VarChar(500)[m
[32m+[m[32m  updatedAt         DateTime @updatedAt[m
[32m+[m
[32m+[m[32m  @@map("SiteAppearance")[m
[32m+[m[32m}[m
[1mdiff --git a/public/hero.svg b/public/hero.svg[m
[1mnew file mode 100644[m
[1mindex 0000000..b4eaf67[m
[1m--- /dev/null[m
[1m+++ b/public/hero.svg[m
[36m@@ -0,0 +1,67 @@[m
[32m+[m[32m<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080" viewBox="0 0 1920 1080" role="img" aria-label="Fundo do BarberFlow">[m
[32m+[m[32m  <defs>[m
[32m+[m[32m    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">[m
[32m+[m[32m      <stop offset="0" stop-color="#0b1220" />[m
[32m+[m[32m      <stop offset="0.55" stop-color="#101c33" />[m
[32m+[m[32m      <stop offset="1" stop-color="#0b1220" />[m
[32m+[m[32m    </linearGradient>[m
[32m+[m[32m    <radialGradient id="spot" cx="65%" cy="35%" r="65%">[m
[32m+[m[32m      <stop offset="0" stop-color="#1d4ed8" stop-opacity="0.35" />[m
[32m+[m[32m      <stop offset="1" stop-color="#1d4ed8" stop-opacity="0" />[m
[32m+[m[32m    </radialGradient>[m
[32m+[m[32m    <radialGradient id="spot2" cx="25%" cy="55%" r="75%">[m
[32m+[m[32m      <stop offset="0" stop-color="#0ea5e9" stop-opacity="0.22" />[m
[32m+[m[32m      <stop offset="1" stop-color="#0ea5e9" stop-opacity="0" />[m
[32m+[m[32m    </radialGradient>[m
[32m+[m[32m    <filter id="blur40" x="-20%" y="-20%" width="140%" height="140%">[m
[32m+[m[32m      <feGaussianBlur stdDeviation="40" />[m
[32m+[m[32m    </filter>[m
[32m+[m[32m    <filter id="blur18" x="-20%" y="-20%" width="140%" height="140%">[m
[32m+[m[32m      <feGaussianBlur stdDeviation="18" />[m
[32m+[m[32m    </filter>[m
[32m+[m[32m  </defs>[m
[32m+[m
[32m+[m[32m  <rect width="1920" height="1080" fill="url(#bg)" />[m
[32m+[m[32m  <rect width="1920" height="1080" fill="url(#spot)" />[m
[32m+[m[32m  <rect width="1920" height="1080" fill="url(#spot2)" />[m
[32m+[m
[32m+[m[32m  <!-- Decorative shapes (subtle) -->[m
[32m+[m[32m  <g opacity="0.8" filter="url(#blur40)">[m
[32m+[m[32m    <path d="M1460 30C1660 120 1800 270 1890 500C1960 680 1910 850 1760 980C1560 1130 1330 1050 1180 900C1030 760 980 590 1060 420C1140 260 1280 140 1460 30Z" fill="#0ea5e9" opacity="0.18"/>[m
[32m+[m[32m    <path d="M350 180C520 60 720 30 920 110C1100 185 1190 340 1170 520C1150 700 1040 830 850 870C650 915 470 860 350 740C250 640 220 500 260 370C290 270 310 240 350 180Z" fill="#2563eb" opacity="0.12"/>[m
[32m+[m[32m  </g>[m
[32m+[m
[32m+[m[32m  <!-- Soft grid -->[m
[32m+[m[32m  <g opacity="0.10">[m
[32m+[m[32m    <path d="M0 180H1920M0 360H1920M0 540H1920M0 720H1920M0 900H1920" stroke="#ffffff" />[m
[32m+[m[32m    <path d="M240 0V1080M480 0V1080M720 0V1080M960 0V1080M1200 0V1080M1440 0V1080M1680 0V1080" stroke="#ffffff" />[m
[32m+[m[32m  </g>[m
[32m+[m
[32m+[m[32m  <!-- Bottom fade (like photo overlay) -->[m
[32m+[m[32m  <rect y="780" width="1920" height="300" fill="#0b1220" opacity="0.65"/>[m
[32m+[m
[32m+[m[32m  <!-- Simple "barber pole" hint on the right -->[m
[32m+[m[32m  <g transform="translate(1420,260)" opacity="0.55">[m
[32m+[m[32m    <rect x="320" y="90" width="120" height="520" rx="60" fill="#0f172a" stroke="#1f2937" stroke-width="2"/>[m
[32m+[m[32m    <g clip-path="url(#clipPole)">[m
[32m+[m[32m      <rect x="320" y="90" width="120" height="520" fill="#e5e7eb" opacity="0.95"/>[m
[32m+[m[32m      <path d="M260 120 L520 20" stroke="#ef4444" stroke-width="34" opacity="0.9"/>[m
[32m+[m[32m      <path d="M260 220 L520 120" stroke="#3b82f6" stroke-width="34" opacity="0.9"/>[m
[32m+[m[32m      <path d="M260 320 L520 220" stroke="#ef4444" stroke-width="34" opacity="0.9"/>[m
[32m+[m[32m      <path d="M260 420 L520 320" stroke="#3b82f6" stroke-width="34" opacity="0.9"/>[m
[32m+[m[32m      <path d="M260 520 L520 420" stroke="#ef4444" stroke-width="34" opacity="0.9"/>[m
[32m+[m[32m      <path d="M260 620 L520 520" stroke="#3b82f6" stroke-width="34" opacity="0.9"/>[m
[32m+[m[32m    </g>[m
[32m+[m[32m    <defs>[m
[32m+[m[32m      <clipPath id="clipPole">[m
[32m+[m[32m        <rect x="320" y="90" width="120" height="520" rx="60"/>[m
[32m+[m[32m      </clipPath>[m
[32m+[m[32m    </defs>[m
[32m+[m[32m    <circle cx="380" cy="80" r="18" fill="#1f2937"/>[m
[32m+[m[32m    <circle cx="380" cy="640" r="18" fill="#1f2937"/>[m
[32m+[m[32m  </g>[m
[32m+[m
[32m+[m[32m  <!-- Vignette -->[m
[32m+[m[32m  <rect width="1920" height="1080" fill="#000000" opacity="0.12" filter="url(#blur18)"/>[m
[32m+[m[32m</svg>[m
[32m+[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/settings/page.tsx b/src/app/(dashboard)/admin/dashboard/settings/page.tsx[m
[1mindex c353a79..cb60417 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/settings/page.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/settings/page.tsx[m
[36m@@ -1,1106 +1,1115 @@[m
[31m-[m
[31m-"use client";[m
[31m-[m
[31m-import { useCallback, useEffect, useState } from "react";[m
[31m-import { Button } from "@/components/ui/button";[m
[31m-import {[m
[31m-  Card,[m
[31m-  CardContent,[m
[31m-  CardDescription,[m
[31m-  CardHeader,[m
[31m-  CardTitle,[m
[31m-  CardFooter,[m
[31m-} from "@/components/ui/card";[m
[31m-import { Input } from "@/components/ui/input";[m
[31m-import { Label } from "@/components/ui/label";[m
[31m-import { Switch } from "@/components/ui/switch";[m
[31m-import { useToast } from "@/hooks/use-toast";[m
[31m-import {[m
[31m-  Dialog,[m
[31m-  DialogContent,[m
[31m-  DialogDescription,[m
[31m-  DialogHeader,[m
[31m-  DialogTitle,[m
[31m-  DialogFooter,[m
[31m-  DialogClose,[m
[31m-} from "@/components/ui/dialog";[m
[31m-import { Crown, Sparkles, Edit, Save, Lock, Upload, Check, AlertCircle, ShoppingCart, Copy, Loader2, Info, QrCode, Eye, EyeOff, Building, CreditCard } from "lucide-react";[m
[31m-import { useAuth } from "@/context/AuthContext";[m
[31m-import { fetchJson, setAccessToken } from "@/lib/fetcher";[m
[31m-import type { AuthUser, Barbershop } from "@/lib/definitions";[m
[31m-import { useBarbershopId } from "@/context/BarbershopIdContext";[m
[31m-import { WhatsAppIcon } from "@/components/icons/whatsapp-icon";[m
[31m-import { differenceInDays, startOfDay, format, isBefore } from "date-fns";[m
[31m-import { formatCurrency, capitalizeWords } from "@/lib/utils";[m
[31m-import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";[m
[31m-import { TooltipProvider, Tooltip, TooltipTrigger, TooltipContent } from "@/components/ui/tooltip";[m
[31m-import { Badge } from "@/components/ui/badge";[m
[31m-[m
[31m-[m
[31m-type OperatingHoursState = {[m
[31m-  [key: string]: {[m
[31m-    active: boolean;[m
[31m-    open: string;[m
[31m-    close: string;[m
[31m-  };[m
[31m-};[m
[31m-[m
[31m-const weekDays = [[m
[31m-  "Domingo",[m
[31m-  "Segunda-feira",[m
[31m-  "Terça-feira",[m
[31m-  "Quarta-feira",[m
[31m-  "Quinta-feira",[m
[31m-  "Sexta-feira",[m
[31m-  "Sábado",[m
[31m-];[m
[31m-[m
[31m-const DEFAULT_OPEN_TIME = "08:00";[m
[31m-const DEFAULT_CLOSE_TIME = "18:00";[m
[31m-[m
[31m-const formatCpfCnpjValue = (value: string) => {[m
[31m-  const raw = value.replace(/\D/g, "");[m
[31m-  if (raw.length <= 11) {[m
[31m-    return raw[m
[31m-      .replace(/(\d{3})(\d)/, "$1.$2")[m
[31m-      .replace(/(\d{3})(\d)/, "$1.$2")[m
[31m-      .replace(/(\d{3})(\d{1,2})$/, "$1-$2");[m
[31m-  }[m
[31m-  return raw[m
[31m-    .substring(0, 14)[m
[31m-    .replace(/^(\d{2})(\d)/, "$1.$2")[m
[31m-    .replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3")[m
[31m-    .replace(/\.(\d{3})(\d)/, ".$1/$2")[m
[31m-    .replace(/(\d{4})(\d)/, "$1-$2");[m
[31m-};[m
[31m-[m
[31m-const planPrices = {[m
[31m-    'Básico': 49.90,[m
[31m-    'Premium': 119.90,[m
[31m-};[m
[31m-[m
[31m-[m
[31m-const digitsOnly = (value: string) => value.replace(/\D/g, "");[m
[31m-const isSequentialDigits = (value: string) => /^(\d)\1+$/.test(value);[m
[31m-[m
[31m-const isValidCpf = (value: string) => {[m
[31m-  const cpf = digitsOnly(value);[m
[31m-  if (cpf.length !== 11 || isSequentialDigits(cpf)) return false;[m
[31m-[m
[31m-  const calcDigit = (slice: number) => {[m
[31m-    const sum = cpf[m
[31m-      .slice(0, slice)[m
[31m-      .split("")[m
[31m-      .reduce((acc, num, idx) => acc + parseInt(num, 10) * (slice + 1 - idx), 0);[m
[31m-    const remainder = (sum * 10) % 11;[m
[31m-    return remainder === 10 ? 0 : remainder;[m
[31m-  };[m
[31m-[m
[31m-  const digit1 = calcDigit(9);[m
[31m-  const digit2 = calcDigit(10);[m
[31m-[m
[31m-  return digit1 === parseInt(cpf[9], 10) && digit2 === parseInt(cpf[10], 10);[m
[31m-};[m
[31m-[m
[31m-const isValidCnpj = (value: string) => {[m
[31m-  const cnpj = digitsOnly(value);[m
[31m-  if (cnpj.length !== 14 || isSequentialDigits(cnpj)) return false;[m
[31m-[m
[31m-  const calcDigit = (slice: number) => {[m
[31m-    const factors = slice === 12[m
[31m-      ? [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2][m
[31m-      : [6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];[m
[31m-    const sum = cnpj[m
[31m-      .slice(0, slice)[m
[31m-      .split("")[m
[31m-      .reduce((acc, num, idx) => acc + parseInt(num, 10) * factors[idx], 0);[m
[31m-    const remainder = sum % 11;[m
[31m-    return remainder < 2 ? 0 : 11 - remainder;[m
[31m-  };[m
[31m-[m
[31m-  const digit1 = calcDigit(12);[m
[31m-  const digit2 = calcDigit(13);[m
[31m-[m
[31m-  return digit1 === parseInt(cnpj[12], 10) && digit2 === parseInt(cnpj[13], 10);[m
[31m-};[m
[31m-[m
[31m-const validateCpfCnpj = (value: string) => {[m
[31m-  const clean = digitsOnly(value);[m
[31m-  if (!clean) return { valid: false, type: null as "CPF" | "CNPJ" | null };[m
[31m-  if (clean.length === 11) return { valid: isValidCpf(clean), type: "CPF" as const };[m
[31m-  if (clean.length === 14) return { valid: isValidCnpj(clean), type: "CNPJ" as const };[m
[31m-  return { valid: false, type: null as "CPF" | "CNPJ" | null };[m
[31m-};[m
[31m-[m
[31m-const normalizeDay = (value: string) =>[m
[31m-  value?.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "") || "";[m
[31m-[m
[31m-const createDefaultScheduleState = () =>[m
[31m-  weekDays.reduce((acc, day) => {[m
[31m-    acc[day] = { active: false, open: DEFAULT_OPEN_TIME, close: DEFAULT_CLOSE_TIME };[m
[31m-    return acc;[m
[31m-  }, {} as OperatingHoursState);[m
[31m-[m
[31m-const mapOperatingHoursToState = (shop: Barbershop | null) => {[m
[31m-  const base = createDefaultScheduleState();[m
[31m-  if (!shop?.operatingHours) return base;[m
[31m-[m
[31m-  return weekDays.reduce((acc, day) => {[m
[31m-    const daySchedule = shop.operatingHours.find([m
[31m-      (h: { day: string }) => normalizeDay(h.day) === normalizeDay(day)[m
[31m-    );[m
[31m-    const open = daySchedule?.open && daySchedule.open !== "closed"[m
[31m-      ? daySchedule.open[m
[31m-      : DEFAULT_OPEN_TIME;[m
[31m-    const close = daySchedule?.close && daySchedule.close !== "closed"[m
[31m-      ? daySchedule.close[m
[31m-      : DEFAULT_CLOSE_TIME;[m
[31m-[m
[31m-    acc[day] = {[m
[31m-      active: !!daySchedule && daySchedule.open !== "closed",[m
[31m-      open,[m
[31m-      close,[m
[31m-    };[m
[31m-    return acc;[m
[31m-  }, base);[m
[31m-};[m
[31m-[m
[31m-const initialScheduleState = createDefaultScheduleState();[m
[31m-[m
[31m-export default function SettingsPage() {[m
[31m-  const { toast } = useToast();[m
[31m-  const { user, refreshUser } = useAuth();[m
[31m-  const { barbershopId, isLoading: isBarbershopIdLoading } = useBarbershopId();[m
[31m-  const [barbershopData, setBarbershopData] = useState<Barbershop | null>(null);[m
[31m-  const [isLoadingBarbershop, setIsLoadingBarbershop] = useState(true);[m
[31m-  const [isSecurityUpdating, setIsSecurityUpdating] = useState(false);[m
[31m-[m
[31m-  const isSuperAdmin = user?.email === 'claudiohs@hotmail.com';[m
[31m-[m
[31m-  const [isEditingInfo, setIsEditingInfo] = useState(false);[m
[31m-  const [isEditingAddress, setIsEditingAddress] = useState(false);[m
[31m-  const [isEditingSecurity, setIsEditingSecurity] = useState(false);[m
[31m-  const [isCropDialogOpen, setIsCropDialogOpen] = useState(false);[m
[31m-  const [rawLogoImage, setRawLogoImage] = useState<string | null>(null);[m
[31m-  const [cropZoom, setCropZoom] = useState(1);[m
[31m-  const [rawLogoDims, setRawLogoDims] = useState<{ w: number; h: number } | null>(null);[m
[31m-  [m
[31m-  // State for form edits, only holds data while editing.[m
[31m-  const [formState, setFormState] = useState<Partial<Barbershop>>({});[m
[31m-  const [logoPreview, setLogoPreview] = useState<string | null>(null);[m
[31m-  const [cpfCnpjError, setCpfCnpjError] = useState<string | null>(null);[m
[31m-[m
[31m-  const [schedule, setSchedule] = useState<OperatingHoursState>(initialScheduleState);[m
[31m-  useEffect(() => {[m
[31m-    setSchedule(mapOperatingHoursToState(barbershopData));[m
[31m-  }, [barbershopData]);[m
[31m-  [m
[31m-  const [userEmail, setUserEmail] = useState("");[m
[31m-  const [currentPassword, setCurrentPassword] = useState("");[m
[31m-  const [newPassword, setNewPassword] = useState("");[m
[31m-  const [confirmNewPassword, setConfirmNewPassword] = useState("");[m
[31m-  const [showCurrentPassword, setShowCurrentPassword] = useState(false);[m
[31m-  const [showNewPassword, setShowNewPassword] = useState(false);[m
[31m-  const [showConfirmPassword, setShowConfirmPassword] = useState(false);[m
[31m-[m
[31m-  const parseErrorMessage = (err: any) => {[m
[31m-    const raw = err?.message || err?.toString?.() || "";[m
[31m-    try {[m
[31m-      const parsed = JSON.parse(raw);[m
[31m-      if (parsed?.error) return String(parsed.error);[m
[31m-    } catch {[m
[31m-      /* ignore */[m
[31m-    }[m
[31m-    return raw || "Não foi possível atualizar a barbearia.";[m
[31m-  };[m
[31m-[m
[31m-  const fetchBarbershop = useCallback(async () => {[m
[31m-    if (!barbershopId) {[m
[31m-      setBarbershopData(null);[m
[31m-      setIsLoadingBarbershop(false);[m
[31m-      return null;[m
[31m-    }[m
[31m-[m
[31m-    setIsLoadingBarbershop(true);[m
[31m-    try {[m
[31m-      const response = await fetchJson<{ data: Barbershop }>(`/api/barbershops/${encodeURIComponent(barbershopId)}`);[m
[31m-      const shop = response.data ?? null;[m
[31m-      setBarbershopData(shop);[m
[31m-      return shop;[m
[31m-    } catch (error: any) {[m
[31m-      const message = error.message || "Erro ao carregar os dados da barbearia.";[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Erro ao carregar barbearia",[m
[31m-        description: message,[m
[31m-      });[m
[31m-      return null;[m
[31m-    } finally {[m
[31m-      setIsLoadingBarbershop(false);[m
[31m-    }[m
[31m-  }, [barbershopId, toast]);[m
[31m-[m
[31m-  useEffect(() => {[m
[31m-    if (!barbershopId) {[m
[31m-      setBarbershopData(null);[m
[31m-      setIsLoadingBarbershop(false);[m
[31m-      return;[m
[31m-    }[m
[31m-    void fetchBarbershop();[m
[31m-  }, [barbershopId, fetchBarbershop]);[m
[31m-[m
[31m-  useEffect(() => {[m
[31m-    if (!isEditingSecurity && user?.email) {[m
[31m-      setUserEmail(user.email);[m
[31m-    }[m
[31m-  }, [user, isEditingSecurity]);[m
[31m-[m
[31m-  // Function to initialize editing state[m
[31m-  const startEditing = (section: 'info' | 'address' | 'security') => {[m
[31m-    if (!barbershopData) return;[m
[31m-    [m
[31m-    setFormState({[m
[31m-      ...barbershopData,[m
[31m-      cpfCnpj: barbershopData.cpfCnpj ? formatCpfCnpjValue(barbershopData.cpfCnpj) : barbershopData.cpfCnpj,[m
[31m-    });[m
[31m-    setLogoPreview(barbershopData.logoUrl || null);[m
[31m-[m
[31m-    const initialSchedule = weekDays.reduce((acc, day) => {[m
[31m-        const daySchedule = barbershopData.operatingHours?.find([m
[31m-          (h: { day: string }) => normalizeDay(h.day) === normalizeDay(day)[m
[31m-        );[m
[31m-        const open = daySchedule?.open && daySchedule.open !== "closed"[m
[31m-          ? daySchedule.open[m
[31m-          : DEFAULT_OPEN_TIME;[m
[31m-        const close = daySchedule?.close && daySchedule.close !== "closed"[m
[31m-          ? daySchedule.close[m
[31m-          : DEFAULT_CLOSE_TIME;[m
[31m-        acc[day] = {[m
[31m-          active: !!daySchedule && daySchedule.open !== "closed",[m
[31m-          open,[m
[31m-          close,[m
[31m-        };[m
[31m-        return acc;[m
[31m-    }, {} as OperatingHoursState);[m
[31m-    setSchedule(initialSchedule);[m
[31m-[m
[31m-    if (user?.email) setUserEmail(user.email);[m
[31m-    [m
[31m-    if (section === 'info') {[m
[31m-      const { valid, type } = validateCpfCnpj(barbershopData.cpfCnpj || "");[m
[31m-      setCpfCnpjError(valid || !barbershopData.cpfCnpj ? null : type ? `${type} inválido` : "CPF/CNPJ inválido");[m
[31m-      setIsEditingInfo(true);[m
[31m-    } else if (section === 'address') {[m
[31m-      setIsEditingAddress(true);[m
[31m-    } else if (section === 'security') {[m
[31m-      setIsEditingSecurity(true);[m
[31m-    }[m
[31m-  };[m
[31m-[m
[31m-  const formCep = formState.address?.cep || '';[m
[31m-  [m
[31m-  const handleFormChange = useCallback((fieldName: keyof Barbershop, value: any) => {[m
[31m-    setFormState(prev => ({ ...prev, [fieldName]: value }));[m
[31m-  }, []);[m
[31m-[m
[31m-  useEffect(() => {[m
[31m-    const fetchAddress = async () => {[m
[31m-      if (!isEditingAddress) return;[m
[31m-      const cleanedCep = formCep.replace(/\D/g, "");[m
[31m-      if (cleanedCep.length === 8) {[m
[31m-        try {[m
[31m-          const response = await fetch(`/api/cep/${cleanedCep}`);[m
[31m-          const data = await response.json();[m
[31m-          if (!data.error) {[m
[31m-            handleFormChange("address", {[m
[31m-                ...formState.address,[m
[31m-                street: data.street,[m
[31m-                neighborhood: data.neighborhood,[m
[31m-                city: data.city,[m
[31m-                state: data.state,[m
[31m-            });[m
[31m-          } else {[m
[31m-             toast({ variant: "destructive", title: "Erro de CEP", description: data.error });[m
[31m-          }[m
[31m-        } catch (error) {[m
[31m-          console.error("Failed to fetch address:", error);[m
[31m-          toast({ variant: "destructive", title: "Erro de Rede", description: "Não foi possível buscar o endereço." });[m
[31m-        }[m
[31m-      }[m
[31m-    };[m
[31m-    fetchAddress();[m
[31m-  }, [formCep, isEditingAddress]);[m
[31m-[m
[31m-  const formCpfCnpj = formState.cpfCnpj || '';[m
[31m-  const fetchCompanyData = useCallback([m
[31m-    async (cleanedCnpj: string) => {[m
[31m-      if (!isEditingInfo || cleanedCnpj.length !== 14) return;[m
[31m-      try {[m
[31m-        const response = await fetch(`/api/cnpj/${cleanedCnpj}`);[m
[31m-        const data = await response.json();[m
[31m-        if (!data.error) {[m
[31m-          setFormState(prev => ({[m
[31m-            ...prev,[m
[31m-            legalName: data.razao_social || prev.legalName,[m
[31m-            name: data.nome_fantasia || prev.name,[m
[31m-          }));[m
[31m-        }[m
[31m-      } catch (error) {[m
[31m-        console.error("Failed to fetch CNPJ data:", error);[m
[31m-      }[m
[31m-    },[m
[31m-    [isEditingInfo][m
[31m-  );[m
[31m-[m
[31m-  useEffect(() => {[m
[31m-    const cleanedCnpj = formCpfCnpj.replace(/\D/g, "");[m
[31m-    if (cleanedCnpj.length === 14) {[m
[31m-      void fetchCompanyData(cleanedCnpj);[m
[31m-    }[m
[31m-  }, [formCpfCnpj, fetchCompanyData]);[m
[31m-[m
[31m-  const handleLogoChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m
[31m-    if (!isEditingInfo) return;[m
[31m-    if (e.target.files && e.target.files[0]) {[m
[31m-      const file = e.target.files[0];[m
[31m-      const reader = new FileReader();[m
[31m-      reader.onloadend = () => {[m
[31m-        const dataUrl = reader.result as string;[m
[31m-        setRawLogoImage(dataUrl);[m
[31m-        setCropZoom(1);[m
[31m-        setIsCropDialogOpen(true);[m
[31m-      };[m
[31m-      reader.readAsDataURL(file);[m
[31m-    }[m
[31m-  };[m
[31m-[m
[31m-  useEffect(() => {[m
[31m-    if (!rawLogoImage) {[m
[31m-      setRawLogoDims(null);[m
[31m-      return;[m
[31m-    }[m
[31m-    const img = new Image();[m
[31m-    img.onload = () => {[m
[31m-      setRawLogoDims({ w: img.width, h: img.height });[m
[31m-    };[m
[31m-    img.src = rawLogoImage;[m
[31m-  }, [rawLogoImage]);[m
[31m-[m
[31m-  const resetCropState = () => {[m
[31m-    setIsCropDialogOpen(false);[m
[31m-    setRawLogoImage(null);[m
[31m-    setCropZoom(1);[m
[31m-    setRawLogoDims(null);[m
[31m-  };[m
[31m-[m
[31m-  const handleApplyLogoCrop = async () => {[m
[31m-    if (!rawLogoImage || !rawLogoDims) {[m
[31m-      resetCropState();[m
[31m-      return;[m
[31m-    }[m
[31m-    const img = new Image();[m
[31m-    img.src = rawLogoImage;[m
[31m-    await new Promise((resolve) => {[m
[31m-      img.onload = resolve;[m
[31m-    });[m
[31m-    const canvasSize = 400;[m
[31m-    const canvas = document.createElement("canvas");[m
[31m-    canvas.width = canvasSize;[m
[31m-    canvas.height = canvasSize;[m
[31m-    const ctx = canvas.getContext("2d");[m
[31m-    if (!ctx) {[m
[31m-      resetCropState();[m
[31m-      return;[m
[31m-    }[m
[31m-    const { w, h } = rawLogoDims;[m
[31m-    const cropSize = Math.min(w, h) / cropZoom;[m
[31m-    const sx = (w - cropSize) / 2;[m
[31m-    const sy = (h - cropSize) / 2;[m
[31m-    ctx.drawImage(img, sx, sy, cropSize, cropSize, 0, 0, canvasSize, canvasSize);[m
[31m-    const dataUrl = canvas.toDataURL("image/png");[m
[31m-    setLogoPreview(dataUrl);[m
[31m-    handleFormChange("logoUrl", dataUrl);[m
[31m-    resetCropState();[m
[31m-  };[m
[31m-[m
[31m-  const persistOperatingHours = useCallback([m
[31m-    async (nextSchedule: OperatingHoursState) => {[m
[31m-      if (!barbershopId) {[m
[31m-        toast({[m
[31m-          variant: "destructive",[m
[31m-          title: "Erro",[m
[31m-          description: "Usuario nao autenticado.",[m
[31m-        });[m
[31m-        return;[m
[31m-      }[m
[31m-[m
[31m-      const isValidTime = (value?: string) => !!value && /^\d{2}:\d{2}$/.test(value);[m
[31m-      const invalidDay = weekDays.find((day) => {[m
[31m-        const daySchedule = nextSchedule[day];[m
[31m-        return daySchedule?.active && (!isValidTime(daySchedule.open) || !isValidTime(daySchedule.close));[m
[31m-      });[m
[31m-      if (invalidDay) {[m
[31m-        toast({[m
[31m-          variant: "destructive",[m
[31m-          title: "Coloque o horario de funcionamento para salvar",[m
[31m-          description: `Preencha abertura e fechamento em ${invalidDay}.`,[m
[31m-        });[m
[31m-        return;[m
[31m-      }[m
[31m-[m
[31m-      const nextOperatingHours = weekDays.map((day) => {[m
[31m-        const daySchedule = nextSchedule[day];[m
[31m-        return {[m
[31m-          day,[m
[31m-          open: daySchedule?.active ? daySchedule.open : "closed",[m
[31m-          close: daySchedule?.active ? daySchedule.close : "closed",[m
[31m-        };[m
[31m-      });[m
[31m-[m
[31m-      try {[m
[31m-        await fetchJson(`/api/barbershops/${barbershopId}`, {[m
[31m-          method: "PATCH",[m
[31m-          headers: { "Content-Type": "application/json" },[m
[31m-          body: JSON.stringify({ operatingHours: nextOperatingHours }),[m
[31m-        });[m
[31m-        const updatedShop = barbershopData[m
[31m-          ? { ...barbershopData, operatingHours: nextOperatingHours as any }[m
[31m-          : null;[m
[31m-[m
[31m-        if (updatedShop) {[m
[31m-          setBarbershopData(updatedShop);[m
[31m-          try {[m
[31m-            window.dispatchEvent(new CustomEvent("barbershop-updated", { detail: updatedShop }));[m
[31m-            localStorage.setItem("barbershop-updated", JSON.stringify({ ...updatedShop, _ts: Date.now() }));[m
[31m-          } catch (error) {[m
[31m-            console.warn("Nao foi possivel propagar atualizacao da barbearia:", error);[m
[31m-          }[m
[31m-        }[m
[31m-      } catch (error: any) {[m
[31m-        toast({[m
[31m-          variant: "destructive",[m
[31m-          title: "Erro ao salvar configuracoes",[m
[31m-          description: error.message || "Nao foi possivel atualizar a barbearia.",[m
[31m-        });[m
[31m-      }[m
[31m-    },[m
[31m-    [barbershopId, toast, barbershopData][m
[31m-  );[m
[31m-[m
[31m-  const handleScheduleChange = useCallback([m
[31m-    (day: string, updates: Partial<OperatingHoursState[string]>) => {[m
[31m-      setSchedule((prev) => {[m
[31m-        const currentDay = prev[day] || { active: false, open: DEFAULT_OPEN_TIME, close: DEFAULT_CLOSE_TIME };[m
[31m-        const nextState = { ...prev, [day]: { ...currentDay, ...updates } };[m
[31m-        void persistOperatingHours(nextState);[m
[31m-        return nextState;[m
[31m-      });[m
[31m-    },[m
[31m-    [persistOperatingHours][m
[31m-  );[m
[31m-[m
[31m-  const handleSaveChanges = async (section: 'info' | 'address') => {[m
[31m-    if (!barbershopId) {[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Erro",[m
[31m-        description: "Usuario nao autenticado.",[m
[31m-      });[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    let payload: Partial<Barbershop> = {};[m
[31m-[m
[31m-    if (section === 'info') {[m
[31m-      const { valid, type } = validateCpfCnpj(formState.cpfCnpj || "");[m
[31m-      if (!valid) {[m
[31m-        const message = type ? `${type} inválido` : "CPF/CNPJ inválido";[m
[31m-        setCpfCnpjError(message);[m
[31m-        toast({[m
[31m-          variant: "destructive",[m
[31m-          title: "Documento inválido",[m
[31m-          description: "Informe um CPF ou CNPJ válido para salvar.",[m
[31m-        });[m
[31m-        return;[m
[31m-      }[m
[31m-[m
[31m-      payload = {[m
[31m-        name: formState.name,[m
[31m-        legalName: formState.legalName,[m
[31m-        phone: formState.phone,[m
[31m-        cpfCnpj: formState.cpfCnpj,[m
[31m-      };[m
[31m-      const logoToSave = logoPreview ?? barbershopData?.logoUrl;[m
[31m-      if (logoToSave) {[m
[31m-        payload.logoUrl = logoToSave;[m
[31m-      }[m
[31m-    } else if (section === 'address') {[m
[31m-      const address = formState.address || {};[m
[31m-      const cleanedCep = (address.cep || "").replace(/\D/g, "");[m
[31m-      const street = address.street?.toString().trim() || "";[m
[31m-      const number = address.number?.toString().trim() || "";[m
[31m-      const neighborhood = address.neighborhood?.toString().trim() || "";[m
[31m-      const city = address.city?.toString().trim() || "";[m
[31m-      const state = address.state?.toString().trim() || "";[m
[31m-[m
[31m-      if ([m
[31m-        !cleanedCep ||[m
[31m-        cleanedCep.length !== 8 ||[m
[31m-        !street ||[m
[31m-        !number ||[m
[31m-        !neighborhood ||[m
[31m-        !city ||[m
[31m-        !state[m
[31m-      ) {[m
[31m-        toast({[m
[31m-          variant: "destructive",[m
[31m-          title: "Erro",[m
[31m-          description: "Preencha CEP, rua, número, bairro, cidade e estado.",[m
[31m-        });[m
[31m-        return;[m
[31m-      }[m
[31m-[m
[31m-      payload = {[m
[31m-        address: {[m
[31m-          ...address,[m
[31m-          cep: cleanedCep.replace(/^(\d{5})(\d{3})$/, "$1-$2"),[m
[31m-          street,[m
[31m-          number,[m
[31m-          neighborhood,[m
[31m-          city,[m
[31m-          state,[m
[31m-        },[m
[31m-      };[m
[31m-    }[m
[31m-[m
[31m-    try {[m
[31m-      await fetchJson(`/api/barbershops/${barbershopId}`, {[m
[31m-        method: "PATCH",[m
[31m-        headers: { "Content-Type": "application/json" },[m
[31m-        body: JSON.stringify(payload),[m
[31m-      });[m
[31m-      toast({[m
[31m-        title: "Configuracoes salvas!",[m
[31m-        description: "As informacoes da sua barbearia foram atualizadas.",[m
[31m-      });[m
[31m-      const updatedShop = await fetchBarbershop();[m
[31m-      if (updatedShop) {[m
[31m-        try {[m
[31m-          window.dispatchEvent(new CustomEvent("barbershop-updated", { detail: updatedShop }));[m
[31m-          localStorage.setItem("barbershop-updated", JSON.stringify({ ...updatedShop, _ts: Date.now() }));[m
[31m-        } catch (error) {[m
[31m-          console.warn("Nao foi possivel propagar atualizacao da barbearia:", error);[m
[31m-        }[m
[31m-      }[m
[31m-      setFormState({});[m
[31m-      if (section === 'info') {[m
[31m-        setIsEditingInfo(false);[m
[31m-        setLogoPreview(null);[m
[31m-        setCpfCnpjError(null);[m
[31m-      } else if (section === 'address') {[m
[31m-        setIsEditingAddress(false);[m
[31m-      }[m
[31m-    } catch (error: any) {[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Erro ao salvar configuracoes",[m
[31m-        description: parseErrorMessage(error),[m
[31m-      });[m
[31m-    }[m
[31m-  };[m
[31m-[m
[31m-  const handleSecurityChanges = async () => {[m
[31m-    if (!user || !barbershopId) {[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Erro",[m
[31m-        description: "Você não está logado.",[m
[31m-      });[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    const passwordChanged = newPassword !== "";[m
[31m-[m
[31m-    if (!passwordChanged) {[m
[31m-      toast({[m
[31m-        title: "Nenhuma alteração",[m
[31m-        description: "Nenhuma alteração de senha foi detectada.",[m
[31m-      });[m
[31m-      setIsEditingSecurity(false);[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    if (passwordChanged && newPassword !== confirmNewPassword) {[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Senhas não coincidem",[m
[31m-        description: "A nova senha e a confirmação não são iguais.",[m
[31m-      });[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    if (!currentPassword) {[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Senha necessária",[m
[31m-        description: "Você deve fornecer sua senha atual para fazer alterações.",[m
[31m-      });[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    setIsSecurityUpdating(true);[m
[31m-    try {[m
[31m-      const body: { currentPassword: string; newPassword?: string } = {[m
[31m-        currentPassword,[m
[31m-      };[m
[31m-      if (passwordChanged) {[m
[31m-        body.newPassword = newPassword;[m
[31m-      }[m
[31m-[m
[31m-      const response = await fetchJson<{[m
[31m-        data: { user: AuthUser; accessToken: string };[m
[31m-      }>("/api/auth/update-profile", {[m
[31m-        method: "PATCH",[m
[31m-        headers: {[m
[31m-          "Content-Type": "application/json",[m
[31m-        },[m
[31m-        body: JSON.stringify(body),[m
[31m-      });[m
[31m-[m
[31m-      setAccessToken(response.data.accessToken);[m
[31m-      await refreshUser();[m
[31m-      toast({[m
[31m-        title: "Segurança atualizada!",[m
[31m-        description: "Suas credenciais foram sincronizadas.",[m
[31m-      });[m
[31m-      setIsEditingSecurity(false);[m
[31m-      setCurrentPassword("");[m
[31m-      setNewPassword("");[m
[31m-      setConfirmNewPassword("");[m
[31m-    } catch (error: any) {[m
[31m-      const description =[m
[31m-        error.message || "Não foi possível atualizar seus dados de segurança.";[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Falha na atualização de segurança",[m
[31m-        description,[m
[31m-      });[m
[31m-    } finally {[m
[31m-      setIsSecurityUpdating(false);[m
[31m-    }[m
[31m-  };[m
[31m-[m
[31m-  const handleCancelEdit = (section: 'info' | 'address' | 'security') => {[m
[31m-    if (section === 'info') {[m
[31m-      setIsEditingInfo(false);[m
[31m-      setCpfCnpjError(null);[m
[31m-    }[m
[31m-    else if (section === 'address') setIsEditingAddress(false);[m
[31m-    else if (section === 'security') {[m
[31m-        setIsEditingSecurity(false);[m
[31m-        if (user?.email) setUserEmail(user.email);[m
[31m-        setCurrentPassword("");[m
[31m-        setNewPassword("");[m
[31m-        setConfirmNewPassword("");[m
[31m-    }[m
[31m-    setFormState({}); // Clear editing state[m
[31m-  };[m
[31m-[m
[31m-[m
[31m-  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m
[31m-    const { name, value } = e.target;[m
[31m-    let finalValue = value;[m
[31m-    if (name === 'phone') {[m
[31m-        let phoneValue = value.replace(/\D/g, '');[m
[31m-        phoneValue = phoneValue.replace(/^(\d{2})(\d)/g, '($1) $2');[m
[31m-        phoneValue = phoneValue.replace(/(\d{5})(\d)/, '$1-$2');[m
[31m-        if (phoneValue.length > 15) phoneValue = phoneValue.substring(0, 15);[m
[31m-        finalValue = phoneValue;[m
[31m-    } else if (name === 'cpfCnpj') {[m
[31m-        const raw = value.replace(/\D/g, '');[m
[31m-        let formatted = raw;[m
[31m-        if (formatted.length <= 11) {[m
[31m-            formatted = formatted.replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d{1,2})$/, '$1-$2');[m
[31m-        } else {[m
[31m-            formatted = formatted.substring(0, 14).replace(/^(\d{2})(\d)/, '$1.$2').replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3').replace(/\.(\d{3})(\d)/, '.$1/$2').replace(/(\d{4})(\d)/, '$1-$2');[m
[31m-        }[m
[31m-[m
[31m-        const { valid, type } = validateCpfCnpj(raw);[m
[31m-        if (!raw) {[m
[31m-          setCpfCnpjError(null);[m
[31m-        } else if (raw.length !== 11 && raw.length !== 14) {[m
[31m-          setCpfCnpjError("CPF/CNPJ incompleto");[m
[31m-        } else if (!valid) {[m
[31m-          setCpfCnpjError(type ? `${type} inválido` : "CPF/CNPJ inválido");[m
[31m-        } else {[m
[31m-          setCpfCnpjError(null);[m
[31m-        }[m
[31m-[m
[31m-        if (isEditingInfo && raw.length === 14) {[m
[31m-          void fetchCompanyData(raw);[m
[31m-        }[m
[31m-[m
[31m-        finalValue = formatted;[m
[31m-    } else if (name === 'cep') {[m
[31m-        let cepValue = value.replace(/\D/g, "").replace(/^(\d{5})(\d)/, "$1-$2");[m
[31m-        if (cepValue.length > 9) cepValue = cepValue.substring(0, 9);[m
[31m-        finalValue = cepValue;[m
[31m-    } else if (name === "address.number") {[m
[31m-        const digits = value.replace(/\D/g, "").slice(0, 7);[m
[31m-        finalValue = digits;[m
[31m-    } else if (name === 'name' || name === 'legalName') {[m
[31m-        finalValue = capitalizeWords(value);[m
[31m-    }[m
[31m-     if (name.includes('.')) {[m
[31m-        const [parent, child] = name.split('.');[m
[31m-        handleFormChange(parent as keyof Barbershop, { ...formState[parent as keyof Barbershop], [child]: finalValue });[m
[31m-    } else {[m
[31m-        handleFormChange(name as keyof Barbershop, finalValue);[m
[31m-    }[m
[31m-  };[m
[31m-  [m
[31m-  if (isBarbershopIdLoading || isLoadingBarbershop) {[m
[31m-      return <div className="p-6">Carregando configurações...</div>;[m
[31m-  }[m
[31m-  [m
[31m-  const infoData = isEditingInfo ? formState : barbershopData;[m
[31m-  const addressData = isEditingAddress ? formState.address : barbershopData?.address;[m
[31m-[m
[31m-  const displayHours = weekDays.map((day) => ({[m
[31m-    day,[m
[31m-    ...schedule[day],[m
[31m-  }));[m
[31m-[m
[31m-[m
[31m-  return ([m
[31m-    <>[m
[31m-      <Dialog open={isCropDialogOpen} onOpenChange={(open) => { if (!open) resetCropState(); }}>[m
[31m-        <DialogContent className="sm:max-w-md">[m
[31m-          <DialogHeader>[m
[31m-            <DialogTitle>Recortar Logo</DialogTitle>[m
[31m-            <DialogDescription>Use o zoom para ajustar o recorte quadrado da logo.</DialogDescription>[m
[31m-          </DialogHeader>[m
[31m-          <div className="space-y-4">[m
[32m+[m[41m[m
[32m+[m[32m"use client";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mimport { useCallback, useEffect, useState } from "react";[m[41m[m
[32m+[m[32mimport { Button } from "@/components/ui/button";[m[41m[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  Card,[m[41m[m
[32m+[m[32m  CardContent,[m[41m[m
[32m+[m[32m  CardDescription,[m[41m[m
[32m+[m[32m  CardHeader,[m[41m[m
[32m+[m[32m  CardTitle,[m[41m[m
[32m+[m[32m  CardFooter,[m[41m[m
[32m+[m[32m} from "@/components/ui/card";[m[41m[m
[32m+[m[32mimport { Input } from "@/components/ui/input";[m[41m[m
[32m+[m[32mimport { Label } from "@/components/ui/label";[m[41m[m
[32m+[m[32mimport { Switch } from "@/components/ui/switch";[m[41m[m
[32m+[m[32mimport { useToast } from "@/hooks/use-toast";[m[41m[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  Dialog,[m[41m[m
[32m+[m[32m  DialogContent,[m[41m[m
[32m+[m[32m  DialogDescription,[m[41m[m
[32m+[m[32m  DialogHeader,[m[41m[m
[32m+[m[32m  DialogTitle,[m[41m[m
[32m+[m[32m  DialogFooter,[m[41m[m
[32m+[m[32m  DialogClose,[m[41m[m
[32m+[m[32m} from "@/components/ui/dialog";[m[41m[m
[32m+[m[32mimport { Crown, Sparkles, Edit, Save, Lock, Upload, Check, AlertCircle, ShoppingCart, Copy, Loader2, Info, QrCode, Eye, EyeOff, Building, CreditCard } from "lucide-react";[m[41m[m
[32m+[m[32mimport { useAuth } from "@/context/AuthContext";[m[41m[m
[32m+[m[32mimport { fetchJson, setAccessToken } from "@/lib/fetcher";[m[41m[m
[32m+[m[32mimport type { AuthUser, Barbershop } from "@/lib/definitions";[m[41m[m
[32m+[m[32mimport { useBarbershopId } from "@/context/BarbershopIdContext";[m[41m[m
[32m+[m[32mimport { WhatsAppIcon } from "@/components/icons/whatsapp-icon";[m[41m[m
[32m+[m[32mimport { differenceInDays, startOfDay, format, isBefore } from "date-fns";[m[41m[m
[32m+[m[32mimport { formatCurrency, capitalizeWords } from "@/lib/utils";[m[41m[m
[32m+[m[32mimport { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";[m[41m[m
[32m+[m[32mimport { TooltipProvider, Tooltip, TooltipTrigger, TooltipContent } from "@/components/ui/tooltip";[m[41m[m
[32m+[m[32mimport { Badge } from "@/components/ui/badge";[m[41m[m
[32m+[m[32mimport NextImage from "next/image";[m
[32m+[m[41m[m
[32m+[m[41m[m
[32m+[m[32mtype OperatingHoursState = {[m[41m[m
[32m+[m[32m  [key: string]: {[m[41m[m
[32m+[m[32m    active: boolean;[m[41m[m
[32m+[m[32m    open: string;[m[41m[m
[32m+[m[32m    close: string;[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst weekDays = [[m[41m[m
[32m+[m[32m  "Domingo",[m[41m[m
[32m+[m[32m  "Segunda-feira",[m[41m[m
[32m+[m[32m  "Terça-feira",[m[41m[m
[32m+[m[32m  "Quarta-feira",[m[41m[m
[32m+[m[32m  "Quinta-feira",[m[41m[m
[32m+[m[32m  "Sexta-feira",[m[41m[m
[32m+[m[32m  "Sábado",[m[41m[m
[32m+[m[32m];[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst DEFAULT_OPEN_TIME = "08:00";[m[41m[m
[32m+[m[32mconst DEFAULT_CLOSE_TIME = "18:00";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst formatCpfCnpjValue = (value: string) => {[m[41m[m
[32m+[m[32m  const raw = value.replace(/\D/g, "");[m[41m[m
[32m+[m[32m  if (raw.length <= 11) {[m[41m[m
[32m+[m[32m    return raw[m[41m[m
[32m+[m[32m      .replace(/(\d{3})(\d)/, "$1.$2")[m[41m[m
[32m+[m[32m      .replace(/(\d{3})(\d)/, "$1.$2")[m[41m[m
[32m+[m[32m      .replace(/(\d{3})(\d{1,2})$/, "$1-$2");[m[41m[m
[32m+[m[32m  }[m[41m[m
[32m+[m[32m  return raw[m[41m[m
[32m+[m[32m    .substring(0, 14)[m[41m[m
[32m+[m[32m    .replace(/^(\d{2})(\d)/, "$1.$2")[m[41m[m
[32m+[m[32m    .replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3")[m[41m[m
[32m+[m[32m    .replace(/\.(\d{3})(\d)/, ".$1/$2")[m[41m[m
[32m+[m[32m    .replace(/(\d{4})(\d)/, "$1-$2");[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst planPrices = {[m[41m[m
[32m+[m[32m    'Básico': 49.90,[m[41m[m
[32m+[m[32m    'Premium': 119.90,[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst digitsOnly = (value: string) => value.replace(/\D/g, "");[m[41m[m
[32m+[m[32mconst isSequentialDigits = (value: string) => /^(\d)\1+$/.test(value);[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst isValidCpf = (value: string) => {[m[41m[m
[32m+[m[32m  const cpf = digitsOnly(value);[m[41m[m
[32m+[m[32m  if (cpf.length !== 11 || isSequentialDigits(cpf)) return false;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const calcDigit = (slice: number) => {[m[41m[m
[32m+[m[32m    const sum = cpf[m[41m[m
[32m+[m[32m      .slice(0, slice)[m[41m[m
[32m+[m[32m      .split("")[m[41m[m
[32m+[m[32m      .reduce((acc, num, idx) => acc + parseInt(num, 10) * (slice + 1 - idx), 0);[m[41m[m
[32m+[m[32m    const remainder = (sum * 10) % 11;[m[41m[m
[32m+[m[32m    return remainder === 10 ? 0 : remainder;[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const digit1 = calcDigit(9);[m[41m[m
[32m+[m[32m  const digit2 = calcDigit(10);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  return digit1 === parseInt(cpf[9], 10) && digit2 === parseInt(cpf[10], 10);[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst isValidCnpj = (value: string) => {[m[41m[m
[32m+[m[32m  const cnpj = digitsOnly(value);[m[41m[m
[32m+[m[32m  if (cnpj.length !== 14 || isSequentialDigits(cnpj)) return false;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const calcDigit = (slice: number) => {[m[41m[m
[32m+[m[32m    const factors = slice === 12[m[41m[m
[32m+[m[32m      ? [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2][m[41m[m
[32m+[m[32m      : [6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];[m[41m[m
[32m+[m[32m    const sum = cnpj[m[41m[m
[32m+[m[32m      .slice(0, slice)[m[41m[m
[32m+[m[32m      .split("")[m[41m[m
[32m+[m[32m      .reduce((acc, num, idx) => acc + parseInt(num, 10) * factors[idx], 0);[m[41m[m
[32m+[m[32m    const remainder = sum % 11;[m[41m[m
[32m+[m[32m    return remainder < 2 ? 0 : 11 - remainder;[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const digit1 = calcDigit(12);[m[41m[m
[32m+[m[32m  const digit2 = calcDigit(13);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  return digit1 === parseInt(cnpj[12], 10) && digit2 === parseInt(cnpj[13], 10);[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst validateCpfCnpj = (value: string) => {[m[41m[m
[32m+[m[32m  const clean = digitsOnly(value);[m[41m[m
[32m+[m[32m  if (!clean) return { valid: false, type: null as "CPF" | "CNPJ" | null };[m[41m[m
[32m+[m[32m  if (clean.length === 11) return { valid: isValidCpf(clean), type: "CPF" as const };[m[41m[m
[32m+[m[32m  if (clean.length === 14) return { valid: isValidCnpj(clean), type: "CNPJ" as const };[m[41m[m
[32m+[m[32m  return { valid: false, type: null as "CPF" | "CNPJ" | null };[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst normalizeDay = (value: string) =>[m[41m[m
[32m+[m[32m  value?.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "") || "";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst createDefaultScheduleState = () =>[m[41m[m
[32m+[m[32m  weekDays.reduce((acc, day) => {[m[41m[m
[32m+[m[32m    acc[day] = { active: false, open: DEFAULT_OPEN_TIME, close: DEFAULT_CLOSE_TIME };[m[41m[m
[32m+[m[32m    return acc;[m[41m[m
[32m+[m[32m  }, {} as OperatingHoursState);[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst mapOperatingHoursToState = (shop: Barbershop | null) => {[m[41m[m
[32m+[m[32m  const base = createDefaultScheduleState();[m[41m[m
[32m+[m[32m  if (!shop?.operatingHours) return base;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  return weekDays.reduce((acc, day) => {[m[41m[m
[32m+[m[32m    const daySchedule = shop.operatingHours.find([m[41m[m
[32m+[m[32m      (h: { day: string }) => normalizeDay(h.day) === normalizeDay(day)[m[41m[m
[32m+[m[32m    );[m[41m[m
[32m+[m[32m    const open = daySchedule?.open && daySchedule.open !== "closed"[m[41m[m
[32m+[m[32m      ? daySchedule.open[m[41m[m
[32m+[m[32m      : DEFAULT_OPEN_TIME;[m[41m[m
[32m+[m[32m    const close = daySchedule?.close && daySchedule.close !== "closed"[m[41m[m
[32m+[m[32m      ? daySchedule.close[m[41m[m
[32m+[m[32m      : DEFAULT_CLOSE_TIME;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    acc[day] = {[m[41m[m
[32m+[m[32m      active: !!daySchedule && daySchedule.open !== "closed",[m[41m[m
[32m+[m[32m      open,[m[41m[m
[32m+[m[32m      close,[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[32m    return acc;[m[41m[m
[32m+[m[32m  }, base);[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst initialScheduleState = createDefaultScheduleState();[m[41m[m
[32m+[m[41m[m
[32m+[m[32mexport default function SettingsPage() {[m[41m[m
[32m+[m[32m  const { toast } = useToast();[m[41m[m
[32m+[m[32m  const { user, refreshUser } = useAuth();[m[41m[m
[32m+[m[32m  const { barbershopId, isLoading: isBarbershopIdLoading } = useBarbershopId();[m[41m[m
[32m+[m[32m  const [barbershopData, setBarbershopData] = useState<Barbershop | null>(null);[m[41m[m
[32m+[m[32m  const [isLoadingBarbershop, setIsLoadingBarbershop] = useState(true);[m[41m[m
[32m+[m[32m  const [isSecurityUpdating, setIsSecurityUpdating] = useState(false);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const isSuperAdmin = user?.email === 'claudiohs@hotmail.com';[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const [isEditingInfo, setIsEditingInfo] = useState(false);[m[41m[m
[32m+[m[32m  const [isEditingAddress, setIsEditingAddress] = useState(false);[m[41m[m
[32m+[m[32m  const [isEditingSecurity, setIsEditingSecurity] = useState(false);[m[41m[m
[32m+[m[32m  const [isCropDialogOpen, setIsCropDialogOpen] = useState(false);[m[41m[m
[32m+[m[32m  const [rawLogoImage, setRawLogoImage] = useState<string | null>(null);[m[41m[m
[32m+[m[32m  const [cropZoom, setCropZoom] = useState(1);[m[41m[m
[32m+[m[32m  const [rawLogoDims, setRawLogoDims] = useState<{ w: number; h: number } | null>(null);[m[41m[m
[32m+[m[41m  [m
[32m+[m[32m  // State for form edits, only holds data while editing.[m[41m[m
[32m+[m[32m  const [formState, setFormState] = useState<Partial<Barbershop>>({});[m[41m[m
[32m+[m[32m  const [logoPreview, setLogoPreview] = useState<string | null>(null);[m[41m[m
[32m+[m[32m  const [cpfCnpjError, setCpfCnpjError] = useState<string | null>(null);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const [schedule, setSchedule] = useState<OperatingHoursState>(initialScheduleState);[m[41m[m
[32m+[m[32m  useEffect(() => {[m[41m[m
[32m+[m[32m    setSchedule(mapOperatingHoursToState(barbershopData));[m[41m[m
[32m+[m[32m  }, [barbershopData]);[m[41m[m
[32m+[m[41m  [m
[32m+[m[32m  const [userEmail, setUserEmail] = useState("");[m[41m[m
[32m+[m[32m  const [currentPassword, setCurrentPassword] = useState("");[m[41m[m
[32m+[m[32m  const [newPassword, setNewPassword] = useState("");[m[41m[m
[32m+[m[32m  const [confirmNewPassword, setConfirmNewPassword] = useState("");[m[41m[m
[32m+[m[32m  const [showCurrentPassword, setShowCurrentPassword] = useState(false);[m[41m[m
[32m+[m[32m  const [showNewPassword, setShowNewPassword] = useState(false);[m[41m[m
[32m+[m[32m  const [showConfirmPassword, setShowConfirmPassword] = useState(false);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const parseErrorMessage = (err: any) => {[m[41m[m
[32m+[m[32m    const raw = err?.message || err?.toString?.() || "";[m[41m[m
[32m+[m[32m    try {[m[41m[m
[32m+[m[32m      const parsed = JSON.parse(raw);[m[41m[m
[32m+[m[32m      if (parsed?.error) return String(parsed.error);[m[41m[m
[32m+[m[32m    } catch {[m[41m[m
[32m+[m[32m      /* ignore */[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    return raw || "Não foi possível atualizar a barbearia.";[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const fetchBarbershop = useCallback(async () => {[m[41m[m
[32m+[m[32m    if (!barbershopId) {[m[41m[m
[32m+[m[32m      setBarbershopData(null);[m[41m[m
[32m+[m[32m      setIsLoadingBarbershop(false);[m[41m[m
[32m+[m[32m      return null;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    setIsLoadingBarbershop(true);[m[41m[m
[32m+[m[32m    try {[m[41m[m
[32m+[m[32m      const response = await fetchJson<{ data: Barbershop }>(`/api/barbershops/${encodeURIComponent(barbershopId)}`);[m[41m[m
[32m+[m[32m      const shop = response.data ?? null;[m[41m[m
[32m+[m[32m      setBarbershopData(shop);[m[41m[m
[32m+[m[32m      return shop;[m[41m[m
[32m+[m[32m    } catch (error: any) {[m[41m[m
[32m+[m[32m      const message = error.message || "Erro ao carregar os dados da barbearia.";[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Erro ao carregar barbearia",[m[41m[m
[32m+[m[32m        description: message,[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      return null;[m[41m[m
[32m+[m[32m    } finally {[m[41m[m
[32m+[m[32m      setIsLoadingBarbershop(false);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  }, [barbershopId, toast]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  useEffect(() => {[m[41m[m
[32m+[m[32m    if (!barbershopId) {[m[41m[m
[32m+[m[32m      setBarbershopData(null);[m[41m[m
[32m+[m[32m      setIsLoadingBarbershop(false);[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    void fetchBarbershop();[m[41m[m
[32m+[m[32m  }, [barbershopId, fetchBarbershop]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  useEffect(() => {[m[41m[m
[32m+[m[32m    if (!isEditingSecurity && user?.email) {[m[41m[m
[32m+[m[32m      setUserEmail(user.email);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  }, [user, isEditingSecurity]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  // Function to initialize editing state[m[41m[m
[32m+[m[32m  const startEditing = (section: 'info' | 'address' | 'security') => {[m[41m[m
[32m+[m[32m    if (!barbershopData) return;[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    setFormState({[m[41m[m
[32m+[m[32m      ...barbershopData,[m[41m[m
[32m+[m[32m      cpfCnpj: barbershopData.cpfCnpj ? formatCpfCnpjValue(barbershopData.cpfCnpj) : barbershopData.cpfCnpj,[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    setLogoPreview(barbershopData.logoUrl || null);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const initialSchedule = weekDays.reduce((acc, day) => {[m[41m[m
[32m+[m[32m        const daySchedule = barbershopData.operatingHours?.find([m[41m[m
[32m+[m[32m          (h: { day: string }) => normalizeDay(h.day) === normalizeDay(day)[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m        const open = daySchedule?.open && daySchedule.open !== "closed"[m[41m[m
[32m+[m[32m          ? daySchedule.open[m[41m[m
[32m+[m[32m          : DEFAULT_OPEN_TIME;[m[41m[m
[32m+[m[32m        const close = daySchedule?.close && daySchedule.close !== "closed"[m[41m[m
[32m+[m[32m          ? daySchedule.close[m[41m[m
[32m+[m[32m          : DEFAULT_CLOSE_TIME;[m[41m[m
[32m+[m[32m        acc[day] = {[m[41m[m
[32m+[m[32m          active: !!daySchedule && daySchedule.open !== "closed",[m[41m[m
[32m+[m[32m          open,[m[41m[m
[32m+[m[32m          close,[m[41m[m
[32m+[m[32m        };[m[41m[m
[32m+[m[32m        return acc;[m[41m[m
[32m+[m[32m    }, {} as OperatingHoursState);[m[41m[m
[32m+[m[32m    setSchedule(initialSchedule);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    if (user?.email) setUserEmail(user.email);[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    if (section === 'info') {[m[41m[m
[32m+[m[32m      const { valid, type } = validateCpfCnpj(barbershopData.cpfCnpj || "");[m[41m[m
[32m+[m[32m      setCpfCnpjError(valid || !barbershopData.cpfCnpj ? null : type ? `${type} inválido` : "CPF/CNPJ inválido");[m[41m[m
[32m+[m[32m      setIsEditingInfo(true);[m[41m[m
[32m+[m[32m    } else if (section === 'address') {[m[41m[m
[32m+[m[32m      setIsEditingAddress(true);[m[41m[m
[32m+[m[32m    } else if (section === 'security') {[m[41m[m
[32m+[m[32m      setIsEditingSecurity(true);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const formCep = formState.address?.cep || '';[m[41m[m
[32m+[m[41m  [m
[32m+[m[32m  const handleFormChange = useCallback((fieldName: keyof Barbershop, value: any) => {[m[41m[m
[32m+[m[32m    setFormState(prev => ({ ...prev, [fieldName]: value }));[m[41m[m
[32m+[m[32m  }, []);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  useEffect(() => {[m[41m[m
[32m+[m[32m    const fetchAddress = async () => {[m[41m[m
[32m+[m[32m      if (!isEditingAddress) return;[m[41m[m
[32m+[m[32m      const cleanedCep = formCep.replace(/\D/g, "");[m[41m[m
[32m+[m[32m      if (cleanedCep.length === 8) {[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m          const response = await fetch(`/api/cep/${cleanedCep}`);[m[41m[m
[32m+[m[32m          const data = await response.json();[m[41m[m
[32m+[m[32m          if (!data.error) {[m[41m[m
[32m+[m[32m            handleFormChange("address", {[m[41m[m
[32m+[m[32m                ...formState.address,[m[41m[m
[32m+[m[32m                street: data.street,[m[41m[m
[32m+[m[32m                neighborhood: data.neighborhood,[m[41m[m
[32m+[m[32m                city: data.city,[m[41m[m
[32m+[m[32m                state: data.state,[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[32m          } else {[m[41m[m
[32m+[m[32m             toast({ variant: "destructive", title: "Erro de CEP", description: data.error });[m[41m[m
[32m+[m[32m          }[m[41m[m
[32m+[m[32m        } catch (error) {[m[41m[m
[32m+[m[32m          console.error("Failed to fetch address:", error);[m[41m[m
[32m+[m[32m          toast({ variant: "destructive", title: "Erro de Rede", description: "Não foi possível buscar o endereço." });[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[32m    fetchAddress();[m[41m[m
[32m+[m[32m  }, [formCep, isEditingAddress, handleFormChange, formState.address, toast]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const formCpfCnpj = formState.cpfCnpj || '';[m[41m[m
[32m+[m[32m  const fetchCompanyData = useCallback([m[41m[m
[32m+[m[32m    async (cleanedCnpj: string) => {[m[41m[m
[32m+[m[32m      if (!isEditingInfo || cleanedCnpj.length !== 14) return;[m[41m[m
[32m+[m[32m      try {[m[41m[m
[32m+[m[32m        const response = await fetch(`/api/cnpj/${cleanedCnpj}`);[m[41m[m
[32m+[m[32m        const data = await response.json();[m[41m[m
[32m+[m[32m        if (!data.error) {[m[41m[m
[32m+[m[32m          setFormState(prev => ({[m[41m[m
[32m+[m[32m            ...prev,[m[41m[m
[32m+[m[32m            legalName: data.razao_social || prev.legalName,[m[41m[m
[32m+[m[32m            name: data.nome_fantasia || prev.name,[m[41m[m
[32m+[m[32m          }));[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m      } catch (error) {[m[41m[m
[32m+[m[32m        console.error("Failed to fetch CNPJ data:", error);[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m    },[m[41m[m
[32m+[m[32m    [isEditingInfo][m[41m[m
[32m+[m[32m  );[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  useEffect(() => {[m[41m[m
[32m+[m[32m    const cleanedCnpj = formCpfCnpj.replace(/\D/g, "");[m[41m[m
[32m+[m[32m    if (cleanedCnpj.length === 14) {[m[41m[m
[32m+[m[32m      void fetchCompanyData(cleanedCnpj);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  }, [formCpfCnpj, fetchCompanyData]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleLogoChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m[41m[m
[32m+[m[32m    if (!isEditingInfo) return;[m[41m[m
[32m+[m[32m    if (e.target.files && e.target.files[0]) {[m[41m[m
[32m+[m[32m      const file = e.target.files[0];[m[41m[m
[32m+[m[32m      const reader = new FileReader();[m[41m[m
[32m+[m[32m      reader.onloadend = () => {[m[41m[m
[32m+[m[32m        const dataUrl = reader.result as string;[m[41m[m
[32m+[m[32m        setRawLogoImage(dataUrl);[m[41m[m
[32m+[m[32m        setCropZoom(1);[m[41m[m
[32m+[m[32m        setIsCropDialogOpen(true);[m[41m[m
[32m+[m[32m      };[m[41m[m
[32m+[m[32m      reader.readAsDataURL(file);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  useEffect(() => {[m[41m[m
[32m+[m[32m    if (!rawLogoImage) {[m[41m[m
[32m+[m[32m      setRawLogoDims(null);[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    const img = new Image();[m[41m[m
[32m+[m[32m    img.onload = () => {[m[41m[m
[32m+[m[32m      setRawLogoDims({ w: img.width, h: img.height });[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[32m    img.src = rawLogoImage;[m[41m[m
[32m+[m[32m  }, [rawLogoImage]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const resetCropState = () => {[m[41m[m
[32m+[m[32m    setIsCropDialogOpen(false);[m[41m[m
[32m+[m[32m    setRawLogoImage(null);[m[41m[m
[32m+[m[32m    setCropZoom(1);[m[41m[m
[32m+[m[32m    setRawLogoDims(null);[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleApplyLogoCrop = async () => {[m[41m[m
[32m+[m[32m    if (!rawLogoImage || !rawLogoDims) {[m[41m[m
[32m+[m[32m      resetCropState();[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    const img = new Image();[m[41m[m
[32m+[m[32m    img.src = rawLogoImage;[m[41m[m
[32m+[m[32m    await new Promise((resolve) => {[m[41m[m
[32m+[m[32m      img.onload = resolve;[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    const canvasSize = 400;[m[41m[m
[32m+[m[32m    const canvas = document.createElement("canvas");[m[41m[m
[32m+[m[32m    canvas.width = canvasSize;[m[41m[m
[32m+[m[32m    canvas.height = canvasSize;[m[41m[m
[32m+[m[32m    const ctx = canvas.getContext("2d");[m[41m[m
[32m+[m[32m    if (!ctx) {[m[41m[m
[32m+[m[32m      resetCropState();[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    const { w, h } = rawLogoDims;[m[41m[m
[32m+[m[32m    const cropSize = Math.min(w, h) / cropZoom;[m[41m[m
[32m+[m[32m    const sx = (w - cropSize) / 2;[m[41m[m
[32m+[m[32m    const sy = (h - cropSize) / 2;[m[41m[m
[32m+[m[32m    ctx.drawImage(img, sx, sy, cropSize, cropSize, 0, 0, canvasSize, canvasSize);[m[41m[m
[32m+[m[32m    const dataUrl = canvas.toDataURL("image/png");[m[41m[m
[32m+[m[32m    setLogoPreview(dataUrl);[m[41m[m
[32m+[m[32m    handleFormChange("logoUrl", dataUrl);[m[41m[m
[32m+[m[32m    resetCropState();[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const persistOperatingHours = useCallback([m[41m[m
[32m+[m[32m    async (nextSchedule: OperatingHoursState) => {[m[41m[m
[32m+[m[32m      if (!barbershopId) {[m[41m[m
[32m+[m[32m        toast({[m[41m[m
[32m+[m[32m          variant: "destructive",[m[41m[m
[32m+[m[32m          title: "Erro",[m[41m[m
[32m+[m[32m          description: "Usuario nao autenticado.",[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m        return;[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      const isValidTime = (value?: string) => !!value && /^\d{2}:\d{2}$/.test(value);[m[41m[m
[32m+[m[32m      const invalidDay = weekDays.find((day) => {[m[41m[m
[32m+[m[32m        const daySchedule = nextSchedule[day];[m[41m[m
[32m+[m[32m        return daySchedule?.active && (!isValidTime(daySchedule.open) || !isValidTime(daySchedule.close));[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      if (invalidDay) {[m[41m[m
[32m+[m[32m        toast({[m[41m[m
[32m+[m[32m          variant: "destructive",[m[41m[m
[32m+[m[32m          title: "Coloque o horario de funcionamento para salvar",[m[41m[m
[32m+[m[32m          description: `Preencha abertura e fechamento em ${invalidDay}.`,[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m        return;[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      const nextOperatingHours = weekDays.map((day) => {[m[41m[m
[32m+[m[32m        const daySchedule = nextSchedule[day];[m[41m[m
[32m+[m[32m        return {[m[41m[m
[32m+[m[32m          day,[m[41m[m
[32m+[m[32m          open: daySchedule?.active ? daySchedule.open : "closed",[m[41m[m
[32m+[m[32m          close: daySchedule?.active ? daySchedule.close : "closed",[m[41m[m
[32m+[m[32m        };[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      try {[m[41m[m
[32m+[m[32m        await fetchJson(`/api/barbershops/${barbershopId}`, {[m[41m[m
[32m+[m[32m          method: "PATCH",[m[41m[m
[32m+[m[32m          headers: { "Content-Type": "application/json" },[m[41m[m
[32m+[m[32m          body: JSON.stringify({ operatingHours: nextOperatingHours }),[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m        const updatedShop = barbershopData[m[41m[m
[32m+[m[32m          ? { ...barbershopData, operatingHours: nextOperatingHours as any }[m[41m[m
[32m+[m[32m          : null;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        if (updatedShop) {[m[41m[m
[32m+[m[32m          setBarbershopData(updatedShop);[m[41m[m
[32m+[m[32m          try {[m[41m[m
[32m+[m[32m            window.dispatchEvent(new CustomEvent("barbershop-updated", { detail: updatedShop }));[m[41m[m
[32m+[m[32m            localStorage.setItem("barbershop-updated", JSON.stringify({ ...updatedShop, _ts: Date.now() }));[m[41m[m
[32m+[m[32m          } catch (error) {[m[41m[m
[32m+[m[32m            console.warn("Nao foi possivel propagar atualizacao da barbearia:", error);[m[41m[m
[32m+[m[32m          }[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m      } catch (error: any) {[m[41m[m
[32m+[m[32m        toast({[m[41m[m
[32m+[m[32m          variant: "destructive",[m[41m[m
[32m+[m[32m          title: "Erro ao salvar configuracoes",[m[41m[m
[32m+[m[32m          description: error.message || "Nao foi possivel atualizar a barbearia.",[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m    },[m[41m[m
[32m+[m[32m    [barbershopId, toast, barbershopData][m[41m[m
[32m+[m[32m  );[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleScheduleChange = useCallback([m[41m[m
[32m+[m[32m    (day: string, updates: Partial<OperatingHoursState[string]>) => {[m[41m[m
[32m+[m[32m      setSchedule((prev) => {[m[41m[m
[32m+[m[32m        const currentDay = prev[day] || { active: false, open: DEFAULT_OPEN_TIME, close: DEFAULT_CLOSE_TIME };[m[41m[m
[32m+[m[32m        const nextState = { ...prev, [day]: { ...currentDay, ...updates } };[m[41m[m
[32m+[m[32m        void persistOperatingHours(nextState);[m[41m[m
[32m+[m[32m        return nextState;[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m    },[m[41m[m
[32m+[m[32m    [persistOperatingHours][m[41m[m
[32m+[m[32m  );[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleSaveChanges = async (section: 'info' | 'address') => {[m[41m[m
[32m+[m[32m    if (!barbershopId) {[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Erro",[m[41m[m
[32m+[m[32m        description: "Usuario nao autenticado.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    let payload: Partial<Barbershop> = {};[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    if (section === 'info') {[m[41m[m
[32m+[m[32m      const { valid, type } = validateCpfCnpj(formState.cpfCnpj || "");[m[41m[m
[32m+[m[32m      if (!valid) {[m[41m[m
[32m+[m[32m        const message = type ? `${type} inválido` : "CPF/CNPJ inválido";[m[41m[m
[32m+[m[32m        setCpfCnpjError(message);[m[41m[m
[32m+[m[32m        toast({[m[41m[m
[32m+[m[32m          variant: "destructive",[m[41m[m
[32m+[m[32m          title: "Documento inválido",[m[41m[m
[32m+[m[32m          description: "Informe um CPF ou CNPJ válido para salvar.",[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m        return;[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      payload = {[m[41m[m
[32m+[m[32m        name: formState.name,[m[41m[m
[32m+[m[32m        legalName: formState.legalName,[m[41m[m
[32m+[m[32m        phone: formState.phone,[m[41m[m
[32m+[m[32m        cpfCnpj: formState.cpfCnpj,[m[41m[m
[32m+[m[32m      };[m[41m[m
[32m+[m[32m      const logoToSave = logoPreview ?? barbershopData?.logoUrl;[m[41m[m
[32m+[m[32m      if (logoToSave) {[m[41m[m
[32m+[m[32m        payload.logoUrl = logoToSave;[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m    } else if (section === 'address') {[m[41m[m
[32m+[m[32m      const address = formState.address || {};[m[41m[m
[32m+[m[32m      const cleanedCep = (address.cep || "").replace(/\D/g, "");[m[41m[m
[32m+[m[32m      const street = address.street?.toString().trim() || "";[m[41m[m
[32m+[m[32m      const number = address.number?.toString().trim() || "";[m[41m[m
[32m+[m[32m      const neighborhood = address.neighborhood?.toString().trim() || "";[m[41m[m
[32m+[m[32m      const city = address.city?.toString().trim() || "";[m[41m[m
[32m+[m[32m      const state = address.state?.toString().trim() || "";[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      if ([m[41m[m
[32m+[m[32m        !cleanedCep ||[m[41m[m
[32m+[m[32m        cleanedCep.length !== 8 ||[m[41m[m
[32m+[m[32m        !street ||[m[41m[m
[32m+[m[32m        !number ||[m[41m[m
[32m+[m[32m        !neighborhood ||[m[41m[m
[32m+[m[32m        !city ||[m[41m[m
[32m+[m[32m        !state[m[41m[m
[32m+[m[32m      ) {[m[41m[m
[32m+[m[32m        toast({[m[41m[m
[32m+[m[32m          variant: "destructive",[m[41m[m
[32m+[m[32m          title: "Erro",[m[41m[m
[32m+[m[32m          description: "Preencha CEP, rua, número, bairro, cidade e estado.",[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m        return;[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      payload = {[m[41m[m
[32m+[m[32m        address: {[m[41m[m
[32m+[m[32m          ...address,[m[41m[m
[32m+[m[32m          cep: cleanedCep.replace(/^(\d{5})(\d{3})$/, "$1-$2"),[m[41m[m
[32m+[m[32m          street,[m[41m[m
[32m+[m[32m          number,[m[41m[m
[32m+[m[32m          neighborhood,[m[41m[m
[32m+[m[32m          city,[m[41m[m
[32m+[m[32m          state,[m[41m[m
[32m+[m[32m        },[m[41m[m
[32m+[m[32m      };[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    try {[m[41m[m
[32m+[m[32m      await fetchJson(`/api/barbershops/${barbershopId}`, {[m[41m[m
[32m+[m[32m        method: "PATCH",[m[41m[m
[32m+[m[32m        headers: { "Content-Type": "application/json" },[m[41m[m
[32m+[m[32m        body: JSON.stringify(payload),[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        title: "Configuracoes salvas!",[m[41m[m
[32m+[m[32m        description: "As informacoes da sua barbearia foram atualizadas.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      const updatedShop = await fetchBarbershop();[m[41m[m
[32m+[m[32m      if (updatedShop) {[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m          window.dispatchEvent(new CustomEvent("barbershop-updated", { detail: updatedShop }));[m[41m[m
[32m+[m[32m          localStorage.setItem("barbershop-updated", JSON.stringify({ ...updatedShop, _ts: Date.now() }));[m[41m[m
[32m+[m[32m        } catch (error) {[m[41m[m
[32m+[m[32m          console.warn("Nao foi possivel propagar atualizacao da barbearia:", error);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m      setFormState({});[m[41m[m
[32m+[m[32m      if (section === 'info') {[m[41m[m
[32m+[m[32m        setIsEditingInfo(false);[m[41m[m
[32m+[m[32m        setLogoPreview(null);[m[41m[m
[32m+[m[32m        setCpfCnpjError(null);[m[41m[m
[32m+[m[32m      } else if (section === 'address') {[m[41m[m
[32m+[m[32m        setIsEditingAddress(false);[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[32m    } catch (error: any) {[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Erro ao salvar configuracoes",[m[41m[m
[32m+[m[32m        description: parseErrorMessage(error),[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleSecurityChanges = async () => {[m[41m[m
[32m+[m[32m    if (!user || !barbershopId) {[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Erro",[m[41m[m
[32m+[m[32m        description: "Você não está logado.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const passwordChanged = newPassword !== "";[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    if (!passwordChanged) {[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        title: "Nenhuma alteração",[m[41m[m
[32m+[m[32m        description: "Nenhuma alteração de senha foi detectada.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      setIsEditingSecurity(false);[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    if (passwordChanged && newPassword !== confirmNewPassword) {[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Senhas não coincidem",[m[41m[m
[32m+[m[32m        description: "A nova senha e a confirmação não são iguais.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    if (!currentPassword) {[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Senha necessária",[m[41m[m
[32m+[m[32m        description: "Você deve fornecer sua senha atual para fazer alterações.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      return;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    setIsSecurityUpdating(true);[m[41m[m
[32m+[m[32m    try {[m[41m[m
[32m+[m[32m      const body: { currentPassword: string; newPassword?: string } = {[m[41m[m
[32m+[m[32m        currentPassword,[m[41m[m
[32m+[m[32m      };[m[41m[m
[32m+[m[32m      if (passwordChanged) {[m[41m[m
[32m+[m[32m        body.newPassword = newPassword;[m[41m[m
[32m+[m[32m      }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      const response = await fetchJson<{[m[41m[m
[32m+[m[32m        data: { user: AuthUser; accessToken: string };[m[41m[m
[32m+[m[32m      }>("/api/auth/update-profile", {[m[41m[m
[32m+[m[32m        method: "PATCH",[m[41m[m
[32m+[m[32m        headers: {[m[41m[m
[32m+[m[32m          "Content-Type": "application/json",[m[41m[m
[32m+[m[32m        },[m[41m[m
[32m+[m[32m        body: JSON.stringify(body),[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      setAccessToken(response.data.accessToken);[m[41m[m
[32m+[m[32m      await refreshUser();[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        title: "Segurança atualizada!",[m[41m[m
[32m+[m[32m        description: "Suas credenciais foram sincronizadas.",[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m      setIsEditingSecurity(false);[m[41m[m
[32m+[m[32m      setCurrentPassword("");[m[41m[m
[32m+[m[32m      setNewPassword("");[m[41m[m
[32m+[m[32m      setConfirmNewPassword("");[m[41m[m
[32m+[m[32m    } catch (error: any) {[m[41m[m
[32m+[m[32m      const description =[m[41m[m
[32m+[m[32m        error.message || "Não foi possível atualizar seus dados de segurança.";[m[41m[m
[32m+[m[32m      toast({[m[41m[m
[32m+[m[32m        variant: "destructive",[m[41m[m
[32m+[m[32m        title: "Falha na atualização de segurança",[m[41m[m
[32m+[m[32m        description,[m[41m[m
[32m+[m[32m      });[m[41m[m
[32m+[m[32m    } finally {[m[41m[m
[32m+[m[32m      setIsSecurityUpdating(false);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleCancelEdit = (section: 'info' | 'address' | 'security') => {[m[41m[m
[32m+[m[32m    if (section === 'info') {[m[41m[m
[32m+[m[32m      setIsEditingInfo(false);[m[41m[m
[32m+[m[32m      setCpfCnpjError(null);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    else if (section === 'address') setIsEditingAddress(false);[m[41m[m
[32m+[m[32m    else if (section === 'security') {[m[41m[m
[32m+[m[32m        setIsEditingSecurity(false);[m[41m[m
[32m+[m[32m        if (user?.email) setUserEmail(user.email);[m[41m[m
[32m+[m[32m        setCurrentPassword("");[m[41m[m
[32m+[m[32m        setNewPassword("");[m[41m[m
[32m+[m[32m        setConfirmNewPassword("");[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    setFormState({}); // Clear editing state[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m[41m[m
[32m+[m[32m    const { name, value } = e.target;[m[41m[m
[32m+[m[32m    let finalValue = value;[m[41m[m
[32m+[m[32m    if (name === 'phone') {[m[41m[m
[32m+[m[32m        let phoneValue = value.replace(/\D/g, '');[m[41m[m
[32m+[m[32m        phoneValue = phoneValue.replace(/^(\d{2})(\d)/g, '($1) $2');[m[41m[m
[32m+[m[32m        phoneValue = phoneValue.replace(/(\d{5})(\d)/, '$1-$2');[m[41m[m
[32m+[m[32m        if (phoneValue.length > 15) phoneValue = phoneValue.substring(0, 15);[m[41m[m
[32m+[m[32m        finalValue = phoneValue;[m[41m[m
[32m+[m[32m    } else if (name === 'cpfCnpj') {[m[41m[m
[32m+[m[32m        const raw = value.replace(/\D/g, '');[m[41m[m
[32m+[m[32m        let formatted = raw;[m[41m[m
[32m+[m[32m        if (formatted.length <= 11) {[m[41m[m
[32m+[m[32m            formatted = formatted.replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d{1,2})$/, '$1-$2');[m[41m[m
[32m+[m[32m        } else {[m[41m[m
[32m+[m[32m            formatted = formatted.substring(0, 14).replace(/^(\d{2})(\d)/, '$1.$2').replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3').replace(/\.(\d{3})(\d)/, '.$1/$2').replace(/(\d{4})(\d)/, '$1-$2');[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        const { valid, type } = validateCpfCnpj(raw);[m[41m[m
[32m+[m[32m        if (!raw) {[m[41m[m
[32m+[m[32m          setCpfCnpjError(null);[m[41m[m
[32m+[m[32m        } else if (raw.length !== 11 && raw.length !== 14) {[m[41m[m
[32m+[m[32m          setCpfCnpjError("CPF/CNPJ incompleto");[m[41m[m
[32m+[m[32m        } else if (!valid) {[m[41m[m
[32m+[m[32m          setCpfCnpjError(type ? `${type} inválido` : "CPF/CNPJ inválido");[m[41m[m
[32m+[m[32m        } else {[m[41m[m
[32m+[m[32m          setCpfCnpjError(null);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        if (isEditingInfo && raw.length === 14) {[m[41m[m
[32m+[m[32m          void fetchCompanyData(raw);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        finalValue = formatted;[m[41m[m
[32m+[m[32m    } else if (name === 'cep') {[m[41m[m
[32m+[m[32m        let cepValue = value.replace(/\D/g, "").replace(/^(\d{5})(\d)/, "$1-$2");[m[41m[m
[32m+[m[32m        if (cepValue.length > 9) cepValue = cepValue.substring(0, 9);[m[41m[m
[32m+[m[32m        finalValue = cepValue;[m[41m[m
[32m+[m[32m    } else if (name === "address.number") {[m[41m[m
[32m+[m[32m        const digits = value.replace(/\D/g, "").slice(0, 7);[m[41m[m
[32m+[m[32m        finalValue = digits;[m[41m[m
[32m+[m[32m    } else if (name === 'name' || name === 'legalName') {[m[41m[m
[32m+[m[32m        finalValue = capitalizeWords(value);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m     if (name.includes('.')) {[m[41m[m
[32m+[m[32m        const [parent, child] = name.split('.');[m[41m[m
[32m+[m[32m        handleFormChange(parent as keyof Barbershop, { ...formState[parent as keyof Barbershop], [child]: finalValue });[m[41m[m
[32m+[m[32m    } else {[m[41m[m
[32m+[m[32m        handleFormChange(name as keyof Barbershop, finalValue);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[41m  [m
[32m+[m[32m  if (isBarbershopIdLoading || isLoadingBarbershop) {[m[41m[m
[32m+[m[32m      return <div className="p-6">Carregando configurações...</div>;[m[41m[m
[32m+[m[32m  }[m[41m[m
[32m+[m[41m  [m
[32m+[m[32m  const infoData = isEditingInfo ? formState : barbershopData;[m[41m[m
[32m+[m[32m  const addressData = isEditingAddress ? formState.address : barbershopData?.address;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  const displayHours = weekDays.map((day) => ({[m[41m[m
[32m+[m[32m    day,[m[41m[m
[32m+[m[32m    ...schedule[day],[m[41m[m
[32m+[m[32m  }));[m[41m[m
[32m+[m[41m[m
[32m+[m[41m[m
[32m+[m[32m  return ([m[41m[m
[32m+[m[32m    <>[m[41m[m
[32m+[m[32m      <Dialog open={isCropDialogOpen} onOpenChange={(open) => { if (!open) resetCropState(); }}>[m[41m[m
[32m+[m[32m        <DialogContent className="sm:max-w-md">[m[41m[m
[32m+[m[32m          <DialogHeader>[m[41m[m
[32m+[m[32m            <DialogTitle>Recortar Logo</DialogTitle>[m[41m[m
[32m+[m[32m            <DialogDescription>Use o zoom para ajustar o recorte quadrado da logo.</DialogDescription>[m[41m[m
[32m+[m[32m          </DialogHeader>[m[41m[m
[32m+[m[32m          <div className="space-y-4">[m[41m[m
             <div className="relative w-full aspect-square bg-slate-900 rounded-lg overflow-hidden border border-slate-700">[m
               {rawLogoImage ? ([m
[31m-                <img[m
[32m+[m[32m                <NextImage[m
                   src={rawLogoImage}[m
[31m-                  alt="Prévia da logo"[m
[31m-                  className="absolute inset-0 w-full h-full object-contain"[m
[32m+[m[32m                  alt="Previa da logo"[m
[32m+[m[32m                  fill[m
[32m+[m[32m                  sizes="(max-width: 768px) 100vw, 400px"[m
[32m+[m[32m                  className="object-contain"[m
                   style={{ transform: `scale(${cropZoom})`, transformOrigin: "center" }}[m
[32m+[m[32m                  unoptimized[m
                 />[m
               ) : ([m
                 <div className="flex items-center justify-center h-full text-sm text-muted-foreground">Selecione uma imagem</div>[m
               )}[m
             </div>[m
[31m-            <div className="space-y-1">[m
[31m-              <Label htmlFor="crop-zoom">Zoom</Label>[m
[31m-              <Input[m
[31m-                id="crop-zoom"[m
[31m-                type="range"[m
[31m-                min={1}[m
[31m-                max={3}[m
[31m-                step={0.1}[m
[31m-                value={cropZoom}[m
[31m-                onChange={(e) => setCropZoom(parseFloat(e.target.value))}[m
[31m-              />[m
[31m-            </div>[m
[31m-          </div>[m
[31m-          <DialogFooter>[m
[31m-            <DialogClose asChild>[m
[31m-              <Button variant="outline" onClick={resetCropState}>Cancelar</Button>[m
[31m-            </DialogClose>[m
[31m-            <Button onClick={handleApplyLogoCrop} disabled={!rawLogoImage}>Aplicar recorte</Button>[m
[31m-          </DialogFooter>[m
[31m-        </DialogContent>[m
[31m-      </Dialog>[m
[31m-[m
[31m-      <div className="space-y-6">[m
[31m-      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">[m
[31m-        <div className="flex flex-col gap-6">[m
[31m-          <Card>[m
[31m-            <CardHeader>[m
[31m-              <CardTitle className="flex items-center gap-2"><Building className="h-5 w-5"/>Informações da Barbearia</CardTitle>[m
[31m-              <CardDescription>[m
[31m-                Edite os dados principais da sua barbearia.[m
[31m-              </CardDescription>[m
[31m-            </CardHeader>[m
[31m-            <CardContent className="space-y-4">[m
[31m-              <div className="flex flex-col items-center gap-4 sm:flex-row sm:items-start">[m
[31m-                <div className="flex-shrink-0">[m
[31m-                    <Label>Logo da Barbearia</Label>[m
[31m-                    <div className="relative group mt-2">[m
[31m-                        <Avatar className="h-32 w-32 border-2 border-solid border-blue-500 p-1">[m
[31m-                        <AvatarImage src={logoPreview || barbershopData?.logoUrl} />[m
[31m-                        <AvatarFallback>[m
[31m-                            <Building className="h-12 w-12 text-muted-foreground" />[m
[31m-                        </AvatarFallback>[m
[31m-                        </Avatar>[m
[31m-                        {isEditingInfo && ([m
[31m-                        <label htmlFor="logo-upload" className="absolute inset-0 flex items-center justify-center bg-black/50 text-white rounded-full cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity">[m
[31m-                            <Upload className="h-6 w-6" />[m
[31m-                        </label>[m
[31m-                        )}[m
[31m-                        <Input id="logo-upload" type="file" onChange={handleLogoChange} className="sr-only" accept="image/*" disabled={!isEditingInfo} />[m
[31m-                    </div>[m
[31m-                </div>[m
[31m-                <div className="space-y-4 w-full">[m
[31m-                  <div className="space-y-2">[m
[31m-                    <Label htmlFor="shop-name">Nome da Barbearia (Nome Fantasia)</Label>[m
[31m-                    <Input id="shop-name" name="name" value={infoData?.name || ''} onChange={handleInputChange} disabled={!isEditingInfo} />[m
[31m-                  </div>[m
[31m-                  <div className="space-y-2">[m
[31m-                    <Label htmlFor="legal-name">Nome/Empresa (Razão Social ou Proprietário)</Label>[m
[31m-                    <Input id="legal-name" name="legalName" value={infoData?.legalName || ''} onChange={handleInputChange} disabled={!isEditingInfo} />[m
[31m-                  </div>[m
[31m-                  <div className="space-y-2">[m
[31m-                    <Label htmlFor="shop-phone">WhatsApp Principal</Label>[m
[31m-                    <Input id="shop-phone" name="phone" value={infoData?.phone || ''} onChange={handleInputChange} maxLength={16} disabled={!isEditingInfo} />[m
[31m-                  </div>[m
[31m-                  <div className="space-y-2">[m
[31m-                      <Label htmlFor="shop-cpf-cnpj">CPF/CNPJ</Label>[m
[31m-                      <Input[m
[31m-                        id="shop-cpf-cnpj"[m
[31m-                        name="cpfCnpj"[m
[31m-                        value={infoData?.cpfCnpj ? formatCpfCnpjValue(infoData.cpfCnpj) : ''}[m
[31m-                        onChange={handleInputChange}[m
[31m-                        disabled={!isEditingInfo}[m
[31m-                        placeholder="Seu CPF ou CNPJ"[m
[31m-                      />[m
[31m-                      {cpfCnpjError && <p className="text-sm text-destructive">{cpfCnpjError}</p>}[m
[31m-                  </div>[m
[31m-                </div>[m
[31m-              </div>[m
[31m-            </CardContent>[m
[31m-            <CardFooter className="border-t px-6 py-4">[m
[31m-              {isEditingInfo ? ([m
[31m-                <div className="flex gap-2">[m
[31m-                  <Button onClick={() => handleSaveChanges('info')} className="hover:bg-[#044a7b]"><Save className="mr-2 h-4 w-4"/>Salvar</Button>[m
[31m-                  <Button variant="ghost" onClick={() => handleCancelEdit('info')}>Cancelar</Button>[m
[31m-                </div>[m
[31m-              ) : ([m
[31m-                <Button onClick={() => startEditing('info')} className="hover:bg-[#044a7b]"><Edit className="mr-2 h-4 w-4"/>Editar Informações</Button>[m
[31m-              )}[m
[31m-            </CardFooter>[m
[31m-          </Card>[m
[31m-          <Card>[m
[31m-            <CardHeader>[m
[31m-                <CardTitle>Horario de Funcionamento</CardTitle>[m
[31m-                <CardDescription>[m
[31m-                Defina os dias e horarios que sua barbearia estara aberta.[m
[31m-                </CardDescription>[m
[31m-            </CardHeader>[m
[31m-            <CardContent className="space-y-3">[m
[31m-                {displayHours.map((day) => ([m
[31m-                <div key={day.day} className="flex flex-col sm:flex-row items-start sm:items-center justify-between rounded-lg border p-3 gap-4 sm:gap-2">[m
[31m-                    <div className="flex items-center gap-4 flex-1">[m
[31m-                        <Switch[m
[31m-                            id={`switch-${day.day}`}[m
[31m-                            checked={day.active}[m
[31m-                            onCheckedChange={(checked) => handleScheduleChange(day.day, { active: checked })}[m
[31m-                            aria-label={`Ativar ${day.day}`}[m
[31m-                        />[m
[31m-                        <Label htmlFor={`switch-${day.day}`} className="w-24 font-medium">[m
[31m-                            {day.day}[m
[31m-                        </Label>[m
[31m-                    </div>[m
[31m-                    {day.active ? ([m
[31m-                        <div className="flex items-center gap-2 w-full sm:w-auto">[m
[31m-                        <Input[m
[31m-                            type="time"[m
[31m-                            className="w-full sm:w-28"[m
[31m-                            value={day.open}[m
[31m-                            onChange={(e) => handleScheduleChange(day.day, { open: e.target.value })}[m
[31m-                        />[m
[31m-                        <span className="text-sm text-muted-foreground">ate</span>[m
[31m-                        <Input[m
[31m-                            type="time"[m
[31m-                            className="w-full sm:w-28"[m
[31m-                            value={day.close}[m
[31m-                            onChange={(e) => handleScheduleChange(day.day, { close: e.target.value })}[m
[31m-                        />[m
[31m-                        </div>[m
[31m-                    ) : ([m
[31m-                        <Badge variant="destructive">FECHADO</Badge>[m
[31m-                    )}[m
[31m-                </div>[m
[31m-                ))}[m
[31m-            </CardContent>[m
[31m-            </Card>[m
[31m-        </div>[m
[31m-[m
[31m-        <div className="flex flex-col gap-6">[m
[31m-           <Card>[m
[31m-            <CardHeader>[m
[31m-                <CardTitle>Endereço</CardTitle>[m
[31m-                <CardDescription>[m
[31m-                Informe o endereço físico da sua barbearia.[m
[31m-                </CardDescription>[m
[31m-            </CardHeader>[m
[31m-            <CardContent className="space-y-4">[m
[31m-                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">[m
[31m-                <div className="space-y-2 sm:col-span-1">[m
[31m-                    <Label htmlFor="cep">CEP</Label>[m
[31m-                    <Input id="cep" name="address.cep" value={addressData?.cep || ''} onChange={handleInputChange} maxLength={9} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-                <div className="space-y-2 sm:col-span-2">[m
[31m-                    <Label htmlFor="street">Rua</Label>[m
[31m-                    <Input id="street" name="address.street" value={addressData?.street || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-                </div>[m
[31m-[m
[31m-                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">[m
[31m-                <div className="space-y-2 sm:col-span-1">[m
[31m-                    <Label htmlFor="number">Número</Label>[m
[31m-                    <Input id="number" name="address.number" value={addressData?.number || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-                <div className="space-y-2 sm:col-span-2">[m
[31m-                    <Label htmlFor="complement">Complemento (Opcional)</Label>[m
[31m-                    <Input id="complement" name="address.complement" value={addressData?.complement || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-                </div>[m
[31m-                <div className="space-y-2">[m
[31m-                    <Label htmlFor="neighborhood">Bairro</Label>[m
[31m-                    <Input id="neighborhood" name="address.neighborhood" value={addressData?.neighborhood || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-[m
[31m-                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">[m
[31m-                <div className="space-y-2">[m
[31m-                    <Label htmlFor="city">Cidade</Label>[m
[31m-                    <Input id="city" name="address.city" value={addressData?.city || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-                <div className="space-y-2">[m
[31m-                    <Label htmlFor="state">Estado</Label>[m
[31m-                    <Input id="state" name="address.state" value={addressData?.state || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m
[31m-                </div>[m
[31m-                </div>[m
[31m-            </CardContent>[m
[31m-             <CardFooter className="border-t px-6 py-4">[m
[31m-              {isEditingAddress ? ([m
[31m-                <div className="flex gap-2">[m
[31m-                  <Button onClick={() => handleSaveChanges('address')} className="hover:bg-[#044a7b]"><Save className="mr-2 h-4 w-4"/>Salvar Endereço</Button>[m
[31m-                  <Button variant="ghost" onClick={() => handleCancelEdit('address')}>Cancelar</Button>[m
[31m-                </div>[m
[31m-              ) : ([m
[31m-                <Button onClick={() => startEditing('address')} className="hover:bg-[#044a7b]"><Edit className="mr-2 h-4 w-4"/>Editar Endereço</Button>[m
[31m-              )}[m
[31m-            </CardFooter>[m
[31m-          </Card>[m
[31m-          [m
[31m-              <Card>[m
[31m-              <CardHeader>[m
[31m-                  <CardTitle className="flex items-center gap-2"><Lock className="h-5 w-5"/>Segurança e Acesso</CardTitle>[m
[31m-                  <CardDescription>[m
[31m-                  Atualize sua senha de login.[m
[31m-                  </CardDescription>[m
[31m-              </CardHeader>[m
[31m-              <CardContent className="space-y-4">[m
[31m-                  <div className="space-y-2">[m
[31m-                  <Label htmlFor="email">E-mail de Login</Label>[m
[31m-                  <Input id="email" type="email" value={userEmail} disabled readOnly />[m
[31m-                  </div>[m
[31m-                  {isEditingSecurity && ([m
[31m-                  <div className="space-y-2">[m
[31m-                      <Label htmlFor="current-password">Senha Atual</Label>[m
[31m-                      <div className="relative">[m
[31m-                        <Input[m
[31m-                          id="current-password"[m
[31m-                          type={showCurrentPassword ? 'text' : 'password'}[m
[31m-                          value={currentPassword}[m
[31m-                          onChange={(e) => setCurrentPassword(e.target.value)}[m
[31m-                          placeholder="••••••••"[m
[31m-                          disabled={!isEditingSecurity}[m
[31m-                          className="pr-12"[m
[31m-                        />[m
[31m-                        <Button[m
[31m-                          type="button"[m
[31m-                          variant="ghost"[m
[31m-                          size="icon"[m
[31m-                          className="absolute right-2 top-1/2 h-7 w-7 -translate-y-1/2"[m
[31m-                          onClick={() => setShowCurrentPassword(prev => !prev)}[m
[31m-                        >[m
[31m-                          {showCurrentPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m
[31m-                        </Button>[m
[31m-                      </div>[m
[31m-                      <p className="text-xs text-muted-foreground">Necessária para confirmar qualquer alteração de segurança.</p>[m
[31m-                  </div>[m
[31m-                  )}[m
[31m-                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">[m
[31m-                    <div className="space-y-2">[m
[31m-                        <Label htmlFor="new-password">Nova Senha</Label>[m
[31m-                        <div className="relative">[m
[31m-                          <Input[m
[31m-                            id="new-password"[m
[31m-                            type={showNewPassword ? 'text' : 'password'}[m
[31m-                            value={newPassword}[m
[31m-                            onChange={(e) => setNewPassword(e.target.value)}[m
[31m-                            placeholder="••••••••"[m
[31m-                            disabled={!isEditingSecurity}[m
[31m-                            className="pr-12"[m
[31m-                          />[m
[31m-                          <Button[m
[31m-                            type="button"[m
[31m-                            variant="ghost"[m
[31m-                            size="icon"[m
[31m-                            className="absolute right-2 top-1/2 h-7 w-7 -translate-y-1/2"[m
[31m-                            onClick={() => setShowNewPassword(prev => !prev)}[m
[31m-                          >[m
[31m-                            {showNewPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m
[31m-                          </Button>[m
[31m-                        </div>[m
[31m-                    </div>[m
[31m-                    <div className="space-y-2">[m
[31m-                        <Label htmlFor="confirm-new-password">Confirmar Nova Senha</Label>[m
[31m-                        <div className="relative">[m
[31m-                          <Input[m
[31m-                            id="confirm-new-password"[m
[31m-                            type={showConfirmPassword ? 'text' : 'password'}[m
[31m-                            value={confirmNewPassword}[m
[31m-                            onChange={(e) => setConfirmNewPassword(e.target.value)}[m
[31m-                            placeholder="••••••••"[m
[31m-                            disabled={!isEditingSecurity}[m
[31m-                            className="pr-12"[m
[31m-                          />[m
[31m-                          <Button[m
[31m-                            type="button"[m
[31m-                            variant="ghost"[m
[31m-                            size="icon"[m
[31m-                            className="absolute right-2 top-1/2 h-7 w-7 -translate-y-1/2"[m
[31m-                            onClick={() => setShowConfirmPassword(prev => !prev)}[m
[31m-                          >[m
[31m-                            {showConfirmPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m
[31m-                          </Button>[m
[31m-                        </div>[m
[31m-                    </div>[m
[31m-                  </div>[m
[31m-              </CardContent>[m
[31m-              <CardFooter className="border-t px-6 py-4">[m
[31m-                  {isEditingSecurity ? ([m
[31m-                  <div className="flex gap-2">[m
[31m-                      <Button onClick={handleSecurityChanges} disabled={isSecurityUpdating} className="hover:bg-[#044a7b]">[m
[31m-                        {isSecurityUpdating ? ([m
[31m-                          <Loader2 className="mr-2 h-4 w-4 animate-spin" />[m
[31m-                        ) : ([m
[31m-                          <Save className="mr-2 h-4 w-4" />[m
[31m-                        )}[m
[31m-                        {isSecurityUpdating ? "Atualizando..." : "Salvar Alterações"}[m
[31m-                      </Button>[m
[31m-                      <Button variant="ghost" onClick={() => handleCancelEdit('security')}>Cancelar</Button>[m
[31m-                  </div>[m
[31m-                  ) : ([m
[31m-                  <Button[m
[31m-                    onClick={() => startEditing('security')}[m
[31m-                    className="hover:bg-[#044a7b]"[m
[31m-                  >[m
[31m-                    <Edit className="mr-2 h-4 w-4" />[m
[31m-                    Alterar Segurança[m
[31m-                  </Button>[m
[31m-                  )}[m
[31m-              </CardFooter>[m
[31m-          </Card>[m
[31m-        </div>[m
[31m-      </div>[m
[31m-    </div>[m
[31m-    </>[m
[31m-  );[m
[31m-}[m
[32m+[m[32m            <div className="space-y-1">[m[41m[m
[32m+[m[32m              <Label htmlFor="crop-zoom">Zoom</Label>[m[41m[m
[32m+[m[32m              <Input[m[41m[m
[32m+[m[32m                id="crop-zoom"[m[41m[m
[32m+[m[32m                type="range"[m[41m[m
[32m+[m[32m                min={1}[m[41m[m
[32m+[m[32m                max={3}[m[41m[m
[32m+[m[32m                step={0.1}[m[41m[m
[32m+[m[32m                value={cropZoom}[m[41m[m
[32m+[m[32m                onChange={(e) => setCropZoom(parseFloat(e.target.value))}[m[41m[m
[32m+[m[32m              />[m[41m[m
[32m+[m[32m            </div>[m[41m[m
[32m+[m[32m          </div>[m[41m[m
[32m+[m[32m          <DialogFooter>[m[41m[m
[32m+[m[32m            <DialogClose asChild>[m[41m[m
[32m+[m[32m              <Button variant="outline" onClick={resetCropState}>Cancelar</Button>[m[41m[m
[32m+[m[32m            </DialogClose>[m[41m[m
[32m+[m[32m            <Button onClick={handleApplyLogoCrop} disabled={!rawLogoImage}>Aplicar recorte</Button>[m[41m[m
[32m+[m[32m          </DialogFooter>[m[41m[m
[32m+[m[32m        </DialogContent>[m[41m[m
[32m+[m[32m      </Dialog>[m[41m[m
[32m+[m[41m[m
[32m+[m[32m      <div className="space-y-6">[m[41m[m
[32m+[m[32m      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">[m[41m[m
[32m+[m[32m        <div className="flex flex-col gap-6">[m[41m[m
[32m+[m[32m          <Card>[m[41m[m
[32m+[m[32m            <CardHeader>[m[41m[m
[32m+[m[32m              <CardTitle className="flex items-center gap-2"><Building className="h-5 w-5"/>Informações da Barbearia</CardTitle>[m[41m[m
[32m+[m[32m              <CardDescription>[m[41m[m
[32m+[m[32m                Edite os dados principais da sua barbearia.[m[41m[m
[32m+[m[32m              </CardDescription>[m[41m[m
[32m+[m[32m            </CardHeader>[m[41m[m
[32m+[m[32m            <CardContent className="space-y-4">[m[41m[m
[32m+[m[32m              <div className="flex flex-col items-center gap-4 sm:flex-row sm:items-start">[m[41m[m
[32m+[m[32m                <div className="flex-shrink-0">[m[41m[m
[32m+[m[32m                    <Label>Logo da Barbearia</Label>[m[41m[m
[32m+[m[32m                    <div className="relative group mt-2">[m[41m[m
[32m+[m[32m                        <Avatar className="h-32 w-32 border-2 border-solid border-blue-500 p-1">[m[41m[m
[32m+[m[32m                        <AvatarImage src={logoPreview || barbershopData?.logoUrl} />[m[41m[m
[32m+[m[32m                        <AvatarFallback>[m[41m[m
[32m+[m[32m                            <Building className="h-12 w-12 text-muted-foreground" />[m[41m[m
[32m+[m[32m                        </AvatarFallback>[m[41m[m
[32m+[m[32m                        </Avatar>[m[41m[m
[32m+[m[32m                        {isEditingInfo && ([m[41m[m
[32m+[m[32m                        <label htmlFor="logo-upload" className="absolute inset-0 flex items-center justify-center bg-black/50 text-white rounded-full cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity">[m[41m[m
[32m+[m[32m                            <Upload className="h-6 w-6" />[m[41m[m
[32m+[m[32m                        </label>[m[41m[m
[32m+[m[32m                        )}[m[41m[m
[32m+[m[32m                        <Input id="logo-upload" type="file" onChange={handleLogoChange} className="sr-only" accept="image/*" disabled={!isEditingInfo} />[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                <div className="space-y-4 w-full">[m[41m[m
[32m+[m[32m                  <div className="space-y-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="shop-name">Nome da Barbearia (Nome Fantasia)</Label>[m[41m[m
[32m+[m[32m                    <Input id="shop-name" name="name" value={infoData?.name || ''} onChange={handleInputChange} disabled={!isEditingInfo} />[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                  <div className="space-y-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="legal-name">Nome/Empresa (Razão Social ou Proprietário)</Label>[m[41m[m
[32m+[m[32m                    <Input id="legal-name" name="legalName" value={infoData?.legalName || ''} onChange={handleInputChange} disabled={!isEditingInfo} />[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                  <div className="space-y-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="shop-phone">WhatsApp Principal</Label>[m[41m[m
[32m+[m[32m                    <Input id="shop-phone" name="phone" value={infoData?.phone || ''} onChange={handleInputChange} maxLength={16} disabled={!isEditingInfo} />[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                  <div className="space-y-2">[m[41m[m
[32m+[m[32m                      <Label htmlFor="shop-cpf-cnpj">CPF/CNPJ</Label>[m[41m[m
[32m+[m[32m                      <Input[m[41m[m
[32m+[m[32m                        id="shop-cpf-cnpj"[m[41m[m
[32m+[m[32m                        name="cpfCnpj"[m[41m[m
[32m+[m[32m                        value={infoData?.cpfCnpj ? formatCpfCnpjValue(infoData.cpfCnpj) : ''}[m[41m[m
[32m+[m[32m                        onChange={handleInputChange}[m[41m[m
[32m+[m[32m                        disabled={!isEditingInfo}[m[41m[m
[32m+[m[32m                        placeholder="Seu CPF ou CNPJ"[m[41m[m
[32m+[m[32m                      />[m[41m[m
[32m+[m[32m                      {cpfCnpjError && <p className="text-sm text-destructive">{cpfCnpjError}</p>}[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m              </div>[m[41m[m
[32m+[m[32m            </CardContent>[m[41m[m
[32m+[m[32m            <CardFooter className="border-t px-6 py-4">[m[41m[m
[32m+[m[32m              {isEditingInfo ? ([m[41m[m
[32m+[m[32m                <div className="flex gap-2">[m[41m[m
[32m+[m[32m                  <Button onClick={() => handleSaveChanges('info')} className="hover:bg-[#044a7b]"><Save className="mr-2 h-4 w-4"/>Salvar</Button>[m[41m[m
[32m+[m[32m                  <Button variant="ghost" onClick={() => handleCancelEdit('info')}>Cancelar</Button>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m              ) : ([m[41m[m
[32m+[m[32m                <Button onClick={() => startEditing('info')} className="hover:bg-[#044a7b]"><Edit className="mr-2 h-4 w-4"/>Editar Informações</Button>[m[41m[m
[32m+[m[32m              )}[m[41m[m
[32m+[m[32m            </CardFooter>[m[41m[m
[32m+[m[32m          </Card>[m[41m[m
[32m+[m[32m          <Card>[m[41m[m
[32m+[m[32m            <CardHeader>[m[41m[m
[32m+[m[32m                <CardTitle>Horario de Funcionamento</CardTitle>[m[41m[m
[32m+[m[32m                <CardDescription>[m[41m[m
[32m+[m[32m                Defina os dias e horarios que sua barbearia estara aberta.[m[41m[m
[32m+[m[32m                </CardDescription>[m[41m[m
[32m+[m[32m            </CardHeader>[m[41m[m
[32m+[m[32m            <CardContent className="space-y-3">[m[41m[m
[32m+[m[32m                {displayHours.map((day) => ([m[41m[m
[32m+[m[32m                <div key={day.day} className="flex flex-col sm:flex-row items-start sm:items-center justify-between rounded-lg border p-3 gap-4 sm:gap-2">[m[41m[m
[32m+[m[32m                    <div className="flex items-center gap-4 flex-1">[m[41m[m
[32m+[m[32m                        <Switch[m[41m[m
[32m+[m[32m                            id={`switch-${day.day}`}[m[41m[m
[32m+[m[32m                            checked={day.active}[m[41m[m
[32m+[m[32m                            onCheckedChange={(checked) => handleScheduleChange(day.day, { active: checked })}[m[41m[m
[32m+[m[32m                            aria-label={`Ativar ${day.day}`}[m[41m[m
[32m+[m[32m                        />[m[41m[m
[32m+[m[32m                        <Label htmlFor={`switch-${day.day}`} className="w-24 font-medium">[m[41m[m
[32m+[m[32m                            {day.day}[m[41m[m
[32m+[m[32m                        </Label>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                    {day.active ? ([m[41m[m
[32m+[m[32m                        <div className="flex items-center gap-2 w-full sm:w-auto">[m[41m[m
[32m+[m[32m                        <Input[m[41m[m
[32m+[m[32m                            type="time"[m[41m[m
[32m+[m[32m                            className="w-full sm:w-28"[m[41m[m
[32m+[m[32m                            value={day.open}[m[41m[m
[32m+[m[32m                            onChange={(e) => handleScheduleChange(day.day, { open: e.target.value })}[m[41m[m
[32m+[m[32m                        />[m[41m[m
[32m+[m[32m                        <span className="text-sm text-muted-foreground">ate</span>[m[41m[m
[32m+[m[32m                        <Input[m[41m[m
[32m+[m[32m                            type="time"[m[41m[m
[32m+[m[32m                            className="w-full sm:w-28"[m[41m[m
[32m+[m[32m                            value={day.close}[m[41m[m
[32m+[m[32m                            onChange={(e) => handleScheduleChange(day.day, { close: e.target.value })}[m[41m[m
[32m+[m[32m                        />[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                    ) : ([m[41m[m
[32m+[m[32m                        <Badge variant="destructive">FECHADO</Badge>[m[41m[m
[32m+[m[32m                    )}[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                ))}[m[41m[m
[32m+[m[32m            </CardContent>[m[41m[m
[32m+[m[32m            </Card>[m[41m[m
[32m+[m[32m        </div>[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        <div className="flex flex-col gap-6">[m[41m[m
[32m+[m[32m           <Card>[m[41m[m
[32m+[m[32m            <CardHeader>[m[41m[m
[32m+[m[32m                <CardTitle>Endereço</CardTitle>[m[41m[m
[32m+[m[32m                <CardDescription>[m[41m[m
[32m+[m[32m                Informe o endereço físico da sua barbearia.[m[41m[m
[32m+[m[32m                </CardDescription>[m[41m[m
[32m+[m[32m            </CardHeader>[m[41m[m
[32m+[m[32m            <CardContent className="space-y-4">[m[41m[m
[32m+[m[32m                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">[m[41m[m
[32m+[m[32m                <div className="space-y-2 sm:col-span-1">[m[41m[m
[32m+[m[32m                    <Label htmlFor="cep">CEP</Label>[m[41m[m
[32m+[m[32m                    <Input id="cep" name="address.cep" value={addressData?.cep || ''} onChange={handleInputChange} maxLength={9} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                <div className="space-y-2 sm:col-span-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="street">Rua</Label>[m[41m[m
[32m+[m[32m                    <Input id="street" name="address.street" value={addressData?.street || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[41m[m
[32m+[m[32m                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">[m[41m[m
[32m+[m[32m                <div className="space-y-2 sm:col-span-1">[m[41m[m
[32m+[m[32m                    <Label htmlFor="number">Número</Label>[m[41m[m
[32m+[m[32m                    <Input id="number" name="address.number" value={addressData?.number || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                <div className="space-y-2 sm:col-span-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="complement">Complemento (Opcional)</Label>[m[41m[m
[32m+[m[32m                    <Input id="complement" name="address.complement" value={addressData?.complement || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                <div className="space-y-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="neighborhood">Bairro</Label>[m[41m[m
[32m+[m[32m                    <Input id="neighborhood" name="address.neighborhood" value={addressData?.neighborhood || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[41m[m
[32m+[m[32m                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                <div className="space-y-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="city">Cidade</Label>[m[41m[m
[32m+[m[32m                    <Input id="city" name="address.city" value={addressData?.city || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                <div className="space-y-2">[m[41m[m
[32m+[m[32m                    <Label htmlFor="state">Estado</Label>[m[41m[m
[32m+[m[32m                    <Input id="state" name="address.state" value={addressData?.state || ''} onChange={handleInputChange} disabled={!isEditingAddress} />[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m            </CardContent>[m[41m[m
[32m+[m[32m             <CardFooter className="border-t px-6 py-4">[m[41m[m
[32m+[m[32m              {isEditingAddress ? ([m[41m[m
[32m+[m[32m                <div className="flex gap-2">[m[41m[m
[32m+[m[32m                  <Button onClick={() => handleSaveChanges('address')} className="hover:bg-[#044a7b]"><Save className="mr-2 h-4 w-4"/>Salvar Endereço</Button>[m[41m[m
[32m+[m[32m                  <Button variant="ghost" onClick={() => handleCancelEdit('address')}>Cancelar</Button>[m[41m[m
[32m+[m[32m                </div>[m[41m[m
[32m+[m[32m              ) : ([m[41m[m
[32m+[m[32m                <Button onClick={() => startEditing('address')} className="hover:bg-[#044a7b]"><Edit className="mr-2 h-4 w-4"/>Editar Endereço</Button>[m[41m[m
[32m+[m[32m              )}[m[41m[m
[32m+[m[32m            </CardFooter>[m[41m[m
[32m+[m[32m          </Card>[m[41m[m
[32m+[m[41m          [m
[32m+[m[32m              <Card>[m[41m[m
[32m+[m[32m              <CardHeader>[m[41m[m
[32m+[m[32m                  <CardTitle className="flex items-center gap-2"><Lock className="h-5 w-5"/>Segurança e Acesso</CardTitle>[m[41m[m
[32m+[m[32m                  <CardDescription>[m[41m[m
[32m+[m[32m                  Atualize sua senha de login.[m[41m[m
[32m+[m[32m                  </CardDescription>[m[41m[m
[32m+[m[32m              </CardHeader>[m[41m[m
[32m+[m[32m              <CardContent className="space-y-4">[m[41m[m
[32m+[m[32m                  <div className="space-y-2">[m[41m[m
[32m+[m[32m                  <Label htmlFor="email">E-mail de Login</Label>[m[41m[m
[32m+[m[32m                  <Input id="email" type="email" value={userEmail} disabled readOnly />[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                  {isEditingSecurity && ([m[41m[m
[32m+[m[32m                  <div className="space-y-2">[m[41m[m
[32m+[m[32m                      <Label htmlFor="current-password">Senha Atual</Label>[m[41m[m
[32m+[m[32m                      <div className="relative">[m[41m[m
[32m+[m[32m                        <Input[m[41m[m
[32m+[m[32m                          id="current-password"[m[41m[m
[32m+[m[32m                          type={showCurrentPassword ? 'text' : 'password'}[m[41m[m
[32m+[m[32m                          value={currentPassword}[m[41m[m
[32m+[m[32m                          onChange={(e) => setCurrentPassword(e.target.value)}[m[41m[m
[32m+[m[32m                          placeholder="••••••••"[m[41m[m
[32m+[m[32m                          disabled={!isEditingSecurity}[m[41m[m
[32m+[m[32m                          className="pr-12"[m[41m[m
[32m+[m[32m                        />[m[41m[m
[32m+[m[32m                        <Button[m[41m[m
[32m+[m[32m                          type="button"[m[41m[m
[32m+[m[32m                          variant="ghost"[m[41m[m
[32m+[m[32m                          size="icon"[m[41m[m
[32m+[m[32m                          className="absolute right-2 top-1/2 h-7 w-7 -translate-y-1/2"[m[41m[m
[32m+[m[32m                          onClick={() => setShowCurrentPassword(prev => !prev)}[m[41m[m
[32m+[m[32m                        >[m[41m[m
[32m+[m[32m                          {showCurrentPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m[41m[m
[32m+[m[32m                        </Button>[m[41m[m
[32m+[m[32m                      </div>[m[41m[m
[32m+[m[32m                      <p className="text-xs text-muted-foreground">Necessária para confirmar qualquer alteração de segurança.</p>[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                  )}[m[41m[m
[32m+[m[32m                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                    <div className="space-y-2">[m[41m[m
[32m+[m[32m                        <Label htmlFor="new-password">Nova Senha</Label>[m[41m[m
[32m+[m[32m                        <div className="relative">[m[41m[m
[32m+[m[32m                          <Input[m[41m[m
[32m+[m[32m                            id="new-password"[m[41m[m
[32m+[m[32m                            type={showNewPassword ? 'text' : 'password'}[m[41m[m
[32m+[m[32m                            value={newPassword}[m[41m[m
[32m+[m[32m                            onChange={(e) => setNewPassword(e.target.value)}[m[41m[m
[32m+[m[32m                            placeholder="••••••••"[m[41m[m
[32m+[m[32m                            disabled={!isEditingSecurity}[m[41m[m
[32m+[m[32m                            className="pr-12"[m[41m[m
[32m+[m[32m                          />[m[41m[m
[32m+[m[32m                          <Button[m[41m[m
[32m+[m[32m                            type="button"[m[41m[m
[32m+[m[32m                            variant="ghost"[m[41m[m
[32m+[m[32m                            size="icon"[m[41m[m
[32m+[m[32m                            className="absolute right-2 top-1/2 h-7 w-7 -translate-y-1/2"[m[41m[m
[32m+[m[32m                            onClick={() => setShowNewPassword(prev => !prev)}[m[41m[m
[32m+[m[32m                          >[m[41m[m
[32m+[m[32m                            {showNewPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m[41m[m
[32m+[m[32m                          </Button>[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                    <div className="space-y-2">[m[41m[m
[32m+[m[32m                        <Label htmlFor="confirm-new-password">Confirmar Nova Senha</Label>[m[41m[m
[32m+[m[32m                        <div className="relative">[m[41m[m
[32m+[m[32m                          <Input[m[41m[m
[32m+[m[32m                            id="confirm-new-password"[m[41m[m
[32m+[m[32m                            type={showConfirmPassword ? 'text' : 'password'}[m[41m[m
[32m+[m[32m                            value={confirmNewPassword}[m[41m[m
[32m+[m[32m                            onChange={(e) => setConfirmNewPassword(e.target.value)}[m[41m[m
[32m+[m[32m                            placeholder="••••••••"[m[41m[m
[32m+[m[32m                            disabled={!isEditingSecurity}[m[41m[m
[32m+[m[32m                            className="pr-12"[m[41m[m
[32m+[m[32m                          />[m[41m[m
[32m+[m[32m                          <Button[m[41m[m
[32m+[m[32m                            type="button"[m[41m[m
[32m+[m[32m                            variant="ghost"[m[41m[m
[32m+[m[32m                            size="icon"[m[41m[m
[32m+[m[32m                            className="absolute right-2 top-1/2 h-7 w-7 -translate-y-1/2"[m[41m[m
[32m+[m[32m                            onClick={() => setShowConfirmPassword(prev => !prev)}[m[41m[m
[32m+[m[32m                          >[m[41m[m
[32m+[m[32m                            {showConfirmPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m[41m[m
[32m+[m[32m                          </Button>[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m              </CardContent>[m[41m[m
[32m+[m[32m              <CardFooter className="border-t px-6 py-4">[m[41m[m
[32m+[m[32m                  {isEditingSecurity ? ([m[41m[m
[32m+[m[32m                  <div className="flex gap-2">[m[41m[m
[32m+[m[32m                      <Button onClick={handleSecurityChanges} disabled={isSecurityUpdating} className="hover:bg-[#044a7b]">[m[41m[m
[32m+[m[32m                        {isSecurityUpdating ? ([m[41m[m
[32m+[m[32m                          <Loader2 className="mr-2 h-4 w-4 animate-spin" />[m[41m[m
[32m+[m[32m                        ) : ([m[41m[m
[32m+[m[32m                          <Save className="mr-2 h-4 w-4" />[m[41m[m
[32m+[m[32m                        )}[m[41m[m
[32m+[m[32m                        {isSecurityUpdating ? "Atualizando..." : "Salvar Alterações"}[m[41m[m
[32m+[m[32m                      </Button>[m[41m[m
[32m+[m[32m                      <Button variant="ghost" onClick={() => handleCancelEdit('security')}>Cancelar</Button>[m[41m[m
[32m+[m[32m                  </div>[m[41m[m
[32m+[m[32m                  ) : ([m[41m[m
[32m+[m[32m                  <Button[m[41m[m
[32m+[m[32m                    onClick={() => startEditing('security')}[m[41m[m
[32m+[m[32m                    className="hover:bg-[#044a7b]"[m[41m[m
[32m+[m[32m                  >[m[41m[m
[32m+[m[32m                    <Edit className="mr-2 h-4 w-4" />[m[41m[m
[32m+[m[32m                    Alterar Segurança[m[41m[m
[32m+[m[32m                  </Button>[m[41m[m
[32m+[m[32m                  )}[m[41m[m
[32m+[m[32m              </CardFooter>[m[41m[m
[32m+[m[32m          </Card>[m[41m[m
[32m+[m[32m        </div>[m[41m[m
[32m+[m[32m      </div>[m[41m[m
[32m+[m[32m    </div>[m[41m[m
[32m+[m[32m    </>[m[41m[m
[32m+[m[32m  );[m[41m[m
[32m+[m[32m}[m[41m[m
[41m+[m
[41m+[m
[41m+[m
[41m+[m
[41m+[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/subscription/page.tsx b/src/app/(dashboard)/admin/dashboard/subscription/page.tsx[m
[1mindex 7bc8c64..5607135 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/subscription/page.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/subscription/page.tsx[m
[36m@@ -21,7 +21,7 @@[m [mimport {[m
   DialogFooter,[m
   DialogClose,[m
 } from "@/components/ui/dialog";[m
[31m-import { Crown, Sparkles, Loader2, QrCode, Copy, CreditCard, HelpCircle, CheckCircle, Zap } from "lucide-react";[m
[32m+[m[32mimport { Crown, Sparkles, CreditCard, HelpCircle, CheckCircle, Zap } from "lucide-react";[m
 import { useAuth } from "@/context/AuthContext";[m
 import { fetchJson } from "@/lib/fetcher";[m
 import type { Barbershop, PlanName } from "@/lib/definitions";[m
[36m@@ -29,9 +29,6 @@[m [mimport { useBarbershopId } from "@/context/BarbershopIdContext";[m
 import { differenceInDays, startOfDay, format, isBefore } from "date-fns";[m
 import { formatCurrency } from "@/lib/utils";[m
 import { Badge } from "@/components/ui/badge";[m
[31m-import Image from "next/image";[m
[31m-import { Input } from "@/components/ui/input";[m
[31m-import { Label } from "@/components/ui/label";[m
 import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";[m
 [m
 [m
[36m@@ -115,9 +112,6 @@[m [mexport default function SubscriptionPage() {[m
         };[m
     }, [isUpgradeModalOpen, barbershopId, fetchBarbershop, toast]);[m
 [m
[31m-    const [isGeneratingPix, setIsGeneratingPix] = useState(false);[m
[31m-    const [pixData, setPixData] = useState<{ qrCodeBase64: string; qrCode: string; paymentId: string; } | null>(null);[m
[31m-[m
     useEffect(() => {[m
         if (typeof window === "undefined") return;[m
         const handler = (event: Event) => {[m
[36m@@ -169,7 +163,7 @@[m [mexport default function SubscriptionPage() {[m
         return { text, days: daysRemaining, date: formattedDate, isTrial };[m
     }[m
 [m
[31m-const handleUpgradeClick = () => {[m
[32m+[m[32m    const handleUpgradeClick = () => {[m
         const expiry = barbershopData?.expiryDate ? new Date(barbershopData.expiryDate) : null;[m
         const today = new Date();[m
         [m
[36m@@ -189,59 +183,14 @@[m [mconst handleUpgradeClick = () => {[m
         }[m
         [m
         setIsUpgradeModalOpen(true);[m
[31m-        setPixData(null);[m
[31m-        setIsGeneratingPix(false);[m
[31m-    }[m
[31m-[m
[31m-    const handleGeneratePix = async () => {[m
[31m-        if (!barbershopId || !barbershopData?.cpfCnpj || !barbershopData?.email) {[m
[31m-            toast({ variant: 'destructive', title: 'Erro', description: 'Dados da barbearia (ID, CPF/CNPJ ou Email) estão incompletos.' });[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        setIsGeneratingPix(true);[m
[31m-        setPixData(null);[m
[32m+[m[32m    };[m
 [m
[31m-        try {[m
[31m-            const response = await fetch('/api/create-payment', {[m
[31m-                method: 'POST',[m
[31m-                headers: { 'Content-Type': 'application/json' },[m
[31m-                body: JSON.stringify({[m
[31m-                    amount: upgradeCost,[m
[31m-                    barbershopId: barbershopId,[m
[31m-                    ownerData: {[m
[31m-                        email: barbershopData.email,[m
[31m-                        cpfCnpj: barbershopData.cpfCnpj,[m
[31m-                        legalName: barbershopData.legalName || barbershopData.name,[m
[31m-                    }[m
[31m-                }),[m
[31m-            });[m
[31m-[m
[31m-            if (!response.ok) {[m
[31m-                const errorData = await response.json();[m
[31m-                throw new Error(errorData.message || 'Falha ao gerar o PIX.');[m
[31m-            }[m
[31m-[m
[31m-            const data = await response.json();[m
[31m-            setPixData({[m
[31m-                qrCodeBase64: data.qrCodeBase64,[m
[31m-                qrCode: data.qrCode,[m
[31m-                paymentId: data.paymentId,[m
[31m-            });[m
[31m-[m
[31m-        } catch (error: any) {[m
[31m-            toast({ variant: 'destructive', title: 'Erro ao Gerar PIX', description: error.message });[m
[31m-        } finally {[m
[31m-            setIsGeneratingPix(false);[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    const copyPixCode = () => {[m
[31m-        if (!pixData?.qrCode) return;[m
[31m-        navigator.clipboard.writeText(pixData.qrCode).then(() => {[m
[31m-        toast({ title: "Código PIX Copiado!", description: "Use 'Copia e Cola' no seu app do banco." });[m
[32m+[m[32m    const notifyPaymentDisabled = () => {[m
[32m+[m[32m        toast({[m
[32m+[m[32m            title: "Pagamento indisponivel",[m
[32m+[m[32m            description: "A integracao de pagamento via Mercado Pago/PIX esta desativada. Fale com o suporte para concluir o upgrade.",[m
         });[m
[31m-    }[m
[32m+[m[32m    };[m
 [m
     if (isBarbershopIdLoading || isLoadingBarbershop) {[m
         return <div className="p-6">Carregando plano...</div>;[m
[36m@@ -345,31 +294,15 @@[m [mconst handleUpgradeClick = () => {[m
                         </CardContent>[m
                     </Card>[m
                     [m
[31m-                    {pixData ? ([m
[31m-                        <div className="space-y-4 text-center">[m
[31m-                            <p className="text-sm text-muted-foreground">Escaneie o QR Code abaixo com o app do seu banco:</p>[m
[31m-                            <div className="flex justify-center">[m
[31m-                                <Image src={`data:image/png;base64,${pixData.qrCodeBase64}`} alt="PIX QR Code" width={256} height={256} />[m
[31m-                            </div>[m
[31m-                            <div className="space-y-2">[m
[31m-                            <Label htmlFor="pix-copy-paste" className="text-xs">Ou use o PIX Copia e Cola:</Label>[m
[31m-                            <div className="flex gap-2">[m
[31m-                                <Input id="pix-copy-paste" readOnly value={pixData.qrCode} className="text-xs h-8"/>[m
[31m-                                <Button size="sm" onClick={copyPixCode}><Copy className="mr-2 h-3 w-3"/>Copiar</Button>[m
[31m-                            </div>[m
[31m-                            </div>[m
[31m-                            <p className="text-xs text-muted-foreground pt-2">Aguardando pagamento... A página será atualizada automaticamente.</p>[m
[31m-                        </div>[m
[31m-                    ) : ([m
[31m-                        <Button onClick={handleGeneratePix} className="w-full" disabled={isGeneratingPix}>[m
[31m-                            {isGeneratingPix ? ([m
[31m-                                <Loader2 className="mr-2 h-4 w-4 animate-spin" />[m
[31m-                            ) : ([m
[31m-                                <QrCode className="mr-2 h-4 w-4" />[m
[31m-                            )}[m
[31m-                            {isGeneratingPix ? 'Gerando PIX...' : 'Gerar QR Code PIX'}[m
[32m+[m[32m                    <div className="space-y-3 rounded-md border border-dashed bg-muted/40 p-4 text-center">[m
[32m+[m[32m                        <p className="font-semibold">Pagamento via PIX desativado</p>[m
[32m+[m[32m                        <p className="text-sm text-muted-foreground">[m
[32m+[m[32m                            A integracao com Mercado Pago/PIX foi removida. Entre em contato com o suporte para concluir o upgrade.[m
[32m+[m[32m                        </p>[m
[32m+[m[32m                        <Button className="w-full" variant="outline" onClick={notifyPaymentDisabled}>[m
[32m+[m[32m                            Falar com o suporte[m
                         </Button>[m
[31m-                    )}[m
[32m+[m[32m                    </div>[m
                 </div>[m
                 <DialogFooter>[m
                     <DialogClose asChild>[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/tutorials/page.tsx b/src/app/(dashboard)/admin/dashboard/tutorials/page.tsx[m
[1mindex 8c2a32b..f64b5c0 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/tutorials/page.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/tutorials/page.tsx[m
[36m@@ -1,67 +1,92 @@[m
 [m
 'use client';[m
 [m
[31m-import { Card, CardHeader, CardTitle, CardDescription, CardContent } from "@/components/ui/card";[m
[31m-import { Youtube } from "lucide-react";[m
[32m+[m[32mimport { useEffect, useState } from "react";[m
[32m+[m[32mimport { Loader2, Youtube } from "lucide-react";[m
[32m+[m
[32m+[m[32mimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";[m
[32m+[m[32mimport { useToast } from "@/hooks/use-toast";[m
[32m+[m[32mimport { fetchJson } from "@/lib/fetcher";[m
[32m+[m
[32m+[m[32mtype TutorialVideo = {[m
[32m+[m[32m  id: string;[m
[32m+[m[32m  title: string;[m
[32m+[m[32m  description: string | null;[m
[32m+[m[32m  youtubeUrl: string;[m
[32m+[m[32m  youtubeId: string | null;[m
[32m+[m[32m  targetEmail: string | null;[m
[32m+[m[32m  enabled: boolean;[m
[32m+[m[32m  createdAt: string;[m
[32m+[m[32m  updatedAt: string;[m
[32m+[m[32m};[m
 [m
 export default function TutorialsPage() {[m
[31m-    // Mock data for tutorials. Replace with your actual video data.[m
[31m-    const tutorials = [[m
[31m-        {[m
[31m-            title: "Configurando sua Barbearia pela Primeira Vez",[m
[31m-            description: "Um guia passo a passo para deixar sua barbearia pronta para receber agendamentos.",[m
[31m-            videoId: "dQw4w9WgXcQ" // Exemplo de ID de vídeo do YouTube[m
[31m-        },[m
[31m-        {[m
[31m-            title: "Gerenciando Barbeiros e Serviços",[m
[31m-            description: "Aprenda a cadastrar sua equipe e os serviços que cada um oferece.",[m
[31m-            videoId: "dQw4w9WgXcQ"[m
[31m-        },[m
[31m-        {[m
[31m-            title: "Dominando a Agenda",[m
[31m-            description: "Veja como cadastrar agendamentos manuais, editar horários e gerenciar o dia a dia.",[m
[31m-            videoId: "dQw4w9WgXcQ"[m
[31m-        },[m
[31m-         {[m
[31m-            title: "Conectando o WhatsApp",[m
[31m-            description: "Configure as mensagens automáticas de lembrete e confirmação para seus clientes.",[m
[31m-            videoId: "dQw4w9WgXcQ"[m
[31m-        }[m
[31m-    ];[m
[32m+[m[32m  const { toast } = useToast();[m
[32m+[m[32m  const [isLoading, setIsLoading] = useState(true);[m
[32m+[m[32m  const [tutorials, setTutorials] = useState<TutorialVideo[]>([]);[m
[32m+[m
[32m+[m[32m  useEffect(() => {[m
[32m+[m[32m    setIsLoading(true);[m
[32m+[m[32m    fetchJson<{ data: TutorialVideo[] }>("/api/tutorials")[m
[32m+[m[32m      .then((res) => setTutorials(res.data || []))[m
[32m+[m[32m      .catch((error: any) => {[m
[32m+[m[32m        console.error("Erro ao carregar tutoriais:", error);[m
[32m+[m[32m        toast({[m
[32m+[m[32m          variant: "destructive",[m
[32m+[m[32m          title: "Erro",[m
[32m+[m[32m          description: error?.message || "Não foi possível carregar os tutoriais.",[m
[32m+[m[32m        });[m
[32m+[m[32m      })[m
[32m+[m[32m      .finally(() => setIsLoading(false));[m
[32m+[m[32m    // eslint-disable-next-line react-hooks/exhaustive-deps[m
[32m+[m[32m  }, []);[m
[32m+[m
[32m+[m[32m  return ([m
[32m+[m[32m    <div className="space-y-6">[m
[32m+[m[32m      <div className="flex items-center justify-between">[m
[32m+[m[32m        <h1 className="text-3xl font-bold font-headline flex items-center gap-2">[m
[32m+[m[32m          <Youtube className="h-8 w-8 text-primary" />[m
[32m+[m[32m          Tutoriais em Vídeo[m
[32m+[m[32m        </h1>[m
[32m+[m[32m        {isLoading ? <Loader2 className="h-5 w-5 animate-spin text-muted-foreground" /> : null}[m
[32m+[m[32m      </div>[m
[32m+[m[32m      <p className="text-muted-foreground">[m
[32m+[m[32m        Assista aos nossos guias rápidos para aprender a usar as funcionalidades do BarberFlow e otimizar a gestão da sua barbearia.[m
[32m+[m[32m      </p>[m
[32m+[m
[32m+[m[32m      {!isLoading && tutorials.length === 0 ? ([m
[32m+[m[32m        <Card>[m
[32m+[m[32m          <CardContent className="p-6 text-sm text-muted-foreground">Nenhum tutorial disponível no momento.</CardContent>[m
[32m+[m[32m        </Card>[m
[32m+[m[32m      ) : null}[m
 [m
[31m-    return ([m
[31m-        <div className="space-y-6">[m
[31m-            <div className="flex items-center justify-between">[m
[31m-                <h1 className="text-3xl font-bold font-headline flex items-center gap-2">[m
[31m-                    <Youtube className="h-8 w-8 text-primary" />[m
[31m-                    Tutoriais em Vídeo[m
[31m-                </h1>[m
[31m-            </div>[m
[31m-            <p className="text-muted-foreground">[m
[31m-                Assista aos nossos guias rápidos para aprender a usar todas as funcionalidades do BarberFlow e otimizar a gestão da sua barbearia.[m
[31m-            </p>[m
[31m-            [m
[31m-            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">[m
[31m-                {tutorials.map((tutorial, index) => ([m
[31m-                    <Card key={index}>[m
[31m-                        <CardHeader>[m
[31m-                            <CardTitle>{tutorial.title}</CardTitle>[m
[31m-                            <CardDescription>{tutorial.description}</CardDescription>[m
[31m-                        </CardHeader>[m
[31m-                        <CardContent>[m
[31m-                            <div className="aspect-video overflow-hidden rounded-lg border">[m
[31m-                                <iframe[m
[31m-                                    className="w-full h-full"[m
[31m-                                    src={`https://www.youtube.com/embed/${tutorial.videoId}`}[m
[31m-                                    title={tutorial.title}[m
[31m-                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"[m
[31m-                                    allowFullScreen[m
[31m-                                ></iframe>[m
[31m-                            </div>[m
[31m-                        </CardContent>[m
[31m-                    </Card>[m
[31m-                ))}[m
[31m-            </div>[m
[31m-        </div>[m
[31m-    )[m
[32m+[m[32m      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">[m
[32m+[m[32m        {tutorials.map((tutorial) => ([m
[32m+[m[32m          <Card key={tutorial.id}>[m
[32m+[m[32m            <CardHeader>[m
[32m+[m[32m              <CardTitle>{tutorial.title}</CardTitle>[m
[32m+[m[32m              {tutorial.description ? <CardDescription>{tutorial.description}</CardDescription> : null}[m
[32m+[m[32m            </CardHeader>[m
[32m+[m[32m            <CardContent>[m
[32m+[m[32m              <div className="aspect-video overflow-hidden rounded-lg border bg-muted">[m
[32m+[m[32m                {tutorial.youtubeId ? ([m
[32m+[m[32m                  <iframe[m
[32m+[m[32m                    className="w-full h-full"[m
[32m+[m[32m                    src={`https://www.youtube.com/embed/${tutorial.youtubeId}`}[m
[32m+[m[32m                    title={tutorial.title}[m
[32m+[m[32m                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"[m
[32m+[m[32m                    allowFullScreen[m
[32m+[m[32m                  />[m
[32m+[m[32m                ) : ([m
[32m+[m[32m                  <div className="h-full w-full flex items-center justify-center text-sm text-muted-foreground">[m
[32m+[m[32m                    Link inválido ou vídeo indisponível.[m
[32m+[m[32m                  </div>[m
[32m+[m[32m                )}[m
[32m+[m[32m              </div>[m
[32m+[m[32m            </CardContent>[m
[32m+[m[32m          </Card>[m
[32m+[m[32m        ))}[m
[32m+[m[32m      </div>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  );[m
 }[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/whatsapp-reports/page.tsx b/src/app/(dashboard)/admin/dashboard/whatsapp-reports/page.tsx[m
[1mindex 7164b2f..abd2a0e 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/whatsapp-reports/page.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/whatsapp-reports/page.tsx[m
[36m@@ -236,7 +236,7 @@[m [mexport default function WhatsappReportsPage() {[m
       );[m
     }[m
     return filtered;[m
[31m-  }, [disparos, searchTerm, dateRange]);[m
[32m+[m[32m  }, [disparos, searchTerm, dateRange, selectedType]);[m
 [m
   const filteredQueue = useMemo(() => {[m
     let filtered = [...queueItems];[m
[36m@@ -260,7 +260,7 @@[m [mexport default function WhatsappReportsPage() {[m
       );[m
     }[m
     return filtered;[m
[31m-  }, [queueItems, searchTerm, dateRange]);[m
[32m+[m[32m  }, [queueItems, searchTerm, dateRange, selectedType]);[m
 [m
   const clearFilters = () => {[m
     setSearchTerm('');[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.client.tsx b/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.client.tsx[m
[1mindex 6a3eb44..59ed7d7 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.client.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.client.tsx[m
[36m@@ -81,9 +81,9 @@[m [mexport default function WhatsAppTemplatesPage() {[m
     [setMessageTemplates][m
   );[m
 [m
[31m-  const updateTemplate = (id: string, patch: Partial<TemplateForm>) => {[m
[32m+[m[32m  const updateTemplate = useCallback((id: string, patch: Partial<TemplateForm>) => {[m
     setTemplates((prev) => prev.map((tpl) => (tpl.id === id ? { ...tpl, ...patch } : tpl)));[m
[31m-  };[m
[32m+[m[32m  }, []);[m
 [m
   const handleContentChange = useCallback([m
     (id: string, value: string) => {[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.tsx b/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.tsx[m
[1mindex 87b8832..a57e6c1 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/whatsapp-templates/page.tsx[m
[36m@@ -1,7 +1,7 @@[m
[31m-import dynamic from "next/dynamic";[m
[32m+[m[32m "use client";[m
 [m
[31m-const WhatsAppTemplatesPage = dynamic(() => import("./page.client"), { ssr: false });[m
[32m+[m[32m import WhatsAppTemplatesPage from "./page.client";[m
 [m
[31m-export default function Page() {[m
[31m-  return <WhatsAppTemplatesPage />;[m
[31m-}[m
[32m+[m[32m export default function Page() {[m
[32m+[m[32m   return <WhatsAppTemplatesPage />;[m
[32m+[m[32m }[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/whatsapp/page.client.tsx b/src/app/(dashboard)/admin/dashboard/whatsapp/page.client.tsx[m
[1mindex 22390a4..f097dfb 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/whatsapp/page.client.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/whatsapp/page.client.tsx[m
[36m@@ -11,7 +11,7 @@[m [mimport { Badge } from "@/components/ui/badge";[m
 import { Button } from "@/components/ui/button";[m
 import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";[m
 import { Separator } from "@/components/ui/separator";[m
[31m-import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";[m
[32m+[m[32mimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from "@/components/ui/dialog";[m
 import { AlertCircle, CheckCircle2, Loader2, PhoneOff, PlugZap, QrCode, RefreshCcw } from "lucide-react";[m
 import Image from "next/image";[m
 [m
[36m@@ -87,6 +87,7 @@[m [mexport default function WhatsAppPage() {[m
   const [isValidating, setIsValidating] = useState(false);[m
   const [isDisconnecting, setIsDisconnecting] = useState(false);[m
   const [isQrModalOpen, setIsQrModalOpen] = useState(false);[m
[32m+[m[32m  const [isMissingInstanceDialogOpen, setIsMissingInstanceDialogOpen] = useState(false);[m
   const [qrGeneratedAt, setQrGeneratedAt] = useState<number | null>(null);[m
   const statusRef = useRef<WhatsAppStatus | null | undefined>(barbershop?.whatsappStatus);[m
 [m
[36m@@ -179,11 +180,21 @@[m [mexport default function WhatsAppPage() {[m
         description: json.message || "Conexão validada com a WhatsApp.",[m
       });[m
     } catch (error: any) {[m
[31m-      toast({[m
[31m-        variant: "destructive",[m
[31m-        title: "Erro ao validar",[m
[31m-        description: error?.message || "Tente novamente.",[m
[31m-      });[m
[32m+[m[32m      const msg: string = error?.message || "";[m
[32m+[m[32m      const normalized = msg.toLowerCase();[m
[32m+[m[32m      if ([m
[32m+[m[32m        normalized.includes("instância bitsafira não configurados") ||[m
[32m+[m[32m        normalized.includes("instancia bitsafira nao configurados") ||[m
[32m+[m[32m        normalized.includes("token ou id da instância bitsafira")[m
[32m+[m[32m      ) {[m
[32m+[m[32m        setIsMissingInstanceDialogOpen(true);[m
[32m+[m[32m      } else {[m
[32m+[m[32m        toast({[m
[32m+[m[32m          variant: "destructive",[m
[32m+[m[32m          title: "Erro ao validar",[m
[32m+[m[32m          description: msg || "Tente novamente.",[m
[32m+[m[32m        });[m
[32m+[m[32m      }[m
     } finally {[m
       setIsValidating(false);[m
     }[m
[36m@@ -460,6 +471,33 @@[m [mexport default function WhatsAppPage() {[m
           )}[m
         </DialogContent>[m
       </Dialog>[m
[32m+[m
[32m+[m[32m      <Dialog open={isMissingInstanceDialogOpen} onOpenChange={setIsMissingInstanceDialogOpen}>[m
[32m+[m[32m        <DialogContent className="sm:max-w-md">[m
[32m+[m[32m          <DialogHeader>[m
[32m+[m[32m            <DialogTitle>Instância não configurada</DialogTitle>[m
[32m+[m[32m            <DialogDescription>[m
[32m+[m[32m              Clique em <strong>Conectar</strong> para criar a instância BitSafira e gerar o QR Code.[m
[32m+[m[32m            </DialogDescription>[m
[32m+[m[32m          </DialogHeader>[m
[32m+[m[32m          <div className="flex justify-end gap-2">[m
[32m+[m[32m            <Button variant="outline" onClick={() => setIsMissingInstanceDialogOpen(false)}>[m
[32m+[m[32m              Fechar[m
[32m+[m[32m            </Button>[m
[32m+[m[32m            <Button[m
[32m+[m[32m              onClick={() => {[m
[32m+[m[32m                setIsMissingInstanceDialogOpen(false);[m
[32m+[m[32m                handleConnect();[m
[32m+[m[32m              }}[m
[32m+[m[32m              disabled={isConnecting}[m
[32m+[m[32m              className="gap-2"[m
[32m+[m[32m            >[m
[32m+[m[32m              {isConnecting ? <Loader2 className="h-4 w-4 animate-spin" /> : null}[m
[32m+[m[32m              Conectar[m
[32m+[m[32m            </Button>[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </DialogContent>[m
[32m+[m[32m      </Dialog>[m
     </div>[m
   );[m
 }[m
[1mdiff --git a/src/app/(dashboard)/admin/dashboard/whatsapp/page.tsx b/src/app/(dashboard)/admin/dashboard/whatsapp/page.tsx[m
[1mindex 0c3c6bc..1f03dd0 100755[m
[1m--- a/src/app/(dashboard)/admin/dashboard/whatsapp/page.tsx[m
[1m+++ b/src/app/(dashboard)/admin/dashboard/whatsapp/page.tsx[m
[36m@@ -1,7 +1,7 @@[m
[31m-import dynamic from "next/dynamic";[m
[32m+[m[32m "use client";[m
 [m
[31m-const WhatsAppPage = dynamic(() => import("./page.client"), { ssr: false });[m
[32m+[m[32m import WhatsAppPage from "./page.client";[m
 [m
[31m-export default function Page() {[m
[31m-  return <WhatsAppPage />;[m
[31m-}[m
[32m+[m[32m export default function Page() {[m
[32m+[m[32m   return <WhatsAppPage />;[m
[32m+[m[32m }[m
[1mdiff --git a/src/app/(superadmin)/super-admin/dashboard/appearance/page.tsx b/src/app/(superadmin)/super-admin/dashboard/appearance/page.tsx[m
[1mnew file mode 100644[m
[1mindex 0000000..f554b3e[m
[1m--- /dev/null[m
[1m+++ b/src/app/(superadmin)/super-admin/dashboard/appearance/page.tsx[m
[36m@@ -0,0 +1,210 @@[m
[32m+[m[32m'use client';[m
[32m+[m
[32m+[m[32mimport { useEffect, useMemo, useState } from 'react';[m
[32m+[m[32mimport { Image as ImageIcon, Loader2, Save } from 'lucide-react';[m
[32m+[m
[32m+[m[32mimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';[m
[32m+[m[32mimport { Button } from '@/components/ui/button';[m
[32m+[m[32mimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';[m
[32m+[m[32mimport { Input } from '@/components/ui/input';[m
[32m+[m[32mimport { Label } from '@/components/ui/label';[m
[32m+[m[32mimport { Separator } from '@/components/ui/separator';[m
[32m+[m[32mimport { useToast } from '@/hooks/use-toast';[m
[32m+[m[32mimport { fetchJson } from '@/lib/fetcher';[m
[32m+[m[32mimport Image from 'next/image';[m
[32m+[m
[32m+[m[32mtype SiteAppearance = {[m
[32m+[m[32m  homeHeroDesktopPath: string | null;[m
[32m+[m[32m  homeHeroMobilePath: string | null;[m
[32m+[m[32m  updatedAt: string | null;[m
[32m+[m[32m};[m
[32m+[m
[32m+[m[32mconst HERO_API = '/api/site-appearance/home-hero';[m
[32m+[m[32mconst HERO_ASSET_DESKTOP = '/api/site-assets/home-hero?variant=desktop';[m
[32m+[m[32mconst HERO_ASSET_MOBILE = '/api/site-assets/home-hero?variant=mobile';[m
[32m+[m
[32m+[m[32mexport default function SuperAdminAppearancePage() {[m
[32m+[m[32m  const { toast } = useToast();[m
[32m+[m
[32m+[m[32m  const [isLoading, setIsLoading] = useState(true);[m
[32m+[m[32m  const [isSaving, setIsSaving] = useState(false);[m
[32m+[m[32m  const [data, setData] = useState<SiteAppearance | null>(null);[m
[32m+[m
[32m+[m[32m  const [desktopFile, setDesktopFile] = useState<File | null>(null);[m
[32m+[m[32m  const [mobileFile, setMobileFile] = useState<File | null>(null);[m
[32m+[m
[32m+[m[32m  const desktopPreview = useMemo(() => (desktopFile ? URL.createObjectURL(desktopFile) : null), [desktopFile]);[m
[32m+[m[32m  const mobilePreview = useMemo(() => (mobileFile ? URL.createObjectURL(mobileFile) : null), [mobileFile]);[m
[32m+[m
[32m+[m[32m  useEffect(() => {[m
[32m+[m[32m    return () => {[m
[32m+[m[32m      if (desktopPreview) URL.revokeObjectURL(desktopPreview);[m
[32m+[m[32m      if (mobilePreview) URL.revokeObjectURL(mobilePreview);[m
[32m+[m[32m    };[m
[32m+[m[32m  }, [desktopPreview, mobilePreview]);[m
[32m+[m
[32m+[m[32m  const load = async () => {[m
[32m+[m[32m    const res = await fetchJson<{ data: SiteAppearance }>(HERO_API);[m
[32m+[m[32m    setData(res.data);[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  useEffect(() => {[m
[32m+[m[32m    setIsLoading(true);[m
[32m+[m[32m    load()[m
[32m+[m[32m      .catch((error: any) => {[m
[32m+[m[32m        console.error('Erro ao carregar aparência:', error);[m
[32m+[m[32m        toast({[m
[32m+[m[32m          variant: 'destructive',[m
[32m+[m[32m          title: 'Erro',[m
[32m+[m[32m          description: error?.message || 'Não foi possível carregar as configurações.',[m
[32m+[m[32m        });[m
[32m+[m[32m      })[m
[32m+[m[32m      .finally(() => setIsLoading(false));[m
[32m+[m[32m    // eslint-disable-next-line react-hooks/exhaustive-deps[m
[32m+[m[32m  }, []);[m
[32m+[m
[32m+[m[32m  const handleSave = async () => {[m
[32m+[m[32m    if (!desktopFile && !mobileFile) {[m
[32m+[m[32m      toast({[m
[32m+[m[32m        variant: 'destructive',[m
[32m+[m[32m        title: 'Erro',[m
[32m+[m[32m        description: 'Selecione pelo menos uma imagem (desktop e/ou mobile).',[m
[32m+[m[32m      });[m
[32m+[m[32m      return;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    setIsSaving(true);[m
[32m+[m[32m    try {[m
[32m+[m[32m      const form = new FormData();[m
[32m+[m[32m      if (desktopFile) form.append('desktop', desktopFile);[m
[32m+[m[32m      if (mobileFile) form.append('mobile', mobileFile);[m
[32m+[m
[32m+[m[32m      const res = await fetchJson<{ data: SiteAppearance }>(HERO_API, {[m
[32m+[m[32m        method: 'POST',[m
[32m+[m[32m        body: form,[m
[32m+[m[32m      });[m
[32m+[m
[32m+[m[32m      setData(res.data);[m
[32m+[m[32m      setDesktopFile(null);[m
[32m+[m[32m      setMobileFile(null);[m
[32m+[m
[32m+[m[32m      toast({[m
[32m+[m[32m        title: 'Salvo!',[m
[32m+[m[32m        description: 'Imagens atualizadas com sucesso.',[m
[32m+[m[32m      });[m
[32m+[m[32m    } catch (error: any) {[m
[32m+[m[32m      console.error('Erro ao salvar aparência:', error);[m
[32m+[m[32m      toast({[m
[32m+[m[32m        variant: 'destructive',[m
[32m+[m[32m        title: 'Erro',[m
[32m+[m[32m        description: error?.message || 'Não foi possível salvar.',[m
[32m+[m[32m      });[m
[32m+[m[32m    } finally {[m
[32m+[m[32m      setIsSaving(false);[m
[32m+[m[32m    }[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  return ([m
[32m+[m[32m    <div className="flex-1 space-y-6 p-4 md:p-8 pt-6">[m
[32m+[m[32m      <div>[m
[32m+[m[32m        <h2 className="text-3xl font-bold tracking-tight font-headline flex items-center gap-2">[m
[32m+[m[32m          <ImageIcon className="h-7 w-7 text-primary" />[m
[32m+[m[32m          Aparência[m
[32m+[m[32m        </h2>[m
[32m+[m[32m        <p className="text-muted-foreground">Personalize imagens e visual do site (Home).</p>[m
[32m+[m[32m      </div>[m
[32m+[m
[32m+[m[32m      <Card>[m
[32m+[m[32m        <CardHeader>[m
[32m+[m[32m          <CardTitle>Imagem de fundo (Home)</CardTitle>[m
[32m+[m[32m          <CardDescription>[m
[32m+[m[32m            Envie uma imagem para desktop e outra para mobile. Formatos aceitos: PNG, JPG, WEBP (até 15MB).[m
[32m+[m[32m          </CardDescription>[m
[32m+[m[32m        </CardHeader>[m
[32m+[m
[32m+[m[32m        <CardContent className="space-y-6">[m
[32m+[m[32m          <Alert>[m
[32m+[m[32m            <AlertTitle>Dica</AlertTitle>[m
[32m+[m[32m            <AlertDescription>[m
[32m+[m[32m              Desktop: recomendado 1920×1080. Mobile: recomendado 1080×1920.[m
[32m+[m[32m            </AlertDescription>[m
[32m+[m[32m          </Alert>[m
[32m+[m
[32m+[m[32m          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">[m
[32m+[m[32m            <div className="space-y-3">[m
[32m+[m[32m              <Label htmlFor="desktopImage">Imagem (Desktop)</Label>[m
[32m+[m[32m              <Input[m
[32m+[m[32m                id="desktopImage"[m
[32m+[m[32m                type="file"[m
[32m+[m[32m                accept="image/png,image/jpeg,image/jpg,image/webp"[m
[32m+[m[32m                onChange={(e) => setDesktopFile(e.target.files?.[0] ?? null)}[m
[32m+[m[32m              />[m
[32m+[m[32m              <div className="rounded-lg border overflow-hidden bg-muted max-w-[560px]">[m
[32m+[m[32m                <div className="aspect-[16/9] relative">[m
[32m+[m[32m                  <Image[m
[32m+[m[32m                    src={desktopPreview || `${HERO_ASSET_DESKTOP}${data?.updatedAt ? `&t=${encodeURIComponent(data.updatedAt)}` : ''}`}[m
[32m+[m[32m                    alt="Preview desktop"[m
[32m+[m[32m                    fill[m
[32m+[m[32m                    sizes="(max-width: 768px) 100vw, 560px"[m
[32m+[m[32m                    className="object-cover"[m
[32m+[m[32m                    unoptimized[m
[32m+[m[32m                  />[m
[32m+[m[32m                </div>[m
[32m+[m[32m              </div>[m
[32m+[m[32m              <p className="text-xs text-muted-foreground">[m
[32m+[m[32m                {desktopFile ? `Selecionado: ${desktopFile.name}` : 'Preview atual do desktop'}[m
[32m+[m[32m              </p>[m
[32m+[m[32m            </div>[m
[32m+[m
[32m+[m[32m            <div className="space-y-3">[m
[32m+[m[32m              <Label htmlFor="mobileImage">Imagem (Mobile)</Label>[m
[32m+[m[32m              <Input[m
[32m+[m[32m                id="mobileImage"[m
[32m+[m[32m                type="file"[m
[32m+[m[32m                accept="image/png,image/jpeg,image/jpg,image/webp"[m
[32m+[m[32m                onChange={(e) => setMobileFile(e.target.files?.[0] ?? null)}[m
[32m+[m[32m              />[m
[32m+[m[32m              <div className="rounded-lg border overflow-hidden bg-muted max-w-[260px] mx-auto lg:mx-0">[m
[32m+[m[32m                <div className="aspect-[9/16] relative">[m
[32m+[m[32m                  <Image[m
[32m+[m[32m                    src={mobilePreview || `${HERO_ASSET_MOBILE}${data?.updatedAt ? `&t=${encodeURIComponent(data.updatedAt)}` : ''}`}[m
[32m+[m[32m                    alt="Preview mobile"[m
[32m+[m[32m                    fill[m
[32m+[m[32m                    sizes="(max-width: 768px) 100vw, 260px"[m
[32m+[m[32m                    className="object-cover"[m
[32m+[m[32m                    unoptimized[m
[32m+[m[32m                  />[m
[32m+[m[32m                </div>[m
[32m+[m[32m              </div>[m
[32m+[m[32m              <p className="text-xs text-muted-foreground">[m
[32m+[m[32m                {mobileFile ? `Selecionado: ${mobileFile.name}` : 'Preview atual do mobile'}[m
[32m+[m[32m              </p>[m
[32m+[m[32m            </div>[m
[32m+[m[32m          </div>[m
[32m+[m
[32m+[m[32m          <Separator />[m
[32m+[m[32m          <div className="flex items-center justify-between">[m
[32m+[m[32m            <div className="text-sm text-muted-foreground">[m
[32m+[m[32m              {isLoading ? 'Carregando...' : data?.updatedAt ? `Última atualização: ${new Date(data.updatedAt).toLocaleString()}` : 'Sem alterações recentes.'}[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <Button onClick={handleSave} disabled={isSaving || isLoading}>[m
[32m+[m[32m              {isSaving ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : <Save className="mr-2 h-4 w-4" />}[m
[32m+[m[32m              Salvar[m
[32m+[m[32m            </Button>[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </CardContent>[m
[32m+[m
[32m+[m[32m        <CardFooter className="text-xs text-muted-foreground">[m
[32m+[m[32m          {data?.homeHeroDesktopPath || data?.homeHeroMobilePath ? ([m
[32m+[m[32m            <div className="space-y-1">[m
[32m+[m[32m              <div>Desktop: {data?.homeHeroDesktopPath || '(padrão)'}</div>[m
[32m+[m[32m              <div>Mobile: {data?.homeHeroMobilePath || '(padrão)'}</div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m          ) : ([m
[32m+[m[32m            <div>Usando imagem padrão do sistema.</div>[m
[32m+[m[32m          )}[m
[32m+[m[32m        </CardFooter>[m
[32m+[m[32m      </Card>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  );[m
[32m+[m[32m}[m
[1mdiff --git a/src/app/(superadmin)/super-admin/dashboard/barbershops/page.tsx b/src/app/(superadmin)/super-admin/dashboard/barbershops/page.tsx[m
[1mindex d6755dd..5aa7d65 100755[m
[1m--- a/src/app/(superadmin)/super-admin/dashboard/barbershops/page.tsx[m
[1m+++ b/src/app/(superadmin)/super-admin/dashboard/barbershops/page.tsx[m
[36m@@ -1,4 +1,4 @@[m
[31m-[m
[32m+[m[32m﻿[m
 'use client';[m
 [m
 import { useState, useMemo, useEffect, useCallback } from 'react';[m
[36m@@ -43,7 +43,7 @@[m [mimport {[m
 } from "@/components/ui/alert-dialog";[m
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';[m
 import { Badge } from '@/components/ui/badge';[m
[31m-import { MapPin, Mail, Smartphone, Calendar, Edit, Search, ExternalLink, Trash2, AlertCircleIcon, PlusCircle, FilterX, KeyRound, RefreshCw } from 'lucide-react';[m
[32m+[m[32mimport { MapPin, Mail, Smartphone, Calendar, Edit, Search, ExternalLink, Trash2, AlertCircleIcon, FilterX, KeyRound, RefreshCw } from 'lucide-react';[m
 import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';[m
 import { Calendar as CalendarIcon } from 'lucide-react';[m
 import { Calendar as CalendarComponent } from '@/components/ui/calendar';[m
[36m@@ -62,7 +62,7 @@[m [mtype SuperAdminBarbershop = {[m
     ownerId: string;[m
     email: string;[m
     phone: string;[m
[31m-    plan: 'Básico' | 'Premium';[m
[32m+[m[32m    plan: 'Basico' | 'Premium';[m
     status: 'Ativa' | 'Inativa';[m
     expiryDate: string;[m
     registeredDate: string;[m
[36m@@ -80,7 +80,7 @@[m [mtype SuperAdminBarbershop = {[m
 };[m
 [m
 const planPrices = {[m
[31m-    'Básico': 49.90,[m
[32m+[m[32m    'Basico': 49.90,[m
     'Premium': 119.90[m
 };[m
 [m
[36m@@ -91,6 +91,21 @@[m [mexport default function BarbershopsPage() {[m
     const [isLoadingBarbershops, setIsLoadingBarbershops] = useState(true);[m
     const [supportTickets, setSupportTickets] = useState<any[]>([]);[m
     const [isLoadingTickets, setIsLoadingTickets] = useState(true);[m
[32m+[m[32m    const [displayedBarbershops, setDisplayedBarbershops] = useState<SuperAdminBarbershop[]>([]);[m
[32m+[m[32m    const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);[m
[32m+[m[32m    const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);[m
[32m+[m[32m    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);[m
[32m+[m[32m    const [shopToDelete, setShopToDelete] = useState<SuperAdminBarbershop | null>(null);[m
[32m+[m[32m    const [deleteConfirmationInput, setDeleteConfirmationInput] = useState('');[m
[32m+[m[32m    const [isUpdatingAll, setIsUpdatingAll] = useState(false);[m
[32m+[m[32m    const [editingShop, setEditingShop] = useState<SuperAdminBarbershop | null>(null);[m
[32m+[m[32m    const [formState, setFormState] = useState<Partial<SuperAdminBarbershop & { password?: string }>>({});[m
[32m+[m[32m    const [isSubmitting, setIsSubmitting] = useState(false);[m
[32m+[m[32m    const [searchTerm, setSearchTerm] = useState('');[m
[32m+[m[32m    const [filterStatus, setFilterStatus] = useState('all');[m
[32m+[m[32m    const [filterPlan, setFilterPlan] = useState('all');[m
[32m+[m[32m    const [isDeletingInstanceId, setIsDeletingInstanceId] = useState<string | null>(null);[m
[32m+[m[32m    const [isCreatingInstanceId, setIsCreatingInstanceId] = useState<string | null>(null);[m
 [m
     const loadData = useCallback(async () => {[m
         setIsLoadingBarbershops(true);[m
[36m@@ -107,7 +122,7 @@[m [mexport default function BarbershopsPage() {[m
             toast({[m
                 variant: "destructive",[m
                 title: "Erro ao carregar dados",[m
[31m-                description: error.message || "Não foi possível carregar as barbearias.",[m
[32m+[m[32m                description: error.message || "No foi possvel carregar as barbearias.",[m
             });[m
         } finally {[m
             setIsLoadingBarbershops(false);[m
[36m@@ -141,13 +156,13 @@[m [mexport default function BarbershopsPage() {[m
 [m
             return {[m
                 id: shop.id,[m
[31m-                name: shop.name || 'Nome não definido',[m
[32m+[m[32m                name: shop.name || 'Nome no definido',[m
                 legalName: shop.legalName,[m
                 cpfCnpj: shop.cpfCnpj,[m
                 ownerId: shop.ownerId,[m
[31m-                email: shop.email || 'E-mail não informado',[m
[32m+[m[32m                email: shop.email || 'E-mail no informado',[m
                 phone: shop.phone || '(00) 00000-0000',[m
[31m-                plan: shop.plan || 'Básico',[m
[32m+[m[32m                plan: shop.plan || 'Basico',[m
                 status,[m
                 expiryDate: expiryDate ? format(expiryDate, 'dd/MM/yyyy') : 'N/A',[m
                 registeredDate: shop.createdAt ? format(new Date(shop.createdAt), 'dd/MM/yyyy') : 'N/A',[m
[36m@@ -159,24 +174,6 @@[m [mexport default function BarbershopsPage() {[m
     }, [rawBarbershops]);[m
 [m
 [m
[31m-    const [displayedBarbershops, setDisplayedBarbershops] = useState<SuperAdminBarbershop[]>([]);[m
[31m-    const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);[m
[31m-    const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);[m
[31m-    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);[m
[31m-    const [shopToDelete, setShopToDelete] = useState<SuperAdminBarbershop | null>(null);[m
[31m-    const [deleteConfirmationInput, setDeleteConfirmationInput] = useState('');[m
[31m-    const [isUpdatingAll, setIsUpdatingAll] = useState(false);[m
[31m-[m
[31m-    const [editingShop, setEditingShop] = useState<SuperAdminBarbershop | null>(null);[m
[31m-[m
[31m-    const [formState, setFormState] = useState<Partial<SuperAdminBarbershop & {password?: string}>>({});[m
[31m-    [m
[31m-    const [isSubmitting, setIsSubmitting] = useState(false);[m
[31m-[m
[31m-    const [searchTerm, setSearchTerm] = useState('');[m
[31m-    const [filterStatus, setFilterStatus] = useState('all');[m
[31m-    const [filterPlan, setFilterPlan] = useState('all');[m
[31m-[m
     useEffect(() => {[m
         let filtered = allBarbershops;[m
 [m
[36m@@ -224,11 +221,11 @@[m [mexport default function BarbershopsPage() {[m
                   return { ...prev, address: newAddress as SuperAdminBarbershop['address'] };[m
               });[m
             } else {[m
[31m-                throw new Error(data.error || 'CEP não encontrado.');[m
[32m+[m[32m                throw new Error(data.error || 'CEP no encontrado.');[m
             }[m
           } catch (error) {[m
             console.error("Failed to fetch address:", error);[m
[31m-            toast({ variant: "destructive", title: "Erro de CEP", description: "Não foi possível buscar o endereço." });[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro de CEP", description: "No foi possvel buscar o endereo." });[m
           }[m
         }[m
       };[m
[36m@@ -273,17 +270,17 @@[m [mexport default function BarbershopsPage() {[m
 [m
     const confirmDelete = async () => {[m
         if (!shopToDelete) {[m
[31m-            toast({ variant: "destructive", title: "Erro", description: "Nenhuma barbearia selecionada para exclusão." });[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: "Nenhuma barbearia selecionada para excluso." });[m
             return;[m
         }[m
 [m
         try {[m
             await fetchJson(`/api/barbershops/${shopToDelete.id}`, { method: "DELETE" });[m
             setRawBarbershops(prev => prev!.filter(s => s.id !== shopToDelete.id));[m
[31m-            toast({ title: "Barbearia Excluída!", description: `${shopToDelete.name} foi removida do banco de dados.` });[m
[32m+[m[32m            toast({ title: "Barbearia Excluda!", description: `${shopToDelete.name} foi removida do banco de dados.` });[m
         } catch (error: any) {[m
             console.error("Erro ao excluir barbearia:", error);[m
[31m-            toast({ variant: "destructive", title: "Erro ao Excluir", description: error.message || "Não foi possível remover a barbearia do banco de dados." });[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro ao Excluir", description: error.message || "No foi possvel remover a barbearia do banco de dados." });[m
         } finally {[m
             setIsDeleteDialogOpen(false);[m
             setShopToDelete(null);[m
[36m@@ -391,11 +388,7 @@[m [mexport default function BarbershopsPage() {[m
             const updatedShop = response.data;[m
             setRawBarbershops(prev => prev!.map(s => (s.id === updatedShop.id ? updatedShop : s)));[m
 [m
[31m-            if (barbershopDocRef) {[m
[31m-                await updateDoc(barbershopDocRef, updateData as Record<string, any>);[m
[31m-            }[m
[31m-[m
[31m-            toast({ title: "Dados da Barbearia Salvos!", description: "As informações no banco de dados foram atualizadas." });[m
[32m+[m[32m                        toast({ title: "Dados da Barbearia Salvos!", description: "As informaes no banco de dados foram atualizadas." });[m
             if (typeof window !== "undefined") {[m
                 const barbershopUpdatePayload = { ...updatedShop, ownerId: updatedShop.ownerId };[m
                 window.dispatchEvent(new CustomEvent("barbershop-updated", { detail: barbershopUpdatePayload }));[m
[36m@@ -405,7 +398,7 @@[m [mexport default function BarbershopsPage() {[m
                         JSON.stringify({ ...barbershopUpdatePayload, timestamp: Date.now() })[m
                     );[m
                 } catch (error) {[m
[31m-                    console.warn("Não foi possível sincronizar a atualização entre abas:", error);[m
[32m+[m[32m                    console.warn("No foi possvel sincronizar a atualizao entre abas:", error);[m
                 }[m
             }[m
         } catch (error: any) {[m
[36m@@ -413,7 +406,7 @@[m [mexport default function BarbershopsPage() {[m
             toast({[m
                 variant: "destructive",[m
                 title: "Erro ao Salvar",[m
[31m-                description: error.message || "Não foi possível atualizar os dados da barbearia.",[m
[32m+[m[32m                description: error.message || "No foi possvel atualizar os dados da barbearia.",[m
             });[m
         } finally {[m
             setIsEditDialogOpen(false);[m
[36m@@ -423,7 +416,7 @@[m [mexport default function BarbershopsPage() {[m
     [m
     const handleCreate = async () => {[m
         if (!formState.email || !formState.password || !formState.name) {[m
[31m-            toast({ variant: "destructive", title: "Erro", description: "Email, senha e nome da barbearia são obrigatórios." });[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: "Email, senha e nome da barbearia so obrigatrios." });[m
             return;[m
         }[m
         setIsSubmitting(true);[m
[36m@@ -454,7 +447,7 @@[m [mexport default function BarbershopsPage() {[m
                     phone: formState.phone,[m
                     cpfCnpj: formState.cpfCnpj,[m
                     ownerId,[m
[31m-                    plan: formState.plan || "Básico",[m
[32m+[m[32m                    plan: formState.plan || "Basico",[m
                     status: "Ativa",[m
                     expiryDate: trialEndDate.toISOString(),[m
                 }),[m
[36m@@ -469,7 +462,7 @@[m [mexport default function BarbershopsPage() {[m
         } catch (error: any) {[m
             console.error("Erro ao criar barbearia:", error);[m
             const baseDescription = error.message?.includes("in use")[m
[31m-                ? "Este e-mail já está em uso por outro proprietário."[m
[32m+[m[32m                ? "Este e-mail j est em uso por outro proprierio."[m
                 : "Ocorreu um erro ao criar a barbearia.";[m
             toast({ variant: "destructive", title: "Erro no Cadastro", description: baseDescription });[m
         } finally {[m
[36m@@ -485,7 +478,7 @@[m [mexport default function BarbershopsPage() {[m
     [m
     // const handleUpdateAllBarbershops = async () => {[m
     //     // This function is no longer needed with the removal of API keys from the barbershop doc.[m
[31m-    //     toast({ title: "Ação Descontinuada", description: "Esta função não é mais necessária." });[m
[32m+[m[32m    //     toast({ title: "Ao Descontinuada", description: "Esta funo no  mais necessria." });[m
     // };[m
 [m
     const getGoogleMapsLink = (address: Barbershop['address']) => {[m
[36m@@ -511,82 +504,9 @@[m [mexport default function BarbershopsPage() {[m
                             <CardTitle>Gerenciar Barbearias</CardTitle>[m
                             <CardDescription>Visualize e edite todos os dados das barbearias cadastradas ({displayedBarbershops.length} de {allBarbershops.length})</CardDescription>[m
                         </div>[m
[31m-                         <Dialog open={isAddDialogOpen} onOpenChange={(isOpen) => { if (!isOpen) setFormState({}); setIsAddDialogOpen(isOpen); }}>[m
[31m-                            <DialogTrigger asChild>[m
[31m-                                <Button size="sm"><PlusCircle className="mr-2 h-4 w-4" /> Nova Barbearia</Button>[m
[31m-                            </DialogTrigger>[m
[31m-                            <DialogContent className="sm:max-w-3xl">[m
[31m-                                <DialogHeader>[m
[31m-                                    <DialogTitle>Cadastrar Nova Barbearia</DialogTitle>[m
[31m-                                </DialogHeader>[m
[31m-                                <div className="grid gap-4 py-4 max-h-[70vh] overflow-y-auto px-2">[m
[31m-                                    <div className="grid gap-4">[m
[31m-                                         <div className="space-y-2">[m
[31m-                                            <Label htmlFor="add-email">Email do Proprietário</Label>[m
[31m-                                            <Input id="add-email" name="email" type="email" value={formState.email || ''} onChange={(e) => setFormState(prev => ({...prev, email: e.target.value}))} />[m
[31m-                                        </div>[m
[31m-                                         <div className="space-y-2">[m
[31m-                                            <Label htmlFor="add-password">Senha Provisória</Label>[m
[31m-                                            <Input id="add-password" name="password" type="password" value={formState.password || ''} onChange={(e) => setFormState(prev => ({...prev, password: e.target.value}))} />[m
[31m-                                        </div>[m
[31m-                                        <div className="space-y-2">[m
[31m-                                            <Label htmlFor="add-name">Nome da Barbearia</Label>[m
[31m-                                            <Input id="add-name" name="name" value={formState.name || ''} onChange={handleFormChange} />[m
[31m-                                        </div>[m
[31m-                                        <div className="space-y-2">[m
[31m-                                            <Label htmlFor="add-cpfCnpj">CPF/CNPJ</Label>[m
[31m-                                            <Input id="add-cpfCnpj" name="cpfCnpj" value={formState.cpfCnpj || ''} onChange={handleCpfCnpjChange} />[m
[31m-                                        </div>[m
[31m-                                         <div className="space-y-2">[m
[31m-                                            <Label htmlFor="add-legalName">Nome/Empresa (Razão Social)</Label>[m
[31m-                                            <Input id="add-legalName" name="legalName" value={formState.legalName || ''} onChange={handleFormChange} />[m
[31m-                                        </div>[m
[31m-                                        <div className="grid grid-cols-3 gap-4">[m
[31m-                                            <div className="space-y-2 col-span-1">[m
[31m-                                                <Label htmlFor="add-cep">CEP</Label>[m
[31m-                                                <Input id="add-cep" name="cep" value={formState.address?.cep || ''} onChange={handleAddressChange} maxLength={9} />[m
[31m-                                            </div>[m
[31m-                                            <div className="space-y-2 col-span-2">[m
[31m-                                                <Label htmlFor="add-street">Rua</Label>[m
[31m-                                                <Input id="add-street" name="street" value={formState.address?.street || ''} onChange={handleAddressChange} />[m
[31m-                                            </div>[m
[31m-                                        </div>[m
[31m-                                         <div className="grid grid-cols-3 gap-4">[m
[31m-                                            <div className="space-y-2">[m
[31m-                                                <Label htmlFor="add-number">Número</Label>[m
[31m-                                                <Input id="add-number" name="number" value={formState.address?.number || ''} onChange={handleAddressChange} />[m
[31m-                                            </div>[m
[31m-                                            <div className="space-y-2 col-span-2">[m
[31m-                                                <Label htmlFor="add-neighborhood">Bairro</Label>[m
[31m-                                                <Input id="add-neighborhood" name="neighborhood" value={formState.address?.neighborhood || ''} onChange={handleAddressChange} />[m
[31m-                                            </div>[m
[31m-                                        </div>[m
[31m-                                        <div className="grid grid-cols-2 gap-4">[m
[31m-                                            <div className="space-y-2">[m
[31m-                                                <Label htmlFor="add-city">Cidade</Label>[m
[31m-                                                <Input id="add-city" name="city" value={formState.address?.city || ''} onChange={handleAddressChange} />[m
[31m-                                            </div>[m
[31m-                                            <div className="space-y-2">[m
[31m-                                                <Label htmlFor="add-state">Estado (UF)</Label>[m
[31m-                                                <Input id="add-state" name="state" value={formState.address?.state || ''} onChange={handleAddressChange} />[m
[31m-                                            </div>[m
[31m-                                        </div>[m
[31m-                                         <div className="space-y-2">[m
[31m-                                            <Label htmlFor="add-phone">WhatsApp do Proprietário</Label>[m
[31m-                                            <Input id="add-phone" name="phone" value={formState.phone || ''} onChange={handlePhoneChange} maxLength={15} />[m
[31m-                                        </div>[m
[31m-                                    </div>[m
[31m-                                </div>[m
[31m-                                <DialogFooter>[m
[31m-                                    <DialogClose asChild>[m
[31m-                                        <Button variant="outline">Cancelar</Button>[m
[31m-                                    </DialogClose>[m
[31m-                                    <Button onClick={handleCreate} disabled={isSubmitting}>[m
[31m-                                        {isSubmitting ? 'Cadastrando...' : 'Salvar Barbearia'}[m
[31m-                                    </Button>[m
[31m-                                </DialogFooter>[m
[31m-                            </DialogContent>[m
[31m-                        </Dialog>[m
[32m+[m[32m                        <Button size="sm" variant="outline" className="gap-2" onClick={loadData}>[m
[32m+[m[32m                            <RefreshCw className="h-4 w-4" /> Atualizar[m
[32m+[m[32m                        </Button>[m
                     </div>[m
                     <div className="flex flex-wrap items-center gap-4 pt-4">[m
                         <div className="relative flex-grow min-w-[200px]">[m
[36m@@ -609,7 +529,7 @@[m [mexport default function BarbershopsPage() {[m
                             </SelectTrigger>[m
                             <SelectContent>[m
                                 <SelectItem value="all">Todos os Planos</SelectItem>[m
[31m-                                <SelectItem value="Básico">Básico</SelectItem>[m
[32m+[m[32m                                <SelectItem value="Basico">Basico</SelectItem>[m
                                 <SelectItem value="Premium">Premium</SelectItem>[m
                             </SelectContent>[m
                         </Select>[m
[36m@@ -618,88 +538,137 @@[m [mexport default function BarbershopsPage() {[m
                         </div>[m
                     </div>[m
                 </CardHeader>[m
[31m-                <CardContent className="space-y-4">[m
[32m+[m[32m                                <CardContent className="space-y-4">[m
                     {displayedBarbershops.map(shop => ([m
                         <div key={shop.id} className="border border-primary/50 rounded-lg p-4 space-y-4">[m
[31m-                             <div className="flex items-start justify-between">[m
[31m-                                <div className="flex items-start gap-4">[m
[31m-                                    <span className="font-mono text-sm text-muted-foreground pt-1">{shop.ownerId?.substring(0, 6)}...</span>[m
[31m-                                    <div>[m
[31m-                                      <h3 className="font-bold text-lg">{shop.name}</h3>[m
[31m-                                      <p className="text-sm text-muted-foreground">{shop.legalName} - {shop.cpfCnpj}</p>[m
[32m+[m[32m                            <div className="flex items-start justify-between gap-4">[m
[32m+[m[32m                                <div className="space-y-1">[m
[32m+[m[32m                                    <div className="flex items-center gap-2">[m
[32m+[m[32m                                        <h3 className="font-bold text-lg">{shop.name}</h3>[m
[32m+[m[32m                                        <Badge variant="outline" className="text-xs">[m
[32m+[m[32m                                            {shop.plan && shop.plan.toLowerCase().startsWith("b") ? "Basico" : shop.plan}[m
[32m+[m[32m                                        </Badge>[m
[32m+[m[32m                                        <Badge variant={shop.status === "Ativa" ? "default" : "destructive"} className={shop.status === "Ativa" ? "bg-green-500/20 text-green-500 border-green-500/30" : ""}>[m
[32m+[m[32m                                            {shop.status}[m
[32m+[m[32m                                        </Badge>[m
                                     </div>[m
[32m+[m[32m                                    <p className="text-sm text-muted-foreground">{shop.legalName} - {shop.cpfCnpj}</p>[m
[32m+[m[32m                                    <p className="text-sm text-muted-foreground">[m
[32m+[m[32m                                        {shop.phone}{" "}[m
[32m+[m[32m                                        <Button variant="link" size="sm" asChild className="p-0 h-auto text-green-500 hover:text-green-500/90">[m
[32m+[m[32m                                            <Link href={getWhatsAppLink(shop.phone)} target="_blank" rel="noopener noreferrer">[m
[32m+[m[32m                                                WhatsApp[m
[32m+[m[32m                                            </Link>[m
[32m+[m[32m                                        </Button>[m
[32m+[m[32m                                    </p>[m
[32m+[m[32m                                </div>[m
[32m+[m[32m                                <div className="text-right space-y-1">[m
[32m+[m[32m                                    <p className="text-[11px] text-muted-foreground uppercase tracking-wide">Owner ID</p>[m
[32m+[m[32m                                    <p className="font-mono text-sm text-muted-foreground">{shop.ownerId}</p>[m
[32m+[m[32m                                    <p className="text-[11px] text-muted-foreground uppercase tracking-wide">Instancia</p>[m
[32m+[m[32m                                    <Badge variant="outline" className="font-mono text-xs">[m
[32m+[m[32m                                        {shop.bitsafiraInstanceId ?? "Nao conectada"}[m
[32m+[m[32m                                    </Badge>[m
                                 </div>[m
                             </div>[m
[31m-                            <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">[m
[32m+[m
[32m+[m[32m                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">[m
                                 <div className="space-y-3">[m
                                     <div className="flex items-start gap-3">[m
[31m-                                        <MapPin className="h-4 w-4 mt-1 text-muted-foreground"/>[m
[32m+[m[32m                                        <MapPin className="h-4 w-4 mt-1 text-muted-foreground" />[m
                                         <div className="flex-1">[m
[31m-                                            <p className="text-sm font-medium">Endereço</p>[m
[31m-                                            <div className="flex justify-between items-center">[m
[31m-                                                <p className="text-sm text-muted-foreground">{shop.fullAddressString}</p>[m
[31m-                                                <Button variant="link" size="sm" asChild className="p-0 h-auto">[m
[31m-                                                    <Link href={getGoogleMapsLink(shop.address)} target="_blank" rel="noopener noreferrer">[m
[31m-                                                        Ver[m
[31m-                                                    </Link>[m
[31m-                                                </Button>[m
[31m-                                            </div>[m
[32m+[m[32m                                            <p className="text-sm font-medium">Endereco</p>[m
[32m+[m[32m                                            <p className="text-sm text-muted-foreground">{shop.fullAddressString}</p>[m
[32m+[m[32m                                            <Button variant="link" size="sm" asChild className="p-0 h-auto">[m
[32m+[m[32m                                                <Link href={getGoogleMapsLink(shop.address)} target="_blank" rel="noopener noreferrer">[m
[32m+[m[32m                                                    Ver no mapa[m
[32m+[m[32m                                                </Link>[m
[32m+[m[32m                                            </Button>[m
                                         </div>[m
                                     </div>[m
                                     <div className="flex items-start gap-3">[m
[31m-                                        <Mail className="h-4 w-4 mt-1 text-muted-foreground"/>[m
[32m+[m[32m                                        <Mail className="h-4 w-4 mt-1 text-muted-foreground" />[m
                                         <div>[m
[31m-                                            <p className="text-sm font-medium">Email do Proprietário</p>[m
[32m+[m[32m                                            <p className="text-sm font-medium">E-mail do proprietario</p>[m
                                             <p className="text-sm text-muted-foreground">{shop.email}</p>[m
                                         </div>[m
                                     </div>[m
[31m-                                    <div className="flex items-start gap-3">[m
[31m-                                        <Smartphone className="h-4 w-4 mt-1 text-muted-foreground"/>[m
[31m-                                        <div className="flex-1">[m
[31m-                                            <p className="text-sm font-medium">WhatsApp do Proprietário</p>[m
[31m-                                            <div className="flex justify-between items-center">[m
[31m-                                                <p className="text-sm text-muted-foreground">{shop.phone}</p>[m
[31m-                                                <Button variant="link" size="sm" asChild className="p-0 h-auto text-green-500 hover:text-green-500/90">[m
[31m-                                                    <Link href={getWhatsAppLink(shop.phone)} target="_blank" rel="noopener noreferrer">[m
[31m-                                                        WhatsApp[m
[31m-                                                    </Link>[m
[31m-                                                </Button>[m
[31m-                                            </div>[m
[31m-                                        </div>[m
[31m-                                    </div>[m
                                 </div>[m
[32m+[m
                                 <div className="space-y-3">[m
[31m-                                     <div className="flex items-start gap-3">[m
[31m-                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground"/>[m
[32m+[m[32m                                    <div className="flex items-start gap-3">[m
[32m+[m[32m                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground" />[m
                                         <div>[m
                                             <p className="text-sm font-medium">Plano</p>[m
[31m-                                            <div className="flex items-center gap-2">[m
[31m-                                                <p className="text-sm text-muted-foreground font-semibold">[m
[31m-                                                  {shop.plan}[m
[31m-                                                </p>[m
[31m-                                                <Badge variant={shop.status === 'Ativa' ? 'default' : 'destructive'} className={shop.status === 'Ativa' ? 'bg-green-500/20 text-green-500 border-green-500/30' : ''}>{shop.status}</Badge>[m
[31m-                                            </div>[m
[32m+[m[32m                                            <p className="text-sm text-muted-foreground">[m
[32m+[m[32m                                                {shop.plan && shop.plan.toLowerCase().startsWith("b") ? "Basico" : shop.plan}[m
[32m+[m[32m                                            </p>[m
                                         </div>[m
                                     </div>[m
                                     <div className="flex items-start gap-3">[m
[31m-                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground"/>[m
[32m+[m[32m                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground" />[m
                                         <div>[m
                                             <p className="text-sm font-medium">Data de Vencimento</p>[m
                                             <p className="text-sm text-muted-foreground">{shop.expiryDate}</p>[m
                                         </div>[m
                                     </div>[m
                                     <div className="flex items-start gap-3">[m
[31m-                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground"/>[m
[32m+[m[32m                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground" />[m
                                         <div>[m
                                             <p className="text-sm font-medium">Cadastrado em</p>[m
                                             <p className="text-sm text-muted-foreground">{shop.registeredDate}</p>[m
                                         </div>[m
                                     </div>[m
                                 </div>[m
[32m+[m
[32m+[m[32m                                <div className="space-y-3">[m
[32m+[m[32m                                    <div className="flex items-start gap-3">[m
[32m+[m[32m                                        <KeyRound className="h-4 w-4 mt-1 text-muted-foreground" />[m
[32m+[m[32m                                        <div className="flex-1 space-y-2">[m
[32m+[m[32m                                            <div>[m
[32m+[m[32m                                                <p className="text-sm font-medium">Instancia BitSafira</p>[m
[32m+[m[32m                                                {shop.bitsafiraPhone && ([m
[32m+[m[32m                                                    <p className="text-xs text-muted-foreground">Numero: {shop.bitsafiraPhone}</p>[m
[32m+[m[32m                                                )}[m
[32m+[m[32m                                            </div>[m
[32m+[m[32m                                            <div className="flex flex-wrap items-center gap-2">[m
[32m+[m[32m                                                <Badge variant="outline" className="font-mono text-xs">[m
[32m+[m[32m                                                    {shop.bitsafiraInstanceId ?? "Nao conectada"}[m
[32m+[m[32m                                                </Badge>[m
[32m+[m[32m                                            </div>[m
[32m+[m[32m                                            <div className="flex flex-wrap gap-2">[m
[32m+[m[32m                                                {!shop.bitsafiraInstanceId && ([m
[32m+[m[32m                                                    <Button[m
[32m+[m[32m                                                        variant="secondary"[m
[32m+[m[32m                                                        size="sm"[m
[32m+[m[32m                                                        className="h-8"[m
[32m+[m[32m                                                        onClick={() => handleCreateInstance(shop)}[m
[32m+[m[32m                                                        disabled={isCreatingInstanceId === shop.id}[m
[32m+[m[32m                                                    >[m
[32m+[m[32m                                                        {isCreatingInstanceId === shop.id ? "Gerando..." : "Gerar nova instancia"}[m
[32m+[m[32m                                                    </Button>[m
[32m+[m[32m                                                )}[m
[32m+[m[32m                                                {shop.bitsafiraInstanceId && ([m
[32m+[m[32m                                                    <Button[m
[32m+[m[32m                                                        variant="outline"[m
[32m+[m[32m                                                        size="sm"[m
[32m+[m[32m                                                        className="h-8"[m
[32m+[m[32m                                                        onClick={() => handleDeleteInstance(shop)}[m
[32m+[m[32m                                                        disabled={isDeletingInstanceId === shop.id}[m
[32m+[m[32m                                                    >[m
[32m+[m[32m                                                        <Trash2 className="mr-2 h-4 w-4" />[m
[32m+[m[32m                                                        {isDeletingInstanceId === shop.id ? "Removendo..." : "Excluir instancia"}[m
[32m+[m[32m                                                    </Button>[m
[32m+[m[32m                                                )}[m
[32m+[m[32m                                            </div>[m
[32m+[m[32m                                        </div>[m
[32m+[m[32m                                    </div>[m
[32m+[m[32m                                </div>[m
                             </div>[m
[32m+[m
                             <CardFooter className="p-0 pt-4 flex justify-end gap-2">[m
[31m-                                <Button variant="outline" onClick={() => handleEditClick(shop)}><Edit className="mr-2 h-4 w-4"/> Editar</Button>[m
[31m-                                <Button variant="destructive" onClick={() => handleDeleteClick(shop)}><Trash2 className="mr-2 h-4 w-4"/> Excluir</Button>[m
[32m+[m[32m                                <Button variant="outline" onClick={() => handleEditClick(shop)}><Edit className="mr-2 h-4 w-4" /> Editar</Button>[m
[32m+[m[32m                                <Button variant="destructive" onClick={() => handleDeleteClick(shop)}><Trash2 className="mr-2 h-4 w-4" /> Excluir</Button>[m
                             </CardFooter>[m
                         </div>[m
                     ))}[m
[36m@@ -711,7 +680,7 @@[m [mexport default function BarbershopsPage() {[m
                     <DialogHeader>[m
                         <DialogTitle>Editar Barbearia</DialogTitle>[m
                         <DialogDescription>[m
[31m-                            Atualize os dados da barbearia {editingShop?.name} (Código: {editingShop?.ownerId})[m
[32m+[m[32m                            Atualize os dados da barbearia {editingShop?.name} (Cdigo: {editingShop?.ownerId})[m
                         </DialogDescription>[m
                     </DialogHeader>[m
                     <div className="grid gap-4 py-4 max-h-[70vh] overflow-y-auto px-2">[m
[36m@@ -721,7 +690,7 @@[m [mexport default function BarbershopsPage() {[m
                                 <Input id="name" name="name" value={formState.name || ''} onChange={handleFormChange} />[m
                             </div>[m
                             <div className="space-y-2">[m
[31m-                                <Label htmlFor="legalName">Nome/Empresa (Razão Social)</Label>[m
[32m+[m[32m                                <Label htmlFor="legalName">Nome/Empresa (Razo Social)</Label>[m
                                 <Input id="legalName" name="legalName" value={formState.legalName || ''} onChange={handleFormChange} />[m
                             </div>[m
                             <div className="space-y-2">[m
[36m@@ -740,7 +709,7 @@[m [mexport default function BarbershopsPage() {[m
                             </div>[m
                              <div className="grid grid-cols-3 gap-4">[m
                                 <div className="space-y-2">[m
[31m-                                    <Label htmlFor="number">Número</Label>[m
[32m+[m[32m                                    <Label htmlFor="number">Nmero</Label>[m
                                     <Input id="number" name="number" value={formState.address?.number || ''} onChange={handleAddressChange} />[m
                                 </div>[m
                                 <div className="space-y-2 col-span-2">[m
[36m@@ -764,17 +733,17 @@[m [mexport default function BarbershopsPage() {[m
                             </div>[m
                             <div className="grid grid-cols-2 gap-4">[m
                                 <div className="space-y-2">[m
[31m-                                    <Label htmlFor="email">Email do Proprietário</Label>[m
[32m+[m[32m                                    <Label htmlFor="email">Email do Proprietrio</Label>[m
                                     <Input id="email" name="email" type="email" value={formState.email || ''} onChange={handleFormChange} disabled />[m
                                     <div className="flex items-start gap-2 p-2 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-300">[m
                                         <AlertCircleIcon className="h-4 w-4 mt-0.5 shrink-0" />[m
                                         <div className='text-xs'>[m
[31m-                                            <p>A alteração do e-mail de login deve ser feita diretamente no Firebase Console para garantir a segurança.</p>[m
[32m+[m[32m                                            <p>A alterao do e-mail de login deve ser feita diretamente no Firebase Console para garantir a segurana.</p>[m
                                         </div>[m
                                     </div>[m
                                 </div>[m
                                 <div className="space-y-2">[m
[31m-                                    <Label htmlFor="phone">WhatsApp do Proprietário</Label>[m
[32m+[m[32m                                    <Label htmlFor="phone">WhatsApp do Propriio</Label>[m
                                     <Input id="phone" name="phone" value={formState.phone || ''} onChange={handlePhoneChange} maxLength={15} />[m
                                 </div>[m
                             </div>[m
[36m@@ -795,14 +764,14 @@[m [mexport default function BarbershopsPage() {[m
                                     <Label>Plano</Label>[m
                                     <Select [m
                                         value={formState.plan} [m
[31m-                                        onValueChange={(value) => handleSelectChange('plan' as keyof Barbershop, value as 'Básico' | 'Premium')}[m
[32m+[m[32m                                        onValueChange={(value) => handleSelectChange('plan' as keyof Barbershop, value as 'Basico' | 'Premium')}[m
                                         disabled={formState.status === 'Inativa'}[m
                                     >[m
                                         <SelectTrigger>[m
                                             <SelectValue placeholder="Selecione o plano" />[m
                                         </SelectTrigger>[m
                                         <SelectContent>[m
[31m-                                            <SelectItem value="Básico">Básico</SelectItem>[m
[32m+[m[32m                                            <SelectItem value="Basico">Basico</SelectItem>[m
                                             <SelectItem value="Premium">Premium</SelectItem>[m
                                         </SelectContent>[m
                                     </Select>[m
[36m@@ -844,16 +813,16 @@[m [mexport default function BarbershopsPage() {[m
                         <DialogClose asChild>[m
                             <Button variant="outline">Cancelar</Button>[m
                         </DialogClose>[m
[31m-                        <Button onClick={handleSave}>Salvar Alterações</Button>[m
[32m+[m[32m                        <Button onClick={handleSave}>Salvar Alteraes</Button>[m
                     </DialogFooter>[m
                 </DialogContent>[m
             </Dialog>[m
             <AlertDialog open={isDeleteDialogOpen} onOpenChange={(isOpen) => { if (!isOpen) setDeleteConfirmationInput(''); setIsDeleteDialogOpen(isOpen);}}>[m
                 <AlertDialogContent>[m
                     <AlertDialogHeader>[m
[31m-                        <AlertDialogTitle>Você tem certeza absoluta?</AlertDialogTitle>[m
[32m+[m[32m                        <AlertDialogTitle>Voc tem certeza absoluta?</AlertDialogTitle>[m
                         <AlertDialogDescription>[m
[31m-                            Esta ação é <span className="font-bold text-destructive">irreversível</span> e excluirá permanentemente a barbearia <span className='font-bold'>{shopToDelete?.name}</span> do banco de dados, mas o usuário de autenticação permanecerá.[m
[32m+[m[32m                            Esta ao  <span className="font-bold text-destructive">irreversvel</span> e excluir permanentemente a barbearia <span className='font-bold'>{shopToDelete?.name}</span> do banco de dados, mas o usurio de autenticao permanecer.[m
                         </AlertDialogDescription>[m
                         <div className="space-y-2 pt-2">[m
                             <Label htmlFor="delete-confirm">Para confirmar, digite "<span className="font-bold">excluir</span>" abaixo:</Label>[m
[36m@@ -879,3 +848,9 @@[m [mexport default function BarbershopsPage() {[m
         </div>[m
     );[m
 }[m
[41m+[m
[41m+[m
[41m+[m
[41m+[m
[41m+[m
[41m+[m
[1mdiff --git a/src/app/(superadmin)/super-admin/dashboard/tutorials/page.tsx b/src/app/(superadmin)/super-admin/dashboard/tutorials/page.tsx[m
[1mnew file mode 100644[m
[1mindex 0000000..a7cebb1[m
[1m--- /dev/null[m
[1m+++ b/src/app/(superadmin)/super-admin/dashboard/tutorials/page.tsx[m
[36m@@ -0,0 +1,296 @@[m
[32m+[m[32m'use client';[m
[32m+[m
[32m+[m[32mimport { useEffect, useMemo, useState } from 'react';[m
[32m+[m[32mimport { Loader2, Plus, Trash2, Youtube } from 'lucide-react';[m
[32m+[m
[32m+[m[32mimport { Badge } from '@/components/ui/badge';[m
[32m+[m[32mimport { Button } from '@/components/ui/button';[m
[32m+[m[32mimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';[m
[32m+[m[32mimport { Input } from '@/components/ui/input';[m
[32m+[m[32mimport { Label } from '@/components/ui/label';[m
[32m+[m[32mimport { Switch } from '@/components/ui/switch';[m
[32m+[m[32mimport { Textarea } from '@/components/ui/textarea';[m
[32m+[m[32mimport { useToast } from '@/hooks/use-toast';[m
[32m+[m[32mimport { fetchJson } from '@/lib/fetcher';[m
[32m+[m
[32m+[m[32mtype TutorialVideo = {[m
[32m+[m[32m  id: string;[m
[32m+[m[32m  title: string;[m
[32m+[m[32m  description: string | null;[m
[32m+[m[32m  youtubeUrl: string;[m
[32m+[m[32m  youtubeId: string | null;[m
[32m+[m[32m  targetEmail: string | null;[m
[32m+[m[32m  enabled: boolean;[m
[32m+[m[32m  createdAt: string;[m
[32m+[m[32m  updatedAt: string;[m
[32m+[m[32m};[m
[32m+[m
[32m+[m[32mexport default function SuperAdminTutorialsPage() {[m
[32m+[m[32m  const { toast } = useToast();[m
[32m+[m
[32m+[m[32m  const [isLoading, setIsLoading] = useState(true);[m
[32m+[m[32m  const [isSaving, setIsSaving] = useState(false);[m
[32m+[m[32m  const [tutorials, setTutorials] = useState<TutorialVideo[]>([]);[m
[32m+[m
[32m+[m[32m  const [title, setTitle] = useState('');[m
[32m+[m[32m  const [description, setDescription] = useState('');[m
[32m+[m[32m  const [youtubeUrl, setYoutubeUrl] = useState('');[m
[32m+[m[32m  const [targetEmail, setTargetEmail] = useState('');[m
[32m+[m[32m  const [enabled, setEnabled] = useState(true);[m
[32m+[m
[32m+[m[32m  const hasForm = useMemo(() => {[m
[32m+[m[32m    return Boolean(title.trim() || description.trim() || youtubeUrl.trim() || targetEmail.trim());[m
[32m+[m[32m  }, [title, description, youtubeUrl, targetEmail]);[m
[32m+[m
[32m+[m[32m  const loadTutorials = async () => {[m
[32m+[m[32m    try {[m
[32m+[m[32m      const res = await fetchJson<{ data: TutorialVideo[] }>('/api/tutorials');[m
[32m+[m[32m      setTutorials(res.data || []);[m
[32m+[m[32m    } catch (error: any) {[m
[32m+[m[32m      console.error('Erro ao carregar tutoriais:', error);[m
[32m+[m[32m      toast({[m
[32m+[m[32m        variant: 'destructive',[m
[32m+[m[32m        title: 'Erro',[m
[32m+[m[32m        description: error?.message || 'Não foi possível carregar os tutoriais.',[m
[32m+[m[32m      });[m
[32m+[m[32m    }[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  useEffect(() => {[m
[32m+[m[32m    setIsLoading(true);[m
[32m+[m[32m    loadTutorials().finally(() => setIsLoading(false));[m
[32m+[m[32m    // eslint-disable-next-line react-hooks/exhaustive-deps[m
[32m+[m[32m  }, []);[m
[32m+[m
[32m+[m[32m  const resetForm = () => {[m
[32m+[m[32m    setTitle('');[m
[32m+[m[32m    setDescription('');[m
[32m+[m[32m    setYoutubeUrl('');[m
[32m+[m[32m    setTargetEmail('');[m
[32m+[m[32m    setEnabled(true);[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  const handleCreate = async () => {[m
[32m+[m[32m    if (!title.trim()) {[m
[32m+[m[32m      toast({ variant: 'destructive', title: 'Erro', description: 'O título é obrigatório.' });[m
[32m+[m[32m      return;[m
[32m+[m[32m    }[m
[32m+[m[32m    if (!youtubeUrl.trim()) {[m
[32m+[m[32m      toast({ variant: 'destructive', title: 'Erro', description: 'O link do YouTube é obrigatório.' });[m
[32m+[m[32m      return;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    setIsSaving(true);[m
[32m+[m[32m    try {[m
[32m+[m[32m      await fetchJson('/api/tutorials', {[m
[32m+[m[32m        method: 'POST',[m
[32m+[m[32m        headers: { 'Content-Type': 'application/json' },[m
[32m+[m[32m        body: JSON.stringify({[m
[32m+[m[32m          title: title.trim(),[m
[32m+[m[32m          description: description.trim() ? description.trim() : null,[m
[32m+[m[32m          youtubeUrl: youtubeUrl.trim(),[m
[32m+[m[32m          targetEmail: targetEmail.trim() ? targetEmail.trim() : null,[m
[32m+[m[32m          enabled,[m
[32m+[m[32m        }),[m
[32m+[m[32m      });[m
[32m+[m
[32m+[m[32m      toast({[m
[32m+[m[32m        title: 'Tutorial criado!',[m
[32m+[m[32m        description: 'O tutorial foi salvo e já pode aparecer no painel da barbearia.',[m
[32m+[m[32m      });[m
[32m+[m[32m      resetForm();[m
[32m+[m[32m      await loadTutorials();[m
[32m+[m[32m    } catch (error: any) {[m
[32m+[m[32m      console.error('Erro ao criar tutorial:', error);[m
[32m+[m[32m      toast({[m
[32m+[m[32m        variant: 'destructive',[m
[32m+[m[32m        title: 'Erro ao salvar',[m
[32m+[m[32m        description: error?.message || 'Não foi possível criar o tutorial.',[m
[32m+[m[32m      });[m
[32m+[m[32m    } finally {[m
[32m+[m[32m      setIsSaving(false);[m
[32m+[m[32m    }[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  const handleToggleEnabled = async (id: string, nextEnabled: boolean) => {[m
[32m+[m[32m    setTutorials((prev) => prev.map((t) => (t.id === id ? { ...t, enabled: nextEnabled } : t)));[m
[32m+[m[32m    try {[m
[32m+[m[32m      await fetchJson(`/api/tutorials/${id}`, {[m
[32m+[m[32m        method: 'PATCH',[m
[32m+[m[32m        headers: { 'Content-Type': 'application/json' },[m
[32m+[m[32m        body: JSON.stringify({ enabled: nextEnabled }),[m
[32m+[m[32m      });[m
[32m+[m[32m    } catch (error: any) {[m
[32m+[m[32m      console.error('Erro ao atualizar tutorial:', error);[m
[32m+[m[32m      toast({[m
[32m+[m[32m        variant: 'destructive',[m
[32m+[m[32m        title: 'Erro',[m
[32m+[m[32m        description: error?.message || 'Não foi possível atualizar o tutorial.',[m
[32m+[m[32m      });[m
[32m+[m[32m      await loadTutorials();[m
[32m+[m[32m    }[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  const handleDelete = async (id: string) => {[m
[32m+[m[32m    setIsSaving(true);[m
[32m+[m[32m    try {[m
[32m+[m[32m      await fetchJson(`/api/tutorials/${id}`, { method: 'DELETE' });[m
[32m+[m[32m      setTutorials((prev) => prev.filter((t) => t.id !== id));[m
[32m+[m[32m      toast({ title: 'Tutorial removido', description: 'O tutorial foi excluído com sucesso.' });[m
[32m+[m[32m    } catch (error: any) {[m
[32m+[m[32m      console.error('Erro ao excluir tutorial:', error);[m
[32m+[m[32m      toast({[m
[32m+[m[32m        variant: 'destructive',[m
[32m+[m[32m        title: 'Erro',[m
[32m+[m[32m        description: error?.message || 'Não foi possível excluir o tutorial.',[m
[32m+[m[32m      });[m
[32m+[m[32m    } finally {[m
[32m+[m[32m      setIsSaving(false);[m
[32m+[m[32m    }[m
[32m+[m[32m  };[m
[32m+[m
[32m+[m[32m  return ([m
[32m+[m[32m    <div className="flex-1 space-y-6 p-4 md:p-8 pt-6">[m
[32m+[m[32m      <div>[m
[32m+[m[32m        <h2 className="text-3xl font-bold tracking-tight font-headline flex items-center gap-2">[m
[32m+[m[32m          <Youtube className="h-7 w-7 text-primary" />[m
[32m+[m[32m          Tutoriais[m
[32m+[m[32m        </h2>[m
[32m+[m[32m        <p className="text-muted-foreground">[m
[32m+[m[32m          Cadastre links do YouTube. Se informar o e-mail de login da barbearia, o vídeo aparece somente para ela.[m
[32m+[m[32m        </p>[m
[32m+[m[32m      </div>[m
[32m+[m
[32m+[m[32m      <Card>[m
[32m+[m[32m        <CardHeader>[m
[32m+[m[32m          <CardTitle>Novo tutorial</CardTitle>[m
[32m+[m[32m          <CardDescription>Crie um novo vídeo de tutorial para a plataforma.</CardDescription>[m
[32m+[m[32m        </CardHeader>[m
[32m+[m[32m        <CardContent className="grid gap-4">[m
[32m+[m[32m          <div className="grid gap-2">[m
[32m+[m[32m            <Label htmlFor="title">Título</Label>[m
[32m+[m[32m            <Input id="title" value={title} onChange={(e) => setTitle(e.target.value)} placeholder="Ex: Dominando a Agenda" />[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div className="grid gap-2">[m
[32m+[m[32m            <Label htmlFor="youtubeUrl">Link do YouTube</Label>[m
[32m+[m[32m            <Input[m
[32m+[m[32m              id="youtubeUrl"[m
[32m+[m[32m              value={youtubeUrl}[m
[32m+[m[32m              onChange={(e) => setYoutubeUrl(e.target.value)}[m
[32m+[m[32m              placeholder="https://www.youtube.com/watch?v=..."[m
[32m+[m[32m            />[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div className="grid gap-2">[m
[32m+[m[32m            <Label htmlFor="targetEmail">Login (e-mail) da barbearia (opcional)</Label>[m
[32m+[m[32m            <Input[m
[32m+[m[32m              id="targetEmail"[m
[32m+[m[32m              value={targetEmail}[m
[32m+[m[32m              onChange={(e) => setTargetEmail(e.target.value)}[m
[32m+[m[32m              placeholder="Ex: barbearia@email.com"[m
[32m+[m[32m              inputMode="email"[m
[32m+[m[32m              autoComplete="email"[m
[32m+[m[32m            />[m
[32m+[m[32m            <p className="text-sm text-muted-foreground">Se deixar vazio, o tutorial será global (todas as barbearias).</p>[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div className="grid gap-2">[m
[32m+[m[32m            <Label htmlFor="description">Descrição (opcional)</Label>[m
[32m+[m[32m            <Textarea[m
[32m+[m[32m              id="description"[m
[32m+[m[32m              value={description}[m
[32m+[m[32m              onChange={(e) => setDescription(e.target.value)}[m
[32m+[m[32m              placeholder="Escreva uma breve descrição para o vídeo..."[m
[32m+[m[32m              className="min-h-24"[m
[32m+[m[32m            />[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div className="flex items-center justify-between rounded-lg border p-3">[m
[32m+[m[32m            <div className="space-y-0.5">[m
[32m+[m[32m              <div className="text-sm font-medium">Ativo</div>[m
[32m+[m[32m              <div className="text-sm text-muted-foreground">Se desativado, não aparece para a barbearia.</div>[m
[32m+[m[32m            </div>[m
[32m+[m[32m            <Switch checked={enabled} onCheckedChange={setEnabled} />[m
[32m+[m[32m          </div>[m
[32m+[m[32m        </CardContent>[m
[32m+[m[32m        <CardFooter className="flex items-center justify-between">[m
[32m+[m[32m          <Button[m
[32m+[m[32m            variant="outline"[m
[32m+[m[32m            onClick={resetForm}[m
[32m+[m[32m            disabled={!hasForm || isSaving}[m
[32m+[m[32m          >[m
[32m+[m[32m            Limpar[m
[32m+[m[32m          </Button>[m
[32m+[m[32m          <Button onClick={handleCreate} disabled={isSaving || isLoading}>[m
[32m+[m[32m            {isSaving ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : <Plus className="mr-2 h-4 w-4" />}[m
[32m+[m[32m            Salvar tutorial[m
[32m+[m[32m          </Button>[m
[32m+[m[32m        </CardFooter>[m
[32m+[m[32m      </Card>[m
[32m+[m
[32m+[m[32m      <div className="space-y-3">[m
[32m+[m[32m        <div className="flex items-center justify-between">[m
[32m+[m[32m          <h3 className="text-xl font-semibold">Tutoriais cadastrados</h3>[m
[32m+[m[32m          {isLoading ? <Loader2 className="h-4 w-4 animate-spin text-muted-foreground" /> : null}[m
[32m+[m[32m        </div>[m
[32m+[m
[32m+[m[32m        {!isLoading && tutorials.length === 0 ? ([m
[32m+[m[32m          <Card>[m
[32m+[m[32m            <CardContent className="p-6 text-sm text-muted-foreground">Nenhum tutorial cadastrado ainda.</CardContent>[m
[32m+[m[32m          </Card>[m
[32m+[m[32m        ) : null}[m
[32m+[m
[32m+[m[32m        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">[m
[32m+[m[32m          {tutorials.map((t) => ([m
[32m+[m[32m            <Card key={t.id}>[m
[32m+[m[32m              <CardHeader className="space-y-2">[m
[32m+[m[32m                <div className="flex items-start justify-between gap-3">[m
[32m+[m[32m                  <div className="space-y-1">[m
[32m+[m[32m                    <CardTitle className="text-lg">{t.title}</CardTitle>[m
[32m+[m[32m                    {t.description ? <CardDescription>{t.description}</CardDescription> : null}[m
[32m+[m[32m                  </div>[m
[32m+[m[32m                  <Button[m
[32m+[m[32m                    variant="ghost"[m
[32m+[m[32m                    size="icon"[m
[32m+[m[32m                    onClick={() => handleDelete(t.id)}[m
[32m+[m[32m                    disabled={isSaving}[m
[32m+[m[32m                    title="Excluir tutorial"[m
[32m+[m[32m                  >[m
[32m+[m[32m                    <Trash2 className="h-4 w-4 text-destructive" />[m
[32m+[m[32m                  </Button>[m
[32m+[m[32m                </div>[m
[32m+[m
[32m+[m[32m                <div className="flex flex-wrap items-center gap-2">[m
[32m+[m[32m                  <Badge variant="secondary">{t.targetEmail ? `Login: ${t.targetEmail}` : 'Global'}</Badge>[m
[32m+[m[32m                  <Badge variant={t.enabled ? 'default' : 'outline'}>{t.enabled ? 'Ativo' : 'Inativo'}</Badge>[m
[32m+[m[32m                </div>[m
[32m+[m[32m              </CardHeader>[m
[32m+[m[32m              <CardContent className="space-y-3">[m
[32m+[m[32m                <div className="aspect-video overflow-hidden rounded-lg border bg-muted">[m
[32m+[m[32m                  {t.youtubeId ? ([m
[32m+[m[32m                    <iframe[m
[32m+[m[32m                      className="w-full h-full"[m
[32m+[m[32m                      src={`https://www.youtube.com/embed/${t.youtubeId}`}[m
[32m+[m[32m                      title={t.title}[m
[32m+[m[32m                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"[m
[32m+[m[32m                      allowFullScreen[m
[32m+[m[32m                    />[m
[32m+[m[32m                  ) : ([m
[32m+[m[32m                    <div className="h-full w-full flex items-center justify-center text-sm text-muted-foreground">[m
[32m+[m[32m                      Link inválido ou ID não encontrado.[m
[32m+[m[32m                    </div>[m
[32m+[m[32m                  )}[m
[32m+[m[32m                </div>[m
[32m+[m[32m                <div className="flex items-center justify-between rounded-lg border p-3">[m
[32m+[m[32m                  <div className="text-sm">Ativo</div>[m
[32m+[m[32m                  <Switch checked={t.enabled} onCheckedChange={(val) => handleToggleEnabled(t.id, val)} />[m
[32m+[m[32m                </div>[m
[32m+[m[32m              </CardContent>[m
[32m+[m[32m              <CardFooter className="text-xs text-muted-foreground break-all">[m
[32m+[m[32m                {t.youtubeUrl}[m
[32m+[m[32m              </CardFooter>[m
[32m+[m[32m            </Card>[m
[32m+[m[32m          ))}[m
[32m+[m[32m        </div>[m
[32m+[m[32m      </div>[m
[32m+[m[32m    </div>[m
[32m+[m[32m  );[m
[32m+[m[32m}[m
[32m+[m
[1mdiff --git a/src/app/api/appointments/[id]/route.ts b/src/app/api/appointments/[id]/route.ts[m
[1mindex 26be003..210b579 100755[m
[1m--- a/src/app/api/appointments/[id]/route.ts[m
[1m+++ b/src/app/api/appointments/[id]/route.ts[m
[36m@@ -2,12 +2,17 @@[m [mimport { NextResponse } from "next/server";[m
 import { updateAppointment, deleteAppointment } from "@/server/db/repositories/appointments";[m
 import { removeReminderQueueForAppointment, syncReminderQueueForAppointment } from "@/server/reminders/reminder-queue";[m
 [m
[31m-type Params = { params: { id: string } };[m
[32m+[m[32mtype Params = { params: Promise<{ id?: string }> };[m
 [m
 export async function PATCH(req: Request, { params }: Params) {[m
[32m+[m[32m  const { id } = await params;[m
[32m+[m[32m  if (!id) {[m
[32m+[m[32m    return NextResponse.json({ error: "ID do agendamento é obrigatório." }, { status: 400 });[m
[32m+[m[32m  }[m
[32m+[m
   try {[m
     const body = await req.json();[m
[31m-    const data = await updateAppointment(params.id, {[m
[32m+[m[32m    const data = await updateAppointment(id, {[m
       ...body,[m
       startTime: body.startTime ? new Date(body.startTime) : undefined,[m
       endTime: body.endTime ? new Date(body.endTime) : undefined,[m
[36m@@ -25,10 +30,15 @@[m [mexport async function PATCH(req: Request, { params }: Params) {[m
 }[m
 [m
 export async function DELETE(_req: Request, { params }: Params) {[m
[32m+[m[32m  const { id } = await params;[m
[32m+[m[32m  if (!id) {[m
[32m+[m[32m    return NextResponse.json({ error: "ID do agendamento é obrigatório." }, { status: 400 });[m
[32m+[m[32m  }[m
[32m+[m
   try {[m
[31m-    await deleteAppointment(params.id);[m
[32m+[m[32m    await deleteAppointment(id);[m
     try {[m
[31m-      await removeReminderQueueForAppointment(params.id);[m
[32m+[m[32m      await removeReminderQueueForAppointment(id);[m
     } catch (queueError) {[m
       console.warn("Falha ao remover lembrete do agendamento:", queueError);[m
     }[m
[1mdiff --git a/src/app/api/barbershops/[id]/route.ts b/src/app/api/barbershops/[id]/route.ts[m
[1mindex 5bff676..1b25c4e 100755[m
[1m--- a/src/app/api/barbershops/[id]/route.ts[m
[1m+++ b/src/app/api/barbershops/[id]/route.ts[m
[36m@@ -1,26 +1,24 @@[m
[31m-﻿import { NextResponse } from "next/server";[m
[31m-import {[m
[31m-  getBarbershopBySlugOrId,[m
[31m-  updateBarbershop,[m
[31m-  deleteBarbershop,[m
[31m-} from "@/server/db/repositories/barbershops";[m
[32m+[m[32mimport { NextResponse } from "next/server";[m
[32m+[m[32mimport { verifyAccessToken } from "@/lib/jwt";[m
[32m+[m[32mimport { deleteBarbershopFully } from "@/server/services/barbershop-deletion";[m
[32m+[m[32mimport { getBarbershopBySlugOrId, updateBarbershop } from "@/server/db/repositories/barbershops";[m
 [m
[31m-interface Params {[m
[31m-  params: {[m
[31m-    id: string;[m
[31m-  };[m
[31m-}[m
[32m+[m[32mtype Params = {[m
[32m+[m[32m  params: Promise<{[m
[32m+[m[32m    id?: string;[m
[32m+[m[32m  }>;[m
[32m+[m[32m};[m
 [m
 export async function GET(_: Request, { params }: Params) {[m
[31m-  const { id } = params || {};[m
[32m+[m[32m  const { id } = await params;[m
   if (!id) {[m
[31m-    return NextResponse.json({ error: "Barbearia não encontrada" }, { status: 404 });[m
[32m+[m[32m    return NextResponse.json({ error: "Barbearia nao encontrada" }, { status: 404 });[m
   }[m
 [m
   try {[m
     const shop = await getBarbershopBySlugOrId(id);[m
     if (!shop) {[m
[31m-      return NextResponse.json({ error: "Barbearia não encontrada" }, { status: 404 });[m
[32m+[m[32m      return NextResponse.json({ error: "Barbearia nao encontrada" }, { status: 404 });[m
     }[m
     return NextResponse.json({ data: shop });[m
   } catch (error: any) {[m
[36m@@ -30,9 +28,9 @@[m [mexport async function GET(_: Request, { params }: Params) {[m
 }[m
 [m
 export async function PATCH(req: Request, { params }: Params) {[m
[31m-  const { id } = params || {};[m
[32m+[m[32m  const { id } = await params;[m
   if (!id) {[m
[31m-    return NextResponse.json({ error: "Barbearia não encontrada" }, { status: 404 });[m
[32m+[m[32m    return NextResponse.json({ error: "Barbearia nao encontrada" }, { status: 404 });[m
   }[m
   try {[m
     const payload = await req.json();[m
[36m@@ -62,16 +60,16 @@[m [mexport async function PATCH(req: Request, { params }: Params) {[m
   }[m
 }[m
 [m
[31m-export async function DELETE(_: Request, { params }: Params) {[m
[31m-  const { id } = params || {};[m
[32m+[m[32mexport async function DELETE(req: Request, { params }: Params) {[m
[32m+[m[32m  const { id } = await params;[m
   if (!id) {[m
[31m-    return NextResponse.json({ error: "Barbearia não encontrada" }, { status: 404 });[m
[32m+[m[32m    return NextResponse.json({ error: "Barbearia nao encontrada" }, { status: 404 });[m
   }[m
   try {[m
[31m-    await deleteBarbershop(id);[m
[32m+[m[32m    await deleteBarbershopFully(id);[m
     return NextResponse.json({ success: true });[m
   } catch (error: any) {[m
     console.error("DELETE /api/barbershops/[id] error:", error);[m
[31m-    return NextResponse.json({ error: "Erro ao excluir barbearia" }, { status: 500 });[m
[32m+[m[32m    return NextResponse.json({ error: error?.message || "Erro ao excluir barbearia" }, { status: 500 });[m
   }[m
 }[m
[1mdiff --git a/src/app/api/bitsafira/connect/route.ts b/src/app/api/bitsafira/connect/route.ts[m
[1mindex fe3dafc..4b9e120 100755[m
[1m--- a/src/app/api/bitsafira/connect/route.ts[m
[1m+++ b/src/app/api/bitsafira/connect/route.ts[m
[36m@@ -8,6 +8,7 @@[m [mimport {[m
   updateBarbershop,[m
   listBarbershopsByOwner,[m
 } from '@/server/db/repositories/barbershops';[m
[32m+[m[32mimport { getUserById } from '@/server/db/repositories/users';[m
 [m
 export async function POST(request: Request) {[m
   try {[m
[36m@@ -40,8 +41,10 @@[m [mexport async function POST(request: Request) {[m
       process.env.NEXT_PUBLIC_BASE_URL ||[m
       new URL(request.url).origin).replace(/\/$/, "");[m
     const webhookUrl = `${appUrl}/api/webhooks/bitsafira`;[m
[31m-    const instanceDescription = barbershop.email[m
[31m-      ? `${barbershop.name || "BarberFlow"}-${barbershop.email}`[m
[32m+[m[32m    const ownerEmail = barbershop.ownerId ? (await getUserById(barbershop.ownerId))?.email : null;[m
[32m+[m[32m    const loginEmail = barbershop.email || ownerEmail;[m
[32m+[m[32m    const instanceDescription = loginEmail[m
[32m+[m[32m      ? `${barbershop.name || "BarberFlow"}-${loginEmail}`[m
       : `${barbershop.name || "BarberFlow"}-${barbershop.id}`;[m
 [m
     let instanceId = barbershop.bitsafiraInstanceId;[m
[1mdiff --git a/src/app/api/bitsafira/instance/create/route.ts b/src/app/api/bitsafira/instance/create/route.ts[m
[1mindex 9afebe8..2c0cbb5 100755[m
[1m--- a/src/app/api/bitsafira/instance/create/route.ts[m
[1m+++ b/src/app/api/bitsafira/instance/create/route.ts[m
[36m@@ -4,6 +4,7 @@[m [mimport { NextRequest, NextResponse } from "next/server";[m
 import { getBitSafiraApiClient } from "@/lib/bitsafira/api";[m
 import type { CreateInstancePayload, CreateInstanceResponse } from "@/lib/bitsafira/types";[m
 import { getBarbershopById, updateBarbershop } from "@/server/db/repositories/barbershops";[m
[32m+[m[32mimport { getUserById } from "@/server/db/repositories/users";[m
 [m
 export async function POST(request: NextRequest) {[m
   try {[m
[36m@@ -24,8 +25,11 @@[m [mexport async function POST(request: NextRequest) {[m
       );[m
     }[m
 [m
[31m-    const instanceDescription = barbershop.email[m
[31m-      ? `${barbershop.name || "BarberFlow"}-${barbershop.email}`[m
[32m+[m[32m    const ownerEmail = barbershop.ownerId ? (await getUserById(barbershop.ownerId))?.email : null;[m
[32m+[m[32m    const loginEmail = barbershop.email || ownerEmail;[m
[32m+[m
[32m+[m[32m    const instanceDescription = loginEmail[m
[32m+[m[32m      ? `${barbershop.name || "BarberFlow"}-${loginEmail}`[m
       : `${barbershop.name || "BarberFlow"}-${barbershop.id}`;[m
 [m
     const bitSafiraToken = barbershop.bitSafiraToken || process.env.BITSAFIRA_TOKEN;[m
[36m@@ -41,16 +45,35 @@[m [mexport async function POST(request: NextRequest) {[m
       request.nextUrl.origin;[m
     const webhookUrl = `${baseUrl.replace(/\/$/, "")}/api/webhooks/bitsafira`;[m
 [m
[31m-    const createPayload: CreateInstancePayload = {[m
[32m+[m[32m    // 1ª tentativa: id vazio (comportamento usado em /api/bitsafira/connect)[m
[32m+[m[32m    let createPayload: CreateInstancePayload = {[m
[32m+[m[32m      id: "",[m
       descricao: instanceDescription,[m
       urlWebhook: webhookUrl,[m
[32m+[m[32m      token: bitSafiraToken,[m
     };[m
     console.log("Payload para criar instancia:", createPayload);[m
 [m
[31m-    const createResult: CreateInstanceResponse = await bitSafira.createInstance(createPayload);[m
[32m+[m[32m    let createResult: CreateInstanceResponse = await bitSafira.createInstance(createPayload);[m
     console.log("Resultado da criacao da instancia:", createResult);[m
 [m
[31m-    if (createResult.status === 200 && createResult.dados) {[m
[32m+[m[32m    // Fallback: algumas respostas da API retornam 400/406 mesmo com todos campos.[m
[32m+[m[32m    // Tentamos sem o campo id para deixar a BitSafira gerar.[m
[32m+[m[32m    if (createResult.status >= 400) {[m
[32m+[m[32m      const fallbackPayload: CreateInstancePayload = {[m
[32m+[m[32m        descricao: instanceDescription,[m
[32m+[m[32m        urlWebhook: webhookUrl,[m
[32m+[m[32m        token: bitSafiraToken,[m
[32m+[m[32m      };[m
[32m+[m[32m      console.log("Retry criando instancia sem ID fixo:", fallbackPayload);[m
[32m+[m[32m      const retryResult = await bitSafira.createInstance(fallbackPayload);[m
[32m+[m[32m      console.log("Resultado retry criacao instancia:", retryResult);[m
[32m+[m[32m      if (retryResult.status < 400) {[m
[32m+[m[32m        createResult = retryResult;[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if ((createResult.status === 200 || createResult.status === 201) && createResult.dados) {[m
       await updateBarbershop(barbershopId, {[m
         bitsafiraInstanceId: createResult.dados.id,[m
         whatsappStatus: "DISCONNECTED",[m
[36m@@ -64,7 +87,10 @@[m [mexport async function POST(request: NextRequest) {[m
     }[m
 [m
     return NextResponse.json([m
[31m-      { success: false, message: createResult.mensagem || "Falha ao criar instancia BitSafira." },[m
[32m+[m[32m      {[m
[32m+[m[32m        success: false,[m
[32m+[m[32m        message: createResult.mensagem || createResult.message || "Falha ao criar instancia BitSafira.",[m
[32m+[m[32m      },[m
       { status: createResult.status || 500 },[m
     );[m
   } catch (error: any) {[m
[1mdiff --git a/src/app/api/bitsafira/validate/route.ts b/src/app/api/bitsafira/validate/route.ts[m
[1mindex c5e94b8..c0b34a7 100755[m
[1m--- a/src/app/api/bitsafira/validate/route.ts[m
[1m+++ b/src/app/api/bitsafira/validate/route.ts[m
[36m@@ -77,11 +77,14 @@[m [mexport async function POST(request: NextRequest) {[m
       const qrCodeValue = normalizeQrCodeBase64(result.dados.qrCode || result.dados.qr);[m
       const hasStatusChanged = barbershop.whatsappStatus !== normalizedStatus;[m
       const hasQrChanged = (qrCodeValue ?? null) !== (barbershop.qrCodeBase64 ?? null);[m
[32m+[m[32m      const missingInstanceInDb = !barbershop.bitsafiraInstanceId && result.dados.id;[m
 [m
[31m-      if (hasStatusChanged || hasQrChanged) {[m
[32m+[m[32m      if (hasStatusChanged || hasQrChanged || missingInstanceInDb) {[m
         await updateBarbershop(barbershopId, {[m
           whatsappStatus: normalizedStatus,[m
           qrCodeBase64: qrCodeValue ?? null,[m
[32m+[m[32m          bitsafiraInstanceId: result.dados.id ?? barbershop.bitsafiraInstanceId,[m
[32m+[m[32m          bitsafiraInstanceData: result.dados as any,[m
         });[m
       }[m
 [m
[1mdiff --git a/src/app/api/cep/[cep]/route.ts b/src/app/api/cep/[cep]/route.ts[m
[1mindex 2fab62a..5992ec4 100755[m
[1m--- a/src/app/api/cep/[cep]/route.ts[m
[1m+++ b/src/app/api/cep/[cep]/route.ts[m
[36m@@ -1,35 +1,39 @@[m
 [m
[31m-import { NextRequest, NextResponse } from 'next/server';[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
 [m
[31m-export async function GET([m
[31m-  request: NextRequest,[m
[31m-  { params }: { params: { cep: string } }[m
[31m-) {[m
[31m-  const { cep } = params;[m
[32m+[m[32mtype Params = { params: Promise<{ cep?: string }> };[m
 [m
[31m-  if (!cep || !/^\d{8}$/.test(cep)) {[m
[31m-    return NextResponse.json({ error: 'CEP inválido.' }, { status: 400 });[m
[32m+[m[32mexport async function GET(_request: NextRequest, { params }: Params) {[m
[32m+[m[32m  const { cep: cepParam } = await params;[m
[32m+[m[32m  const cep = (cepParam || "").replace(/\D/g, "");[m
[32m+[m
[32m+[m[32m  if (!cep || cep.length !== 8) {[m
[32m+[m[32m    return NextResponse.json({ error: "CEP invalido." }, { status: 400 });[m
   }[m
 [m
   try {[m
     const response = await fetch(`https://brasilapi.com.br/api/cep/v1/${cep}`);[m
 [m
     if (!response.ok) {[m
[31m-        const errorData = await response.json();[m
[31m-        return NextResponse.json({ error: errorData.message || 'Falha ao buscar CEP no serviço BrasilAPI.' }, { status: response.status });[m
[32m+[m[32m      const errorData = await response.json();[m
[32m+[m[32m      return NextResponse.json([m
[32m+[m[32m        { error: errorData.message || "Falha ao buscar CEP no servico BrasilAPI." },[m
[32m+[m[32m        { status: response.status }[m
[32m+[m[32m      );[m
     }[m
 [m
     const data = await response.json();[m
 [m
[31m-    // BrasilAPI retorna um erro no corpo da resposta com status 404, então checamos a existência de `type`.[m
[31m-    if (data.type === 'service_error') {[m
[31m-         return NextResponse.json({ error: data.message || 'CEP não encontrado.' }, { status: 404 });[m
[32m+[m[32m    if (data.type === "service_error") {[m
[32m+[m[32m      return NextResponse.json({ error: data.message || "CEP nao encontrado." }, { status: 404 });[m
     }[m
 [m
     return NextResponse.json(data);[m
[31m-    [m
   } catch (error) {[m
     console.error("Erro no proxy da API de CEP:", error);[m
[31m-    return NextResponse.json({ error: 'Erro interno no servidor ao processar a solicitação de CEP.' }, { status: 500 });[m
[32m+[m[32m    return NextResponse.json([m
[32m+[m[32m      { error: "Erro interno no servidor ao processar a solicitacao de CEP." },[m
[32m+[m[32m      { status: 500 }[m
[32m+[m[32m    );[m
   }[m
 }[m
[1mdiff --git a/src/app/api/delete-barbershop/route.ts b/src/app/api/delete-barbershop/route.ts[m
[1mindex d2e20eb..c9b8d28 100755[m
[1m--- a/src/app/api/delete-barbershop/route.ts[m
[1m+++ b/src/app/api/delete-barbershop/route.ts[m
[36m@@ -1,49 +1,45 @@[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
[32m+[m[32mimport { verifyAccessToken } from "@/lib/jwt";[m
[32m+[m[32mimport { deleteBarbershopFully } from "@/server/services/barbershop-deletion";[m
 [m
[31m-import { NextRequest, NextResponse } from 'next/server';[m
[31m-import { verifyAccessToken } from '@/lib/jwt';[m
[31m-import { deleteBarbershop } from '@/server/db/repositories/barbershops';[m
[32m+[m[32mexport const dynamic = "force-dynamic";[m
 [m
 export async function POST(req: NextRequest) {[m
   try {[m
[31m-    const authorization = req.headers.get('Authorization') ?? '';[m
[31m-    if (!authorization.toLowerCase().startsWith('bearer ')) {[m
[32m+[m[32m    const authorization = req.headers.get("Authorization") ?? "";[m
[32m+[m[32m    if (!authorization.toLowerCase().startsWith("bearer ")) {[m
       return NextResponse.json([m
[31m-        { success: false, message: 'Token de autorização ausente ou mal formatado.' },[m
[32m+[m[32m        { success: false, message: "Token de autorização ausente ou mal formatado." },[m
         { status: 401 }[m
       );[m
     }[m
 [m
     const token = authorization.slice(7).trim();[m
     const payload = verifyAccessToken(token);[m
[31m-    if (!payload || typeof payload === 'string') {[m
[31m-      return NextResponse.json([m
[31m-        { success: false, message: 'Token inválido ou expirado.' },[m
[31m-        { status: 401 }[m
[31m-      );[m
[32m+[m[32m    if (!payload || typeof payload === "string") {[m
[32m+[m[32m      return NextResponse.json({ success: false, message: "Token inválido ou expirado." }, { status: 401 });[m
     }[m
 [m
[31m-    if (payload.role !== 'SUPERADMIN') {[m
[31m-      return NextResponse.json([m
[31m-        { success: false, message: 'Apenas Superadmins podem realizar esta ação.' },[m
[31m-        { status: 403 }[m
[31m-      );[m
[32m+[m[32m    if (payload.role !== "SUPERADMIN") {[m
[32m+[m[32m      return NextResponse.json({ success: false, message: "Apenas Superadmins podem realizar esta ação." }, { status: 403 });[m
     }[m
 [m
[31m-    const { barbershopId } = await req.json();[m
[32m+[m[32m    const { barbershopId, forceBitSafiraFailure } = await req.json();[m
     if (!barbershopId) {[m
[31m-      return NextResponse.json([m
[31m-        { success: false, message: 'O ID da barbearia é obrigatório.' },[m
[31m-        { status: 400 }[m
[31m-      );[m
[32m+[m[32m      return NextResponse.json({ success: false, message: "O ID da barbearia é obrigatório." }, { status: 400 });[m
     }[m
 [m
[31m-    await deleteBarbershop(barbershopId);[m
[32m+[m[32m    await deleteBarbershopFully(String(barbershopId), { forceBitSafiraFailure: Boolean(forceBitSafiraFailure) });[m
     console.log(`Barbearia com ID ${barbershopId} removida pelo Superadmin ${payload.userId}.`);[m
[31m-    return NextResponse.json({ success: true, message: 'Barbearia excluída do banco de dados com sucesso.' });[m
[32m+[m
[32m+[m[32m    return NextResponse.json({[m
[32m+[m[32m      success: true,[m
[32m+[m[32m      message: "Barbearia excluída com sucesso (dados + instância BitSafira, quando existir).",[m
[32m+[m[32m    });[m
   } catch (error: any) {[m
[31m-    console.error('Erro na API de exclusão de barbearia:', error);[m
[32m+[m[32m    console.error("Erro na API de exclusão de barbearia:", error);[m
     return NextResponse.json([m
[31m-      { success: false, message: 'Erro interno do servidor.', error: error.message },[m
[32m+[m[32m      { success: false, message: "Erro interno do servidor.", error: error.message },[m
       { status: 500 }[m
     );[m
   }[m
[1mdiff --git a/src/app/api/site-appearance/home-hero/route.ts b/src/app/api/site-appearance/home-hero/route.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..bc37e6d[m
[1m--- /dev/null[m
[1m+++ b/src/app/api/site-appearance/home-hero/route.ts[m
[36m@@ -0,0 +1,156 @@[m
[32m+[m[32mimport fs from "fs/promises";[m
[32m+[m[32mimport path from "path";[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
[32m+[m
[32m+[m[32mimport { verifyAccessToken } from "@/lib/jwt";[m
[32m+[m[32mimport { isSuperAdminEmail } from "@/lib/super-admin";[m
[32m+[m[32mimport { buildHeroFileName, ensureDir, getExtFromMime, getSiteAssetsDir, safeFileName } from "@/lib/site-assets";[m
[32m+[m[32mimport { getSiteAppearance, upsertSiteAppearance } from "@/server/db/repositories/site-appearance";[m
[32m+[m
[32m+[m[32mexport const dynamic = "force-dynamic";[m
[32m+[m
[32m+[m[32mfunction getAuthPayload(req: Request) {[m
[32m+[m[32m  const authHeader = req.headers.get("Authorization") || "";[m
[32m+[m[32m  const token = authHeader.replace("Bearer ", "").trim();[m
[32m+[m[32m  if (!token) return null;[m
[32m+[m[32m  const payload = verifyAccessToken(token);[m
[32m+[m[32m  if (!payload || typeof payload === "string") return null;[m
[32m+[m[32m  return payload as any;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction requireSuperAdmin(req: Request) {[m
[32m+[m[32m  const payload = getAuthPayload(req);[m
[32m+[m[32m  const email = (payload?.email as string | undefined)?.toLowerCase() ?? null;[m
[32m+[m[32m  const ok = payload?.role === "SUPERADMIN" || (email ? isSuperAdminEmail(email) : false);[m
[32m+[m[32m  return { ok, payload };[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction normalizeVariant(value: unknown): "desktop" | "mobile" | null {[m
[32m+[m[32m  const v = String(value || "").toLowerCase();[m
[32m+[m[32m  if (v === "desktop") return "desktop";[m
[32m+[m[32m  if (v === "mobile") return "mobile";[m
[32m+[m[32m  return null;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32masync function saveUpload(file: File, variant: "desktop" | "mobile") {[m
[32m+[m[32m  const ext = getExtFromMime(file.type);[m
[32m+[m[32m  if (!ext) {[m
[32m+[m[32m    throw new Error("Formato inválido. Envie PNG, JPG ou WEBP.");[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  const size = (file as any)?.size ?? 0;[m
[32m+[m[32m  const maxBytes = 15 * 1024 * 1024;[m
[32m+[m[32m  if (size > maxBytes) {[m
[32m+[m[32m    throw new Error("Imagem muito grande. Máximo: 15MB.");[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  const siteDir = getSiteAssetsDir();[m
[32m+[m[32m  await ensureDir(siteDir);[m
[32m+[m
[32m+[m[32m  const baseName = buildHeroFileName(variant, ext);[m
[32m+[m[32m  const fileName = safeFileName(baseName);[m
[32m+[m[32m  const absPath = path.join(siteDir, fileName);[m
[32m+[m
[32m+[m[32m  const buffer = Buffer.from(await file.arrayBuffer());[m
[32m+[m[32m  await fs.writeFile(absPath, buffer);[m
[32m+[m
[32m+[m[32m  // Store as relative path so we can resolve in any environment[m
[32m+[m[32m  const relativePath = path.posix.join("uploads", "site", fileName);[m
[32m+[m[32m  return relativePath;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32masync function tryDeleteOld(relativePath?: string | null) {[m
[32m+[m[32m  if (!relativePath) return;[m
[32m+[m[32m  const abs = path.join(process.cwd(), relativePath.replace(/\//g, path.sep));[m
[32m+[m[32m  try {[m
[32m+[m[32m    await fs.unlink(abs);[m
[32m+[m[32m  } catch {[m
[32m+[m[32m    // ignore[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function GET(req: NextRequest) {[m
[32m+[m[32m  const { ok } = requireSuperAdmin(req);[m
[32m+[m[32m  if (!ok) return NextResponse.json({ error: "Acesso negado" }, { status: 403 });[m
[32m+[m
[32m+[m[32m  const current = await getSiteAppearance();[m
[32m+[m[32m  return NextResponse.json({[m
[32m+[m[32m    data: {[m
[32m+[m[32m      homeHeroDesktopPath: current?.homeHeroDesktopPath ?? null,[m
[32m+[m[32m      homeHeroMobilePath: current?.homeHeroMobilePath ?? null,[m
[32m+[m[32m      updatedAt: current?.updatedAt?.toISOString?.() ?? null,[m
[32m+[m[32m    },[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function POST(req: NextRequest) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const { ok } = requireSuperAdmin(req);[m
[32m+[m[32m    if (!ok) return NextResponse.json({ error: "Acesso negado" }, { status: 403 });[m
[32m+[m
[32m+[m[32m    const form = await req.formData();[m
[32m+[m
[32m+[m[32m    // Accept either both files, or a single one with a "variant"[m
[32m+[m[32m    const desktopFile = form.get("desktop");[m
[32m+[m[32m    const mobileFile = form.get("mobile");[m
[32m+[m[32m    const singleFile = form.get("file");[m
[32m+[m[32m    const variant = normalizeVariant(form.get("variant"));[m
[32m+[m
[32m+[m[32m    const current = await getSiteAppearance();[m
[32m+[m[32m    let nextDesktopPath = current?.homeHeroDesktopPath ?? null;[m
[32m+[m[32m    let nextMobilePath = current?.homeHeroMobilePath ?? null;[m
[32m+[m
[32m+[m[32m    if (desktopFile && desktopFile instanceof File) {[m
[32m+[m[32m      const saved = await saveUpload(desktopFile, "desktop");[m
[32m+[m[32m      await tryDeleteOld(current?.homeHeroDesktopPath);[m
[32m+[m[32m      nextDesktopPath = saved;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if (mobileFile && mobileFile instanceof File) {[m
[32m+[m[32m      const saved = await saveUpload(mobileFile, "mobile");[m
[32m+[m[32m      await tryDeleteOld(current?.homeHeroMobilePath);[m
[32m+[m[32m      nextMobilePath = saved;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if (singleFile && singleFile instanceof File) {[m
[32m+[m[32m      if (!variant) {[m
[32m+[m[32m        return NextResponse.json({ error: "Informe o variant: desktop ou mobile." }, { status: 400 });[m
[32m+[m[32m      }[m
[32m+[m[32m      const saved = await saveUpload(singleFile, variant);[m
[32m+[m[32m      if (variant === "desktop") {[m
[32m+[m[32m        await tryDeleteOld(current?.homeHeroDesktopPath);[m
[32m+[m[32m        nextDesktopPath = saved;[m
[32m+[m[32m      } else {[m
[32m+[m[32m        await tryDeleteOld(current?.homeHeroMobilePath);[m
[32m+[m[32m        nextMobilePath = saved;[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if ([m
[32m+[m[32m      !(desktopFile instanceof File) &&[m
[32m+[m[32m      !(mobileFile instanceof File) &&[m
[32m+[m[32m      !(singleFile instanceof File)[m
[32m+[m[32m    ) {[m
[32m+[m[32m      return NextResponse.json([m
[32m+[m[32m        { error: "Envie pelo menos uma imagem (desktop e/ou mobile)." },[m
[32m+[m[32m        { status: 400 },[m
[32m+[m[32m      );[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    const updated = await upsertSiteAppearance({[m
[32m+[m[32m      homeHeroDesktopPath: nextDesktopPath,[m
[32m+[m[32m      homeHeroMobilePath: nextMobilePath,[m
[32m+[m[32m    });[m
[32m+[m
[32m+[m[32m    return NextResponse.json({[m
[32m+[m[32m      data: {[m
[32m+[m[32m        homeHeroDesktopPath: updated.homeHeroDesktopPath ?? null,[m
[32m+[m[32m        homeHeroMobilePath: updated.homeHeroMobilePath ?? null,[m
[32m+[m[32m        updatedAt: updated.updatedAt.toISOString(),[m
[32m+[m[32m      },[m
[32m+[m[32m    });[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    console.error("POST /api/site-appearance/home-hero error:", error);[m
[32m+[m[32m    return NextResponse.json({ error: error?.message || "Erro ao salvar imagem" }, { status: 500 });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[1mdiff --git a/src/app/api/site-assets/home-hero/route.ts b/src/app/api/site-assets/home-hero/route.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..8e5c6bf[m
[1m--- /dev/null[m
[1m+++ b/src/app/api/site-assets/home-hero/route.ts[m
[36m@@ -0,0 +1,60 @@[m
[32m+[m[32mimport fs from "fs/promises";[m
[32m+[m[32mimport path from "path";[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
[32m+[m
[32m+[m[32mimport { getMimeFromExt } from "@/lib/site-assets";[m
[32m+[m[32mimport { getSiteAppearance } from "@/server/db/repositories/site-appearance";[m
[32m+[m
[32m+[m[32mexport const dynamic = "force-dynamic";[m
[32m+[m
[32m+[m[32mfunction pickVariant(req: NextRequest): "desktop" | "mobile" {[m
[32m+[m[32m  const v = (req.nextUrl.searchParams.get("variant") || "desktop").toLowerCase();[m
[32m+[m[32m  return v === "mobile" ? "mobile" : "desktop";[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32masync function readFallbackSvg() {[m
[32m+[m[32m  const abs = path.join(process.cwd(), "public", "hero.svg");[m
[32m+[m[32m  const data = await fs.readFile(abs);[m
[32m+[m[32m  return { data, contentType: "image/svg+xml" };[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32masync function readFileFromRelative(relativePath: string) {[m
[32m+[m[32m  const normalized = relativePath.replace(/\\/g, "/").replace(/^\/+/, "");[m
[32m+[m[32m  const abs = path.join(process.cwd(), normalized.split("/").join(path.sep));[m
[32m+[m[32m  const data = await fs.readFile(abs);[m
[32m+[m[32m  const ext = path.extname(abs).replace(".", "").toLowerCase();[m
[32m+[m[32m  return { data, contentType: getMimeFromExt(ext) };[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function GET(req: NextRequest) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const variant = pickVariant(req);[m
[32m+[m[32m    const appearance = await getSiteAppearance();[m
[32m+[m[32m    const relativePath = variant === "mobile" ? appearance?.homeHeroMobilePath : appearance?.homeHeroDesktopPath;[m
[32m+[m
[32m+[m[32m    let result: { data: Buffer; contentType: string };[m
[32m+[m[32m    if (relativePath) {[m
[32m+[m[32m      result = await readFileFromRelative(relativePath);[m
[32m+[m[32m    } else {[m
[32m+[m[32m      result = await readFallbackSvg();[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    return new NextResponse(result.data, {[m
[32m+[m[32m      status: 200,[m
[32m+[m[32m      headers: {[m
[32m+[m[32m        "Content-Type": result.contentType,[m
[32m+[m[32m        "Cache-Control": "no-store",[m
[32m+[m[32m      },[m
[32m+[m[32m    });[m
[32m+[m[32m  } catch (error) {[m
[32m+[m[32m    // If something went wrong, fallback to bundled SVG[m
[32m+[m[32m    const fallback = await readFallbackSvg();[m
[32m+[m[32m    return new NextResponse(fallback.data, {[m
[32m+[m[32m      status: 200,[m
[32m+[m[32m      headers: {[m
[32m+[m[32m        "Content-Type": fallback.contentType,[m
[32m+[m[32m        "Cache-Control": "no-store",[m
[32m+[m[32m      },[m
[32m+[m[32m    });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[1mdiff --git a/src/app/api/super-admin/barbershops/[id]/bitsafira-instance/route.ts b/src/app/api/super-admin/barbershops/[id]/bitsafira-instance/route.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..3af4a6f[m
[1m--- /dev/null[m
[1m+++ b/src/app/api/super-admin/barbershops/[id]/bitsafira-instance/route.ts[m
[36m@@ -0,0 +1,36 @@[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
[32m+[m
[32m+[m[32mimport { verifyAccessToken } from "@/lib/jwt";[m
[32m+[m[32mimport { deleteBitSafiraInstanceForBarbershop } from "@/server/services/barbershop-deletion";[m
[32m+[m
[32m+[m[32mexport const dynamic = "force-dynamic";[m
[32m+[m
[32m+[m[32mfunction requireSuperAdmin(req: Request) {[m
[32m+[m[32m  const authHeader = req.headers.get("Authorization") || "";[m
[32m+[m[32m  const token = authHeader.replace("Bearer ", "").trim();[m
[32m+[m[32m  if (!token) return { ok: false as const, error: "Token ausente." };[m
[32m+[m
[32m+[m[32m  const payload = verifyAccessToken(token);[m
[32m+[m[32m  if (!payload || typeof payload === "string") return { ok: false as const, error: "Token inválido ou expirado." };[m
[32m+[m[32m  if ((payload as any).role !== "SUPERADMIN") return { ok: false as const, error: "Acesso negado." };[m
[32m+[m
[32m+[m[32m  return { ok: true as const };[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mtype Params = { params: Promise<{ id?: string }> };[m
[32m+[m
[32m+[m[32mexport async function DELETE(req: NextRequest, { params }: Params) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const auth = requireSuperAdmin(req);[m
[32m+[m[32m    if (!auth.ok) return NextResponse.json({ error: auth.error }, { status: 403 });[m
[32m+[m
[32m+[m[32m    const { id } = await params;[m
[32m+[m[32m    if (!id) return NextResponse.json({ error: "ID da barbearia é obrigatório." }, { status: 400 });[m
[32m+[m
[32m+[m[32m    const result = await deleteBitSafiraInstanceForBarbershop(id);[m
[32m+[m[32m    return NextResponse.json({ success: true, data: result });[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    console.error("DELETE /api/super-admin/barbershops/[id]/bitsafira-instance error:", error);[m
[32m+[m[32m    return NextResponse.json({ error: error?.message || "Erro ao excluir instância." }, { status: 500 });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[1mdiff --git a/src/app/api/tutorials/[id]/route.ts b/src/app/api/tutorials/[id]/route.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..7f630d4[m
[1m--- /dev/null[m
[1m+++ b/src/app/api/tutorials/[id]/route.ts[m
[36m@@ -0,0 +1,65 @@[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
[32m+[m[32mimport { verifyAccessToken } from "@/lib/jwt";[m
[32m+[m[32mimport { isSuperAdminEmail } from "@/lib/super-admin";[m
[32m+[m[32mimport { extractYoutubeId, updateTutorialVideo, deleteTutorialVideo } from "@/server/db/repositories/tutorials";[m
[32m+[m
[32m+[m[32mexport const dynamic = "force-dynamic";[m
[32m+[m
[32m+[m[32mfunction getAuthPayload(req: Request) {[m
[32m+[m[32m  const authHeader = req.headers.get("Authorization") || "";[m
[32m+[m[32m  const token = authHeader.replace("Bearer ", "").trim();[m
[32m+[m[32m  if (!token) return null;[m
[32m+[m[32m  const payload = verifyAccessToken(token);[m
[32m+[m[32m  if (!payload || typeof payload === "string") return null;[m
[32m+[m[32m  return payload as any;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction requireSuperAdmin(req: Request) {[m
[32m+[m[32m  const payload = getAuthPayload(req);[m
[32m+[m[32m  const email = (payload?.email as string | undefined)?.toLowerCase() ?? null;[m
[32m+[m[32m  const ok = payload?.role === "SUPERADMIN" || (email ? isSuperAdminEmail(email) : false);[m
[32m+[m[32m  return { ok, payload };[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function PATCH(req: NextRequest, { params }: { params: { id: string } }) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const { ok } = requireSuperAdmin(req);[m
[32m+[m[32m    if (!ok) return NextResponse.json({ error: "Acesso negado" }, { status: 403 });[m
[32m+[m
[32m+[m[32m    const body = await req.json();[m
[32m+[m[32m    const title = body?.title != null ? String(body.title).trim() : undefined;[m
[32m+[m[32m    const description = body?.description != null ? String(body.description) : undefined;[m
[32m+[m[32m    const youtubeUrl = body?.youtubeUrl != null ? String(body.youtubeUrl).trim() : undefined;[m
[32m+[m[32m    const targetEmail = body?.targetEmail != null ? String(body.targetEmail).trim().toLowerCase() : undefined;[m
[32m+[m[32m    const enabled = body?.enabled === undefined ? undefined : Boolean(body.enabled);[m
[32m+[m
[32m+[m[32m    const youtubeId = youtubeUrl ? extractYoutubeId(youtubeUrl) : undefined;[m
[32m+[m[32m    const updated = await updateTutorialVideo(params.id, {[m
[32m+[m[32m      title,[m
[32m+[m[32m      description,[m
[32m+[m[32m      youtubeUrl,[m
[32m+[m[32m      youtubeId,[m
[32m+[m[32m      targetEmail,[m
[32m+[m[32m      enabled,[m
[32m+[m[32m    });[m
[32m+[m
[32m+[m[32m    return NextResponse.json({ data: updated });[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    console.error("PATCH /api/tutorials/[id] error:", error);[m
[32m+[m[32m    return NextResponse.json({ error: error?.message || "Erro ao atualizar tutorial" }, { status: 500 });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function DELETE(req: NextRequest, { params }: { params: { id: string } }) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const { ok } = requireSuperAdmin(req);[m
[32m+[m[32m    if (!ok) return NextResponse.json({ error: "Acesso negado" }, { status: 403 });[m
[32m+[m
[32m+[m[32m    await deleteTutorialVideo(params.id);[m
[32m+[m[32m    return NextResponse.json({ success: true });[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    console.error("DELETE /api/tutorials/[id] error:", error);[m
[32m+[m[32m    return NextResponse.json({ error: error?.message || "Erro ao excluir tutorial" }, { status: 500 });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[1mdiff --git a/src/app/api/tutorials/route.ts b/src/app/api/tutorials/route.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..edc6d9b[m
[1m--- /dev/null[m
[1m+++ b/src/app/api/tutorials/route.ts[m
[36m@@ -0,0 +1,75 @@[m
[32m+[m[32mimport { NextRequest, NextResponse } from "next/server";[m
[32m+[m[32mimport { verifyAccessToken } from "@/lib/jwt";[m
[32m+[m[32mimport { isSuperAdminEmail } from "@/lib/super-admin";[m
[32m+[m[32mimport {[m
[32m+[m[32m  createTutorialVideo,[m
[32m+[m[32m  extractYoutubeId,[m
[32m+[m[32m  listAllTutorialVideos,[m
[32m+[m[32m  listTutorialVideosForEmail,[m
[32m+[m[32m} from "@/server/db/repositories/tutorials";[m
[32m+[m
[32m+[m[32mexport const dynamic = "force-dynamic";[m
[32m+[m
[32m+[m[32mfunction getTokenFromRequest(req: Request) {[m
[32m+[m[32m  const authHeader = req.headers.get("Authorization") || "";[m
[32m+[m[32m  return authHeader.replace("Bearer ", "").trim();[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction getAuthPayload(req: Request) {[m
[32m+[m[32m  const token = getTokenFromRequest(req);[m
[32m+[m[32m  if (!token) return null;[m
[32m+[m[32m  const payload = verifyAccessToken(token);[m
[32m+[m[32m  if (!payload || typeof payload === "string") return null;[m
[32m+[m[32m  return payload as any;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function GET(req: NextRequest) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const payload = getAuthPayload(req);[m
[32m+[m[32m    const email = (payload?.email as string | undefined)?.toLowerCase() ?? null;[m
[32m+[m[32m    const isSuperAdmin = payload?.role === "SUPERADMIN" || (email ? isSuperAdminEmail(email) : false);[m
[32m+[m
[32m+[m[32m    const data = isSuperAdmin ? await listAllTutorialVideos() : await listTutorialVideosForEmail(email);[m
[32m+[m[32m    return NextResponse.json({ data });[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    console.error("GET /api/tutorials error:", error);[m
[32m+[m[32m    return NextResponse.json({ error: "Erro ao listar tutoriais" }, { status: 500 });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function POST(req: NextRequest) {[m
[32m+[m[32m  try {[m
[32m+[m[32m    const payload = getAuthPayload(req);[m
[32m+[m[32m    const email = (payload?.email as string | undefined)?.toLowerCase() ?? null;[m
[32m+[m[32m    const isSuperAdmin = payload?.role === "SUPERADMIN" || (email ? isSuperAdminEmail(email) : false);[m
[32m+[m[32m    if (!isSuperAdmin) {[m
[32m+[m[32m      return NextResponse.json({ error: "Acesso negado" }, { status: 403 });[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    const body = await req.json();[m
[32m+[m[32m    const title = String(body?.title || "").trim();[m
[32m+[m[32m    const description = body?.description != null ? String(body.description) : null;[m
[32m+[m[32m    const youtubeUrl = String(body?.youtubeUrl || "").trim();[m
[32m+[m[32m    const targetEmail = body?.targetEmail != null ? String(body.targetEmail).trim().toLowerCase() : null;[m
[32m+[m[32m    const enabled = body?.enabled === undefined ? true : Boolean(body.enabled);[m
[32m+[m
[32m+[m[32m    if (!title) return NextResponse.json({ error: "Título é obrigatório." }, { status: 400 });[m
[32m+[m[32m    if (!youtubeUrl) return NextResponse.json({ error: "Link do YouTube é obrigatório." }, { status: 400 });[m
[32m+[m
[32m+[m[32m    const youtubeId = extractYoutubeId(youtubeUrl);[m
[32m+[m[32m    const created = await createTutorialVideo({[m
[32m+[m[32m      title,[m
[32m+[m[32m      description,[m
[32m+[m[32m      youtubeUrl,[m
[32m+[m[32m      youtubeId,[m
[32m+[m[32m      targetEmail,[m
[32m+[m[32m      enabled,[m
[32m+[m[32m    });[m
[32m+[m
[32m+[m[32m    return NextResponse.json({ data: created }, { status: 201 });[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    console.error("POST /api/tutorials error:", error);[m
[32m+[m[32m    return NextResponse.json({ error: error?.message || "Erro ao criar tutorial" }, { status: 500 });[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[1mdiff --git a/src/app/auth/admin/login/page.tsx b/src/app/auth/admin/login/page.tsx[m
[1mindex 5b9bb81..2ca194e 100755[m
[1m--- a/src/app/auth/admin/login/page.tsx[m
[1m+++ b/src/app/auth/admin/login/page.tsx[m
[36m@@ -124,9 +124,13 @@[m [mconst checkSubscriptionAndLogin = async (user: AuthUser) => {[m
         }[m
 [m
         const expiryDate = barbershopData.expiryDate ? new Date(barbershopData.expiryDate) : null;[m
[31m-        const isExpired = expiryDate ? isBefore(expiryDate, startOfDay(new Date())) : false;[m
[32m+[m[32m        const today = startOfDay(new Date());[m
[32m+[m[32m        // compara apenas a data (ignora timezone) para evitar falsos positivos[m
[32m+[m[32m        const isExpired = expiryDate ? isBefore(startOfDay(expiryDate), today) : false;[m
[32m+[m[32m        // se houver data futura, consideramos ativo mesmo que o status salvo esteja "Inativa"[m
[32m+[m[32m        const isInactive = isExpired || barbershopData.status === "Inativa";[m
 [m
[31m-        if (barbershopData.status === "Inativa" || isExpired) {[m
[32m+[m[32m        if (isInactive) {[m
             setInactiveBarbershop(barbershopData);[m
             setIsSubscriptionModalOpen(true);[m
             await signOut();[m
[36m@@ -184,16 +188,32 @@[m [mconst onSubmit = async (values: FormData) => {[m
               name="password"[m
               render={({ field }) => ([m
                 <FormItem>[m
[31m-                  <FormLabel>Senha</FormLabel>[m
                   <FormControl>[m
                     <div className="relative">[m
[31m-                      <Input type={showPassword ? 'text' : 'password'} placeholder="••••••••" {...field} />[m
[31m-                      <Button type="button" variant="ghost" size="icon" className="absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7" onClick={() => setShowPassword(prev => !prev)}>[m
[31m-                          {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}[m
[32m+[m[32m                      <Input[m
[32m+[m[32m                        type={showPassword ? "text" : "password"}[m
[32m+[m[32m                        placeholder="********"[m
[32m+[m[32m                        {...field}[m
[32m+[m[32m                      />[m
[32m+[m[32m                      <Button[m
[32m+[m[32m                        type="button"[m
[32m+[m[32m                        variant="ghost"[m
[32m+[m[32m                        size="icon"[m
[32m+[m[32m                        className="absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7"[m
[32m+[m[32m                        onClick={() => setShowPassword((prev) => !prev)}[m
[32m+[m[32m                        suppressHydrationWarning[m
[32m+[m[32m                        aria-label={showPassword ? "Ocultar senha" : "Mostrar senha"}[m
[32m+[m[32m                      >[m
[32m+[m[32m                        <span suppressHydrationWarning>[m
[32m+[m[32m                          {showPassword ? ([m
[32m+[m[32m                            <EyeOff className="h-4 w-4" suppressHydrationWarning />[m
[32m+[m[32m                          ) : ([m
[32m+[m[32m                            <Eye className="h-4 w-4" suppressHydrationWarning />[m
[32m+[m[32m                          )}[m
[32m+[m[32m                        </span>[m
                       </Button>[m
                     </div>[m
                   </FormControl>[m
[31m-                  <FormMessage />[m
                 </FormItem>[m
               )}[m
             />[m
[1mdiff --git a/src/app/auth/admin/register/page.tsx b/src/app/auth/admin/register/page.tsx[m
[1mindex cc64b7c..b5b5b39 100755[m
[1m--- a/src/app/auth/admin/register/page.tsx[m
[1m+++ b/src/app/auth/admin/register/page.tsx[m
[36m@@ -1,4 +1,4 @@[m
[31m-[m
[32m+[m[32m﻿[m
 "use client";[m
 [m
 import Link from "next/link";[m
[36m@@ -6,7 +6,7 @@[m [mimport { useRouter } from "next/navigation";[m
 import { useForm } from "react-hook-form";[m
 import { zodResolver } from "@hookform/resolvers/zod";[m
 import { z } from "zod";[m
[31m-import { useEffect, useState } from "react";[m
[32m+[m[32mimport { useEffect, useState, type ReactNode } from "react";[m
 import { capitalizeWords, formatCurrency, cn } from "@/lib/utils";[m
 import { useAuth } from "@/context/AuthContext";[m
 import { useToast } from "@/hooks/use-toast";[m
[36m@@ -257,11 +257,23 @@[m [mconst handleCreateBarbershop = async () => {[m
 [m
     } catch (error: any) {[m
         console.error("Erro no cadastro:", error);[m
[31m-        let description = "Ocorreu um erro ao tentar se cadastrar. Tente novamente.";[m
[32m+[m[32m        let description: ReactNode = "Ocorreu um erro ao tentar se cadastrar. Tente novamente.";[m
         if (error.message?.includes("E-mail")) {[m
[31m-            description = "Este e-mail já está em uso. Tente fazer login ou use um e-mail diferente.";[m
[31m-        } else if (error.message?.includes("CPF/CNPJ")) {[m
[31m-            description = "Este CPF/CNPJ já está cadastrado em outra barbearia.";[m
[32m+[m[32m            description = "Este e-mail ja esta em uso. Tente fazer login ou use um e-mail diferente.";[m
[32m+[m[32m        } else if (error.message?.toLowerCase().includes("cpf/cnpj")) {[m
[32m+[m[32m            description = ([m
[32m+[m[32m                <div className="space-y-1">[m
[32m+[m[32m                    <p>CPF/CNPJ ja cadastrado, se nao foi voce, entre em contato com o suporte.</p>[m
[32m+[m[32m                    <a[m
[32m+[m[32m                        className="text-primary underline font-medium"[m
[32m+[m[32m                        target="_blank"[m
[32m+[m[32m                        rel="noopener noreferrer"[m
[32m+[m[32m                        href="https://wa.me/5531994371680?text=Preciso%20de%20ajuda%20com%20meu%20cadastro"[m
[32m+[m[32m                    >[m
[32m+[m[32m                        Falar no WhatsApp (+55 31 9 9437-1680)[m
[32m+[m[32m                    </a>[m
[32m+[m[32m                </div>[m
[32m+[m[32m            );[m
         }[m
         toast({[m
             variant: "destructive",[m
[1mdiff --git a/src/app/auth/login/page.tsx b/src/app/auth/login/page.tsx[m
[1mindex fc07ac4..f5c1365 100755[m
[1m--- a/src/app/auth/login/page.tsx[m
[1m+++ b/src/app/auth/login/page.tsx[m
[36m@@ -18,7 +18,7 @@[m [mexport default function LoginPage() {[m
 [m
       <div className="text-center mb-10">[m
         <div className="inline-flex items-center justify-center h-16 w-16 rounded-full bg-primary/10 border-2 border-primary/30 mb-6">[m
[31m-            <Scissors className="h-8 w-8 text-primary" />[m
[32m+[m[32m            <Scissors className="h-8 w-8 text-primary" suppressHydrationWarning />[m
         </div>[m
         <h1 className="text-3xl font-headline font-bold mb-2">[m
           Bem-vindo de volta ao{" "}[m
[1mdiff --git a/src/app/page.tsx b/src/app/page.tsx[m
[1mindex f0d1bf9..34d5dcb 100755[m
[1m--- a/src/app/page.tsx[m
[1m+++ b/src/app/page.tsx[m
[36m@@ -1,8 +1,8 @@[m
 import * as React from "react";[m
 import type { Metadata } from "next";[m
 import Script from "next/script";[m
[31m-import Image from "next/image";[m
 import Link from "next/link";[m
[32m+[m[32mimport Image from "next/image";[m
 import { PlaceHolderImages } from "@/lib/placeholder-images";[m
 import { Header } from "@/components/layout/header";[m
 import { Footer } from "@/components/layout/footer";[m
[36m@@ -196,12 +196,30 @@[m [mexport default function Home() {[m
       />[m
       <main className="flex-1">[m
         <section className="relative isolate overflow-hidden bg-gray-900 py-24 sm:py-32">[m
[31m-          <Image[m
[31m-            src="https://firebasestorage.googleapis.com/v0/b/studio-201065062-ef553.firebasestorage.app/o/Gemini_Generated_Image_rii7etrii7etrii7.png?alt=media&token=4fbed90a-66b0-411d-9f49-953e73981c42"[m
[31m-            alt="Interface do painel BarberFlow com agendamentos e métricas"[m
[31m-            fill[m
[31m-            className="absolute inset-0 -z-20 h-full w-full object-cover object-right md:object-center"[m
[31m-          />[m
[32m+[m[32m          <div className="absolute inset-0 -z-20 md:hidden" suppressHydrationWarning>[m
[32m+[m[32m            <Image[m
[32m+[m[32m              suppressHydrationWarning[m
[32m+[m[32m              src="/api/site-assets/home-hero?variant=mobile"[m
[32m+[m[32m              alt="Fundo do BarberFlow (mobile)"[m
[32m+[m[32m              fill[m
[32m+[m[32m              sizes="100vw"[m
[32m+[m[32m              className="object-cover"[m
[32m+[m[32m              priority[m
[32m+[m[32m              unoptimized[m
[32m+[m[32m            />[m
[32m+[m[32m          </div>[m
[32m+[m[32m          <div className="absolute inset-0 -z-20 hidden md:block" suppressHydrationWarning>[m
[32m+[m[32m            <Image[m
[32m+[m[32m              suppressHydrationWarning[m
[32m+[m[32m              src="/api/site-assets/home-hero?variant=desktop"[m
[32m+[m[32m              alt="Fundo do BarberFlow (desktop)"[m
[32m+[m[32m              fill[m
[32m+[m[32m              sizes="100vw"[m
[32m+[m[32m              className="object-cover object-right md:object-center"[m
[32m+[m[32m              priority[m
[32m+[m[32m              unoptimized[m
[32m+[m[32m            />[m
[32m+[m[32m          </div>[m
           <div className="absolute inset-0 bg-background/75 -z-10" />[m
           <div[m
             aria-hidden="true"[m
[1mdiff --git a/src/components/icons/logo.tsx b/src/components/icons/logo.tsx[m
[1mindex 2c08798..6f856fc 100755[m
[1m--- a/src/components/icons/logo.tsx[m
[1m+++ b/src/components/icons/logo.tsx[m
[36m@@ -13,6 +13,7 @@[m [mexport function Logo(props: SVGProps<SVGSVGElement>) {[m
       strokeWidth="2"[m
       strokeLinecap="round"[m
       strokeLinejoin="round"[m
[32m+[m[32m      suppressHydrationWarning[m
       {...props}[m
     >[m
       <circle cx="6" cy="6" r="3" />[m
[1mdiff --git a/src/components/layout/admin-sidebar.tsx b/src/components/layout/admin-sidebar.tsx[m
[1mindex 5e50be6..a95ab59 100755[m
[1m--- a/src/components/layout/admin-sidebar.tsx[m
[1m+++ b/src/components/layout/admin-sidebar.tsx[m
[36m@@ -114,23 +114,26 @@[m [mexport function AdminSidebar() {[m
       });[m
   };[m
 [m
[31m-  const renderMenuItem = (item: any) => ([m
[32m+[m[32m  const renderMenuItem = (item: any) => {[m
[32m+[m[32m    const Icon = item.icon;[m
[32m+[m[32m    return ([m
     <SidebarMenuItem key={item.label}>[m
       <SidebarMenuButton asChild isActive={pathname === item.href} tooltip={{ children: item.label }}>[m
         <Link href={item.href} className="flex justify-between items-center w-full">[m
           <div className="flex items-center gap-2">[m
[31m-            <item.icon />[m
[32m+[m[32m            <Icon suppressHydrationWarning />[m
             <span>{item.label}</span>[m
           </div>[m
           {item.isPremium && barbershopData?.plan === "Básico" && ([m
             <div className="flex items-center gap-1 text-yellow-500">[m
[31m-              <Crown className="h-3 w-3" />[m
[32m+[m[32m              <Crown className="h-3 w-3" suppressHydrationWarning />[m
             </div>[m
           )}[m
         </Link>[m
       </SidebarMenuButton>[m
     </SidebarMenuItem>[m
   );[m
[32m+[m[32m  };[m
 [m
   return ([m
     <Sidebar>[m
[36m@@ -168,7 +171,7 @@[m [mexport function AdminSidebar() {[m
         <SidebarMenu>[m
           <SidebarMenuItem>[m
             <SidebarMenuButton onClick={handleSignOut} tooltip={{ children: "Sair" }}>[m
[31m-              <LogOut />[m
[32m+[m[32m              <LogOut suppressHydrationWarning />[m
               <span>Sair</span>[m
             </SidebarMenuButton>[m
           </SidebarMenuItem>[m
[1mdiff --git a/src/components/layout/header.tsx b/src/components/layout/header.tsx[m
[1mindex a4bd909..e314441 100755[m
[1m--- a/src/components/layout/header.tsx[m
[1m+++ b/src/components/layout/header.tsx[m
[36m@@ -1,4 +1,4 @@[m
[31m-[m
[32m+[m[32m﻿[m
 "use client";[m
 [m
 import Link from "next/link";[m
[36m@@ -48,8 +48,8 @@[m [mexport function Header() {[m
             <Button variant="ghost" asChild className="transition-transform duration-300 hover:scale-105">[m
               <Link href="/auth/login">Entrar</Link>[m
             </Button>[m
[31m-            <Button asChild className="bg-red-600 hover:bg-red-700 text-white transition-transform duration-300 hover:scale-105 hover:shadow-lg">[m
[31m-              <Link href="/auth/admin/register">Começar</Link>[m
[32m+[m[32m            <Button asChild className="bg-pink-600 hover:bg-pink-700 text-white transition-transform duration-300 hover:scale-105 hover:shadow-lg">[m
[32m+[m[32m              <Link href="/auth/admin/register">Comecar</Link>[m
             </Button>[m
           </nav>[m
           <Sheet>[m
[36m@@ -59,7 +59,7 @@[m [mexport function Header() {[m
                 size="icon"[m
                 className="md:hidden"[m
               >[m
[31m-                <Menu className="h-5 w-5" />[m
[32m+[m[32m                <Menu className="h-5 w-5" suppressHydrationWarning />[m
                 <span className="sr-only">Toggle Menu</span>[m
               </Button>[m
             </SheetTrigger>[m
[36m@@ -91,8 +91,8 @@[m [mexport function Header() {[m
                     <Button variant="ghost" asChild>[m
                         <Link href="/auth/login">Entrar</Link>[m
                     </Button>[m
[31m-                    <Button asChild className="bg-red-600 hover:bg-red-700 text-white">[m
[31m-                        <Link href="/auth/admin/register">Começar</Link>[m
[32m+[m[32m                    <Button asChild className="bg-pink-600 hover:bg-pink-700 text-white">[m
[32m+[m[32m                        <Link href="/auth/admin/register">Comecar</Link>[m
                     </Button>[m
                 </div>[m
               </nav>[m
[1mdiff --git a/src/components/layout/super-admin-sidebar.tsx b/src/components/layout/super-admin-sidebar.tsx[m
[1mindex 203a81f..22698fb 100755[m
[1m--- a/src/components/layout/super-admin-sidebar.tsx[m
[1m+++ b/src/components/layout/super-admin-sidebar.tsx[m
[36m@@ -18,7 +18,8 @@[m [mimport {[m
   Store,[m
   Ticket,[m
   Bell,[m
[31m-  Webhook,[m
[32m+[m[32m  Youtube,[m
[32m+[m[32m  Image as ImageIcon,[m
   LogOut,[m
 } from 'lucide-react';[m
 import { useAuth } from '@/context/AuthContext';[m
[36m@@ -53,9 +54,14 @@[m [mexport function SuperAdminSidebar() {[m
       icon: Bell,[m
     },[m
     {[m
[31m-      href: '/super-admin/dashboard/integrations',[m
[31m-      label: 'Integrações',[m
[31m-      icon: Webhook,[m
[32m+[m[32m      href: '/super-admin/dashboard/appearance',[m
[32m+[m[32m      label: 'Aparência',[m
[32m+[m[32m      icon: ImageIcon,[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      href: '/super-admin/dashboard/tutorials',[m
[32m+[m[32m      label: 'Tutoriais',[m
[32m+[m[32m      icon: Youtube,[m
     },[m
   ];[m
 [m
[1mdiff --git a/src/firebase/index.ts b/src/firebase/index.ts[m
[1mindex 11fb27e..e30a211 100755[m
[1m--- a/src/firebase/index.ts[m
[1m+++ b/src/firebase/index.ts[m
[36m@@ -60,7 +60,6 @@[m [mexport function initializeFirebase() {[m
   } catch (e: any) {[m
     // Não falhar a inicialização em caso de emulador indisponível — logs são suficientes.[m
     // Em produção esta flag não é definida.[m
[31m-    // eslint-disable-next-line no-console[m
     console.warn('Firebase emulator connection failed or not configured:', e);[m
   }[m
 [m
[1mdiff --git a/src/lib/bitsafira/api.ts b/src/lib/bitsafira/api.ts[m
[1mindex 5b66cf5..c585d95 100755[m
[1m--- a/src/lib/bitsafira/api.ts[m
[1m+++ b/src/lib/bitsafira/api.ts[m
[36m@@ -101,7 +101,19 @@[m [mexport class BitSafiraApiClient {[m
 [m
   // Deletar uma instância[m
   async deleteInstance(payload: DeleteInstancePayload): Promise<DeleteInstanceResponse> {[m
[31m-    return this.request<any>('DELETE', `/instancia/deletar`, payload);[m
[32m+[m[32m    // Documentado: DELETE /instancia/excluir com body { id }[m
[32m+[m[32m    const main = await this.request<any>('DELETE', '/instancia/excluir', payload);[m
[32m+[m[32m    if ([200, 201, 204, 404].includes(main.status || 0)) return main;[m
[32m+[m
[32m+[m[32m    // Fallbacks que já vimos em ambientes anteriores[m
[32m+[m[32m    const tryDelete = await this.request<any>('DELETE', '/instancia/deletar', payload);[m
[32m+[m[32m    if ([200, 201, 204, 404].includes(tryDelete.status || 0)) return tryDelete;[m
[32m+[m
[32m+[m[32m    const tryPost = await this.request<any>('POST', '/instancia/deletar', payload);[m
[32m+[m[32m    if ([200, 201, 204, 404].includes(tryPost.status || 0)) return tryPost;[m
[32m+[m
[32m+[m[32m    const tryExcluir = await this.request<any>('POST', '/instancia/excluir', payload);[m
[32m+[m[32m    return tryExcluir;[m
   }[m
 [m
   // Conectar/Obter QR Code para uma instância[m
[1mdiff --git a/src/lib/fetcher.ts b/src/lib/fetcher.ts[m
[1mindex f6fc6d8..5eb676f 100755[m
[1m--- a/src/lib/fetcher.ts[m
[1m+++ b/src/lib/fetcher.ts[m
[36m@@ -36,23 +36,31 @@[m [mexport async function fetchJson<T>(input: RequestInfo, init: RequestInit = {}):[m
     credentials: init.credentials ?? "omit",[m
   });[m
 [m
[32m+[m[32m  const contentType = res.headers.get("content-type") || "";[m
[32m+[m
   if (!res.ok) {[m
[31m-    const contentType = res.headers.get("content-type") || "";[m
[32m+[m[32m    if (contentType.includes("text/html")) {[m
[32m+[m[32m      throw new Error(res.statusText || `Erro ${res.status}`);[m
[32m+[m[32m    }[m
 [m
     if (contentType.includes("application/json")) {[m
       try {[m
         const data = await res.json();[m
         const message = extractErrorMessage(data);[m
[31m-        throw new Error(message || res.statusText || "Falha na requisição.");[m
[32m+[m[32m        throw new Error(message || res.statusText || "Falha na requisicao.");[m
       } catch (e: any) {[m
         if (e instanceof Error && e.message) throw e;[m
       }[m
     }[m
 [m
[31m-    const text = await res.text();[m
[31m-    throw new Error(text.trim() || res.statusText || "Falha na requisição.");[m
[32m+[m[32m    const textBody = await res.text();[m
[32m+[m[32m    const stripped = textBody.replace(/<[^>]+>/g, "").trim();[m
[32m+[m[32m    throw new Error(stripped || res.statusText || `Erro ${res.status}`);[m
   }[m
 [m
[31m-  return res.json() as Promise<T>;[m
[31m-}[m
[32m+[m[32m  if (contentType.includes("application/json")) {[m
[32m+[m[32m    return res.json() as Promise<T>;[m
[32m+[m[32m  }[m
 [m
[32m+[m[32m  return res.text() as unknown as T;[m
[32m+[m[32m}[m
[1mdiff --git a/src/lib/site-assets.ts b/src/lib/site-assets.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..1e98e86[m
[1m--- /dev/null[m
[1m+++ b/src/lib/site-assets.ts[m
[36m@@ -0,0 +1,45 @@[m
[32m+[m[32mimport fs from "fs/promises";[m
[32m+[m[32mimport path from "path";[m
[32m+[m
[32m+[m[32mexport type AssetVariant = "desktop" | "mobile";[m
[32m+[m
[32m+[m[32mexport function getUploadsDir() {[m
[32m+[m[32m  return process.env.UPLOADS_DIR[m
[32m+[m[32m    ? path.resolve(process.env.UPLOADS_DIR)[m
[32m+[m[32m    : path.join(process.cwd(), "uploads");[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport function getSiteAssetsDir() {[m
[32m+[m[32m  return path.join(getUploadsDir(), "site");[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport function getExtFromMime(mime: string) {[m
[32m+[m[32m  const m = (mime || "").toLowerCase();[m
[32m+[m[32m  if (m.includes("png")) return "png";[m
[32m+[m[32m  if (m.includes("jpeg") || m.includes("jpg")) return "jpg";[m
[32m+[m[32m  if (m.includes("webp")) return "webp";[m
[32m+[m[32m  return null;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport function getMimeFromExt(ext: string) {[m
[32m+[m[32m  const e = (ext || "").toLowerCase();[m
[32m+[m[32m  if (e === "png") return "image/png";[m
[32m+[m[32m  if (e === "jpg" || e === "jpeg") return "image/jpeg";[m
[32m+[m[32m  if (e === "webp") return "image/webp";[m
[32m+[m[32m  if (e === "svg") return "image/svg+xml";[m
[32m+[m[32m  return "application/octet-stream";[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function ensureDir(dir: string) {[m
[32m+[m[32m  await fs.mkdir(dir, { recursive: true });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport function buildHeroFileName(variant: AssetVariant, ext: string) {[m
[32m+[m[32m  const stamp = new Date().toISOString().replace(/[:.]/g, "-");[m
[32m+[m[32m  return `home-hero-${variant}-${stamp}.${ext}`;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport function safeFileName(name: string) {[m
[32m+[m[32m  return (name || "").replace(/[^a-zA-Z0-9._-]/g, "_");[m
[32m+[m[32m}[m
[32m+[m
[1mdiff --git a/src/server/db/repositories/barbershops.ts b/src/server/db/repositories/barbershops.ts[m
[1mindex 8ac493a..7888414 100755[m
[1m--- a/src/server/db/repositories/barbershops.ts[m
[1m+++ b/src/server/db/repositories/barbershops.ts[m
[36m@@ -1,4 +1,4 @@[m
[31m-import { Prisma } from "@prisma/client";[m
[32m+[m[32m﻿import { Prisma } from "@prisma/client";[m
 import prisma from "../client";[m
 import type { Barbershop, Address, OperatingHour, MessageTemplate } from "@/lib/definitions";[m
 import { slugify } from "@/lib/utils";[m
[36m@@ -12,7 +12,7 @@[m [mtype BarbershopCreateInput = {[m
   phone?: string;[m
   description?: string;[m
   ownerId?: string;[m
[31m-  plan?: "Básico" | "Premium";[m
[32m+[m[32m  plan?: "B├ísico" | "Premium";[m
   status?: "Ativa" | "Inativa";[m
   expiryDate?: Date | string | null;[m
   address?: Address;[m
[36m@@ -66,7 +66,7 @@[m [mfunction toDomain(shop: Prisma.BarbershopGetPayload<{ include: { messageTemplate[m
     phone: shop.phone ?? undefined,[m
     description: shop.description ?? undefined,[m
     ownerId: shop.ownerId ?? undefined,[m
[31m-    plan: shop.plan === "PREMIUM" ? "Premium" : "Básico",[m
[32m+[m[32m    plan: shop.plan === "PREMIUM" ? "Premium" : "B├ísico",[m
     status: shop.status as Barbershop["status"],[m
     expiryDate: shop.expiryDate?.toISOString(),[m
     address: (shop.addressJson as Address | null) ?? undefined,[m
[36m@@ -97,7 +97,7 @@[m [mexport async function createBarbershop(data: BarbershopCreateInput) {[m
   if (normalizedCpfCnpj) {[m
     const existing = await findExistingBarbershopByCpfCnpj(normalizedCpfCnpj);[m
     if (existing) {[m
[31m-      throw new Error("CPF/CNPJ já está cadastrado para outra barbearia.");[m
[32m+[m[32m      throw new Error("CPF/CNPJ j├í est├í cadastrado para outra barbearia.");[m
     }[m
   }[m
 [m
[36m@@ -135,7 +135,7 @@[m [mexport async function updateBarbershop(id: string, data: BarbershopUpdateInput)[m
   if (normalizedCpfCnpj) {[m
     const existing = await findExistingBarbershopByCpfCnpj(normalizedCpfCnpj, id);[m
     if (existing) {[m
[31m-      throw new Error("CPF/CNPJ já está cadastrado para outra barbearia.");[m
[32m+[m[32m      throw new Error("CPF/CNPJ j├í est├í cadastrado para outra barbearia.");[m
     }[m
   }[m
 [m
[36m@@ -218,3 +218,30 @@[m [mexport async function listBarbershopsByOwner(ownerId: string) {[m
 export async function deleteBarbershop(id: string) {[m
   await prisma.barbershop.delete({ where: { id } });[m
 }[m
[32m+[m
[32m+[m[32mexport async function deleteBarbershopAndData(barbershopId: string) {[m
[32m+[m[32m  await prisma.$transaction(async (tx) => {[m
[32m+[m[32m    // Things that reference barbershopId directly[m
[32m+[m[32m    await tx.whatsappmessagelog.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.webhook.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.messagetemplate.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.expense.deleteMany({ where: { barbershopId } });[m
[32m+[m
[32m+[m[32m    // Tickets/announcements have optional barbershopId, but may still block deletion[m
[32m+[m[32m    await tx.ticket.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.announcement.deleteMany({ where: { barbershopId } });[m
[32m+[m
[32m+[m[32m    // Appointments (and their join tables)[m
[32m+[m[32m    await tx.appointmentservice.deleteMany({ where: { appointment: { barbershopId } } });[m
[32m+[m[32m    await tx.whatsappmessagequeue.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.appointment.deleteMany({ where: { barbershopId } });[m
[32m+[m
[32m+[m[32m    // People/services[m
[32m+[m[32m    await tx.barber.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.client.deleteMany({ where: { barbershopId } });[m
[32m+[m[32m    await tx.service.deleteMany({ where: { barbershopId } });[m
[32m+[m
[32m+[m[32m    await tx.barbershop.delete({ where: { id: barbershopId } });[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[41m+[m
[1mdiff --git a/src/server/db/repositories/site-appearance.ts b/src/server/db/repositories/site-appearance.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..be987d4[m
[1m--- /dev/null[m
[1m+++ b/src/server/db/repositories/site-appearance.ts[m
[36m@@ -0,0 +1,26 @@[m
[32m+[m[32mimport prisma from "../client";[m
[32m+[m
[32m+[m[32mconst SINGLETON_ID = 1;[m
[32m+[m
[32m+[m[32mexport async function getSiteAppearance() {[m
[32m+[m[32m  return prisma.siteappearance.findUnique({ where: { id: SINGLETON_ID } });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function upsertSiteAppearance(data: {[m
[32m+[m[32m  homeHeroDesktopPath?: string | null;[m
[32m+[m[32m  homeHeroMobilePath?: string | null;[m
[32m+[m[32m}) {[m
[32m+[m[32m  return prisma.siteappearance.upsert({[m
[32m+[m[32m    where: { id: SINGLETON_ID },[m
[32m+[m[32m    create: {[m
[32m+[m[32m      id: SINGLETON_ID,[m
[32m+[m[32m      homeHeroDesktopPath: data.homeHeroDesktopPath ?? null,[m
[32m+[m[32m      homeHeroMobilePath: data.homeHeroMobilePath ?? null,[m
[32m+[m[32m    },[m
[32m+[m[32m    update: {[m
[32m+[m[32m      homeHeroDesktopPath: data.homeHeroDesktopPath ?? undefined,[m
[32m+[m[32m      homeHeroMobilePath: data.homeHeroMobilePath ?? undefined,[m
[32m+[m[32m    },[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[1mdiff --git a/src/server/db/repositories/tutorials.ts b/src/server/db/repositories/tutorials.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..fec5f12[m
[1m--- /dev/null[m
[1m+++ b/src/server/db/repositories/tutorials.ts[m
[36m@@ -0,0 +1,101 @@[m
[32m+[m[32mimport prisma from "../client";[m
[32m+[m
[32m+[m[32mexport type TutorialVideoInput = {[m
[32m+[m[32m  title: string;[m
[32m+[m[32m  description?: string | null;[m
[32m+[m[32m  youtubeUrl: string;[m
[32m+[m[32m  youtubeId?: string | null;[m
[32m+[m[32m  targetEmail?: string | null;[m
[32m+[m[32m  enabled?: boolean;[m
[32m+[m[32m};[m
[32m+[m
[32m+[m[32mexport function extractYoutubeId(rawUrl: string): string | null {[m
[32m+[m[32m  const value = (rawUrl || "").trim();[m
[32m+[m[32m  if (!value) return null;[m
[32m+[m
[32m+[m[32m  // If user pasted only the ID[m
[32m+[m[32m  if (/^[a-zA-Z0-9_-]{6,}$/.test(value) && !value.includes("http")) {[m
[32m+[m[32m    return value;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  try {[m
[32m+[m[32m    const url = new URL(value);[m
[32m+[m[32m    const host = url.hostname.replace(/^www\./, "");[m
[32m+[m
[32m+[m[32m    if (host === "youtu.be") {[m
[32m+[m[32m      const id = url.pathname.replace("/", "").trim();[m
[32m+[m[32m      return id || null;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if (host.endsWith("youtube.com")) {[m
[32m+[m[32m      const v = url.searchParams.get("v");[m
[32m+[m[32m      if (v) return v;[m
[32m+[m
[32m+[m[32m      const parts = url.pathname.split("/").filter(Boolean);[m
[32m+[m[32m      // /embed/:id[m
[32m+[m[32m      if (parts[0] === "embed" && parts[1]) return parts[1];[m
[32m+[m[32m      // /shorts/:id[m
[32m+[m[32m      if (parts[0] === "shorts" && parts[1]) return parts[1];[m
[32m+[m[32m      // /live/:id[m
[32m+[m[32m      if (parts[0] === "live" && parts[1]) return parts[1];[m
[32m+[m[32m    }[m
[32m+[m[32m  } catch {[m
[32m+[m[32m    // ignore[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  return null;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction normalizeEmail(email?: string | null) {[m
[32m+[m[32m  const value = (email || "").trim().toLowerCase();[m
[32m+[m[32m  return value || null;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function listTutorialVideosForEmail(email: string | null) {[m
[32m+[m[32m  const normalized = normalizeEmail(email);[m
[32m+[m[32m  return prisma.tutorialvideo.findMany({[m
[32m+[m[32m    where: {[m
[32m+[m[32m      enabled: true,[m
[32m+[m[32m      ...(normalized ? { OR: [{ targetEmail: null }, { targetEmail: normalized }] } : { targetEmail: null }),[m
[32m+[m[32m    },[m
[32m+[m[32m    orderBy: { createdAt: "desc" },[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function listAllTutorialVideos() {[m
[32m+[m[32m  return prisma.tutorialvideo.findMany({[m
[32m+[m[32m    orderBy: { createdAt: "desc" },[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function createTutorialVideo(input: TutorialVideoInput) {[m
[32m+[m[32m  return prisma.tutorialvideo.create({[m
[32m+[m[32m    data: {[m
[32m+[m[32m      title: input.title,[m
[32m+[m[32m      description: input.description ?? null,[m
[32m+[m[32m      youtubeUrl: input.youtubeUrl,[m
[32m+[m[32m      youtubeId: input.youtubeId ?? null,[m
[32m+[m[32m      targetEmail: normalizeEmail(input.targetEmail),[m
[32m+[m[32m      enabled: input.enabled ?? true,[m
[32m+[m[32m    },[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function updateTutorialVideo(id: string, input: Partial<TutorialVideoInput>) {[m
[32m+[m[32m  return prisma.tutorialvideo.update({[m
[32m+[m[32m    where: { id },[m
[32m+[m[32m    data: {[m
[32m+[m[32m      title: input.title,[m
[32m+[m[32m      description: input.description,[m
[32m+[m[32m      youtubeUrl: input.youtubeUrl,[m
[32m+[m[32m      youtubeId: input.youtubeId,[m
[32m+[m[32m      targetEmail: input.targetEmail !== undefined ? normalizeEmail(input.targetEmail) : undefined,[m
[32m+[m[32m      enabled: input.enabled,[m
[32m+[m[32m    },[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function deleteTutorialVideo(id: string) {[m
[32m+[m[32m  await prisma.tutorialvideo.delete({ where: { id } });[m
[32m+[m[32m}[m
[32m+[m
[1mdiff --git a/src/server/db/repositories/users.ts b/src/server/db/repositories/users.ts[m
[1mindex 5e9cf5c..f893a5e 100755[m
[1m--- a/src/server/db/repositories/users.ts[m
[1m+++ b/src/server/db/repositories/users.ts[m
[36m@@ -14,10 +14,20 @@[m [mexport async function findUserByEmail(email: string) {[m
   return prisma.user.findUnique({ where: { email: email.toLowerCase() } });[m
 }[m
 [m
[32m+[m[32mexport async function getUserById(id: string) {[m
[32m+[m[32m  if (!id) return null;[m
[32m+[m[32m  return prisma.user.findUnique({ where: { id } });[m
[32m+[m[32m}[m
[32m+[m
 export async function createUser(data: CreateUserInput) {[m
   const existing = await findUserByEmail(data.email);[m
   if (existing) {[m
[31m-    throw new Error("E-mail já está em uso.");[m
[32m+[m[32m    const ownedBarbershops = await prisma.barbershop.count({ where: { ownerId: existing.id } });[m
[32m+[m[32m    if (ownedBarbershops === 0) {[m
[32m+[m[32m      await prisma.user.delete({ where: { id: existing.id } });[m
[32m+[m[32m    } else {[m
[32m+[m[32m      throw new Error("E-mail já está em uso.");[m
[32m+[m[32m    }[m
   }[m
 [m
   const passwordHash = await bcrypt.hash(data.password, 12);[m
[1mdiff --git a/src/server/services/barbershop-deletion.ts b/src/server/services/barbershop-deletion.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..9cf05ec[m
[1m--- /dev/null[m
[1m+++ b/src/server/services/barbershop-deletion.ts[m
[36m@@ -0,0 +1,56 @@[m
[32m+[m[32mimport { getBitSafiraApiClient } from "@/lib/bitsafira/api";[m
[32m+[m[32mimport type { DeleteInstancePayload, DeleteInstanceResponse } from "@/lib/bitsafira/types";[m
[32m+[m[32mimport { getBarbershopById, updateBarbershop, deleteBarbershopAndData } from "@/server/db/repositories/barbershops";[m
[32m+[m
[32m+[m[32mexport async function deleteBitSafiraInstanceForBarbershop(barbershopId: string) {[m
[32m+[m[32m  const shop = await getBarbershopById(barbershopId);[m
[32m+[m[32m  if (!shop) throw new Error("Barbearia não encontrada.");[m
[32m+[m
[32m+[m[32m  const instanceId = shop.bitsafiraInstanceId || null;[m
[32m+[m[32m  if (!instanceId) {[m
[32m+[m[32m    return { deleted: false, instanceId: null, message: "Sem instância cadastrada." };[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  const bitSafiraToken = shop.bitSafiraToken || process.env.BITSAFIRA_TOKEN;[m
[32m+[m[32m  if (!bitSafiraToken) {[m
[32m+[m[32m    throw new Error("Token da BitSafira não configurado.");[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  const bitSafira = getBitSafiraApiClient(bitSafiraToken);[m
[32m+[m[32m  const deletePayload: DeleteInstancePayload = { id: instanceId };[m
[32m+[m[32m  const deleteResult: DeleteInstanceResponse = await bitSafira.deleteInstance(deletePayload);[m
[32m+[m
[32m+[m[32m  // BitSafira às vezes retorna 404 quando já está apagada; tratamos como OK.[m
[32m+[m[32m  const ok = [200, 201, 204, 404].includes(deleteResult.status || 0);[m
[32m+[m[32m  if (!ok) {[m
[32m+[m[32m    throw new Error(deleteResult.mensagem || deleteResult.message || "Falha ao excluir instância BitSafira.");[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  await updateBarbershop(barbershopId, {[m
[32m+[m[32m    bitsafiraInstanceId: null,[m
[32m+[m[32m    whatsappStatus: "DISCONNECTED",[m
[32m+[m[32m    qrCodeBase64: null,[m
[32m+[m[32m    bitsafiraInstanceData: null as any,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  return { deleted: true, instanceId, message: "Instância excluída." };[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function deleteBarbershopFully([m
[32m+[m[32m  barbershopId: string,[m
[32m+[m[32m  options?: { forceBitSafiraFailure?: boolean }[m
[32m+[m[32m) {[m
[32m+[m[32m  // First: try to delete BitSafira instance (if any) so we don't orphan instances[m
[32m+[m[32m  try {[m
[32m+[m[32m    await deleteBitSafiraInstanceForBarbershop(barbershopId);[m
[32m+[m[32m  } catch (error: any) {[m
[32m+[m[32m    if (options?.forceBitSafiraFailure) {[m
[32m+[m[32m      console.warn("Forçando exclusão mesmo com erro no BitSafira:", error?.message || error);[m
[32m+[m[32m    } else {[m
[32m+[m[32m      throw error;[m
[32m+[m[32m    }[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  // Then: wipe all data and the barbershop record[m
[32m+[m[32m  await deleteBarbershopAndData(barbershopId);[m
[32m+[m[32m}[m
[1mdiff --git a/tmp_barbershops.txt b/tmp_barbershops.txt[m
[1mnew file mode 100644[m
[1mindex 0000000..1054105[m
[1m--- /dev/null[m
[1m+++ b/tmp_barbershops.txt[m
[36m@@ -0,0 +1,975 @@[m
[32m+[m[41m[m
[32m+[m[32m'use client';[m[41m[m
[32m+[m[41m[m
[32m+[m[32mimport { useState, useMemo, useEffect, useCallback } from 'react';[m[41m[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  Card,[m[41m[m
[32m+[m[32m  CardContent,[m[41m[m
[32m+[m[32m  CardHeader,[m[41m[m
[32m+[m[32m  CardTitle,[m[41m[m
[32m+[m[32m  CardFooter,[m[41m[m
[32m+[m[32m  CardDescription[m[41m[m
[32m+[m[32m} from "@/components/ui/card";[m[41m[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  Table,[m[41m[m
[32m+[m[32m  TableBody,[m[41m[m
[32m+[m[32m  TableCell,[m[41m[m
[32m+[m[32m  TableHead,[m[41m[m
[32m+[m[32m  TableHeader,[m[41m[m
[32m+[m[32m  TableRow,[m[41m[m
[32m+[m[32m} from "@/components/ui/table";[m[41m[m
[32m+[m[32mimport { Button } from '@/components/ui/button';[m[41m[m
[32m+[m[32mimport { Input } from '@/components/ui/input';[m[41m[m
[32m+[m[32mimport { Label } from '@/components/ui/label';[m[41m[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  Dialog,[m[41m[m
[32m+[m[32m  DialogContent,[m[41m[m
[32m+[m[32m  DialogHeader,[m[41m[m
[32m+[m[32m  DialogTitle,[m[41m[m
[32m+[m[32m  DialogFooter,[m[41m[m
[32m+[m[32m  DialogClose,[m[41m[m
[32m+[m[32m  DialogTrigger,[m[41m[m
[32m+[m[32m  DialogDescription[m[41m[m
[32m+[m[32m} from "@/components/ui/dialog";[m[41m[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  AlertDialog,[m[41m[m
[32m+[m[32m  AlertDialogAction,[m[41m[m
[32m+[m[32m  AlertDialogCancel,[m[41m[m
[32m+[m[32m  AlertDialogContent,[m[41m[m
[32m+[m[32m  AlertDialogDescription,[m[41m[m
[32m+[m[32m  AlertDialogFooter,[m[41m[m
[32m+[m[32m  AlertDialogHeader,[m[41m[m
[32m+[m[32m  AlertDialogTitle,[m[41m[m
[32m+[m[32m} from "@/components/ui/alert-dialog";[m[41m[m
[32m+[m[32mimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';[m[41m[m
[32m+[m[32mimport { Badge } from '@/components/ui/badge';[m[41m[m
[32m+[m[32mimport { Checkbox } from '@/components/ui/checkbox';[m[41m[m
[32m+[m[32mimport { MapPin, Mail, Smartphone, Calendar, Edit, Search, ExternalLink, Trash2, AlertCircleIcon, FilterX, KeyRound, RefreshCw, Unplug } from 'lucide-react';[m[41m[m
[32m+[m[32mimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';[m[41m[m
[32m+[m[32mimport { Calendar as CalendarIcon } from 'lucide-react';[m[41m[m
[32m+[m[32mimport { Calendar as CalendarComponent } from '@/components/ui/calendar';[m[41m[m
[32m+[m[32mimport { format, parse, isValid, isBefore, startOfDay, addDays } from 'date-fns';[m[41m[m
[32m+[m[32mimport { useToast } from '@/hooks/use-toast';[m[41m[m
[32m+[m[32mimport { useAuth } from "@/context/AuthContext";[m[41m[m
[32m+[m[32mimport Link from 'next/link';[m[41m[m
[32m+[m[32mimport { formatCurrency, cn, capitalizeWords } from "@/lib/utils";[m[41m[m
[32m+[m[32mimport { fetchJson } from "@/lib/fetcher";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mtype SuperAdminBarbershop = {[m[41m[m
[32m+[m[32m    id: string;[m[41m[m
[32m+[m[32m    name: string;[m[41m[m
[32m+[m[32m    legalName?: string;[m[41m[m
[32m+[m[32m    cpfCnpj?: string;[m[41m[m
[32m+[m[32m    ownerId: string;[m[41m[m
[32m+[m[32m    email: string;[m[41m[m
[32m+[m[32m    phone: string;[m[41m[m
[32m+[m[32m    plan: 'B�sico' | 'Premium';[m[41m[m
[32m+[m[32m    status: 'Ativa' | 'Inativa';[m[41m[m
[32m+[m[32m    expiryDate: string;[m[41m[m
[32m+[m[32m    registeredDate: string;[m[41m[m
[32m+[m[32m    operatingHours: any[];[m[41m[m
[32m+[m[32m    bitsafiraInstanceId?: string | null;[m[41m[m
[32m+[m[32m    address: {[m[41m[m
[32m+[m[32m        street: string;[m[41m[m
[32m+[m[32m        number: string;[m[41m[m
[32m+[m[32m        complement: string;[m[41m[m
[32m+[m[32m        neighborhood: string;[m[41m[m
[32m+[m[32m        city: string;[m[41m[m
[32m+[m[32m        state: string;[m[41m[m
[32m+[m[32m        cep: string;[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[32m    fullAddressString: string;[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst planPrices = {[m[41m[m
[32m+[m[32m    'B�sico': 49.90,[m[41m[m
[32m+[m[32m    'Premium': 119.90[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mexport default function BarbershopsPage() {[m[41m[m
[32m+[m[32m    const { toast } = useToast();[m[41m[m
[32m+[m[32m    const { isLoading: isUserLoading } = useAuth();[m[41m[m
[32m+[m[32m    const [rawBarbershops, setRawBarbershops] = useState<any[]>([]);[m[41m[m
[32m+[m[32m    const [isLoadingBarbershops, setIsLoadingBarbershops] = useState(true);[m[41m[m
[32m+[m[32m    const [supportTickets, setSupportTickets] = useState<any[]>([]);[m[41m[m
[32m+[m[32m    const [isLoadingTickets, setIsLoadingTickets] = useState(true);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const loadData = useCallback(async () => {[m[41m[m
[32m+[m[32m        setIsLoadingBarbershops(true);[m[41m[m
[32m+[m[32m        setIsLoadingTickets(true);[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m            const [barbershopsResponse, ticketsResponse] = await Promise.all([[m[41m[m
[32m+[m[32m                fetchJson<{ data: any[] }>("/api/barbershops"),[m[41m[m
[32m+[m[32m                fetchJson<{ data: any[] }>("/api/tickets"),[m[41m[m
[32m+[m[32m            ]);[m[41m[m
[32m+[m[32m            setRawBarbershops(barbershopsResponse.data ?? []);[m[41m[m
[32m+[m[32m            setSupportTickets(ticketsResponse.data ?? []);[m[41m[m
[32m+[m[32m        } catch (error: any) {[m[41m[m
[32m+[m[32m            console.error("Erro ao carregar barbearias:", error);[m[41m[m
[32m+[m[32m            toast({[m[41m[m
[32m+[m[32m                variant: "destructive",[m[41m[m
[32m+[m[32m                title: "Erro ao carregar dados",[m[41m[m
[32m+[m[32m                description: error.message || "N�o foi poss�vel carregar as barbearias.",[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[32m        } finally {[m[41m[m
[32m+[m[32m            setIsLoadingBarbershops(false);[m[41m[m
[32m+[m[32m            setIsLoadingTickets(false);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    }, [toast]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    useEffect(() => {[m[41m[m
[32m+[m[32m        void loadData();[m[41m[m
[32m+[m[32m    }, [loadData]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const allBarbershops = useMemo(() => {[m[41m[m
[32m+[m[32m        if (!rawBarbershops) return [];[m[41m[m
[32m+[m[32m        return rawBarbershops.map((shop) => {[m[41m[m
[32m+[m[32m            let addressObj: SuperAdminBarbershop['address'] = { street: '', number: '', complement: '', neighborhood: '', city: '', state: '', cep: '' };[m[41m[m
[32m+[m[32m            let fullAddressString = '';[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (typeof shop.address === 'object' && shop.address !== null) {[m[41m[m
[32m+[m[32m                addressObj = { ...addressObj, ...shop.address };[m[41m[m
[32m+[m[32m                fullAddressString = `${addressObj.street || ''}, ${addressObj.number || ''}${addressObj.complement ? `, ${addressObj.complement}` : ''} - ${addressObj.neighborhood || ''}, ${addressObj.city || ''} - ${addressObj.state || ''}, ${addressObj.cep || ''}`;[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            const expiryDate = shop.expiryDate ? new Date(shop.expiryDate) : null;[m[41m[m
[32m+[m[32m            let status = shop.status || 'Inativa';[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (expiryDate && !isBefore(expiryDate, startOfDay(new Date()))) {[m[41m[m
[32m+[m[32m                status = 'Ativa';[m[41m[m
[32m+[m[32m            } else if (expiryDate && isBefore(expiryDate, startOfDay(new Date()))) {[m[41m[m
[32m+[m[32m                status = 'Inativa';[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            return {[m[41m[m
[32m+[m[32m                id: shop.id,[m[41m[m
[32m+[m[32m                name: shop.name || 'Nome n�o definido',[m[41m[m
[32m+[m[32m                legalName: shop.legalName,[m[41m[m
[32m+[m[32m                cpfCnpj: shop.cpfCnpj,[m[41m[m
[32m+[m[32m                ownerId: shop.ownerId,[m[41m[m
[32m+[m[32m                email: shop.email || 'E-mail n�o informado',[m[41m[m
[32m+[m[32m                phone: shop.phone || '(00) 00000-0000',[m[41m[m
[32m+[m[32m                plan: shop.plan || 'B�sico',[m[41m[m
[32m+[m[32m                status,[m[41m[m
[32m+[m[32m                expiryDate: expiryDate ? format(expiryDate, 'dd/MM/yyyy') : 'N/A',[m[41m[m
[32m+[m[32m                registeredDate: shop.createdAt ? format(new Date(shop.createdAt), 'dd/MM/yyyy') : 'N/A',[m[41m[m
[32m+[m[32m                operatingHours: shop.operatingHours || [],[m[41m[m
[32m+[m[32m                address: addressObj,[m[41m[m
[32m+[m[32m                fullAddressString,[m[41m[m
[32m+[m[32m                bitsafiraInstanceId: shop.bitsafiraInstanceId ?? null,[m[41m[m
[32m+[m[32m            };[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m    }, [rawBarbershops]);[m[41m[m
[32m+[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const [displayedBarbershops, setDisplayedBarbershops] = useState<SuperAdminBarbershop[]>([]);[m[41m[m
[32m+[m[32m    const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);[m[41m[m
[32m+[m[32m    const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);[m[41m[m
[32m+[m[32m    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);[m[41m[m
[32m+[m[32m    const [shopToDelete, setShopToDelete] = useState<SuperAdminBarbershop | null>(null);[m[41m[m
[32m+[m[32m    const [deleteConfirmationInput, setDeleteConfirmationInput] = useState('');[m[41m[m
[32m+[m[32m    const [forceDeleteEvenIfBitFails, setForceDeleteEvenIfBitFails] = useState(false);[m[41m[m
[32m+[m[32m    const [isDeleteInstanceDialogOpen, setIsDeleteInstanceDialogOpen] = useState(false);[m[41m[m
[32m+[m[32m    const [shopToDeleteInstance, setShopToDeleteInstance] = useState<SuperAdminBarbershop | null>(null);[m[41m[m
[32m+[m[32m    const [isDeletingInstance, setIsDeletingInstance] = useState(false);[m[41m[m
[32m+[m[32m    const [isUpdatingAll, setIsUpdatingAll] = useState(false);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const [editingShop, setEditingShop] = useState<SuperAdminBarbershop | null>(null);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const [formState, setFormState] = useState<Partial<SuperAdminBarbershop & {password?: string}>>({});[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    const [isSubmitting, setIsSubmitting] = useState(false);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const [searchTerm, setSearchTerm] = useState('');[m[41m[m
[32m+[m[32m    const [filterStatus, setFilterStatus] = useState('all');[m[41m[m
[32m+[m[32m    const [filterPlan, setFilterPlan] = useState('all');[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    useEffect(() => {[m[41m[m
[32m+[m[32m        let filtered = allBarbershops;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        if (searchTerm) {[m[41m[m
[32m+[m[32m            const lowercasedTerm = searchTerm.toLowerCase();[m[41m[m
[32m+[m[32m            filtered = filtered.filter(shop =>[m[41m [m
[32m+[m[32m                shop.name.toLowerCase().includes(lowercasedTerm) ||[m[41m[m
[32m+[m[32m                (shop.ownerId && shop.ownerId.toLowerCase().includes(lowercasedTerm)) ||[m[41m[m
[32m+[m[32m                shop.email.toLowerCase().includes(lowercasedTerm)[m[41m[m
[32m+[m[32m            );[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        if (filterStatus !== 'all') {[m[41m[m
[32m+[m[32m            filtered = filtered.filter(shop => shop.status === filterStatus);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        if (filterPlan !== 'all') {[m[41m[m
[32m+[m[32m            filtered = filtered.filter(shop => shop.plan === filterPlan);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m        [m
[32m+[m[32m        setDisplayedBarbershops(filtered);[m[41m[m
[32m+[m[32m    }, [searchTerm, filterStatus, filterPlan, allBarbershops]);[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    const watchedCep = formState.address?.cep;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    useEffect(() => {[m[41m[m
[32m+[m[32m      const fetchAddress = async () => {[m[41m[m
[32m+[m[32m        if (!isEditDialogOpen && !isAddDialogOpen) return;[m[41m[m
[32m+[m[32m        if (!watchedCep) return;[m[41m[m
[32m+[m[32m        const cleanedCep = watchedCep.replace(/\D/g, "");[m[41m[m
[32m+[m[32m        if (cleanedCep.length === 8) {[m[41m[m
[32m+[m[32m          try {[m[41m[m
[32m+[m[32m            const response = await fetch(`/api/cep/${cleanedCep}`);[m[41m[m
[32m+[m[32m            if (!response.ok) throw new Error('Network response was not ok');[m[41m[m
[32m+[m[32m            const data = await response.json();[m[41m[m
[32m+[m[32m            if (!data.error) {[m[41m[m
[32m+[m[32m              setFormState((prev) => {[m[41m[m
[32m+[m[32m                  const newAddress = {[m[41m [m
[32m+[m[32m                      ...(prev.address || {}),[m[41m [m
[32m+[m[32m                      street: data.street,[m[41m [m
[32m+[m[32m                      neighborhood: data.neighborhood,[m[41m [m
[32m+[m[32m                      city: data.city,[m[41m [m
[32m+[m[32m                      state: data.state[m[41m [m
[32m+[m[32m                  };[m[41m[m
[32m+[m[32m                  return { ...prev, address: newAddress as SuperAdminBarbershop['address'] };[m[41m[m
[32m+[m[32m              });[m[41m[m
[32m+[m[32m            } else {[m[41m[m
[32m+[m[32m                throw new Error(data.error || 'CEP n�o encontrado.');[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m          } catch (error) {[m[41m[m
[32m+[m[32m            console.error("Failed to fetch address:", error);[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro de CEP", description: "N�o foi poss�vel buscar o endere�o." });[m[41m[m
[32m+[m[32m          }[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m      };[m[41m[m
[32m+[m[32m      fetchAddress();[m[41m[m
[32m+[m[32m    }, [watchedCep, toast, isEditDialogOpen, isAddDialogOpen]);[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    const watchedCnpj = formState.cpfCnpj;[m[41m[m
[32m+[m[32m     useEffect(() => {[m[41m[m
[32m+[m[32m        const fetchCompanyData = async () => {[m[41m[m
[32m+[m[32m            if (!isAddDialogOpen && !isEditDialogOpen) return;[m[41m[m
[32m+[m[32m            if(!watchedCnpj) return;[m[41m[m
[32m+[m[32m            const cleanedCnpj = watchedCnpj.replace(/\D/g, "");[m[41m[m
[32m+[m[32m            if (cleanedCnpj.length === 14) {[m[41m[m
[32m+[m[32m                try {[m[41m[m
[32m+[m[32m                    const response = await fetch(`/api/cnpj/${cleanedCnpj}`);[m[41m[m
[32m+[m[32m                    const data = await response.json();[m[41m[m
[32m+[m[32m                    if (!data.error) {[m[41m[m
[32m+[m[32m                       setFormState(prev => ({[m[41m[m
[32m+[m[32m                           ...prev,[m[41m[m
[32m+[m[32m                           legalName: data.razao_social || prev.legalName,[m[41m[m
[32m+[m[32m                           name: data.nome_fantasia || prev.name[m[41m[m
[32m+[m[32m                       }));[m[41m[m
[32m+[m[32m                    }[m[41m[m
[32m+[m[32m                } catch (error) {[m[41m[m
[32m+[m[32m                    console.error("Failed to fetch CNPJ data:", error);[m[41m[m
[32m+[m[32m                }[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        };[m[41m[m
[32m+[m[32m        fetchCompanyData();[m[41m[m
[32m+[m[32m    }, [watchedCnpj, isAddDialogOpen, isEditDialogOpen]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleEditClick = (shop: Barbershop) => {[m[41m[m
[32m+[m[32m        setEditingShop(shop);[m[41m[m
[32m+[m[32m        setFormState({ ...shop });[m[41m[m
[32m+[m[32m        setIsEditDialogOpen(true);[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleDeleteClick = (shop: Barbershop) => {[m[41m[m
[32m+[m[32m        setShopToDelete(shop);[m[41m[m
[32m+[m[32m        setIsDeleteDialogOpen(true);[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleDeleteInstanceClick = (shop: SuperAdminBarbershop) => {[m[41m[m
[32m+[m[32m        setShopToDeleteInstance(shop);[m[41m[m
[32m+[m[32m        setIsDeleteInstanceDialogOpen(true);[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const confirmDelete = async () => {[m[41m[m
[32m+[m[32m        if (!shopToDelete) {[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: "Nenhuma barbearia selecionada para exclus�o." });[m[41m[m
[32m+[m[32m            return;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m            await fetchJson(`/api/delete-barbershop`, {[m[41m[m
[32m+[m[32m                method: "POST",[m[41m[m
[32m+[m[32m                headers: { "Content-Type": "application/json" },[m[41m[m
[32m+[m[32m                body: JSON.stringify({[m[41m[m
[32m+[m[32m                    barbershopId: shopToDelete.id,[m[41m[m
[32m+[m[32m                    forceBitSafiraFailure: forceDeleteEvenIfBitFails,[m[41m[m
[32m+[m[32m                }),[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[32m            setRawBarbershops(prev => prev!.filter(s => s.id !== shopToDelete.id));[m[41m[m
[32m+[m[32m            toast({ title: "Barbearia Exclu�da!", description: `${shopToDelete.name} foi removida do banco de dados.` });[m[41m[m
[32m+[m[32m        } catch (error: any) {[m[41m[m
[32m+[m[32m            console.error("Erro ao excluir barbearia:", error);[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro ao Excluir", description: error.message || "N�o foi poss�vel remover a barbearia do banco de dados." });[m[41m[m
[32m+[m[32m        } finally {[m[41m[m
[32m+[m[32m            setIsDeleteDialogOpen(false);[m[41m[m
[32m+[m[32m            setShopToDelete(null);[m[41m[m
[32m+[m[32m            setDeleteConfirmationInput('');[m[41m[m
[32m+[m[32m            setForceDeleteEvenIfBitFails(false);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const confirmDeleteInstance = async () => {[m[41m[m
[32m+[m[32m        if (!shopToDeleteInstance) {[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: "Nenhuma barbearia selecionada." });[m[41m[m
[32m+[m[32m            return;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        setIsDeletingInstance(true);[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m            await fetchJson(`/api/super-admin/barbershops/${shopToDeleteInstance.id}/bitsafira-instance`, { method: "DELETE" });[m[41m[m
[32m+[m[32m            setRawBarbershops((prev) =>[m[41m[m
[32m+[m[32m                (prev || []).map((s: any) =>[m[41m[m
[32m+[m[32m                    s.id === shopToDeleteInstance.id[m[41m[m
[32m+[m[32m                        ? { ...s, bitsafiraInstanceId: null, whatsappStatus: "DISCONNECTED", qrCodeBase64: null }[m[41m[m
[32m+[m[32m                        : s[m[41m[m
[32m+[m[32m                )[m[41m[m
[32m+[m[32m            );[m[41m[m
[32m+[m[32m            toast({ title: "Inst�ncia exclu�da", description: "A inst�ncia do BitSafira foi removida desta barbearia." });[m[41m[m
[32m+[m[32m        } catch (error: any) {[m[41m[m
[32m+[m[32m            console.error("Erro ao excluir inst�ncia:", error);[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: error.message || "N�o foi poss�vel excluir a inst�ncia." });[m[41m[m
[32m+[m[32m        } finally {[m[41m[m
[32m+[m[32m            setIsDeletingInstance(false);[m[41m[m
[32m+[m[32m            setIsDeleteInstanceDialogOpen(false);[m[41m[m
[32m+[m[32m            setShopToDeleteInstance(null);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m[41m[m
[32m+[m[32m        let value = e.target.value;[m[41m[m
[32m+[m[32m        value = value.replace(/\D/g, "");[m[41m[m
[32m+[m[32m        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');[m[41m[m
[32m+[m[32m        value = value.replace(/(\d{5})(\d)/, '$1-$2');[m[41m[m
[32m+[m[32m        if (value.length > 15) {[m[41m[m
[32m+[m[32m            value = value.substring(0, 15);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m        setFormState(prev => ({ ...prev, phone: value }));[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleCpfCnpjChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m[41m[m
[32m+[m[32m        let value = e.target.value;[m[41m[m
[32m+[m[32m        if (!value) {[m[41m[m
[32m+[m[32m            setFormState(prev => ({ ...prev, cpfCnpj: '' }));[m[41m[m
[32m+[m[32m            return;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m        value = value.replace(/\D/g, '');[m[41m[m
[32m+[m[32m        if (value.length <= 11) {[m[41m[m
[32m+[m[32m            value = value.replace(/(\d{3})(\d)/, '$1.$2');[m[41m[m
[32m+[m[32m            value = value.replace(/(\d{3})(\d)/, '$1.$2');[m[41m[m
[32m+[m[32m            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');[m[41m[m
[32m+[m[32m        } else {[m[41m[m
[32m+[m[32m            value = value.substring(0, 14);[m[41m[m
[32m+[m[32m            value = value.replace(/^(\d{2})(\d)/, '$1.$2');[m[41m[m
[32m+[m[32m            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');[m[41m[m
[32m+[m[32m            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');[m[41m[m
[32m+[m[32m            value = value.replace(/(\d{4})(\d)/, '$1-$2');[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m        setFormState(prev => ({ ...prev, cpfCnpj: value }));[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleAddressChange = (e: React.ChangeEvent<HTMLInputElement>) => {[m[41m[m
[32m+[m[32m        const { name, value } = e.target;[m[41m[m
[32m+[m[32m        let processedValue = value;[m[41m[m
[32m+[m[32m        if (name === 'cep') {[m[41m[m
[32m+[m[32m            processedValue = value.replace(/\D/g, "").replace(/^(\d{5})(\d)/, "$1-$2");[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m        setFormState(prev => ({[m[41m[m
[32m+[m[32m            ...prev,[m[41m[m
[32m+[m[32m            address: {[m[41m[m
[32m+[m[32m                ...prev.address!,[m[41m[m
[32m+[m[32m                [name]: processedValue,[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        }));[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleFormChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {[m[41m[m
[32m+[m[32m        const { name, value } = e.target;[m[41m[m
[32m+[m[32m         setFormState(prev => ({ ...prev, [name]: capitalizeWords(value) }));[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleSelectChange = (name: keyof Barbershop, value: string) => {[m[41m[m
[32m+[m[32m        setFormState(prev => ({ ...prev, [name]: value }));[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleDateChange = (date: Date | undefined) => {[m[41m[m
[32m+[m[32m        if (date) {[m[41m[m
[32m+[m[32m            setFormState(prev => ({ ...prev, expiryDate: format(date, 'dd/MM/yyyy') }));[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleSave = async () => {[m[41m[m
[32m+[m[32m        if (!editingShop) {[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: "Nenhuma barbearia selecionada." });[m[41m[m
[32m+[m[32m            return;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m            const updateData: Record<string, unknown> = {[m[41m[m
[32m+[m[32m                name: formState.name,[m[41m[m
[32m+[m[32m                legalName: formState.legalName,[m[41m[m
[32m+[m[32m                cpfCnpj: formState.cpfCnpj,[m[41m[m
[32m+[m[32m                address: formState.address,[m[41m[m
[32m+[m[32m                phone: formState.phone,[m[41m[m
[32m+[m[32m                plan: formState.plan,[m[41m[m
[32m+[m[32m                status: formState.status,[m[41m[m
[32m+[m[32m            };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (formState.email) {[m[41m[m
[32m+[m[32m                updateData.email = formState.email;[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (formState.expiryDate) {[m[41m[m
[32m+[m[32m                const parsedDate = parse(formState.expiryDate, 'dd/MM/yyyy', new Date());[m[41m[m
[32m+[m[32m                if (isValid(parsedDate)) {[m[41m[m
[32m+[m[32m                    updateData.expiryDate = parsedDate.toISOString();[m[41m[m
[32m+[m[32m                }[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            const response = await fetchJson<{ data: any }>(`/api/barbershops/${editingShop.id}`, {[m[41m[m
[32m+[m[32m                method: "PATCH",[m[41m[m
[32m+[m[32m                headers: { "Content-Type": "application/json" },[m[41m[m
[32m+[m[32m                body: JSON.stringify(updateData),[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            const updatedShop = response.data;[m[41m[m
[32m+[m[32m            setRawBarbershops(prev => prev!.map(s => (s.id === updatedShop.id ? updatedShop : s)));[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (barbershopDocRef) {[m[41m[m
[32m+[m[32m                await updateDoc(barbershopDocRef, updateData as Record<string, any>);[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            toast({ title: "Dados da Barbearia Salvos!", description: "As informa��es no banco de dados foram atualizadas." });[m[41m[m
[32m+[m[32m            if (typeof window !== "undefined") {[m[41m[m
[32m+[m[32m                const barbershopUpdatePayload = { ...updatedShop, ownerId: updatedShop.ownerId };[m[41m[m
[32m+[m[32m                window.dispatchEvent(new CustomEvent("barbershop-updated", { detail: barbershopUpdatePayload }));[m[41m[m
[32m+[m[32m                try {[m[41m[m
[32m+[m[32m                    window.localStorage.setItem([m[41m[m
[32m+[m[32m                        "barbershop-updated",[m[41m[m
[32m+[m[32m                        JSON.stringify({ ...barbershopUpdatePayload, timestamp: Date.now() })[m[41m[m
[32m+[m[32m                    );[m[41m[m
[32m+[m[32m                } catch (error) {[m[41m[m
[32m+[m[32m                    console.warn("N�o foi poss�vel sincronizar a atualiza��o entre abas:", error);[m[41m[m
[32m+[m[32m                }[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        } catch (error: any) {[m[41m[m
[32m+[m[32m            console.error("Erro ao atualizar barbearia:", error);[m[41m[m
[32m+[m[32m            toast({[m[41m[m
[32m+[m[32m                variant: "destructive",[m[41m[m
[32m+[m[32m                title: "Erro ao Salvar",[m[41m[m
[32m+[m[32m                description: error.message || "N�o foi poss�vel atualizar os dados da barbearia.",[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[32m        } finally {[m[41m[m
[32m+[m[32m            setIsEditDialogOpen(false);[m[41m[m
[32m+[m[32m            setEditingShop(null);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    const handleCreate = async () => {[m[41m[m
[32m+[m[32m        if (!formState.email || !formState.password || !formState.name) {[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro", description: "Email, senha e nome da barbearia s�o obrigat�rios." });[m[41m[m
[32m+[m[32m            return;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m        setIsSubmitting(true);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        try {[m[41m[m
[32m+[m[32m            const registerResponse = await fetchJson<{ data: { id: string } }>("/api/auth/register", {[m[41m[m
[32m+[m[32m                method: "POST",[m[41m[m
[32m+[m[32m                headers: { "Content-Type": "application/json" },[m[41m[m
[32m+[m[32m                body: JSON.stringify({[m[41m[m
[32m+[m[32m                    email: formState.email,[m[41m[m
[32m+[m[32m                    password: formState.password,[m[41m[m
[32m+[m[32m                    name: formState.name,[m[41m[m
[32m+[m[32m                    phone: formState.phone,[m[41m[m
[32m+[m[32m                    role: "ADMIN",[m[41m[m
[32m+[m[32m                }),[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            const ownerId = registerResponse.data.id;[m[41m[m
[32m+[m[32m            const trialEndDate = addDays(new Date(), 7);[m[41m[m
[32m+[m[32m            const createResponse = await fetchJson<{ data: any }>("/api/barbershops", {[m[41m[m
[32m+[m[32m                method: "POST",[m[41m[m
[32m+[m[32m                headers: { "Content-Type": "application/json" },[m[41m[m
[32m+[m[32m                body: JSON.stringify({[m[41m[m
[32m+[m[32m                    name: formState.name,[m[41m[m
[32m+[m[32m                    legalName: formState.legalName,[m[41m[m
[32m+[m[32m                    email: formState.email,[m[41m[m
[32m+[m[32m                    address: formState.address,[m[41m[m
[32m+[m[32m                    phone: formState.phone,[m[41m[m
[32m+[m[32m                    cpfCnpj: formState.cpfCnpj,[m[41m[m
[32m+[m[32m                    ownerId,[m[41m[m
[32m+[m[32m                    plan: formState.plan || "B�sico",[m[41m[m
[32m+[m[32m                    status: "Ativa",[m[41m[m
[32m+[m[32m                    expiryDate: trialEndDate.toISOString(),[m[41m[m
[32m+[m[32m                }),[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            const createdShop = createResponse.data;[m[41m[m
[32m+[m[32m            setRawBarbershops(prev => [...(prev || []), createdShop]);[m[41m[m
[32m+[m[32m            toast({ title: "Barbearia Criada!", description: `${formState.name} foi adicionada com sucesso.` });[m[41m[m
[32m+[m[32m            setIsAddDialogOpen(false);[m[41m[m
[32m+[m[32m            setFormState({});[m[41m[m
[32m+[m[32m            await loadData();[m[41m[m
[32m+[m[32m        } catch (error: any) {[m[41m[m
[32m+[m[32m            console.error("Erro ao criar barbearia:", error);[m[41m[m
[32m+[m[32m            const baseDescription = error.message?.includes("in use")[m[41m[m
[32m+[m[32m                ? "Este e-mail j� est� em uso por outro propriet�rio."[m[41m[m
[32m+[m[32m                : "Ocorreu um erro ao criar a barbearia.";[m[41m[m
[32m+[m[32m            toast({ variant: "destructive", title: "Erro no Cadastro", description: baseDescription });[m[41m[m
[32m+[m[32m        } finally {[m[41m[m
[32m+[m[32m            setIsSubmitting(false);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const handleClearFilters = () => {[m[41m[m
[32m+[m[32m        setSearchTerm('');[m[41m[m
[32m+[m[32m        setFilterStatus('all');[m[41m[m
[32m+[m[32m        setFilterPlan('all');[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    // const handleUpdateAllBarbershops = async () => {[m[41m[m
[32m+[m[32m    //     // This function is no longer needed with the removal of API keys from the barbershop doc.[m[41m[m
[32m+[m[32m    //     toast({ title: "A��o Descontinuada", description: "Esta fun��o n�o � mais necess�ria." });[m[41m[m
[32m+[m[32m    // };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const getGoogleMapsLink = (address: Barbershop['address']) => {[m[41m[m
[32m+[m[32m        const fullAddress = `${address.street}, ${address.number}, ${address.city}, ${address.state}`;[m[41m[m
[32m+[m[32m        return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(fullAddress)}`;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    const getWhatsAppLink = (phone: string) => {[m[41m[m
[32m+[m[32m        const cleanedPhone = phone.replace(/\D/g, '');[m[41m[m
[32m+[m[32m        return `https://wa.me/55${cleanedPhone}`;[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    if (isUserLoading || isLoadingBarbershops) {[m[41m[m
[32m+[m[32m        return <div className="p-8">Carregando dados...</div>[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[41m    [m
[32m+[m[32m    return ([m[41m[m
[32m+[m[32m        <div className="flex-1 space-y-6 p-4 md:p-8 pt-6">[m[41m[m
[32m+[m[32m            <Card>[m[41m[m
[32m+[m[32m                <CardHeader>[m[41m[m
[32m+[m[32m                    <div className="flex justify-between items-center">[m[41m[m
[32m+[m[32m                        <div>[m[41m[m
[32m+[m[32m                            <CardTitle>Gerenciar Barbearias</CardTitle>[m[41m[m
[32m+[m[32m                            <CardDescription>Visualize e edite todos os dados das barbearias cadastradas ({displayedBarbershops.length} de {allBarbershops.length})</CardDescription>[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                         <Dialog open={isAddDialogOpen} onOpenChange={(isOpen) => { if (!isOpen) setFormState({}); setIsAddDialogOpen(isOpen); }}>[m[41m[m
[32m+[m[32m                            <DialogTrigger asChild>[m[41m[m
[32m+[m[32m                                <Button size="sm"><PlusCircle className="mr-2 h-4 w-4" /> Nova Barbearia</Button>[m[41m[m
[32m+[m[32m                            </DialogTrigger>[m[41m[m
[32m+[m[32m                            <DialogContent className="sm:max-w-3xl">[m[41m[m
[32m+[m[32m                                <DialogHeader>[m[41m[m
[32m+[m[32m                                    <DialogTitle>Cadastrar Nova Barbearia</DialogTitle>[m[41m[m
[32m+[m[32m                                </DialogHeader>[m[41m[m
[32m+[m[32m                                <div className="grid gap-4 py-4 max-h-[70vh] overflow-y-auto px-2">[m[41m[m
[32m+[m[32m                                    <div className="grid gap-4">[m[41m[m
[32m+[m[32m                                         <div className="space-y-2">[m[41m[m
[32m+[m[32m                                            <Label htmlFor="add-email">Email do Propriet�rio</Label>[m[41m[m
[32m+[m[32m                                            <Input id="add-email" name="email" type="email" value={formState.email || ''} onChange={(e) => setFormState(prev => ({...prev, email: e.target.value}))} />[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                         <div className="space-y-2">[m[41m[m
[32m+[m[32m                                            <Label htmlFor="add-password">Senha Provis�ria</Label>[m[41m[m
[32m+[m[32m                                            <Input id="add-password" name="password" type="password" value={formState.password || ''} onChange={(e) => setFormState(prev => ({...prev, password: e.target.value}))} />[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                        <div className="space-y-2">[m[41m[m
[32m+[m[32m                                            <Label htmlFor="add-name">Nome da Barbearia</Label>[m[41m[m
[32m+[m[32m                                            <Input id="add-name" name="name" value={formState.name || ''} onChange={handleFormChange} />[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                        <div className="space-y-2">[m[41m[m
[32m+[m[32m                                            <Label htmlFor="add-cpfCnpj">CPF/CNPJ</Label>[m[41m[m
[32m+[m[32m                                            <Input id="add-cpfCnpj" name="cpfCnpj" value={formState.cpfCnpj || ''} onChange={handleCpfCnpjChange} />[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                         <div className="space-y-2">[m[41m[m
[32m+[m[32m                                            <Label htmlFor="add-legalName">Nome/Empresa (Raz�o Social)</Label>[m[41m[m
[32m+[m[32m                                            <Input id="add-legalName" name="legalName" value={formState.legalName || ''} onChange={handleFormChange} />[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                        <div className="grid grid-cols-3 gap-4">[m[41m[m
[32m+[m[32m                                            <div className="space-y-2 col-span-1">[m[41m[m
[32m+[m[32m                                                <Label htmlFor="add-cep">CEP</Label>[m[41m[m
[32m+[m[32m                                                <Input id="add-cep" name="cep" value={formState.address?.cep || ''} onChange={handleAddressChange} maxLength={9} />[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                            <div className="space-y-2 col-span-2">[m[41m[m
[32m+[m[32m                                                <Label htmlFor="add-street">Rua</Label>[m[41m[m
[32m+[m[32m                                                <Input id="add-street" name="street" value={formState.address?.street || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                         <div className="grid grid-cols-3 gap-4">[m[41m[m
[32m+[m[32m                                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                                <Label htmlFor="add-number">N�mero</Label>[m[41m[m
[32m+[m[32m                                                <Input id="add-number" name="number" value={formState.address?.number || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                            <div className="space-y-2 col-span-2">[m[41m[m
[32m+[m[32m                                                <Label htmlFor="add-neighborhood">Bairro</Label>[m[41m[m
[32m+[m[32m                                                <Input id="add-neighborhood" name="neighborhood" value={formState.address?.neighborhood || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                        <div className="grid grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                                <Label htmlFor="add-city">Cidade</Label>[m[41m[m
[32m+[m[32m                                                <Input id="add-city" name="city" value={formState.address?.city || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                                <Label htmlFor="add-state">Estado (UF)</Label>[m[41m[m
[32m+[m[32m                                                <Input id="add-state" name="state" value={formState.address?.state || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                         <div className="space-y-2">[m[41m[m
[32m+[m[32m                                            <Label htmlFor="add-phone">WhatsApp do Propriet�rio</Label>[m[41m[m
[32m+[m[32m                                            <Input id="add-phone" name="phone" value={formState.phone || ''} onChange={handlePhoneChange} maxLength={15} />[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <DialogFooter>[m[41m[m
[32m+[m[32m                                    <DialogClose asChild>[m[41m[m
[32m+[m[32m                                        <Button variant="outline">Cancelar</Button>[m[41m[m
[32m+[m[32m                                    </DialogClose>[m[41m[m
[32m+[m[32m                                    <Button onClick={handleCreate} disabled={isSubmitting}>[m[41m[m
[32m+[m[32m                                        {isSubmitting ? 'Cadastrando...' : 'Salvar Barbearia'}[m[41m[m
[32m+[m[32m                                    </Button>[m[41m[m
[32m+[m[32m                                </DialogFooter>[m[41m[m
[32m+[m[32m                            </DialogContent>[m[41m[m
[32m+[m[32m                        </Dialog>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                    <div className="flex flex-wrap items-center gap-4 pt-4">[m[41m[m
[32m+[m[32m                        <div className="relative flex-grow min-w-[200px]">[m[41m[m
[32m+[m[32m                           <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />[m[41m[m
[32m+[m[32m                           <Input placeholder="Buscar por nome, ID ou email..." className="pl-10" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                        <Select value={filterStatus} onValueChange={setFilterStatus}>[m[41m[m
[32m+[m[32m                            <SelectTrigger className="w-full sm:w-[180px]">[m[41m[m
[32m+[m[32m                                <SelectValue placeholder="Todos os Status" />[m[41m[m
[32m+[m[32m                            </SelectTrigger>[m[41m[m
[32m+[m[32m                            <SelectContent>[m[41m[m
[32m+[m[32m                                <SelectItem value="all">Todos os Status</SelectItem>[m[41m[m
[32m+[m[32m                                <SelectItem value="Ativa">Ativa</SelectItem>[m[41m[m
[32m+[m[32m                                <SelectItem value="Inativa">Inativa</SelectItem>[m[41m[m
[32m+[m[32m                            </SelectContent>[m[41m[m
[32m+[m[32m                        </Select>[m[41m[m
[32m+[m[32m                         <Select value={filterPlan} onValueChange={setFilterPlan}>[m[41m[m
[32m+[m[32m                            <SelectTrigger className="w-full sm:w-[180px]">[m[41m[m
[32m+[m[32m                                <SelectValue placeholder="Todos os Planos" />[m[41m[m
[32m+[m[32m                            </SelectTrigger>[m[41m[m
[32m+[m[32m                            <SelectContent>[m[41m[m
[32m+[m[32m                                <SelectItem value="all">Todos os Planos</SelectItem>[m[41m[m
[32m+[m[32m                                <SelectItem value="B�sico">B�sico</SelectItem>[m[41m[m
[32m+[m[32m                                <SelectItem value="Premium">Premium</SelectItem>[m[41m[m
[32m+[m[32m                            </SelectContent>[m[41m[m
[32m+[m[32m                        </Select>[m[41m[m
[32m+[m[32m                        <div className="flex gap-2">[m[41m[m
[32m+[m[32m                           <Button variant="ghost" onClick={handleClearFilters}><FilterX className="mr-2 h-4 w-4"/>Limpar</Button>[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                </CardHeader>[m[41m[m
[32m+[m[32m                <CardContent className="space-y-4">[m[41m[m
[32m+[m[32m                    {displayedBarbershops.map(shop => ([m[41m[m
[32m+[m[32m                        <div key={shop.id} className="border border-primary/50 rounded-lg p-4 space-y-4">[m[41m[m
[32m+[m[32m                             <div className="flex items-start justify-between">[m[41m[m
[32m+[m[32m                                <div className="flex items-start gap-4">[m[41m[m
[32m+[m[32m                                    <span className="font-mono text-sm text-muted-foreground pt-1">{shop.ownerId?.substring(0, 6)}...</span>[m[41m[m
[32m+[m[32m                                    <div>[m[41m[m
[32m+[m[32m                                      <h3 className="font-bold text-lg">{shop.name}</h3>[m[41m[m
[32m+[m[32m                                      <p className="text-sm text-muted-foreground">{shop.legalName} - {shop.cpfCnpj}</p>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">[m[41m[m
[32m+[m[32m                                <div className="space-y-3">[m[41m[m
[32m+[m[32m                                    <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                        <MapPin className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                        <div className="flex-1">[m[41m[m
[32m+[m[32m                                            <p className="text-sm font-medium">Endere�o</p>[m[41m[m
[32m+[m[32m                                            <div className="flex justify-between items-center">[m[41m[m
[32m+[m[32m                                                <p className="text-sm text-muted-foreground">{shop.fullAddressString}</p>[m[41m[m
[32m+[m[32m                                                <Button variant="link" size="sm" asChild className="p-0 h-auto">[m[41m[m
[32m+[m[32m                                                    <Link href={getGoogleMapsLink(shop.address)} target="_blank" rel="noopener noreferrer">[m[41m[m
[32m+[m[32m                                                        Ver[m[41m[m
[32m+[m[32m                                                    </Link>[m[41m[m
[32m+[m[32m                                                </Button>[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                    <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                        <Mail className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                        <div>[m[41m[m
[32m+[m[32m                                            <p className="text-sm font-medium">Email do Propriet�rio</p>[m[41m[m
[32m+[m[32m                                            <p className="text-sm text-muted-foreground">{shop.email}</p>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                <Smartphone className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                <div className="flex-1">[m[41m[m
[32m+[m[32m                                    <p className="text-sm font-medium">WhatsApp do Propriet�rio</p>[m[41m[m
[32m+[m[32m                                    <div className="flex justify-between items-center">[m[41m[m
[32m+[m[32m                                        <p className="text-sm text-muted-foreground">{shop.phone}</p>[m[41m[m
[32m+[m[32m                                        <Button variant="link" size="sm" asChild className="p-0 h-auto text-green-500 hover:text-green-500/90">[m[41m[m
[32m+[m[32m                                            <Link href={getWhatsAppLink(shop.phone)} target="_blank" rel="noopener noreferrer">[m[41m[m
[32m+[m[32m                                                WhatsApp[m[41m[m
[32m+[m[32m                                            </Link>[m[41m[m
[32m+[m[32m                                        </Button>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                <Unplug className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                <div className="flex-1">[m[41m[m
[32m+[m[32m                                    <p className="text-sm font-medium">Inst�ncia BitSafira</p>[m[41m[m
[32m+[m[32m                                    <p className="text-sm text-muted-foreground">[m[41m[m
[32m+[m[32m                                        {shop.bitsafiraInstanceId ? shop.bitsafiraInstanceId : 'Nenhuma inst�ncia vinculada'}[m[41m[m
[32m+[m[32m                                    </p>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-3">[m[41m[m
[32m+[m[32m                                     <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                        <div>[m[41m[m
[32m+[m[32m                                            <p className="text-sm font-medium">Plano</p>[m[41m[m
[32m+[m[32m                                            <div className="flex items-center gap-2">[m[41m[m
[32m+[m[32m                                                <p className="text-sm text-muted-foreground font-semibold">[m[41m[m
[32m+[m[32m                                                  {shop.plan}[m[41m[m
[32m+[m[32m                                                </p>[m[41m[m
[32m+[m[32m                                                <Badge variant={shop.status === 'Ativa' ? 'default' : 'destructive'} className={shop.status === 'Ativa' ? 'bg-green-500/20 text-green-500 border-green-500/30' : ''}>{shop.status}</Badge>[m[41m[m
[32m+[m[32m                                            </div>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                    <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                        <div>[m[41m[m
[32m+[m[32m                                            <p className="text-sm font-medium">Data de Vencimento</p>[m[41m[m
[32m+[m[32m                                            <p className="text-sm text-muted-foreground">{shop.expiryDate}</p>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                    <div className="flex items-start gap-3">[m[41m[m
[32m+[m[32m                                        <Calendar className="h-4 w-4 mt-1 text-muted-foreground"/>[m[41m[m
[32m+[m[32m                                        <div>[m[41m[m
[32m+[m[32m                                            <p className="text-sm font-medium">Cadastrado em</p>[m[41m[m
[32m+[m[32m                                            <p className="text-sm text-muted-foreground">{shop.registeredDate}</p>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <CardFooter className="p-0 pt-4 flex justify-end gap-2">[m[41m[m
[32m+[m[32m                                {shop.bitsafiraInstanceId ? ([m[41m[m
[32m+[m[32m                                    <Button variant="outline" onClick={() => handleDeleteInstanceClick(shop)}>[m[41m[m
[32m+[m[32m                                        <Unplug className="mr-2 h-4 w-4" /> Excluir Inst�ncia[m[41m[m
[32m+[m[32m                                    </Button>[m[41m[m
[32m+[m[32m                                ) : null}[m[41m[m
[32m+[m[32m                                <Button variant="outline" onClick={() => handleEditClick(shop)}><Edit className="mr-2 h-4 w-4"/> Editar</Button>[m[41m[m
[32m+[m[32m                                <Button variant="destructive" onClick={() => handleDeleteClick(shop)}><Trash2 className="mr-2 h-4 w-4"/> Excluir</Button>[m[41m[m
[32m+[m[32m                            </CardFooter>[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                    ))}[m[41m[m
[32m+[m[32m                </CardContent>[m[41m[m
[32m+[m[32m            </Card>[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>[m[41m[m
[32m+[m[32m                <DialogContent className="sm:max-w-3xl">[m[41m[m
[32m+[m[32m                    <DialogHeader>[m[41m[m
[32m+[m[32m                        <DialogTitle>Editar Barbearia</DialogTitle>[m[41m[m
[32m+[m[32m                        <DialogDescription>[m[41m[m
[32m+[m[32m                            Atualize os dados da barbearia {editingShop?.name} (C�digo: {editingShop?.ownerId})[m[41m[m
[32m+[m[32m                        </DialogDescription>[m[41m[m
[32m+[m[32m                    </DialogHeader>[m[41m[m
[32m+[m[32m                    <div className="grid gap-4 py-4 max-h-[70vh] overflow-y-auto px-2">[m[41m[m
[32m+[m[32m                        <div className="grid gap-4">[m[41m[m
[32m+[m[32m                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                <Label htmlFor="name">Nome da Barbearia</Label>[m[41m[m
[32m+[m[32m                                <Input id="name" name="name" value={formState.name || ''} onChange={handleFormChange} />[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                <Label htmlFor="legalName">Nome/Empresa (Raz�o Social)</Label>[m[41m[m
[32m+[m[32m                                <Input id="legalName" name="legalName" value={formState.legalName || ''} onChange={handleFormChange} />[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                <Label htmlFor="cpfCnpj">CPF/CNPJ</Label>[m[41m[m
[32m+[m[32m                                <Input id="cpfCnpj" name="cpfCnpj" value={formState.cpfCnpj || ''} onChange={handleCpfCnpjChange} />[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="grid grid-cols-3 gap-4">[m[41m[m
[32m+[m[32m                               <div className="space-y-2 col-span-1">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="cep">CEP</Label>[m[41m[m
[32m+[m[32m                                    <Input id="cep" name="cep" value={formState.address?.cep || ''} onChange={handleAddressChange} maxLength={9} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-2 col-span-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="street">Rua</Label>[m[41m[m
[32m+[m[32m                                    <Input id="street" name="street" value={formState.address?.street || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                             <div className="grid grid-cols-3 gap-4">[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="number">N�mero</Label>[m[41m[m
[32m+[m[32m                                    <Input id="number" name="number" value={formState.address?.number || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-2 col-span-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="neighborhood">Bairro</Label>[m[41m[m
[32m+[m[32m                                    <Input id="neighborhood" name="neighborhood" value={formState.address?.neighborhood || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="grid grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="city">Cidade</Label>[m[41m[m
[32m+[m[32m                                    <Input id="city" name="city" value={formState.address?.city || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="state">Estado (UF)</Label>[m[41m[m
[32m+[m[32m                                    <Input id="state" name="state" value={formState.address?.state || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="space-y-2">[m[41m[m
[32m+[m[32m                                <Label htmlFor="complement">Complemento</Label>[m[41m[m
[32m+[m[32m                                <Input id="complement" name="complement" value={formState.address?.complement || ''} onChange={handleAddressChange} />[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="grid grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="email">Email do Propriet�rio</Label>[m[41m[m
[32m+[m[32m                                    <Input id="email" name="email" type="email" value={formState.email || ''} onChange={handleFormChange} disabled />[m[41m[m
[32m+[m[32m                                    <div className="flex items-start gap-2 p-2 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-300">[m[41m[m
[32m+[m[32m                                        <AlertCircleIcon className="h-4 w-4 mt-0.5 shrink-0" />[m[41m[m
[32m+[m[32m                                        <div className='text-xs'>[m[41m[m
[32m+[m[32m                                            <p>A altera��o do e-mail de login deve ser feita diretamente no Firebase Console para garantir a seguran�a.</p>[m[41m[m
[32m+[m[32m                                        </div>[m[41m[m
[32m+[m[32m                                    </div>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label htmlFor="phone">WhatsApp do Propriet�rio</Label>[m[41m[m
[32m+[m[32m                                    <Input id="phone" name="phone" value={formState.phone || ''} onChange={handlePhoneChange} maxLength={15} />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            <div className="grid grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label>Status da Assinatura</Label>[m[41m[m
[32m+[m[32m                                    <Select value={formState.status} onValueChange={(value) => handleSelectChange('status' as keyof Barbershop, value)}>[m[41m[m
[32m+[m[32m                                        <SelectTrigger>[m[41m[m
[32m+[m[32m                                            <SelectValue placeholder="Selecione o status" />[m[41m[m
[32m+[m[32m                                        </SelectTrigger>[m[41m[m
[32m+[m[32m                                        <SelectContent>[m[41m[m
[32m+[m[32m                                            <SelectItem value="Ativa">Ativa</SelectItem>[m[41m[m
[32m+[m[32m                                            <SelectItem value="Inativa">Inativa</SelectItem>[m[41m[m
[32m+[m[32m                                        </SelectContent>[m[41m[m
[32m+[m[32m                                    </Select>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label>Plano</Label>[m[41m[m
[32m+[m[32m                                    <Select[m[41m [m
[32m+[m[32m                                        value={formState.plan}[m[41m [m
[32m+[m[32m                                        onValueChange={(value) => handleSelectChange('plan' as keyof Barbershop, value as 'B�sico' | 'Premium')}[m[41m[m
[32m+[m[32m                                        disabled={formState.status === 'Inativa'}[m[41m[m
[32m+[m[32m                                    >[m[41m[m
[32m+[m[32m                                        <SelectTrigger>[m[41m[m
[32m+[m[32m                                            <SelectValue placeholder="Selecione o plano" />[m[41m[m
[32m+[m[32m                                        </SelectTrigger>[m[41m[m
[32m+[m[32m                                        <SelectContent>[m[41m[m
[32m+[m[32m                                            <SelectItem value="B�sico">B�sico</SelectItem>[m[41m[m
[32m+[m[32m                                            <SelectItem value="Premium">Premium</SelectItem>[m[41m[m
[32m+[m[32m                                        </SelectContent>[m[41m[m
[32m+[m[32m                                    </Select>[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            {formState.plan && formState.status === 'Ativa' && ([m[41m[m
[32m+[m[32m                            <div className="grid grid-cols-2 gap-4">[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                    <Label>Valor do Plano (R$)</Label>[m[41m[m
[32m+[m[32m                                    <Input value={formatCurrency(planPrices[formState.plan as keyof typeof planPrices])} readOnly disabled />[m[41m[m
[32m+[m[32m                                </div>[m[41m[m
[32m+[m[32m                                <div className="space-y-2">[m[41m[m
[32m+[m[32m                                <Label>Data de Vencimento do Plano</Label>[m[41m[m
[32m+[m[32m                                <Popover>[m[41m[m
[32m+[m[32m                                    <PopoverTrigger asChild>[m[41m[m
[32m+[m[32m                                        <Button[m[41m[m
[32m+[m[32m                                            variant={"outline"}[m[41m[m
[32m+[m[32m                                            className="w-full justify-start text-left font-normal"[m[41m[m
[32m+[m[32m                                        >[m[41m[m
[32m+[m[32m                                            <CalendarIcon className="mr-2 h-4 w-4" />[m[41m[m
[32m+[m[32m                                            {formState.expiryDate ? formState.expiryDate : <span>Selecione uma data</span>}[m[41m[m
[32m+[m[32m                                        </Button>[m[41m[m
[32m+[m[32m                                    </PopoverTrigger>[m[41m[m
[32m+[m[32m                                    <PopoverContent className="w-auto p-0">[m[41m[m
[32m+[m[32m                                        <CalendarComponent[m[41m[m
[32m+[m[32m                                            mode="single"[m[41m[m
[32m+[m[32m                                            selected={formState.expiryDate ? parse(formState.expiryDate, 'dd/MM/yyyy', new Date()) : undefined}[m[41m[m
[32m+[m[32m                                            onSelect={handleDateChange}[m[41m[m
[32m+[m[32m                                            initialFocus[m[41m[m
[32m+[m[32m                                        />[m[41m[m
[32m+[m[32m                                    </PopoverContent>[m[41m[m
[32m+[m[32m                                </Popover>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            </div>[m[41m[m
[32m+[m[32m                            )}[m[41m[m
[32m+[m[32m                        </div>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                    <DialogFooter>[m[41m[m
[32m+[m[32m                        <DialogClose asChild>[m[41m[m
[32m+[m[32m                            <Button variant="outline">Cancelar</Button>[m[41m[m
[32m+[m[32m                        </DialogClose>[m[41m[m
[32m+[m[32m                        <Button onClick={handleSave}>Salvar Altera��es</Button>[m[41m[m
[32m+[m[32m                    </DialogFooter>[m[41m[m
[32m+[m[32m                </DialogContent>[m[41m[m
[32m+[m[32m            </Dialog>[m[41m[m
[32m+[m[32m            <AlertDialog open={isDeleteInstanceDialogOpen} onOpenChange={(isOpen) => { setIsDeleteInstanceDialogOpen(isOpen); if (!isOpen) setShopToDeleteInstance(null); }}>[m[41m[m
[32m+[m[32m                <AlertDialogContent>[m[41m[m
[32m+[m[32m                    <AlertDialogHeader>[m[41m[m
[32m+[m[32m                        <AlertDialogTitle>Excluir inst�ncia do BitSafira?</AlertDialogTitle>[m[41m[m
[32m+[m[32m                        <AlertDialogDescription>[m[41m[m
[32m+[m[32m                            Isso vai remover a inst�ncia do WhatsApp desta barbearia no BitSafira (desconecta e limpa o QR/ID).[m[41m[m
[32m+[m[32m                            <span className="block mt-2">A barbearia continuar� existindo, mas precisar� reconectar o WhatsApp.</span>[m[41m[m
[32m+[m[32m                        </AlertDialogDescription>[m[41m[m
[32m+[m[32m                    </AlertDialogHeader>[m[41m[m
[32m+[m[32m                    <AlertDialogFooter>[m[41m[m
[32m+[m[32m                        <AlertDialogCancel disabled={isDeletingInstance}>Cancelar</AlertDialogCancel>[m[41m[m
[32m+[m[32m                        <AlertDialogAction[m[41m[m
[32m+[m[32m                            onClick={confirmDeleteInstance}[m[41m[m
[32m+[m[32m                            disabled={isDeletingInstance}[m[41m[m
[32m+[m[32m                            className="bg-destructive hover:bg-destructive/90"[m[41m[m
[32m+[m[32m                        >[m[41m[m
[32m+[m[32m                            {isDeletingInstance ? "Excluindo..." : "Sim, excluir inst�ncia"}[m[41m[m
[32m+[m[32m                        </AlertDialogAction>[m[41m[m
[32m+[m[32m                    </AlertDialogFooter>[m[41m[m
[32m+[m[32m                </AlertDialogContent>[m[41m[m
[32m+[m[32m            </AlertDialog>[m[41m[m
[32m+[m[32m            <AlertDialog open={isDeleteDialogOpen} onOpenChange={(isOpen) => { if (!isOpen) { setDeleteConfirmationInput(''); setForceDeleteEvenIfBitFails(false); } setIsDeleteDialogOpen(isOpen);}}>[m[41m[m
[32m+[m[32m                <AlertDialogContent>[m[41m[m
[32m+[m[32m                    <AlertDialogHeader>[m[41m[m
[32m+[m[32m                        <AlertDialogTitle>Voc� tem certeza absoluta?</AlertDialogTitle>[m[41m[m
[32m+[m[32m                        <AlertDialogDescription>[m[41m[m
[32m+[m[32m                            Esta a��o � <span className="font-bold text-destructive">irrevers�vel</span> e excluir� permanentemente a barbearia <span className='font-bold'>{shopToDelete?.name}</span> do banco de dados,[m[41m[m
[32m+[m[32m                            apagando tamb�m todos os dados relacionados (clientes, servi�os, agenda, WhatsApp) e tentando excluir a inst�ncia do BitSafira quando existir. O usu�rio de autentica��o permanecer�.[m[41m[m
[32m+[m[32m                        </AlertDialogDescription>[m[41m[m
[32m+[m[32m                    <div className="space-y-2 pt-2">[m[41m[m
[32m+[m[32m                        <Label htmlFor="delete-confirm">Para confirmar, digite "<span className="font-bold">excluir</span>" abaixo:</Label>[m[41m[m
[32m+[m[32m                        <Input[m[41m[m
[32m+[m[32m                            id="delete-confirm"[m[41m[m
[32m+[m[32m                            value={deleteConfirmationInput}[m[41m[m
[32m+[m[32m                            onChange={(e) => setDeleteConfirmationInput(e.target.value)}[m[41m[m
[32m+[m[32m                        />[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                    <div className="flex items-center gap-2 pt-2">[m[41m[m
[32m+[m[32m                        <Checkbox[m[41m[m
[32m+[m[32m                            id="force-delete-bit-safira"[m[41m[m
[32m+[m[32m                            checked={forceDeleteEvenIfBitFails}[m[41m[m
[32m+[m[32m                            onCheckedChange={setForceDeleteEvenIfBitFails}[m[41m[m
[32m+[m[32m                        />[m[41m[m
[32m+[m[32m                        <Label htmlFor="force-delete-bit-safira" className="mb-0">[m[41m[m
[32m+[m[32m                            For�ar exclus�o mesmo se o BitSafira falhar[m[41m[m
[32m+[m[32m                        </Label>[m[41m[m
[32m+[m[32m                    </div>[m[41m[m
[32m+[m[32m                    </AlertDialogHeader>[m[41m[m
[32m+[m[32m                    <AlertDialogFooter>[m[41m[m
[32m+[m[32m                        <AlertDialogCancel>Cancelar</AlertDialogCancel>[m[41m[m
[32m+[m[32m                        <AlertDialogAction[m[41m [m
[32m+[m[32m                            onClick={confirmDelete}[m[41m [m
[32m+[m[32m                            disabled={deleteConfirmationInput !== 'excluir'}[m[41m[m
[32m+[m[32m                            className="bg-destructive hover:bg-destructive/90"[m[41m[m
[32m+[m[32m                        >[m[41m[m
[32m+[m[32m                            Sim, Excluir do Banco de Dados[m[41m[m
[32m+[m[32m                        </AlertDialogAction>[m[41m[m
[32m+[m[32m                    </AlertDialogFooter>[m[41m[m
[32m+[m[32m                </AlertDialogContent>[m[41m[m
[32m+[m[32m            </AlertDialog>[m[41m[m
[32m+[m[32m        </div>[m[41m[m
[32m+[m[32m    );[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[41m[m
[1mdiff --git a/tsconfig.json b/tsconfig.json[m
[1mindex db3ed1d..f0ef775 100755[m
[1m--- a/tsconfig.json[m
[1m+++ b/tsconfig.json[m
[36m@@ -1,7 +1,11 @@[m
 {[m
   "compilerOptions": {[m
     "target": "ES2017",[m
[31m-    "lib": ["dom", "dom.iterable", "es2017"],[m
[32m+[m[32m    "lib": [[m
[32m+[m[32m      "dom",[m
[32m+[m[32m      "dom.iterable",[m
[32m+[m[32m      "es2017"[m
[32m+[m[32m    ],[m
     "allowJs": true,[m
     "skipLibCheck": true,[m
     "strict": true,[m
[36m@@ -11,7 +15,7 @@[m
     "moduleResolution": "bundler",[m
     "resolveJsonModule": true,[m
     "isolatedModules": true,[m
[31m-    "jsx": "preserve",[m
[32m+[m[32m    "jsx": "react-jsx",[m
     "incremental": true,[m
     "plugins": [[m
       {[m
[36m@@ -19,12 +23,27 @@[m
       }[m
     ],[m
     "paths": {[m
[31m-      "@/*": ["./src/*"][m
[32m+[m[32m      "@/*": [[m
[32m+[m[32m        "./src/*"[m
[32m+[m[32m      ][m
     },[m
     // CORREÇÃO AQUI: Adicionar typeRoots e types[m
[31m-    "typeRoots": ["./node_modules/@types", "./types"], // Onde procurar por @types[m
[31m-    "types": ["node"] // Incluir apenas os tipos que você realmente usa implicitamente[m
[32m+[m[32m    "typeRoots": [[m
[32m+[m[32m      "./node_modules/@types",[m
[32m+[m[32m      "./types"[m
[32m+[m[32m    ], // Onde procurar por @types[m
[32m+[m[32m    "types": [[m
[32m+[m[32m      "node"[m
[32m+[m[32m    ] // Incluir apenas os tipos que você realmente usa implicitamente[m
   },[m
[31m-  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],[m
[31m-  "exclude": ["node_modules"][m
[32m+[m[32m  "include": [[m
[32m+[m[32m    "next-env.d.ts",[m
[32m+[m[32m    "**/*.ts",[m
[32m+[m[32m    "**/*.tsx",[m
[32m+[m[32m    ".next/types/**/*.ts",[m
[32m+[m[32m    ".next/dev/types/**/*.ts"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "exclude": [[m
[32m+[m[32m    "node_modules"[m
[32m+[m[32m  ][m
 }[m
